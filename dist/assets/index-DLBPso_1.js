(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const o of a.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function n(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerPolicy&&(a.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?a.credentials="include":s.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function r(s){if(s.ep)return;s.ep=!0;const a=n(s);fetch(s.href,a)}})();function c_(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Jy={exports:{}},wc={},Zy={exports:{}},ge={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Qa=Symbol.for("react.element"),u_=Symbol.for("react.portal"),d_=Symbol.for("react.fragment"),h_=Symbol.for("react.strict_mode"),m_=Symbol.for("react.profiler"),f_=Symbol.for("react.provider"),p_=Symbol.for("react.context"),g_=Symbol.for("react.forward_ref"),y_=Symbol.for("react.suspense"),x_=Symbol.for("react.memo"),v_=Symbol.for("react.lazy"),bp=Symbol.iterator;function b_(t){return t===null||typeof t!="object"?null:(t=bp&&t[bp]||t["@@iterator"],typeof t=="function"?t:null)}var e0={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},t0=Object.assign,n0={};function wi(t,e,n){this.props=t,this.context=e,this.refs=n0,this.updater=n||e0}wi.prototype.isReactComponent={};wi.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};wi.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function r0(){}r0.prototype=wi.prototype;function kh(t,e,n){this.props=t,this.context=e,this.refs=n0,this.updater=n||e0}var Ph=kh.prototype=new r0;Ph.constructor=kh;t0(Ph,wi.prototype);Ph.isPureReactComponent=!0;var wp=Array.isArray,s0=Object.prototype.hasOwnProperty,Rh={current:null},i0={key:!0,ref:!0,__self:!0,__source:!0};function a0(t,e,n){var r,s={},a=null,o=null;if(e!=null)for(r in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(a=""+e.key),e)s0.call(e,r)&&!i0.hasOwnProperty(r)&&(s[r]=e[r]);var c=arguments.length-2;if(c===1)s.children=n;else if(1<c){for(var u=Array(c),d=0;d<c;d++)u[d]=arguments[d+2];s.children=u}if(t&&t.defaultProps)for(r in c=t.defaultProps,c)s[r]===void 0&&(s[r]=c[r]);return{$$typeof:Qa,type:t,key:a,ref:o,props:s,_owner:Rh.current}}function w_(t,e){return{$$typeof:Qa,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function Dh(t){return typeof t=="object"&&t!==null&&t.$$typeof===Qa}function __(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var _p=/\/+/g;function Iu(t,e){return typeof t=="object"&&t!==null&&t.key!=null?__(""+t.key):e.toString(36)}function al(t,e,n,r,s){var a=typeof t;(a==="undefined"||a==="boolean")&&(t=null);var o=!1;if(t===null)o=!0;else switch(a){case"string":case"number":o=!0;break;case"object":switch(t.$$typeof){case Qa:case u_:o=!0}}if(o)return o=t,s=s(o),t=r===""?"."+Iu(o,0):r,wp(s)?(n="",t!=null&&(n=t.replace(_p,"$&/")+"/"),al(s,e,n,"",function(d){return d})):s!=null&&(Dh(s)&&(s=w_(s,n+(!s.key||o&&o.key===s.key?"":(""+s.key).replace(_p,"$&/")+"/")+t)),e.push(s)),1;if(o=0,r=r===""?".":r+":",wp(t))for(var c=0;c<t.length;c++){a=t[c];var u=r+Iu(a,c);o+=al(a,e,n,u,s)}else if(u=b_(t),typeof u=="function")for(t=u.call(t),c=0;!(a=t.next()).done;)a=a.value,u=r+Iu(a,c++),o+=al(a,e,n,u,s);else if(a==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function Lo(t,e,n){if(t==null)return t;var r=[],s=0;return al(t,r,"","",function(a){return e.call(n,a,s++)}),r}function N_(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var It={current:null},ol={transition:null},E_={ReactCurrentDispatcher:It,ReactCurrentBatchConfig:ol,ReactCurrentOwner:Rh};function o0(){throw Error("act(...) is not supported in production builds of React.")}ge.Children={map:Lo,forEach:function(t,e,n){Lo(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return Lo(t,function(){e++}),e},toArray:function(t){return Lo(t,function(e){return e})||[]},only:function(t){if(!Dh(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};ge.Component=wi;ge.Fragment=d_;ge.Profiler=m_;ge.PureComponent=kh;ge.StrictMode=h_;ge.Suspense=y_;ge.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=E_;ge.act=o0;ge.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var r=t0({},t.props),s=t.key,a=t.ref,o=t._owner;if(e!=null){if(e.ref!==void 0&&(a=e.ref,o=Rh.current),e.key!==void 0&&(s=""+e.key),t.type&&t.type.defaultProps)var c=t.type.defaultProps;for(u in e)s0.call(e,u)&&!i0.hasOwnProperty(u)&&(r[u]=e[u]===void 0&&c!==void 0?c[u]:e[u])}var u=arguments.length-2;if(u===1)r.children=n;else if(1<u){c=Array(u);for(var d=0;d<u;d++)c[d]=arguments[d+2];r.children=c}return{$$typeof:Qa,type:t.type,key:s,ref:a,props:r,_owner:o}};ge.createContext=function(t){return t={$$typeof:p_,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:f_,_context:t},t.Consumer=t};ge.createElement=a0;ge.createFactory=function(t){var e=a0.bind(null,t);return e.type=t,e};ge.createRef=function(){return{current:null}};ge.forwardRef=function(t){return{$$typeof:g_,render:t}};ge.isValidElement=Dh;ge.lazy=function(t){return{$$typeof:v_,_payload:{_status:-1,_result:t},_init:N_}};ge.memo=function(t,e){return{$$typeof:x_,type:t,compare:e===void 0?null:e}};ge.startTransition=function(t){var e=ol.transition;ol.transition={};try{t()}finally{ol.transition=e}};ge.unstable_act=o0;ge.useCallback=function(t,e){return It.current.useCallback(t,e)};ge.useContext=function(t){return It.current.useContext(t)};ge.useDebugValue=function(){};ge.useDeferredValue=function(t){return It.current.useDeferredValue(t)};ge.useEffect=function(t,e){return It.current.useEffect(t,e)};ge.useId=function(){return It.current.useId()};ge.useImperativeHandle=function(t,e,n){return It.current.useImperativeHandle(t,e,n)};ge.useInsertionEffect=function(t,e){return It.current.useInsertionEffect(t,e)};ge.useLayoutEffect=function(t,e){return It.current.useLayoutEffect(t,e)};ge.useMemo=function(t,e){return It.current.useMemo(t,e)};ge.useReducer=function(t,e,n){return It.current.useReducer(t,e,n)};ge.useRef=function(t){return It.current.useRef(t)};ge.useState=function(t){return It.current.useState(t)};ge.useSyncExternalStore=function(t,e,n){return It.current.useSyncExternalStore(t,e,n)};ge.useTransition=function(){return It.current.useTransition()};ge.version="18.3.1";Zy.exports=ge;var V=Zy.exports;const T_=c_(V);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var j_=V,S_=Symbol.for("react.element"),C_=Symbol.for("react.fragment"),I_=Object.prototype.hasOwnProperty,A_=j_.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,k_={key:!0,ref:!0,__self:!0,__source:!0};function l0(t,e,n){var r,s={},a=null,o=null;n!==void 0&&(a=""+n),e.key!==void 0&&(a=""+e.key),e.ref!==void 0&&(o=e.ref);for(r in e)I_.call(e,r)&&!k_.hasOwnProperty(r)&&(s[r]=e[r]);if(t&&t.defaultProps)for(r in e=t.defaultProps,e)s[r]===void 0&&(s[r]=e[r]);return{$$typeof:S_,type:t,key:a,ref:o,props:s,_owner:A_.current}}wc.Fragment=C_;wc.jsx=l0;wc.jsxs=l0;Jy.exports=wc;var i=Jy.exports,md={},c0={exports:{}},Kt={},u0={exports:{}},d0={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(M,W){var U=M.length;M.push(W);e:for(;0<U;){var Q=U-1>>>1,P=M[Q];if(0<s(P,W))M[Q]=W,M[U]=P,U=Q;else break e}}function n(M){return M.length===0?null:M[0]}function r(M){if(M.length===0)return null;var W=M[0],U=M.pop();if(U!==W){M[0]=U;e:for(var Q=0,P=M.length,H=P>>>1;Q<H;){var R=2*(Q+1)-1,K=M[R],Y=R+1,ne=M[Y];if(0>s(K,U))Y<P&&0>s(ne,K)?(M[Q]=ne,M[Y]=U,Q=Y):(M[Q]=K,M[R]=U,Q=R);else if(Y<P&&0>s(ne,U))M[Q]=ne,M[Y]=U,Q=Y;else break e}}return W}function s(M,W){var U=M.sortIndex-W.sortIndex;return U!==0?U:M.id-W.id}if(typeof performance=="object"&&typeof performance.now=="function"){var a=performance;t.unstable_now=function(){return a.now()}}else{var o=Date,c=o.now();t.unstable_now=function(){return o.now()-c}}var u=[],d=[],m=1,y=null,g=3,x=!1,C=!1,E=!1,A=typeof setTimeout=="function"?setTimeout:null,N=typeof clearTimeout=="function"?clearTimeout:null,T=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function k(M){for(var W=n(d);W!==null;){if(W.callback===null)r(d);else if(W.startTime<=M)r(d),W.sortIndex=W.expirationTime,e(u,W);else break;W=n(d)}}function L(M){if(E=!1,k(M),!C)if(n(u)!==null)C=!0,F(q);else{var W=n(d);W!==null&&O(L,W.startTime-M)}}function q(M,W){C=!1,E&&(E=!1,N(v),v=-1),x=!0;var U=g;try{for(k(W),y=n(u);y!==null&&(!(y.expirationTime>W)||M&&!I());){var Q=y.callback;if(typeof Q=="function"){y.callback=null,g=y.priorityLevel;var P=Q(y.expirationTime<=W);W=t.unstable_now(),typeof P=="function"?y.callback=P:y===n(u)&&r(u),k(W)}else r(u);y=n(u)}if(y!==null)var H=!0;else{var R=n(d);R!==null&&O(L,R.startTime-W),H=!1}return H}finally{y=null,g=U,x=!1}}var z=!1,j=null,v=-1,S=5,p=-1;function I(){return!(t.unstable_now()-p<S)}function b(){if(j!==null){var M=t.unstable_now();p=M;var W=!0;try{W=j(!0,M)}finally{W?_():(z=!1,j=null)}}else z=!1}var _;if(typeof T=="function")_=function(){T(b)};else if(typeof MessageChannel<"u"){var $=new MessageChannel,D=$.port2;$.port1.onmessage=b,_=function(){D.postMessage(null)}}else _=function(){A(b,0)};function F(M){j=M,z||(z=!0,_())}function O(M,W){v=A(function(){M(t.unstable_now())},W)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(M){M.callback=null},t.unstable_continueExecution=function(){C||x||(C=!0,F(q))},t.unstable_forceFrameRate=function(M){0>M||125<M?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):S=0<M?Math.floor(1e3/M):5},t.unstable_getCurrentPriorityLevel=function(){return g},t.unstable_getFirstCallbackNode=function(){return n(u)},t.unstable_next=function(M){switch(g){case 1:case 2:case 3:var W=3;break;default:W=g}var U=g;g=W;try{return M()}finally{g=U}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(M,W){switch(M){case 1:case 2:case 3:case 4:case 5:break;default:M=3}var U=g;g=M;try{return W()}finally{g=U}},t.unstable_scheduleCallback=function(M,W,U){var Q=t.unstable_now();switch(typeof U=="object"&&U!==null?(U=U.delay,U=typeof U=="number"&&0<U?Q+U:Q):U=Q,M){case 1:var P=-1;break;case 2:P=250;break;case 5:P=1073741823;break;case 4:P=1e4;break;default:P=5e3}return P=U+P,M={id:m++,callback:W,priorityLevel:M,startTime:U,expirationTime:P,sortIndex:-1},U>Q?(M.sortIndex=U,e(d,M),n(u)===null&&M===n(d)&&(E?(N(v),v=-1):E=!0,O(L,U-Q))):(M.sortIndex=P,e(u,M),C||x||(C=!0,F(q))),M},t.unstable_shouldYield=I,t.unstable_wrapCallback=function(M){var W=g;return function(){var U=g;g=W;try{return M.apply(this,arguments)}finally{g=U}}}})(d0);u0.exports=d0;var P_=u0.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var R_=V,Wt=P_;function Z(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var h0=new Set,_a={};function bs(t,e){si(t,e),si(t+"Capture",e)}function si(t,e){for(_a[t]=e,t=0;t<e.length;t++)h0.add(e[t])}var Kn=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),fd=Object.prototype.hasOwnProperty,D_=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Np={},Ep={};function M_(t){return fd.call(Ep,t)?!0:fd.call(Np,t)?!1:D_.test(t)?Ep[t]=!0:(Np[t]=!0,!1)}function O_(t,e,n,r){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return r?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function L_(t,e,n,r){if(e===null||typeof e>"u"||O_(t,e,n,r))return!0;if(r)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function At(t,e,n,r,s,a,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=r,this.attributeNamespace=s,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=a,this.removeEmptyString=o}var dt={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){dt[t]=new At(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];dt[e]=new At(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){dt[t]=new At(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){dt[t]=new At(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){dt[t]=new At(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){dt[t]=new At(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){dt[t]=new At(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){dt[t]=new At(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){dt[t]=new At(t,5,!1,t.toLowerCase(),null,!1,!1)});var Mh=/[\-:]([a-z])/g;function Oh(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(Mh,Oh);dt[e]=new At(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(Mh,Oh);dt[e]=new At(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(Mh,Oh);dt[e]=new At(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){dt[t]=new At(t,1,!1,t.toLowerCase(),null,!1,!1)});dt.xlinkHref=new At("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){dt[t]=new At(t,1,!1,t.toLowerCase(),null,!0,!0)});function Lh(t,e,n,r){var s=dt.hasOwnProperty(e)?dt[e]:null;(s!==null?s.type!==0:r||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(L_(e,n,s,r)&&(n=null),r||s===null?M_(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):s.mustUseProperty?t[s.propertyName]=n===null?s.type===3?!1:"":n:(e=s.attributeName,r=s.attributeNamespace,n===null?t.removeAttribute(e):(s=s.type,n=s===3||s===4&&n===!0?"":""+n,r?t.setAttributeNS(r,e,n):t.setAttribute(e,n))))}var ir=R_.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Vo=Symbol.for("react.element"),Ds=Symbol.for("react.portal"),Ms=Symbol.for("react.fragment"),Vh=Symbol.for("react.strict_mode"),pd=Symbol.for("react.profiler"),m0=Symbol.for("react.provider"),f0=Symbol.for("react.context"),Fh=Symbol.for("react.forward_ref"),gd=Symbol.for("react.suspense"),yd=Symbol.for("react.suspense_list"),Uh=Symbol.for("react.memo"),mr=Symbol.for("react.lazy"),p0=Symbol.for("react.offscreen"),Tp=Symbol.iterator;function zi(t){return t===null||typeof t!="object"?null:(t=Tp&&t[Tp]||t["@@iterator"],typeof t=="function"?t:null)}var Ue=Object.assign,Au;function Ji(t){if(Au===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);Au=e&&e[1]||""}return`
`+Au+t}var ku=!1;function Pu(t,e){if(!t||ku)return"";ku=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(d){var r=d}Reflect.construct(t,[],e)}else{try{e.call()}catch(d){r=d}t.call(e.prototype)}else{try{throw Error()}catch(d){r=d}t()}}catch(d){if(d&&r&&typeof d.stack=="string"){for(var s=d.stack.split(`
`),a=r.stack.split(`
`),o=s.length-1,c=a.length-1;1<=o&&0<=c&&s[o]!==a[c];)c--;for(;1<=o&&0<=c;o--,c--)if(s[o]!==a[c]){if(o!==1||c!==1)do if(o--,c--,0>c||s[o]!==a[c]){var u=`
`+s[o].replace(" at new "," at ");return t.displayName&&u.includes("<anonymous>")&&(u=u.replace("<anonymous>",t.displayName)),u}while(1<=o&&0<=c);break}}}finally{ku=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?Ji(t):""}function V_(t){switch(t.tag){case 5:return Ji(t.type);case 16:return Ji("Lazy");case 13:return Ji("Suspense");case 19:return Ji("SuspenseList");case 0:case 2:case 15:return t=Pu(t.type,!1),t;case 11:return t=Pu(t.type.render,!1),t;case 1:return t=Pu(t.type,!0),t;default:return""}}function xd(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case Ms:return"Fragment";case Ds:return"Portal";case pd:return"Profiler";case Vh:return"StrictMode";case gd:return"Suspense";case yd:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case f0:return(t.displayName||"Context")+".Consumer";case m0:return(t._context.displayName||"Context")+".Provider";case Fh:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case Uh:return e=t.displayName||null,e!==null?e:xd(t.type)||"Memo";case mr:e=t._payload,t=t._init;try{return xd(t(e))}catch{}}return null}function F_(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return xd(e);case 8:return e===Vh?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function Or(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function g0(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function U_(t){var e=g0(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),r=""+t[e];if(!t.hasOwnProperty(e)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var s=n.get,a=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return s.call(this)},set:function(o){r=""+o,a.call(this,o)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(o){r=""+o},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function Fo(t){t._valueTracker||(t._valueTracker=U_(t))}function y0(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),r="";return t&&(r=g0(t)?t.checked?"true":"false":t.value),t=r,t!==n?(e.setValue(t),!0):!1}function Cl(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function vd(t,e){var n=e.checked;return Ue({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??t._wrapperState.initialChecked})}function jp(t,e){var n=e.defaultValue==null?"":e.defaultValue,r=e.checked!=null?e.checked:e.defaultChecked;n=Or(e.value!=null?e.value:n),t._wrapperState={initialChecked:r,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function x0(t,e){e=e.checked,e!=null&&Lh(t,"checked",e,!1)}function bd(t,e){x0(t,e);var n=Or(e.value),r=e.type;if(n!=null)r==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(r==="submit"||r==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?wd(t,e.type,n):e.hasOwnProperty("defaultValue")&&wd(t,e.type,Or(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function Sp(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!(r!=="submit"&&r!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function wd(t,e,n){(e!=="number"||Cl(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var Zi=Array.isArray;function Ws(t,e,n,r){if(t=t.options,e){e={};for(var s=0;s<n.length;s++)e["$"+n[s]]=!0;for(n=0;n<t.length;n++)s=e.hasOwnProperty("$"+t[n].value),t[n].selected!==s&&(t[n].selected=s),s&&r&&(t[n].defaultSelected=!0)}else{for(n=""+Or(n),e=null,s=0;s<t.length;s++){if(t[s].value===n){t[s].selected=!0,r&&(t[s].defaultSelected=!0);return}e!==null||t[s].disabled||(e=t[s])}e!==null&&(e.selected=!0)}}function _d(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(Z(91));return Ue({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function Cp(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(Z(92));if(Zi(n)){if(1<n.length)throw Error(Z(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:Or(n)}}function v0(t,e){var n=Or(e.value),r=Or(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),r!=null&&(t.defaultValue=""+r)}function Ip(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function b0(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Nd(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?b0(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var Uo,w0=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,n,r,s){MSApp.execUnsafeLocalFunction(function(){return t(e,n,r,s)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(Uo=Uo||document.createElement("div"),Uo.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=Uo.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function Na(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var la={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},B_=["Webkit","ms","Moz","O"];Object.keys(la).forEach(function(t){B_.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),la[e]=la[t]})});function _0(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||la.hasOwnProperty(t)&&la[t]?(""+e).trim():e+"px"}function N0(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var r=n.indexOf("--")===0,s=_0(n,e[n],r);n==="float"&&(n="cssFloat"),r?t.setProperty(n,s):t[n]=s}}var $_=Ue({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Ed(t,e){if(e){if($_[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(Z(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(Z(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(Z(61))}if(e.style!=null&&typeof e.style!="object")throw Error(Z(62))}}function Td(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var jd=null;function Bh(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var Sd=null,Ks=null,Qs=null;function Ap(t){if(t=Ja(t)){if(typeof Sd!="function")throw Error(Z(280));var e=t.stateNode;e&&(e=jc(e),Sd(t.stateNode,t.type,e))}}function E0(t){Ks?Qs?Qs.push(t):Qs=[t]:Ks=t}function T0(){if(Ks){var t=Ks,e=Qs;if(Qs=Ks=null,Ap(t),e)for(t=0;t<e.length;t++)Ap(e[t])}}function j0(t,e){return t(e)}function S0(){}var Ru=!1;function C0(t,e,n){if(Ru)return t(e,n);Ru=!0;try{return j0(t,e,n)}finally{Ru=!1,(Ks!==null||Qs!==null)&&(S0(),T0())}}function Ea(t,e){var n=t.stateNode;if(n===null)return null;var r=jc(n);if(r===null)return null;n=r[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(t=t.type,r=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!r;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(Z(231,e,typeof n));return n}var Cd=!1;if(Kn)try{var qi={};Object.defineProperty(qi,"passive",{get:function(){Cd=!0}}),window.addEventListener("test",qi,qi),window.removeEventListener("test",qi,qi)}catch{Cd=!1}function z_(t,e,n,r,s,a,o,c,u){var d=Array.prototype.slice.call(arguments,3);try{e.apply(n,d)}catch(m){this.onError(m)}}var ca=!1,Il=null,Al=!1,Id=null,q_={onError:function(t){ca=!0,Il=t}};function H_(t,e,n,r,s,a,o,c,u){ca=!1,Il=null,z_.apply(q_,arguments)}function G_(t,e,n,r,s,a,o,c,u){if(H_.apply(this,arguments),ca){if(ca){var d=Il;ca=!1,Il=null}else throw Error(Z(198));Al||(Al=!0,Id=d)}}function ws(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function I0(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function kp(t){if(ws(t)!==t)throw Error(Z(188))}function W_(t){var e=t.alternate;if(!e){if(e=ws(t),e===null)throw Error(Z(188));return e!==t?null:t}for(var n=t,r=e;;){var s=n.return;if(s===null)break;var a=s.alternate;if(a===null){if(r=s.return,r!==null){n=r;continue}break}if(s.child===a.child){for(a=s.child;a;){if(a===n)return kp(s),t;if(a===r)return kp(s),e;a=a.sibling}throw Error(Z(188))}if(n.return!==r.return)n=s,r=a;else{for(var o=!1,c=s.child;c;){if(c===n){o=!0,n=s,r=a;break}if(c===r){o=!0,r=s,n=a;break}c=c.sibling}if(!o){for(c=a.child;c;){if(c===n){o=!0,n=a,r=s;break}if(c===r){o=!0,r=a,n=s;break}c=c.sibling}if(!o)throw Error(Z(189))}}if(n.alternate!==r)throw Error(Z(190))}if(n.tag!==3)throw Error(Z(188));return n.stateNode.current===n?t:e}function A0(t){return t=W_(t),t!==null?k0(t):null}function k0(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=k0(t);if(e!==null)return e;t=t.sibling}return null}var P0=Wt.unstable_scheduleCallback,Pp=Wt.unstable_cancelCallback,K_=Wt.unstable_shouldYield,Q_=Wt.unstable_requestPaint,We=Wt.unstable_now,Y_=Wt.unstable_getCurrentPriorityLevel,$h=Wt.unstable_ImmediatePriority,R0=Wt.unstable_UserBlockingPriority,kl=Wt.unstable_NormalPriority,X_=Wt.unstable_LowPriority,D0=Wt.unstable_IdlePriority,_c=null,_n=null;function J_(t){if(_n&&typeof _n.onCommitFiberRoot=="function")try{_n.onCommitFiberRoot(_c,t,void 0,(t.current.flags&128)===128)}catch{}}var mn=Math.clz32?Math.clz32:tN,Z_=Math.log,eN=Math.LN2;function tN(t){return t>>>=0,t===0?32:31-(Z_(t)/eN|0)|0}var Bo=64,$o=4194304;function ea(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function Pl(t,e){var n=t.pendingLanes;if(n===0)return 0;var r=0,s=t.suspendedLanes,a=t.pingedLanes,o=n&268435455;if(o!==0){var c=o&~s;c!==0?r=ea(c):(a&=o,a!==0&&(r=ea(a)))}else o=n&~s,o!==0?r=ea(o):a!==0&&(r=ea(a));if(r===0)return 0;if(e!==0&&e!==r&&!(e&s)&&(s=r&-r,a=e&-e,s>=a||s===16&&(a&4194240)!==0))return e;if(r&4&&(r|=n&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=r;0<e;)n=31-mn(e),s=1<<n,r|=t[n],e&=~s;return r}function nN(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function rN(t,e){for(var n=t.suspendedLanes,r=t.pingedLanes,s=t.expirationTimes,a=t.pendingLanes;0<a;){var o=31-mn(a),c=1<<o,u=s[o];u===-1?(!(c&n)||c&r)&&(s[o]=nN(c,e)):u<=e&&(t.expiredLanes|=c),a&=~c}}function Ad(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function M0(){var t=Bo;return Bo<<=1,!(Bo&4194240)&&(Bo=64),t}function Du(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function Ya(t,e,n){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-mn(e),t[e]=n}function sN(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var r=t.eventTimes;for(t=t.expirationTimes;0<n;){var s=31-mn(n),a=1<<s;e[s]=0,r[s]=-1,t[s]=-1,n&=~a}}function zh(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var r=31-mn(n),s=1<<r;s&e|t[r]&e&&(t[r]|=e),n&=~s}}var Te=0;function O0(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var L0,qh,V0,F0,U0,kd=!1,zo=[],Er=null,Tr=null,jr=null,Ta=new Map,ja=new Map,pr=[],iN="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Rp(t,e){switch(t){case"focusin":case"focusout":Er=null;break;case"dragenter":case"dragleave":Tr=null;break;case"mouseover":case"mouseout":jr=null;break;case"pointerover":case"pointerout":Ta.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":ja.delete(e.pointerId)}}function Hi(t,e,n,r,s,a){return t===null||t.nativeEvent!==a?(t={blockedOn:e,domEventName:n,eventSystemFlags:r,nativeEvent:a,targetContainers:[s]},e!==null&&(e=Ja(e),e!==null&&qh(e)),t):(t.eventSystemFlags|=r,e=t.targetContainers,s!==null&&e.indexOf(s)===-1&&e.push(s),t)}function aN(t,e,n,r,s){switch(e){case"focusin":return Er=Hi(Er,t,e,n,r,s),!0;case"dragenter":return Tr=Hi(Tr,t,e,n,r,s),!0;case"mouseover":return jr=Hi(jr,t,e,n,r,s),!0;case"pointerover":var a=s.pointerId;return Ta.set(a,Hi(Ta.get(a)||null,t,e,n,r,s)),!0;case"gotpointercapture":return a=s.pointerId,ja.set(a,Hi(ja.get(a)||null,t,e,n,r,s)),!0}return!1}function B0(t){var e=es(t.target);if(e!==null){var n=ws(e);if(n!==null){if(e=n.tag,e===13){if(e=I0(n),e!==null){t.blockedOn=e,U0(t.priority,function(){V0(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function ll(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=Pd(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n===null){n=t.nativeEvent;var r=new n.constructor(n.type,n);jd=r,n.target.dispatchEvent(r),jd=null}else return e=Ja(n),e!==null&&qh(e),t.blockedOn=n,!1;e.shift()}return!0}function Dp(t,e,n){ll(t)&&n.delete(e)}function oN(){kd=!1,Er!==null&&ll(Er)&&(Er=null),Tr!==null&&ll(Tr)&&(Tr=null),jr!==null&&ll(jr)&&(jr=null),Ta.forEach(Dp),ja.forEach(Dp)}function Gi(t,e){t.blockedOn===e&&(t.blockedOn=null,kd||(kd=!0,Wt.unstable_scheduleCallback(Wt.unstable_NormalPriority,oN)))}function Sa(t){function e(s){return Gi(s,t)}if(0<zo.length){Gi(zo[0],t);for(var n=1;n<zo.length;n++){var r=zo[n];r.blockedOn===t&&(r.blockedOn=null)}}for(Er!==null&&Gi(Er,t),Tr!==null&&Gi(Tr,t),jr!==null&&Gi(jr,t),Ta.forEach(e),ja.forEach(e),n=0;n<pr.length;n++)r=pr[n],r.blockedOn===t&&(r.blockedOn=null);for(;0<pr.length&&(n=pr[0],n.blockedOn===null);)B0(n),n.blockedOn===null&&pr.shift()}var Ys=ir.ReactCurrentBatchConfig,Rl=!0;function lN(t,e,n,r){var s=Te,a=Ys.transition;Ys.transition=null;try{Te=1,Hh(t,e,n,r)}finally{Te=s,Ys.transition=a}}function cN(t,e,n,r){var s=Te,a=Ys.transition;Ys.transition=null;try{Te=4,Hh(t,e,n,r)}finally{Te=s,Ys.transition=a}}function Hh(t,e,n,r){if(Rl){var s=Pd(t,e,n,r);if(s===null)qu(t,e,r,Dl,n),Rp(t,r);else if(aN(s,t,e,n,r))r.stopPropagation();else if(Rp(t,r),e&4&&-1<iN.indexOf(t)){for(;s!==null;){var a=Ja(s);if(a!==null&&L0(a),a=Pd(t,e,n,r),a===null&&qu(t,e,r,Dl,n),a===s)break;s=a}s!==null&&r.stopPropagation()}else qu(t,e,r,null,n)}}var Dl=null;function Pd(t,e,n,r){if(Dl=null,t=Bh(r),t=es(t),t!==null)if(e=ws(t),e===null)t=null;else if(n=e.tag,n===13){if(t=I0(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return Dl=t,null}function $0(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Y_()){case $h:return 1;case R0:return 4;case kl:case X_:return 16;case D0:return 536870912;default:return 16}default:return 16}}var wr=null,Gh=null,cl=null;function z0(){if(cl)return cl;var t,e=Gh,n=e.length,r,s="value"in wr?wr.value:wr.textContent,a=s.length;for(t=0;t<n&&e[t]===s[t];t++);var o=n-t;for(r=1;r<=o&&e[n-r]===s[a-r];r++);return cl=s.slice(t,1<r?1-r:void 0)}function ul(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function qo(){return!0}function Mp(){return!1}function Qt(t){function e(n,r,s,a,o){this._reactName=n,this._targetInst=s,this.type=r,this.nativeEvent=a,this.target=o,this.currentTarget=null;for(var c in t)t.hasOwnProperty(c)&&(n=t[c],this[c]=n?n(a):a[c]);return this.isDefaultPrevented=(a.defaultPrevented!=null?a.defaultPrevented:a.returnValue===!1)?qo:Mp,this.isPropagationStopped=Mp,this}return Ue(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=qo)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=qo)},persist:function(){},isPersistent:qo}),e}var _i={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Wh=Qt(_i),Xa=Ue({},_i,{view:0,detail:0}),uN=Qt(Xa),Mu,Ou,Wi,Nc=Ue({},Xa,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Kh,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==Wi&&(Wi&&t.type==="mousemove"?(Mu=t.screenX-Wi.screenX,Ou=t.screenY-Wi.screenY):Ou=Mu=0,Wi=t),Mu)},movementY:function(t){return"movementY"in t?t.movementY:Ou}}),Op=Qt(Nc),dN=Ue({},Nc,{dataTransfer:0}),hN=Qt(dN),mN=Ue({},Xa,{relatedTarget:0}),Lu=Qt(mN),fN=Ue({},_i,{animationName:0,elapsedTime:0,pseudoElement:0}),pN=Qt(fN),gN=Ue({},_i,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),yN=Qt(gN),xN=Ue({},_i,{data:0}),Lp=Qt(xN),vN={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},bN={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},wN={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function _N(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=wN[t])?!!e[t]:!1}function Kh(){return _N}var NN=Ue({},Xa,{key:function(t){if(t.key){var e=vN[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=ul(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?bN[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Kh,charCode:function(t){return t.type==="keypress"?ul(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?ul(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),EN=Qt(NN),TN=Ue({},Nc,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Vp=Qt(TN),jN=Ue({},Xa,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Kh}),SN=Qt(jN),CN=Ue({},_i,{propertyName:0,elapsedTime:0,pseudoElement:0}),IN=Qt(CN),AN=Ue({},Nc,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),kN=Qt(AN),PN=[9,13,27,32],Qh=Kn&&"CompositionEvent"in window,ua=null;Kn&&"documentMode"in document&&(ua=document.documentMode);var RN=Kn&&"TextEvent"in window&&!ua,q0=Kn&&(!Qh||ua&&8<ua&&11>=ua),Fp=" ",Up=!1;function H0(t,e){switch(t){case"keyup":return PN.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function G0(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var Os=!1;function DN(t,e){switch(t){case"compositionend":return G0(e);case"keypress":return e.which!==32?null:(Up=!0,Fp);case"textInput":return t=e.data,t===Fp&&Up?null:t;default:return null}}function MN(t,e){if(Os)return t==="compositionend"||!Qh&&H0(t,e)?(t=z0(),cl=Gh=wr=null,Os=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return q0&&e.locale!=="ko"?null:e.data;default:return null}}var ON={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Bp(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!ON[t.type]:e==="textarea"}function W0(t,e,n,r){E0(r),e=Ml(e,"onChange"),0<e.length&&(n=new Wh("onChange","change",null,n,r),t.push({event:n,listeners:e}))}var da=null,Ca=null;function LN(t){sx(t,0)}function Ec(t){var e=Fs(t);if(y0(e))return t}function VN(t,e){if(t==="change")return e}var K0=!1;if(Kn){var Vu;if(Kn){var Fu="oninput"in document;if(!Fu){var $p=document.createElement("div");$p.setAttribute("oninput","return;"),Fu=typeof $p.oninput=="function"}Vu=Fu}else Vu=!1;K0=Vu&&(!document.documentMode||9<document.documentMode)}function zp(){da&&(da.detachEvent("onpropertychange",Q0),Ca=da=null)}function Q0(t){if(t.propertyName==="value"&&Ec(Ca)){var e=[];W0(e,Ca,t,Bh(t)),C0(LN,e)}}function FN(t,e,n){t==="focusin"?(zp(),da=e,Ca=n,da.attachEvent("onpropertychange",Q0)):t==="focusout"&&zp()}function UN(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return Ec(Ca)}function BN(t,e){if(t==="click")return Ec(e)}function $N(t,e){if(t==="input"||t==="change")return Ec(e)}function zN(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var pn=typeof Object.is=="function"?Object.is:zN;function Ia(t,e){if(pn(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),r=Object.keys(e);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var s=n[r];if(!fd.call(e,s)||!pn(t[s],e[s]))return!1}return!0}function qp(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function Hp(t,e){var n=qp(t);t=0;for(var r;n;){if(n.nodeType===3){if(r=t+n.textContent.length,t<=e&&r>=e)return{node:n,offset:e-t};t=r}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=qp(n)}}function Y0(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?Y0(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function X0(){for(var t=window,e=Cl();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=Cl(t.document)}return e}function Yh(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function qN(t){var e=X0(),n=t.focusedElem,r=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&Y0(n.ownerDocument.documentElement,n)){if(r!==null&&Yh(n)){if(e=r.start,t=r.end,t===void 0&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if(t=(e=n.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var s=n.textContent.length,a=Math.min(r.start,s);r=r.end===void 0?a:Math.min(r.end,s),!t.extend&&a>r&&(s=r,r=a,a=s),s=Hp(n,a);var o=Hp(n,r);s&&o&&(t.rangeCount!==1||t.anchorNode!==s.node||t.anchorOffset!==s.offset||t.focusNode!==o.node||t.focusOffset!==o.offset)&&(e=e.createRange(),e.setStart(s.node,s.offset),t.removeAllRanges(),a>r?(t.addRange(e),t.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),t.addRange(e)))}}for(e=[],t=n;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<e.length;n++)t=e[n],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var HN=Kn&&"documentMode"in document&&11>=document.documentMode,Ls=null,Rd=null,ha=null,Dd=!1;function Gp(t,e,n){var r=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;Dd||Ls==null||Ls!==Cl(r)||(r=Ls,"selectionStart"in r&&Yh(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),ha&&Ia(ha,r)||(ha=r,r=Ml(Rd,"onSelect"),0<r.length&&(e=new Wh("onSelect","select",null,e,n),t.push({event:e,listeners:r}),e.target=Ls)))}function Ho(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var Vs={animationend:Ho("Animation","AnimationEnd"),animationiteration:Ho("Animation","AnimationIteration"),animationstart:Ho("Animation","AnimationStart"),transitionend:Ho("Transition","TransitionEnd")},Uu={},J0={};Kn&&(J0=document.createElement("div").style,"AnimationEvent"in window||(delete Vs.animationend.animation,delete Vs.animationiteration.animation,delete Vs.animationstart.animation),"TransitionEvent"in window||delete Vs.transitionend.transition);function Tc(t){if(Uu[t])return Uu[t];if(!Vs[t])return t;var e=Vs[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in J0)return Uu[t]=e[n];return t}var Z0=Tc("animationend"),ex=Tc("animationiteration"),tx=Tc("animationstart"),nx=Tc("transitionend"),rx=new Map,Wp="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function zr(t,e){rx.set(t,e),bs(e,[t])}for(var Bu=0;Bu<Wp.length;Bu++){var $u=Wp[Bu],GN=$u.toLowerCase(),WN=$u[0].toUpperCase()+$u.slice(1);zr(GN,"on"+WN)}zr(Z0,"onAnimationEnd");zr(ex,"onAnimationIteration");zr(tx,"onAnimationStart");zr("dblclick","onDoubleClick");zr("focusin","onFocus");zr("focusout","onBlur");zr(nx,"onTransitionEnd");si("onMouseEnter",["mouseout","mouseover"]);si("onMouseLeave",["mouseout","mouseover"]);si("onPointerEnter",["pointerout","pointerover"]);si("onPointerLeave",["pointerout","pointerover"]);bs("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));bs("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));bs("onBeforeInput",["compositionend","keypress","textInput","paste"]);bs("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));bs("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));bs("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var ta="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),KN=new Set("cancel close invalid load scroll toggle".split(" ").concat(ta));function Kp(t,e,n){var r=t.type||"unknown-event";t.currentTarget=n,G_(r,e,void 0,t),t.currentTarget=null}function sx(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var r=t[n],s=r.event;r=r.listeners;e:{var a=void 0;if(e)for(var o=r.length-1;0<=o;o--){var c=r[o],u=c.instance,d=c.currentTarget;if(c=c.listener,u!==a&&s.isPropagationStopped())break e;Kp(s,c,d),a=u}else for(o=0;o<r.length;o++){if(c=r[o],u=c.instance,d=c.currentTarget,c=c.listener,u!==a&&s.isPropagationStopped())break e;Kp(s,c,d),a=u}}}if(Al)throw t=Id,Al=!1,Id=null,t}function Re(t,e){var n=e[Fd];n===void 0&&(n=e[Fd]=new Set);var r=t+"__bubble";n.has(r)||(ix(e,t,2,!1),n.add(r))}function zu(t,e,n){var r=0;e&&(r|=4),ix(n,t,r,e)}var Go="_reactListening"+Math.random().toString(36).slice(2);function Aa(t){if(!t[Go]){t[Go]=!0,h0.forEach(function(n){n!=="selectionchange"&&(KN.has(n)||zu(n,!1,t),zu(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[Go]||(e[Go]=!0,zu("selectionchange",!1,e))}}function ix(t,e,n,r){switch($0(e)){case 1:var s=lN;break;case 4:s=cN;break;default:s=Hh}n=s.bind(null,e,n,t),s=void 0,!Cd||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(s=!0),r?s!==void 0?t.addEventListener(e,n,{capture:!0,passive:s}):t.addEventListener(e,n,!0):s!==void 0?t.addEventListener(e,n,{passive:s}):t.addEventListener(e,n,!1)}function qu(t,e,n,r,s){var a=r;if(!(e&1)&&!(e&2)&&r!==null)e:for(;;){if(r===null)return;var o=r.tag;if(o===3||o===4){var c=r.stateNode.containerInfo;if(c===s||c.nodeType===8&&c.parentNode===s)break;if(o===4)for(o=r.return;o!==null;){var u=o.tag;if((u===3||u===4)&&(u=o.stateNode.containerInfo,u===s||u.nodeType===8&&u.parentNode===s))return;o=o.return}for(;c!==null;){if(o=es(c),o===null)return;if(u=o.tag,u===5||u===6){r=a=o;continue e}c=c.parentNode}}r=r.return}C0(function(){var d=a,m=Bh(n),y=[];e:{var g=rx.get(t);if(g!==void 0){var x=Wh,C=t;switch(t){case"keypress":if(ul(n)===0)break e;case"keydown":case"keyup":x=EN;break;case"focusin":C="focus",x=Lu;break;case"focusout":C="blur",x=Lu;break;case"beforeblur":case"afterblur":x=Lu;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":x=Op;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":x=hN;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":x=SN;break;case Z0:case ex:case tx:x=pN;break;case nx:x=IN;break;case"scroll":x=uN;break;case"wheel":x=kN;break;case"copy":case"cut":case"paste":x=yN;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":x=Vp}var E=(e&4)!==0,A=!E&&t==="scroll",N=E?g!==null?g+"Capture":null:g;E=[];for(var T=d,k;T!==null;){k=T;var L=k.stateNode;if(k.tag===5&&L!==null&&(k=L,N!==null&&(L=Ea(T,N),L!=null&&E.push(ka(T,L,k)))),A)break;T=T.return}0<E.length&&(g=new x(g,C,null,n,m),y.push({event:g,listeners:E}))}}if(!(e&7)){e:{if(g=t==="mouseover"||t==="pointerover",x=t==="mouseout"||t==="pointerout",g&&n!==jd&&(C=n.relatedTarget||n.fromElement)&&(es(C)||C[Qn]))break e;if((x||g)&&(g=m.window===m?m:(g=m.ownerDocument)?g.defaultView||g.parentWindow:window,x?(C=n.relatedTarget||n.toElement,x=d,C=C?es(C):null,C!==null&&(A=ws(C),C!==A||C.tag!==5&&C.tag!==6)&&(C=null)):(x=null,C=d),x!==C)){if(E=Op,L="onMouseLeave",N="onMouseEnter",T="mouse",(t==="pointerout"||t==="pointerover")&&(E=Vp,L="onPointerLeave",N="onPointerEnter",T="pointer"),A=x==null?g:Fs(x),k=C==null?g:Fs(C),g=new E(L,T+"leave",x,n,m),g.target=A,g.relatedTarget=k,L=null,es(m)===d&&(E=new E(N,T+"enter",C,n,m),E.target=k,E.relatedTarget=A,L=E),A=L,x&&C)t:{for(E=x,N=C,T=0,k=E;k;k=As(k))T++;for(k=0,L=N;L;L=As(L))k++;for(;0<T-k;)E=As(E),T--;for(;0<k-T;)N=As(N),k--;for(;T--;){if(E===N||N!==null&&E===N.alternate)break t;E=As(E),N=As(N)}E=null}else E=null;x!==null&&Qp(y,g,x,E,!1),C!==null&&A!==null&&Qp(y,A,C,E,!0)}}e:{if(g=d?Fs(d):window,x=g.nodeName&&g.nodeName.toLowerCase(),x==="select"||x==="input"&&g.type==="file")var q=VN;else if(Bp(g))if(K0)q=$N;else{q=UN;var z=FN}else(x=g.nodeName)&&x.toLowerCase()==="input"&&(g.type==="checkbox"||g.type==="radio")&&(q=BN);if(q&&(q=q(t,d))){W0(y,q,n,m);break e}z&&z(t,g,d),t==="focusout"&&(z=g._wrapperState)&&z.controlled&&g.type==="number"&&wd(g,"number",g.value)}switch(z=d?Fs(d):window,t){case"focusin":(Bp(z)||z.contentEditable==="true")&&(Ls=z,Rd=d,ha=null);break;case"focusout":ha=Rd=Ls=null;break;case"mousedown":Dd=!0;break;case"contextmenu":case"mouseup":case"dragend":Dd=!1,Gp(y,n,m);break;case"selectionchange":if(HN)break;case"keydown":case"keyup":Gp(y,n,m)}var j;if(Qh)e:{switch(t){case"compositionstart":var v="onCompositionStart";break e;case"compositionend":v="onCompositionEnd";break e;case"compositionupdate":v="onCompositionUpdate";break e}v=void 0}else Os?H0(t,n)&&(v="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(v="onCompositionStart");v&&(q0&&n.locale!=="ko"&&(Os||v!=="onCompositionStart"?v==="onCompositionEnd"&&Os&&(j=z0()):(wr=m,Gh="value"in wr?wr.value:wr.textContent,Os=!0)),z=Ml(d,v),0<z.length&&(v=new Lp(v,t,null,n,m),y.push({event:v,listeners:z}),j?v.data=j:(j=G0(n),j!==null&&(v.data=j)))),(j=RN?DN(t,n):MN(t,n))&&(d=Ml(d,"onBeforeInput"),0<d.length&&(m=new Lp("onBeforeInput","beforeinput",null,n,m),y.push({event:m,listeners:d}),m.data=j))}sx(y,e)})}function ka(t,e,n){return{instance:t,listener:e,currentTarget:n}}function Ml(t,e){for(var n=e+"Capture",r=[];t!==null;){var s=t,a=s.stateNode;s.tag===5&&a!==null&&(s=a,a=Ea(t,n),a!=null&&r.unshift(ka(t,a,s)),a=Ea(t,e),a!=null&&r.push(ka(t,a,s))),t=t.return}return r}function As(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function Qp(t,e,n,r,s){for(var a=e._reactName,o=[];n!==null&&n!==r;){var c=n,u=c.alternate,d=c.stateNode;if(u!==null&&u===r)break;c.tag===5&&d!==null&&(c=d,s?(u=Ea(n,a),u!=null&&o.unshift(ka(n,u,c))):s||(u=Ea(n,a),u!=null&&o.push(ka(n,u,c)))),n=n.return}o.length!==0&&t.push({event:e,listeners:o})}var QN=/\r\n?/g,YN=/\u0000|\uFFFD/g;function Yp(t){return(typeof t=="string"?t:""+t).replace(QN,`
`).replace(YN,"")}function Wo(t,e,n){if(e=Yp(e),Yp(t)!==e&&n)throw Error(Z(425))}function Ol(){}var Md=null,Od=null;function Ld(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var Vd=typeof setTimeout=="function"?setTimeout:void 0,XN=typeof clearTimeout=="function"?clearTimeout:void 0,Xp=typeof Promise=="function"?Promise:void 0,JN=typeof queueMicrotask=="function"?queueMicrotask:typeof Xp<"u"?function(t){return Xp.resolve(null).then(t).catch(ZN)}:Vd;function ZN(t){setTimeout(function(){throw t})}function Hu(t,e){var n=e,r=0;do{var s=n.nextSibling;if(t.removeChild(n),s&&s.nodeType===8)if(n=s.data,n==="/$"){if(r===0){t.removeChild(s),Sa(e);return}r--}else n!=="$"&&n!=="$?"&&n!=="$!"||r++;n=s}while(n);Sa(e)}function Sr(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function Jp(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}var Ni=Math.random().toString(36).slice(2),bn="__reactFiber$"+Ni,Pa="__reactProps$"+Ni,Qn="__reactContainer$"+Ni,Fd="__reactEvents$"+Ni,eE="__reactListeners$"+Ni,tE="__reactHandles$"+Ni;function es(t){var e=t[bn];if(e)return e;for(var n=t.parentNode;n;){if(e=n[Qn]||n[bn]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=Jp(t);t!==null;){if(n=t[bn])return n;t=Jp(t)}return e}t=n,n=t.parentNode}return null}function Ja(t){return t=t[bn]||t[Qn],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function Fs(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(Z(33))}function jc(t){return t[Pa]||null}var Ud=[],Us=-1;function qr(t){return{current:t}}function Me(t){0>Us||(t.current=Ud[Us],Ud[Us]=null,Us--)}function Ae(t,e){Us++,Ud[Us]=t.current,t.current=e}var Lr={},Nt=qr(Lr),Ot=qr(!1),us=Lr;function ii(t,e){var n=t.type.contextTypes;if(!n)return Lr;var r=t.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var s={},a;for(a in n)s[a]=e[a];return r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=s),s}function Lt(t){return t=t.childContextTypes,t!=null}function Ll(){Me(Ot),Me(Nt)}function Zp(t,e,n){if(Nt.current!==Lr)throw Error(Z(168));Ae(Nt,e),Ae(Ot,n)}function ax(t,e,n){var r=t.stateNode;if(e=e.childContextTypes,typeof r.getChildContext!="function")return n;r=r.getChildContext();for(var s in r)if(!(s in e))throw Error(Z(108,F_(t)||"Unknown",s));return Ue({},n,r)}function Vl(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||Lr,us=Nt.current,Ae(Nt,t),Ae(Ot,Ot.current),!0}function eg(t,e,n){var r=t.stateNode;if(!r)throw Error(Z(169));n?(t=ax(t,e,us),r.__reactInternalMemoizedMergedChildContext=t,Me(Ot),Me(Nt),Ae(Nt,t)):Me(Ot),Ae(Ot,n)}var Fn=null,Sc=!1,Gu=!1;function ox(t){Fn===null?Fn=[t]:Fn.push(t)}function nE(t){Sc=!0,ox(t)}function Hr(){if(!Gu&&Fn!==null){Gu=!0;var t=0,e=Te;try{var n=Fn;for(Te=1;t<n.length;t++){var r=n[t];do r=r(!0);while(r!==null)}Fn=null,Sc=!1}catch(s){throw Fn!==null&&(Fn=Fn.slice(t+1)),P0($h,Hr),s}finally{Te=e,Gu=!1}}return null}var Bs=[],$s=0,Fl=null,Ul=0,Yt=[],Xt=0,ds=null,Un=1,Bn="";function Xr(t,e){Bs[$s++]=Ul,Bs[$s++]=Fl,Fl=t,Ul=e}function lx(t,e,n){Yt[Xt++]=Un,Yt[Xt++]=Bn,Yt[Xt++]=ds,ds=t;var r=Un;t=Bn;var s=32-mn(r)-1;r&=~(1<<s),n+=1;var a=32-mn(e)+s;if(30<a){var o=s-s%5;a=(r&(1<<o)-1).toString(32),r>>=o,s-=o,Un=1<<32-mn(e)+s|n<<s|r,Bn=a+t}else Un=1<<a|n<<s|r,Bn=t}function Xh(t){t.return!==null&&(Xr(t,1),lx(t,1,0))}function Jh(t){for(;t===Fl;)Fl=Bs[--$s],Bs[$s]=null,Ul=Bs[--$s],Bs[$s]=null;for(;t===ds;)ds=Yt[--Xt],Yt[Xt]=null,Bn=Yt[--Xt],Yt[Xt]=null,Un=Yt[--Xt],Yt[Xt]=null}var Gt=null,qt=null,Oe=!1,dn=null;function cx(t,e){var n=Zt(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,e=t.deletions,e===null?(t.deletions=[n],t.flags|=16):e.push(n)}function tg(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,Gt=t,qt=Sr(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,Gt=t,qt=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(n=ds!==null?{id:Un,overflow:Bn}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},n=Zt(18,null,null,0),n.stateNode=e,n.return=t,t.child=n,Gt=t,qt=null,!0):!1;default:return!1}}function Bd(t){return(t.mode&1)!==0&&(t.flags&128)===0}function $d(t){if(Oe){var e=qt;if(e){var n=e;if(!tg(t,e)){if(Bd(t))throw Error(Z(418));e=Sr(n.nextSibling);var r=Gt;e&&tg(t,e)?cx(r,n):(t.flags=t.flags&-4097|2,Oe=!1,Gt=t)}}else{if(Bd(t))throw Error(Z(418));t.flags=t.flags&-4097|2,Oe=!1,Gt=t}}}function ng(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;Gt=t}function Ko(t){if(t!==Gt)return!1;if(!Oe)return ng(t),Oe=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!Ld(t.type,t.memoizedProps)),e&&(e=qt)){if(Bd(t))throw ux(),Error(Z(418));for(;e;)cx(t,e),e=Sr(e.nextSibling)}if(ng(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(Z(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(e===0){qt=Sr(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}t=t.nextSibling}qt=null}}else qt=Gt?Sr(t.stateNode.nextSibling):null;return!0}function ux(){for(var t=qt;t;)t=Sr(t.nextSibling)}function ai(){qt=Gt=null,Oe=!1}function Zh(t){dn===null?dn=[t]:dn.push(t)}var rE=ir.ReactCurrentBatchConfig;function Ki(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(Z(309));var r=n.stateNode}if(!r)throw Error(Z(147,t));var s=r,a=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===a?e.ref:(e=function(o){var c=s.refs;o===null?delete c[a]:c[a]=o},e._stringRef=a,e)}if(typeof t!="string")throw Error(Z(284));if(!n._owner)throw Error(Z(290,t))}return t}function Qo(t,e){throw t=Object.prototype.toString.call(e),Error(Z(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function rg(t){var e=t._init;return e(t._payload)}function dx(t){function e(N,T){if(t){var k=N.deletions;k===null?(N.deletions=[T],N.flags|=16):k.push(T)}}function n(N,T){if(!t)return null;for(;T!==null;)e(N,T),T=T.sibling;return null}function r(N,T){for(N=new Map;T!==null;)T.key!==null?N.set(T.key,T):N.set(T.index,T),T=T.sibling;return N}function s(N,T){return N=kr(N,T),N.index=0,N.sibling=null,N}function a(N,T,k){return N.index=k,t?(k=N.alternate,k!==null?(k=k.index,k<T?(N.flags|=2,T):k):(N.flags|=2,T)):(N.flags|=1048576,T)}function o(N){return t&&N.alternate===null&&(N.flags|=2),N}function c(N,T,k,L){return T===null||T.tag!==6?(T=Zu(k,N.mode,L),T.return=N,T):(T=s(T,k),T.return=N,T)}function u(N,T,k,L){var q=k.type;return q===Ms?m(N,T,k.props.children,L,k.key):T!==null&&(T.elementType===q||typeof q=="object"&&q!==null&&q.$$typeof===mr&&rg(q)===T.type)?(L=s(T,k.props),L.ref=Ki(N,T,k),L.return=N,L):(L=yl(k.type,k.key,k.props,null,N.mode,L),L.ref=Ki(N,T,k),L.return=N,L)}function d(N,T,k,L){return T===null||T.tag!==4||T.stateNode.containerInfo!==k.containerInfo||T.stateNode.implementation!==k.implementation?(T=ed(k,N.mode,L),T.return=N,T):(T=s(T,k.children||[]),T.return=N,T)}function m(N,T,k,L,q){return T===null||T.tag!==7?(T=as(k,N.mode,L,q),T.return=N,T):(T=s(T,k),T.return=N,T)}function y(N,T,k){if(typeof T=="string"&&T!==""||typeof T=="number")return T=Zu(""+T,N.mode,k),T.return=N,T;if(typeof T=="object"&&T!==null){switch(T.$$typeof){case Vo:return k=yl(T.type,T.key,T.props,null,N.mode,k),k.ref=Ki(N,null,T),k.return=N,k;case Ds:return T=ed(T,N.mode,k),T.return=N,T;case mr:var L=T._init;return y(N,L(T._payload),k)}if(Zi(T)||zi(T))return T=as(T,N.mode,k,null),T.return=N,T;Qo(N,T)}return null}function g(N,T,k,L){var q=T!==null?T.key:null;if(typeof k=="string"&&k!==""||typeof k=="number")return q!==null?null:c(N,T,""+k,L);if(typeof k=="object"&&k!==null){switch(k.$$typeof){case Vo:return k.key===q?u(N,T,k,L):null;case Ds:return k.key===q?d(N,T,k,L):null;case mr:return q=k._init,g(N,T,q(k._payload),L)}if(Zi(k)||zi(k))return q!==null?null:m(N,T,k,L,null);Qo(N,k)}return null}function x(N,T,k,L,q){if(typeof L=="string"&&L!==""||typeof L=="number")return N=N.get(k)||null,c(T,N,""+L,q);if(typeof L=="object"&&L!==null){switch(L.$$typeof){case Vo:return N=N.get(L.key===null?k:L.key)||null,u(T,N,L,q);case Ds:return N=N.get(L.key===null?k:L.key)||null,d(T,N,L,q);case mr:var z=L._init;return x(N,T,k,z(L._payload),q)}if(Zi(L)||zi(L))return N=N.get(k)||null,m(T,N,L,q,null);Qo(T,L)}return null}function C(N,T,k,L){for(var q=null,z=null,j=T,v=T=0,S=null;j!==null&&v<k.length;v++){j.index>v?(S=j,j=null):S=j.sibling;var p=g(N,j,k[v],L);if(p===null){j===null&&(j=S);break}t&&j&&p.alternate===null&&e(N,j),T=a(p,T,v),z===null?q=p:z.sibling=p,z=p,j=S}if(v===k.length)return n(N,j),Oe&&Xr(N,v),q;if(j===null){for(;v<k.length;v++)j=y(N,k[v],L),j!==null&&(T=a(j,T,v),z===null?q=j:z.sibling=j,z=j);return Oe&&Xr(N,v),q}for(j=r(N,j);v<k.length;v++)S=x(j,N,v,k[v],L),S!==null&&(t&&S.alternate!==null&&j.delete(S.key===null?v:S.key),T=a(S,T,v),z===null?q=S:z.sibling=S,z=S);return t&&j.forEach(function(I){return e(N,I)}),Oe&&Xr(N,v),q}function E(N,T,k,L){var q=zi(k);if(typeof q!="function")throw Error(Z(150));if(k=q.call(k),k==null)throw Error(Z(151));for(var z=q=null,j=T,v=T=0,S=null,p=k.next();j!==null&&!p.done;v++,p=k.next()){j.index>v?(S=j,j=null):S=j.sibling;var I=g(N,j,p.value,L);if(I===null){j===null&&(j=S);break}t&&j&&I.alternate===null&&e(N,j),T=a(I,T,v),z===null?q=I:z.sibling=I,z=I,j=S}if(p.done)return n(N,j),Oe&&Xr(N,v),q;if(j===null){for(;!p.done;v++,p=k.next())p=y(N,p.value,L),p!==null&&(T=a(p,T,v),z===null?q=p:z.sibling=p,z=p);return Oe&&Xr(N,v),q}for(j=r(N,j);!p.done;v++,p=k.next())p=x(j,N,v,p.value,L),p!==null&&(t&&p.alternate!==null&&j.delete(p.key===null?v:p.key),T=a(p,T,v),z===null?q=p:z.sibling=p,z=p);return t&&j.forEach(function(b){return e(N,b)}),Oe&&Xr(N,v),q}function A(N,T,k,L){if(typeof k=="object"&&k!==null&&k.type===Ms&&k.key===null&&(k=k.props.children),typeof k=="object"&&k!==null){switch(k.$$typeof){case Vo:e:{for(var q=k.key,z=T;z!==null;){if(z.key===q){if(q=k.type,q===Ms){if(z.tag===7){n(N,z.sibling),T=s(z,k.props.children),T.return=N,N=T;break e}}else if(z.elementType===q||typeof q=="object"&&q!==null&&q.$$typeof===mr&&rg(q)===z.type){n(N,z.sibling),T=s(z,k.props),T.ref=Ki(N,z,k),T.return=N,N=T;break e}n(N,z);break}else e(N,z);z=z.sibling}k.type===Ms?(T=as(k.props.children,N.mode,L,k.key),T.return=N,N=T):(L=yl(k.type,k.key,k.props,null,N.mode,L),L.ref=Ki(N,T,k),L.return=N,N=L)}return o(N);case Ds:e:{for(z=k.key;T!==null;){if(T.key===z)if(T.tag===4&&T.stateNode.containerInfo===k.containerInfo&&T.stateNode.implementation===k.implementation){n(N,T.sibling),T=s(T,k.children||[]),T.return=N,N=T;break e}else{n(N,T);break}else e(N,T);T=T.sibling}T=ed(k,N.mode,L),T.return=N,N=T}return o(N);case mr:return z=k._init,A(N,T,z(k._payload),L)}if(Zi(k))return C(N,T,k,L);if(zi(k))return E(N,T,k,L);Qo(N,k)}return typeof k=="string"&&k!==""||typeof k=="number"?(k=""+k,T!==null&&T.tag===6?(n(N,T.sibling),T=s(T,k),T.return=N,N=T):(n(N,T),T=Zu(k,N.mode,L),T.return=N,N=T),o(N)):n(N,T)}return A}var oi=dx(!0),hx=dx(!1),Bl=qr(null),$l=null,zs=null,em=null;function tm(){em=zs=$l=null}function nm(t){var e=Bl.current;Me(Bl),t._currentValue=e}function zd(t,e,n){for(;t!==null;){var r=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,r!==null&&(r.childLanes|=e)):r!==null&&(r.childLanes&e)!==e&&(r.childLanes|=e),t===n)break;t=t.return}}function Xs(t,e){$l=t,em=zs=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(Mt=!0),t.firstContext=null)}function rn(t){var e=t._currentValue;if(em!==t)if(t={context:t,memoizedValue:e,next:null},zs===null){if($l===null)throw Error(Z(308));zs=t,$l.dependencies={lanes:0,firstContext:t}}else zs=zs.next=t;return e}var ts=null;function rm(t){ts===null?ts=[t]:ts.push(t)}function mx(t,e,n,r){var s=e.interleaved;return s===null?(n.next=n,rm(e)):(n.next=s.next,s.next=n),e.interleaved=n,Yn(t,r)}function Yn(t,e){t.lanes|=e;var n=t.alternate;for(n!==null&&(n.lanes|=e),n=t,t=t.return;t!==null;)t.childLanes|=e,n=t.alternate,n!==null&&(n.childLanes|=e),n=t,t=t.return;return n.tag===3?n.stateNode:null}var fr=!1;function sm(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function fx(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function Hn(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function Cr(t,e,n){var r=t.updateQueue;if(r===null)return null;if(r=r.shared,we&2){var s=r.pending;return s===null?e.next=e:(e.next=s.next,s.next=e),r.pending=e,Yn(t,n)}return s=r.interleaved,s===null?(e.next=e,rm(r)):(e.next=s.next,s.next=e),r.interleaved=e,Yn(t,n)}function dl(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194240)!==0)){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,zh(t,n)}}function sg(t,e){var n=t.updateQueue,r=t.alternate;if(r!==null&&(r=r.updateQueue,n===r)){var s=null,a=null;if(n=n.firstBaseUpdate,n!==null){do{var o={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};a===null?s=a=o:a=a.next=o,n=n.next}while(n!==null);a===null?s=a=e:a=a.next=e}else s=a=e;n={baseState:r.baseState,firstBaseUpdate:s,lastBaseUpdate:a,shared:r.shared,effects:r.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function zl(t,e,n,r){var s=t.updateQueue;fr=!1;var a=s.firstBaseUpdate,o=s.lastBaseUpdate,c=s.shared.pending;if(c!==null){s.shared.pending=null;var u=c,d=u.next;u.next=null,o===null?a=d:o.next=d,o=u;var m=t.alternate;m!==null&&(m=m.updateQueue,c=m.lastBaseUpdate,c!==o&&(c===null?m.firstBaseUpdate=d:c.next=d,m.lastBaseUpdate=u))}if(a!==null){var y=s.baseState;o=0,m=d=u=null,c=a;do{var g=c.lane,x=c.eventTime;if((r&g)===g){m!==null&&(m=m.next={eventTime:x,lane:0,tag:c.tag,payload:c.payload,callback:c.callback,next:null});e:{var C=t,E=c;switch(g=e,x=n,E.tag){case 1:if(C=E.payload,typeof C=="function"){y=C.call(x,y,g);break e}y=C;break e;case 3:C.flags=C.flags&-65537|128;case 0:if(C=E.payload,g=typeof C=="function"?C.call(x,y,g):C,g==null)break e;y=Ue({},y,g);break e;case 2:fr=!0}}c.callback!==null&&c.lane!==0&&(t.flags|=64,g=s.effects,g===null?s.effects=[c]:g.push(c))}else x={eventTime:x,lane:g,tag:c.tag,payload:c.payload,callback:c.callback,next:null},m===null?(d=m=x,u=y):m=m.next=x,o|=g;if(c=c.next,c===null){if(c=s.shared.pending,c===null)break;g=c,c=g.next,g.next=null,s.lastBaseUpdate=g,s.shared.pending=null}}while(!0);if(m===null&&(u=y),s.baseState=u,s.firstBaseUpdate=d,s.lastBaseUpdate=m,e=s.shared.interleaved,e!==null){s=e;do o|=s.lane,s=s.next;while(s!==e)}else a===null&&(s.shared.lanes=0);ms|=o,t.lanes=o,t.memoizedState=y}}function ig(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var r=t[e],s=r.callback;if(s!==null){if(r.callback=null,r=n,typeof s!="function")throw Error(Z(191,s));s.call(r)}}}var Za={},Nn=qr(Za),Ra=qr(Za),Da=qr(Za);function ns(t){if(t===Za)throw Error(Z(174));return t}function im(t,e){switch(Ae(Da,e),Ae(Ra,t),Ae(Nn,Za),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:Nd(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=Nd(e,t)}Me(Nn),Ae(Nn,e)}function li(){Me(Nn),Me(Ra),Me(Da)}function px(t){ns(Da.current);var e=ns(Nn.current),n=Nd(e,t.type);e!==n&&(Ae(Ra,t),Ae(Nn,n))}function am(t){Ra.current===t&&(Me(Nn),Me(Ra))}var Ve=qr(0);function ql(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var Wu=[];function om(){for(var t=0;t<Wu.length;t++)Wu[t]._workInProgressVersionPrimary=null;Wu.length=0}var hl=ir.ReactCurrentDispatcher,Ku=ir.ReactCurrentBatchConfig,hs=0,Fe=null,Xe=null,nt=null,Hl=!1,ma=!1,Ma=0,sE=0;function gt(){throw Error(Z(321))}function lm(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!pn(t[n],e[n]))return!1;return!0}function cm(t,e,n,r,s,a){if(hs=a,Fe=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,hl.current=t===null||t.memoizedState===null?lE:cE,t=n(r,s),ma){a=0;do{if(ma=!1,Ma=0,25<=a)throw Error(Z(301));a+=1,nt=Xe=null,e.updateQueue=null,hl.current=uE,t=n(r,s)}while(ma)}if(hl.current=Gl,e=Xe!==null&&Xe.next!==null,hs=0,nt=Xe=Fe=null,Hl=!1,e)throw Error(Z(300));return t}function um(){var t=Ma!==0;return Ma=0,t}function vn(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return nt===null?Fe.memoizedState=nt=t:nt=nt.next=t,nt}function sn(){if(Xe===null){var t=Fe.alternate;t=t!==null?t.memoizedState:null}else t=Xe.next;var e=nt===null?Fe.memoizedState:nt.next;if(e!==null)nt=e,Xe=t;else{if(t===null)throw Error(Z(310));Xe=t,t={memoizedState:Xe.memoizedState,baseState:Xe.baseState,baseQueue:Xe.baseQueue,queue:Xe.queue,next:null},nt===null?Fe.memoizedState=nt=t:nt=nt.next=t}return nt}function Oa(t,e){return typeof e=="function"?e(t):e}function Qu(t){var e=sn(),n=e.queue;if(n===null)throw Error(Z(311));n.lastRenderedReducer=t;var r=Xe,s=r.baseQueue,a=n.pending;if(a!==null){if(s!==null){var o=s.next;s.next=a.next,a.next=o}r.baseQueue=s=a,n.pending=null}if(s!==null){a=s.next,r=r.baseState;var c=o=null,u=null,d=a;do{var m=d.lane;if((hs&m)===m)u!==null&&(u=u.next={lane:0,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null}),r=d.hasEagerState?d.eagerState:t(r,d.action);else{var y={lane:m,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null};u===null?(c=u=y,o=r):u=u.next=y,Fe.lanes|=m,ms|=m}d=d.next}while(d!==null&&d!==a);u===null?o=r:u.next=c,pn(r,e.memoizedState)||(Mt=!0),e.memoizedState=r,e.baseState=o,e.baseQueue=u,n.lastRenderedState=r}if(t=n.interleaved,t!==null){s=t;do a=s.lane,Fe.lanes|=a,ms|=a,s=s.next;while(s!==t)}else s===null&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function Yu(t){var e=sn(),n=e.queue;if(n===null)throw Error(Z(311));n.lastRenderedReducer=t;var r=n.dispatch,s=n.pending,a=e.memoizedState;if(s!==null){n.pending=null;var o=s=s.next;do a=t(a,o.action),o=o.next;while(o!==s);pn(a,e.memoizedState)||(Mt=!0),e.memoizedState=a,e.baseQueue===null&&(e.baseState=a),n.lastRenderedState=a}return[a,r]}function gx(){}function yx(t,e){var n=Fe,r=sn(),s=e(),a=!pn(r.memoizedState,s);if(a&&(r.memoizedState=s,Mt=!0),r=r.queue,dm(bx.bind(null,n,r,t),[t]),r.getSnapshot!==e||a||nt!==null&&nt.memoizedState.tag&1){if(n.flags|=2048,La(9,vx.bind(null,n,r,s,e),void 0,null),st===null)throw Error(Z(349));hs&30||xx(n,e,s)}return s}function xx(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=Fe.updateQueue,e===null?(e={lastEffect:null,stores:null},Fe.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function vx(t,e,n,r){e.value=n,e.getSnapshot=r,wx(e)&&_x(t)}function bx(t,e,n){return n(function(){wx(e)&&_x(t)})}function wx(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!pn(t,n)}catch{return!0}}function _x(t){var e=Yn(t,1);e!==null&&fn(e,t,1,-1)}function ag(t){var e=vn();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Oa,lastRenderedState:t},e.queue=t,t=t.dispatch=oE.bind(null,Fe,t),[e.memoizedState,t]}function La(t,e,n,r){return t={tag:t,create:e,destroy:n,deps:r,next:null},e=Fe.updateQueue,e===null?(e={lastEffect:null,stores:null},Fe.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(r=n.next,n.next=t,t.next=r,e.lastEffect=t)),t}function Nx(){return sn().memoizedState}function ml(t,e,n,r){var s=vn();Fe.flags|=t,s.memoizedState=La(1|e,n,void 0,r===void 0?null:r)}function Cc(t,e,n,r){var s=sn();r=r===void 0?null:r;var a=void 0;if(Xe!==null){var o=Xe.memoizedState;if(a=o.destroy,r!==null&&lm(r,o.deps)){s.memoizedState=La(e,n,a,r);return}}Fe.flags|=t,s.memoizedState=La(1|e,n,a,r)}function og(t,e){return ml(8390656,8,t,e)}function dm(t,e){return Cc(2048,8,t,e)}function Ex(t,e){return Cc(4,2,t,e)}function Tx(t,e){return Cc(4,4,t,e)}function jx(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function Sx(t,e,n){return n=n!=null?n.concat([t]):null,Cc(4,4,jx.bind(null,e,t),n)}function hm(){}function Cx(t,e){var n=sn();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&lm(e,r[1])?r[0]:(n.memoizedState=[t,e],t)}function Ix(t,e){var n=sn();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&lm(e,r[1])?r[0]:(t=t(),n.memoizedState=[t,e],t)}function Ax(t,e,n){return hs&21?(pn(n,e)||(n=M0(),Fe.lanes|=n,ms|=n,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,Mt=!0),t.memoizedState=n)}function iE(t,e){var n=Te;Te=n!==0&&4>n?n:4,t(!0);var r=Ku.transition;Ku.transition={};try{t(!1),e()}finally{Te=n,Ku.transition=r}}function kx(){return sn().memoizedState}function aE(t,e,n){var r=Ar(t);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},Px(t))Rx(e,n);else if(n=mx(t,e,n,r),n!==null){var s=Ct();fn(n,t,r,s),Dx(n,e,r)}}function oE(t,e,n){var r=Ar(t),s={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(Px(t))Rx(e,s);else{var a=t.alternate;if(t.lanes===0&&(a===null||a.lanes===0)&&(a=e.lastRenderedReducer,a!==null))try{var o=e.lastRenderedState,c=a(o,n);if(s.hasEagerState=!0,s.eagerState=c,pn(c,o)){var u=e.interleaved;u===null?(s.next=s,rm(e)):(s.next=u.next,u.next=s),e.interleaved=s;return}}catch{}finally{}n=mx(t,e,s,r),n!==null&&(s=Ct(),fn(n,t,r,s),Dx(n,e,r))}}function Px(t){var e=t.alternate;return t===Fe||e!==null&&e===Fe}function Rx(t,e){ma=Hl=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function Dx(t,e,n){if(n&4194240){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,zh(t,n)}}var Gl={readContext:rn,useCallback:gt,useContext:gt,useEffect:gt,useImperativeHandle:gt,useInsertionEffect:gt,useLayoutEffect:gt,useMemo:gt,useReducer:gt,useRef:gt,useState:gt,useDebugValue:gt,useDeferredValue:gt,useTransition:gt,useMutableSource:gt,useSyncExternalStore:gt,useId:gt,unstable_isNewReconciler:!1},lE={readContext:rn,useCallback:function(t,e){return vn().memoizedState=[t,e===void 0?null:e],t},useContext:rn,useEffect:og,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,ml(4194308,4,jx.bind(null,e,t),n)},useLayoutEffect:function(t,e){return ml(4194308,4,t,e)},useInsertionEffect:function(t,e){return ml(4,2,t,e)},useMemo:function(t,e){var n=vn();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var r=vn();return e=n!==void 0?n(e):e,r.memoizedState=r.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},r.queue=t,t=t.dispatch=aE.bind(null,Fe,t),[r.memoizedState,t]},useRef:function(t){var e=vn();return t={current:t},e.memoizedState=t},useState:ag,useDebugValue:hm,useDeferredValue:function(t){return vn().memoizedState=t},useTransition:function(){var t=ag(!1),e=t[0];return t=iE.bind(null,t[1]),vn().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var r=Fe,s=vn();if(Oe){if(n===void 0)throw Error(Z(407));n=n()}else{if(n=e(),st===null)throw Error(Z(349));hs&30||xx(r,e,n)}s.memoizedState=n;var a={value:n,getSnapshot:e};return s.queue=a,og(bx.bind(null,r,a,t),[t]),r.flags|=2048,La(9,vx.bind(null,r,a,n,e),void 0,null),n},useId:function(){var t=vn(),e=st.identifierPrefix;if(Oe){var n=Bn,r=Un;n=(r&~(1<<32-mn(r)-1)).toString(32)+n,e=":"+e+"R"+n,n=Ma++,0<n&&(e+="H"+n.toString(32)),e+=":"}else n=sE++,e=":"+e+"r"+n.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},cE={readContext:rn,useCallback:Cx,useContext:rn,useEffect:dm,useImperativeHandle:Sx,useInsertionEffect:Ex,useLayoutEffect:Tx,useMemo:Ix,useReducer:Qu,useRef:Nx,useState:function(){return Qu(Oa)},useDebugValue:hm,useDeferredValue:function(t){var e=sn();return Ax(e,Xe.memoizedState,t)},useTransition:function(){var t=Qu(Oa)[0],e=sn().memoizedState;return[t,e]},useMutableSource:gx,useSyncExternalStore:yx,useId:kx,unstable_isNewReconciler:!1},uE={readContext:rn,useCallback:Cx,useContext:rn,useEffect:dm,useImperativeHandle:Sx,useInsertionEffect:Ex,useLayoutEffect:Tx,useMemo:Ix,useReducer:Yu,useRef:Nx,useState:function(){return Yu(Oa)},useDebugValue:hm,useDeferredValue:function(t){var e=sn();return Xe===null?e.memoizedState=t:Ax(e,Xe.memoizedState,t)},useTransition:function(){var t=Yu(Oa)[0],e=sn().memoizedState;return[t,e]},useMutableSource:gx,useSyncExternalStore:yx,useId:kx,unstable_isNewReconciler:!1};function cn(t,e){if(t&&t.defaultProps){e=Ue({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}function qd(t,e,n,r){e=t.memoizedState,n=n(r,e),n=n==null?e:Ue({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var Ic={isMounted:function(t){return(t=t._reactInternals)?ws(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var r=Ct(),s=Ar(t),a=Hn(r,s);a.payload=e,n!=null&&(a.callback=n),e=Cr(t,a,s),e!==null&&(fn(e,t,s,r),dl(e,t,s))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var r=Ct(),s=Ar(t),a=Hn(r,s);a.tag=1,a.payload=e,n!=null&&(a.callback=n),e=Cr(t,a,s),e!==null&&(fn(e,t,s,r),dl(e,t,s))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=Ct(),r=Ar(t),s=Hn(n,r);s.tag=2,e!=null&&(s.callback=e),e=Cr(t,s,r),e!==null&&(fn(e,t,r,n),dl(e,t,r))}};function lg(t,e,n,r,s,a,o){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(r,a,o):e.prototype&&e.prototype.isPureReactComponent?!Ia(n,r)||!Ia(s,a):!0}function Mx(t,e,n){var r=!1,s=Lr,a=e.contextType;return typeof a=="object"&&a!==null?a=rn(a):(s=Lt(e)?us:Nt.current,r=e.contextTypes,a=(r=r!=null)?ii(t,s):Lr),e=new e(n,a),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=Ic,t.stateNode=e,e._reactInternals=t,r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=s,t.__reactInternalMemoizedMaskedChildContext=a),e}function cg(t,e,n,r){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,r),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,r),e.state!==t&&Ic.enqueueReplaceState(e,e.state,null)}function Hd(t,e,n,r){var s=t.stateNode;s.props=n,s.state=t.memoizedState,s.refs={},sm(t);var a=e.contextType;typeof a=="object"&&a!==null?s.context=rn(a):(a=Lt(e)?us:Nt.current,s.context=ii(t,a)),s.state=t.memoizedState,a=e.getDerivedStateFromProps,typeof a=="function"&&(qd(t,e,a,n),s.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof s.getSnapshotBeforeUpdate=="function"||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(e=s.state,typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount(),e!==s.state&&Ic.enqueueReplaceState(s,s.state,null),zl(t,n,s,r),s.state=t.memoizedState),typeof s.componentDidMount=="function"&&(t.flags|=4194308)}function ci(t,e){try{var n="",r=e;do n+=V_(r),r=r.return;while(r);var s=n}catch(a){s=`
Error generating stack: `+a.message+`
`+a.stack}return{value:t,source:e,stack:s,digest:null}}function Xu(t,e,n){return{value:t,source:null,stack:n??null,digest:e??null}}function Gd(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var dE=typeof WeakMap=="function"?WeakMap:Map;function Ox(t,e,n){n=Hn(-1,n),n.tag=3,n.payload={element:null};var r=e.value;return n.callback=function(){Kl||(Kl=!0,nh=r),Gd(t,e)},n}function Lx(t,e,n){n=Hn(-1,n),n.tag=3;var r=t.type.getDerivedStateFromError;if(typeof r=="function"){var s=e.value;n.payload=function(){return r(s)},n.callback=function(){Gd(t,e)}}var a=t.stateNode;return a!==null&&typeof a.componentDidCatch=="function"&&(n.callback=function(){Gd(t,e),typeof r!="function"&&(Ir===null?Ir=new Set([this]):Ir.add(this));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),n}function ug(t,e,n){var r=t.pingCache;if(r===null){r=t.pingCache=new dE;var s=new Set;r.set(e,s)}else s=r.get(e),s===void 0&&(s=new Set,r.set(e,s));s.has(n)||(s.add(n),t=TE.bind(null,t,e,n),e.then(t,t))}function dg(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function hg(t,e,n,r,s){return t.mode&1?(t.flags|=65536,t.lanes=s,t):(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(e=Hn(-1,1),e.tag=2,Cr(n,e,1))),n.lanes|=1),t)}var hE=ir.ReactCurrentOwner,Mt=!1;function St(t,e,n,r){e.child=t===null?hx(e,null,n,r):oi(e,t.child,n,r)}function mg(t,e,n,r,s){n=n.render;var a=e.ref;return Xs(e,s),r=cm(t,e,n,r,a,s),n=um(),t!==null&&!Mt?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~s,Xn(t,e,s)):(Oe&&n&&Xh(e),e.flags|=1,St(t,e,r,s),e.child)}function fg(t,e,n,r,s){if(t===null){var a=n.type;return typeof a=="function"&&!bm(a)&&a.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=a,Vx(t,e,a,r,s)):(t=yl(n.type,null,r,e,e.mode,s),t.ref=e.ref,t.return=e,e.child=t)}if(a=t.child,!(t.lanes&s)){var o=a.memoizedProps;if(n=n.compare,n=n!==null?n:Ia,n(o,r)&&t.ref===e.ref)return Xn(t,e,s)}return e.flags|=1,t=kr(a,r),t.ref=e.ref,t.return=e,e.child=t}function Vx(t,e,n,r,s){if(t!==null){var a=t.memoizedProps;if(Ia(a,r)&&t.ref===e.ref)if(Mt=!1,e.pendingProps=r=a,(t.lanes&s)!==0)t.flags&131072&&(Mt=!0);else return e.lanes=t.lanes,Xn(t,e,s)}return Wd(t,e,n,r,s)}function Fx(t,e,n){var r=e.pendingProps,s=r.children,a=t!==null?t.memoizedState:null;if(r.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},Ae(Hs,zt),zt|=n;else{if(!(n&1073741824))return t=a!==null?a.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,Ae(Hs,zt),zt|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=a!==null?a.baseLanes:n,Ae(Hs,zt),zt|=r}else a!==null?(r=a.baseLanes|n,e.memoizedState=null):r=n,Ae(Hs,zt),zt|=r;return St(t,e,s,n),e.child}function Ux(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function Wd(t,e,n,r,s){var a=Lt(n)?us:Nt.current;return a=ii(e,a),Xs(e,s),n=cm(t,e,n,r,a,s),r=um(),t!==null&&!Mt?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~s,Xn(t,e,s)):(Oe&&r&&Xh(e),e.flags|=1,St(t,e,n,s),e.child)}function pg(t,e,n,r,s){if(Lt(n)){var a=!0;Vl(e)}else a=!1;if(Xs(e,s),e.stateNode===null)fl(t,e),Mx(e,n,r),Hd(e,n,r,s),r=!0;else if(t===null){var o=e.stateNode,c=e.memoizedProps;o.props=c;var u=o.context,d=n.contextType;typeof d=="object"&&d!==null?d=rn(d):(d=Lt(n)?us:Nt.current,d=ii(e,d));var m=n.getDerivedStateFromProps,y=typeof m=="function"||typeof o.getSnapshotBeforeUpdate=="function";y||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(c!==r||u!==d)&&cg(e,o,r,d),fr=!1;var g=e.memoizedState;o.state=g,zl(e,r,o,s),u=e.memoizedState,c!==r||g!==u||Ot.current||fr?(typeof m=="function"&&(qd(e,n,m,r),u=e.memoizedState),(c=fr||lg(e,n,c,r,g,u,d))?(y||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4194308)):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=r,e.memoizedState=u),o.props=r,o.state=u,o.context=d,r=c):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),r=!1)}else{o=e.stateNode,fx(t,e),c=e.memoizedProps,d=e.type===e.elementType?c:cn(e.type,c),o.props=d,y=e.pendingProps,g=o.context,u=n.contextType,typeof u=="object"&&u!==null?u=rn(u):(u=Lt(n)?us:Nt.current,u=ii(e,u));var x=n.getDerivedStateFromProps;(m=typeof x=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(c!==y||g!==u)&&cg(e,o,r,u),fr=!1,g=e.memoizedState,o.state=g,zl(e,r,o,s);var C=e.memoizedState;c!==y||g!==C||Ot.current||fr?(typeof x=="function"&&(qd(e,n,x,r),C=e.memoizedState),(d=fr||lg(e,n,d,r,g,C,u)||!1)?(m||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(r,C,u),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(r,C,u)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof o.componentDidUpdate!="function"||c===t.memoizedProps&&g===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||c===t.memoizedProps&&g===t.memoizedState||(e.flags|=1024),e.memoizedProps=r,e.memoizedState=C),o.props=r,o.state=C,o.context=u,r=d):(typeof o.componentDidUpdate!="function"||c===t.memoizedProps&&g===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||c===t.memoizedProps&&g===t.memoizedState||(e.flags|=1024),r=!1)}return Kd(t,e,n,r,a,s)}function Kd(t,e,n,r,s,a){Ux(t,e);var o=(e.flags&128)!==0;if(!r&&!o)return s&&eg(e,n,!1),Xn(t,e,a);r=e.stateNode,hE.current=e;var c=o&&typeof n.getDerivedStateFromError!="function"?null:r.render();return e.flags|=1,t!==null&&o?(e.child=oi(e,t.child,null,a),e.child=oi(e,null,c,a)):St(t,e,c,a),e.memoizedState=r.state,s&&eg(e,n,!0),e.child}function Bx(t){var e=t.stateNode;e.pendingContext?Zp(t,e.pendingContext,e.pendingContext!==e.context):e.context&&Zp(t,e.context,!1),im(t,e.containerInfo)}function gg(t,e,n,r,s){return ai(),Zh(s),e.flags|=256,St(t,e,n,r),e.child}var Qd={dehydrated:null,treeContext:null,retryLane:0};function Yd(t){return{baseLanes:t,cachePool:null,transitions:null}}function $x(t,e,n){var r=e.pendingProps,s=Ve.current,a=!1,o=(e.flags&128)!==0,c;if((c=o)||(c=t!==null&&t.memoizedState===null?!1:(s&2)!==0),c?(a=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(s|=1),Ae(Ve,s&1),t===null)return $d(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(o=r.children,t=r.fallback,a?(r=e.mode,a=e.child,o={mode:"hidden",children:o},!(r&1)&&a!==null?(a.childLanes=0,a.pendingProps=o):a=Pc(o,r,0,null),t=as(t,r,n,null),a.return=e,t.return=e,a.sibling=t,e.child=a,e.child.memoizedState=Yd(n),e.memoizedState=Qd,t):mm(e,o));if(s=t.memoizedState,s!==null&&(c=s.dehydrated,c!==null))return mE(t,e,o,r,c,s,n);if(a){a=r.fallback,o=e.mode,s=t.child,c=s.sibling;var u={mode:"hidden",children:r.children};return!(o&1)&&e.child!==s?(r=e.child,r.childLanes=0,r.pendingProps=u,e.deletions=null):(r=kr(s,u),r.subtreeFlags=s.subtreeFlags&14680064),c!==null?a=kr(c,a):(a=as(a,o,n,null),a.flags|=2),a.return=e,r.return=e,r.sibling=a,e.child=r,r=a,a=e.child,o=t.child.memoizedState,o=o===null?Yd(n):{baseLanes:o.baseLanes|n,cachePool:null,transitions:o.transitions},a.memoizedState=o,a.childLanes=t.childLanes&~n,e.memoizedState=Qd,r}return a=t.child,t=a.sibling,r=kr(a,{mode:"visible",children:r.children}),!(e.mode&1)&&(r.lanes=n),r.return=e,r.sibling=null,t!==null&&(n=e.deletions,n===null?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=r,e.memoizedState=null,r}function mm(t,e){return e=Pc({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function Yo(t,e,n,r){return r!==null&&Zh(r),oi(e,t.child,null,n),t=mm(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function mE(t,e,n,r,s,a,o){if(n)return e.flags&256?(e.flags&=-257,r=Xu(Error(Z(422))),Yo(t,e,o,r)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(a=r.fallback,s=e.mode,r=Pc({mode:"visible",children:r.children},s,0,null),a=as(a,s,o,null),a.flags|=2,r.return=e,a.return=e,r.sibling=a,e.child=r,e.mode&1&&oi(e,t.child,null,o),e.child.memoizedState=Yd(o),e.memoizedState=Qd,a);if(!(e.mode&1))return Yo(t,e,o,null);if(s.data==="$!"){if(r=s.nextSibling&&s.nextSibling.dataset,r)var c=r.dgst;return r=c,a=Error(Z(419)),r=Xu(a,r,void 0),Yo(t,e,o,r)}if(c=(o&t.childLanes)!==0,Mt||c){if(r=st,r!==null){switch(o&-o){case 4:s=2;break;case 16:s=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:s=32;break;case 536870912:s=268435456;break;default:s=0}s=s&(r.suspendedLanes|o)?0:s,s!==0&&s!==a.retryLane&&(a.retryLane=s,Yn(t,s),fn(r,t,s,-1))}return vm(),r=Xu(Error(Z(421))),Yo(t,e,o,r)}return s.data==="$?"?(e.flags|=128,e.child=t.child,e=jE.bind(null,t),s._reactRetry=e,null):(t=a.treeContext,qt=Sr(s.nextSibling),Gt=e,Oe=!0,dn=null,t!==null&&(Yt[Xt++]=Un,Yt[Xt++]=Bn,Yt[Xt++]=ds,Un=t.id,Bn=t.overflow,ds=e),e=mm(e,r.children),e.flags|=4096,e)}function yg(t,e,n){t.lanes|=e;var r=t.alternate;r!==null&&(r.lanes|=e),zd(t.return,e,n)}function Ju(t,e,n,r,s){var a=t.memoizedState;a===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:s}:(a.isBackwards=e,a.rendering=null,a.renderingStartTime=0,a.last=r,a.tail=n,a.tailMode=s)}function zx(t,e,n){var r=e.pendingProps,s=r.revealOrder,a=r.tail;if(St(t,e,r.children,n),r=Ve.current,r&2)r=r&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&yg(t,n,e);else if(t.tag===19)yg(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}r&=1}if(Ae(Ve,r),!(e.mode&1))e.memoizedState=null;else switch(s){case"forwards":for(n=e.child,s=null;n!==null;)t=n.alternate,t!==null&&ql(t)===null&&(s=n),n=n.sibling;n=s,n===null?(s=e.child,e.child=null):(s=n.sibling,n.sibling=null),Ju(e,!1,s,n,a);break;case"backwards":for(n=null,s=e.child,e.child=null;s!==null;){if(t=s.alternate,t!==null&&ql(t)===null){e.child=s;break}t=s.sibling,s.sibling=n,n=s,s=t}Ju(e,!0,n,null,a);break;case"together":Ju(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function fl(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function Xn(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),ms|=e.lanes,!(n&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(Z(153));if(e.child!==null){for(t=e.child,n=kr(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=kr(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function fE(t,e,n){switch(e.tag){case 3:Bx(e),ai();break;case 5:px(e);break;case 1:Lt(e.type)&&Vl(e);break;case 4:im(e,e.stateNode.containerInfo);break;case 10:var r=e.type._context,s=e.memoizedProps.value;Ae(Bl,r._currentValue),r._currentValue=s;break;case 13:if(r=e.memoizedState,r!==null)return r.dehydrated!==null?(Ae(Ve,Ve.current&1),e.flags|=128,null):n&e.child.childLanes?$x(t,e,n):(Ae(Ve,Ve.current&1),t=Xn(t,e,n),t!==null?t.sibling:null);Ae(Ve,Ve.current&1);break;case 19:if(r=(n&e.childLanes)!==0,t.flags&128){if(r)return zx(t,e,n);e.flags|=128}if(s=e.memoizedState,s!==null&&(s.rendering=null,s.tail=null,s.lastEffect=null),Ae(Ve,Ve.current),r)break;return null;case 22:case 23:return e.lanes=0,Fx(t,e,n)}return Xn(t,e,n)}var qx,Xd,Hx,Gx;qx=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};Xd=function(){};Hx=function(t,e,n,r){var s=t.memoizedProps;if(s!==r){t=e.stateNode,ns(Nn.current);var a=null;switch(n){case"input":s=vd(t,s),r=vd(t,r),a=[];break;case"select":s=Ue({},s,{value:void 0}),r=Ue({},r,{value:void 0}),a=[];break;case"textarea":s=_d(t,s),r=_d(t,r),a=[];break;default:typeof s.onClick!="function"&&typeof r.onClick=="function"&&(t.onclick=Ol)}Ed(n,r);var o;n=null;for(d in s)if(!r.hasOwnProperty(d)&&s.hasOwnProperty(d)&&s[d]!=null)if(d==="style"){var c=s[d];for(o in c)c.hasOwnProperty(o)&&(n||(n={}),n[o]="")}else d!=="dangerouslySetInnerHTML"&&d!=="children"&&d!=="suppressContentEditableWarning"&&d!=="suppressHydrationWarning"&&d!=="autoFocus"&&(_a.hasOwnProperty(d)?a||(a=[]):(a=a||[]).push(d,null));for(d in r){var u=r[d];if(c=s!=null?s[d]:void 0,r.hasOwnProperty(d)&&u!==c&&(u!=null||c!=null))if(d==="style")if(c){for(o in c)!c.hasOwnProperty(o)||u&&u.hasOwnProperty(o)||(n||(n={}),n[o]="");for(o in u)u.hasOwnProperty(o)&&c[o]!==u[o]&&(n||(n={}),n[o]=u[o])}else n||(a||(a=[]),a.push(d,n)),n=u;else d==="dangerouslySetInnerHTML"?(u=u?u.__html:void 0,c=c?c.__html:void 0,u!=null&&c!==u&&(a=a||[]).push(d,u)):d==="children"?typeof u!="string"&&typeof u!="number"||(a=a||[]).push(d,""+u):d!=="suppressContentEditableWarning"&&d!=="suppressHydrationWarning"&&(_a.hasOwnProperty(d)?(u!=null&&d==="onScroll"&&Re("scroll",t),a||c===u||(a=[])):(a=a||[]).push(d,u))}n&&(a=a||[]).push("style",n);var d=a;(e.updateQueue=d)&&(e.flags|=4)}};Gx=function(t,e,n,r){n!==r&&(e.flags|=4)};function Qi(t,e){if(!Oe)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var r=null;n!==null;)n.alternate!==null&&(r=n),n=n.sibling;r===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:r.sibling=null}}function yt(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,r=0;if(e)for(var s=t.child;s!==null;)n|=s.lanes|s.childLanes,r|=s.subtreeFlags&14680064,r|=s.flags&14680064,s.return=t,s=s.sibling;else for(s=t.child;s!==null;)n|=s.lanes|s.childLanes,r|=s.subtreeFlags,r|=s.flags,s.return=t,s=s.sibling;return t.subtreeFlags|=r,t.childLanes=n,e}function pE(t,e,n){var r=e.pendingProps;switch(Jh(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return yt(e),null;case 1:return Lt(e.type)&&Ll(),yt(e),null;case 3:return r=e.stateNode,li(),Me(Ot),Me(Nt),om(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(t===null||t.child===null)&&(Ko(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,dn!==null&&(ih(dn),dn=null))),Xd(t,e),yt(e),null;case 5:am(e);var s=ns(Da.current);if(n=e.type,t!==null&&e.stateNode!=null)Hx(t,e,n,r,s),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!r){if(e.stateNode===null)throw Error(Z(166));return yt(e),null}if(t=ns(Nn.current),Ko(e)){r=e.stateNode,n=e.type;var a=e.memoizedProps;switch(r[bn]=e,r[Pa]=a,t=(e.mode&1)!==0,n){case"dialog":Re("cancel",r),Re("close",r);break;case"iframe":case"object":case"embed":Re("load",r);break;case"video":case"audio":for(s=0;s<ta.length;s++)Re(ta[s],r);break;case"source":Re("error",r);break;case"img":case"image":case"link":Re("error",r),Re("load",r);break;case"details":Re("toggle",r);break;case"input":jp(r,a),Re("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!a.multiple},Re("invalid",r);break;case"textarea":Cp(r,a),Re("invalid",r)}Ed(n,a),s=null;for(var o in a)if(a.hasOwnProperty(o)){var c=a[o];o==="children"?typeof c=="string"?r.textContent!==c&&(a.suppressHydrationWarning!==!0&&Wo(r.textContent,c,t),s=["children",c]):typeof c=="number"&&r.textContent!==""+c&&(a.suppressHydrationWarning!==!0&&Wo(r.textContent,c,t),s=["children",""+c]):_a.hasOwnProperty(o)&&c!=null&&o==="onScroll"&&Re("scroll",r)}switch(n){case"input":Fo(r),Sp(r,a,!0);break;case"textarea":Fo(r),Ip(r);break;case"select":case"option":break;default:typeof a.onClick=="function"&&(r.onclick=Ol)}r=s,e.updateQueue=r,r!==null&&(e.flags|=4)}else{o=s.nodeType===9?s:s.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=b0(n)),t==="http://www.w3.org/1999/xhtml"?n==="script"?(t=o.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof r.is=="string"?t=o.createElement(n,{is:r.is}):(t=o.createElement(n),n==="select"&&(o=t,r.multiple?o.multiple=!0:r.size&&(o.size=r.size))):t=o.createElementNS(t,n),t[bn]=e,t[Pa]=r,qx(t,e,!1,!1),e.stateNode=t;e:{switch(o=Td(n,r),n){case"dialog":Re("cancel",t),Re("close",t),s=r;break;case"iframe":case"object":case"embed":Re("load",t),s=r;break;case"video":case"audio":for(s=0;s<ta.length;s++)Re(ta[s],t);s=r;break;case"source":Re("error",t),s=r;break;case"img":case"image":case"link":Re("error",t),Re("load",t),s=r;break;case"details":Re("toggle",t),s=r;break;case"input":jp(t,r),s=vd(t,r),Re("invalid",t);break;case"option":s=r;break;case"select":t._wrapperState={wasMultiple:!!r.multiple},s=Ue({},r,{value:void 0}),Re("invalid",t);break;case"textarea":Cp(t,r),s=_d(t,r),Re("invalid",t);break;default:s=r}Ed(n,s),c=s;for(a in c)if(c.hasOwnProperty(a)){var u=c[a];a==="style"?N0(t,u):a==="dangerouslySetInnerHTML"?(u=u?u.__html:void 0,u!=null&&w0(t,u)):a==="children"?typeof u=="string"?(n!=="textarea"||u!=="")&&Na(t,u):typeof u=="number"&&Na(t,""+u):a!=="suppressContentEditableWarning"&&a!=="suppressHydrationWarning"&&a!=="autoFocus"&&(_a.hasOwnProperty(a)?u!=null&&a==="onScroll"&&Re("scroll",t):u!=null&&Lh(t,a,u,o))}switch(n){case"input":Fo(t),Sp(t,r,!1);break;case"textarea":Fo(t),Ip(t);break;case"option":r.value!=null&&t.setAttribute("value",""+Or(r.value));break;case"select":t.multiple=!!r.multiple,a=r.value,a!=null?Ws(t,!!r.multiple,a,!1):r.defaultValue!=null&&Ws(t,!!r.multiple,r.defaultValue,!0);break;default:typeof s.onClick=="function"&&(t.onclick=Ol)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return yt(e),null;case 6:if(t&&e.stateNode!=null)Gx(t,e,t.memoizedProps,r);else{if(typeof r!="string"&&e.stateNode===null)throw Error(Z(166));if(n=ns(Da.current),ns(Nn.current),Ko(e)){if(r=e.stateNode,n=e.memoizedProps,r[bn]=e,(a=r.nodeValue!==n)&&(t=Gt,t!==null))switch(t.tag){case 3:Wo(r.nodeValue,n,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&Wo(r.nodeValue,n,(t.mode&1)!==0)}a&&(e.flags|=4)}else r=(n.nodeType===9?n:n.ownerDocument).createTextNode(r),r[bn]=e,e.stateNode=r}return yt(e),null;case 13:if(Me(Ve),r=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(Oe&&qt!==null&&e.mode&1&&!(e.flags&128))ux(),ai(),e.flags|=98560,a=!1;else if(a=Ko(e),r!==null&&r.dehydrated!==null){if(t===null){if(!a)throw Error(Z(318));if(a=e.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(Z(317));a[bn]=e}else ai(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;yt(e),a=!1}else dn!==null&&(ih(dn),dn=null),a=!0;if(!a)return e.flags&65536?e:null}return e.flags&128?(e.lanes=n,e):(r=r!==null,r!==(t!==null&&t.memoizedState!==null)&&r&&(e.child.flags|=8192,e.mode&1&&(t===null||Ve.current&1?Ze===0&&(Ze=3):vm())),e.updateQueue!==null&&(e.flags|=4),yt(e),null);case 4:return li(),Xd(t,e),t===null&&Aa(e.stateNode.containerInfo),yt(e),null;case 10:return nm(e.type._context),yt(e),null;case 17:return Lt(e.type)&&Ll(),yt(e),null;case 19:if(Me(Ve),a=e.memoizedState,a===null)return yt(e),null;if(r=(e.flags&128)!==0,o=a.rendering,o===null)if(r)Qi(a,!1);else{if(Ze!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(o=ql(t),o!==null){for(e.flags|=128,Qi(a,!1),r=o.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),e.subtreeFlags=0,r=n,n=e.child;n!==null;)a=n,t=r,a.flags&=14680066,o=a.alternate,o===null?(a.childLanes=0,a.lanes=t,a.child=null,a.subtreeFlags=0,a.memoizedProps=null,a.memoizedState=null,a.updateQueue=null,a.dependencies=null,a.stateNode=null):(a.childLanes=o.childLanes,a.lanes=o.lanes,a.child=o.child,a.subtreeFlags=0,a.deletions=null,a.memoizedProps=o.memoizedProps,a.memoizedState=o.memoizedState,a.updateQueue=o.updateQueue,a.type=o.type,t=o.dependencies,a.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return Ae(Ve,Ve.current&1|2),e.child}t=t.sibling}a.tail!==null&&We()>ui&&(e.flags|=128,r=!0,Qi(a,!1),e.lanes=4194304)}else{if(!r)if(t=ql(o),t!==null){if(e.flags|=128,r=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),Qi(a,!0),a.tail===null&&a.tailMode==="hidden"&&!o.alternate&&!Oe)return yt(e),null}else 2*We()-a.renderingStartTime>ui&&n!==1073741824&&(e.flags|=128,r=!0,Qi(a,!1),e.lanes=4194304);a.isBackwards?(o.sibling=e.child,e.child=o):(n=a.last,n!==null?n.sibling=o:e.child=o,a.last=o)}return a.tail!==null?(e=a.tail,a.rendering=e,a.tail=e.sibling,a.renderingStartTime=We(),e.sibling=null,n=Ve.current,Ae(Ve,r?n&1|2:n&1),e):(yt(e),null);case 22:case 23:return xm(),r=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==r&&(e.flags|=8192),r&&e.mode&1?zt&1073741824&&(yt(e),e.subtreeFlags&6&&(e.flags|=8192)):yt(e),null;case 24:return null;case 25:return null}throw Error(Z(156,e.tag))}function gE(t,e){switch(Jh(e),e.tag){case 1:return Lt(e.type)&&Ll(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return li(),Me(Ot),Me(Nt),om(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return am(e),null;case 13:if(Me(Ve),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(Z(340));ai()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return Me(Ve),null;case 4:return li(),null;case 10:return nm(e.type._context),null;case 22:case 23:return xm(),null;case 24:return null;default:return null}}var Xo=!1,bt=!1,yE=typeof WeakSet=="function"?WeakSet:Set,ie=null;function qs(t,e){var n=t.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(r){ze(t,e,r)}else n.current=null}function Jd(t,e,n){try{n()}catch(r){ze(t,e,r)}}var xg=!1;function xE(t,e){if(Md=Rl,t=X0(),Yh(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var r=n.getSelection&&n.getSelection();if(r&&r.rangeCount!==0){n=r.anchorNode;var s=r.anchorOffset,a=r.focusNode;r=r.focusOffset;try{n.nodeType,a.nodeType}catch{n=null;break e}var o=0,c=-1,u=-1,d=0,m=0,y=t,g=null;t:for(;;){for(var x;y!==n||s!==0&&y.nodeType!==3||(c=o+s),y!==a||r!==0&&y.nodeType!==3||(u=o+r),y.nodeType===3&&(o+=y.nodeValue.length),(x=y.firstChild)!==null;)g=y,y=x;for(;;){if(y===t)break t;if(g===n&&++d===s&&(c=o),g===a&&++m===r&&(u=o),(x=y.nextSibling)!==null)break;y=g,g=y.parentNode}y=x}n=c===-1||u===-1?null:{start:c,end:u}}else n=null}n=n||{start:0,end:0}}else n=null;for(Od={focusedElem:t,selectionRange:n},Rl=!1,ie=e;ie!==null;)if(e=ie,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,ie=t;else for(;ie!==null;){e=ie;try{var C=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(C!==null){var E=C.memoizedProps,A=C.memoizedState,N=e.stateNode,T=N.getSnapshotBeforeUpdate(e.elementType===e.type?E:cn(e.type,E),A);N.__reactInternalSnapshotBeforeUpdate=T}break;case 3:var k=e.stateNode.containerInfo;k.nodeType===1?k.textContent="":k.nodeType===9&&k.documentElement&&k.removeChild(k.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(Z(163))}}catch(L){ze(e,e.return,L)}if(t=e.sibling,t!==null){t.return=e.return,ie=t;break}ie=e.return}return C=xg,xg=!1,C}function fa(t,e,n){var r=e.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var s=r=r.next;do{if((s.tag&t)===t){var a=s.destroy;s.destroy=void 0,a!==void 0&&Jd(e,n,a)}s=s.next}while(s!==r)}}function Ac(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var n=e=e.next;do{if((n.tag&t)===t){var r=n.create;n.destroy=r()}n=n.next}while(n!==e)}}function Zd(t){var e=t.ref;if(e!==null){var n=t.stateNode;switch(t.tag){case 5:t=n;break;default:t=n}typeof e=="function"?e(t):e.current=t}}function Wx(t){var e=t.alternate;e!==null&&(t.alternate=null,Wx(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[bn],delete e[Pa],delete e[Fd],delete e[eE],delete e[tE])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function Kx(t){return t.tag===5||t.tag===3||t.tag===4}function vg(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||Kx(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function eh(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=Ol));else if(r!==4&&(t=t.child,t!==null))for(eh(t,e,n),t=t.sibling;t!==null;)eh(t,e,n),t=t.sibling}function th(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(r!==4&&(t=t.child,t!==null))for(th(t,e,n),t=t.sibling;t!==null;)th(t,e,n),t=t.sibling}var at=null,un=!1;function dr(t,e,n){for(n=n.child;n!==null;)Qx(t,e,n),n=n.sibling}function Qx(t,e,n){if(_n&&typeof _n.onCommitFiberUnmount=="function")try{_n.onCommitFiberUnmount(_c,n)}catch{}switch(n.tag){case 5:bt||qs(n,e);case 6:var r=at,s=un;at=null,dr(t,e,n),at=r,un=s,at!==null&&(un?(t=at,n=n.stateNode,t.nodeType===8?t.parentNode.removeChild(n):t.removeChild(n)):at.removeChild(n.stateNode));break;case 18:at!==null&&(un?(t=at,n=n.stateNode,t.nodeType===8?Hu(t.parentNode,n):t.nodeType===1&&Hu(t,n),Sa(t)):Hu(at,n.stateNode));break;case 4:r=at,s=un,at=n.stateNode.containerInfo,un=!0,dr(t,e,n),at=r,un=s;break;case 0:case 11:case 14:case 15:if(!bt&&(r=n.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){s=r=r.next;do{var a=s,o=a.destroy;a=a.tag,o!==void 0&&(a&2||a&4)&&Jd(n,e,o),s=s.next}while(s!==r)}dr(t,e,n);break;case 1:if(!bt&&(qs(n,e),r=n.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(c){ze(n,e,c)}dr(t,e,n);break;case 21:dr(t,e,n);break;case 22:n.mode&1?(bt=(r=bt)||n.memoizedState!==null,dr(t,e,n),bt=r):dr(t,e,n);break;default:dr(t,e,n)}}function bg(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new yE),e.forEach(function(r){var s=SE.bind(null,t,r);n.has(r)||(n.add(r),r.then(s,s))})}}function ln(t,e){var n=e.deletions;if(n!==null)for(var r=0;r<n.length;r++){var s=n[r];try{var a=t,o=e,c=o;e:for(;c!==null;){switch(c.tag){case 5:at=c.stateNode,un=!1;break e;case 3:at=c.stateNode.containerInfo,un=!0;break e;case 4:at=c.stateNode.containerInfo,un=!0;break e}c=c.return}if(at===null)throw Error(Z(160));Qx(a,o,s),at=null,un=!1;var u=s.alternate;u!==null&&(u.return=null),s.return=null}catch(d){ze(s,e,d)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)Yx(e,t),e=e.sibling}function Yx(t,e){var n=t.alternate,r=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(ln(e,t),xn(t),r&4){try{fa(3,t,t.return),Ac(3,t)}catch(E){ze(t,t.return,E)}try{fa(5,t,t.return)}catch(E){ze(t,t.return,E)}}break;case 1:ln(e,t),xn(t),r&512&&n!==null&&qs(n,n.return);break;case 5:if(ln(e,t),xn(t),r&512&&n!==null&&qs(n,n.return),t.flags&32){var s=t.stateNode;try{Na(s,"")}catch(E){ze(t,t.return,E)}}if(r&4&&(s=t.stateNode,s!=null)){var a=t.memoizedProps,o=n!==null?n.memoizedProps:a,c=t.type,u=t.updateQueue;if(t.updateQueue=null,u!==null)try{c==="input"&&a.type==="radio"&&a.name!=null&&x0(s,a),Td(c,o);var d=Td(c,a);for(o=0;o<u.length;o+=2){var m=u[o],y=u[o+1];m==="style"?N0(s,y):m==="dangerouslySetInnerHTML"?w0(s,y):m==="children"?Na(s,y):Lh(s,m,y,d)}switch(c){case"input":bd(s,a);break;case"textarea":v0(s,a);break;case"select":var g=s._wrapperState.wasMultiple;s._wrapperState.wasMultiple=!!a.multiple;var x=a.value;x!=null?Ws(s,!!a.multiple,x,!1):g!==!!a.multiple&&(a.defaultValue!=null?Ws(s,!!a.multiple,a.defaultValue,!0):Ws(s,!!a.multiple,a.multiple?[]:"",!1))}s[Pa]=a}catch(E){ze(t,t.return,E)}}break;case 6:if(ln(e,t),xn(t),r&4){if(t.stateNode===null)throw Error(Z(162));s=t.stateNode,a=t.memoizedProps;try{s.nodeValue=a}catch(E){ze(t,t.return,E)}}break;case 3:if(ln(e,t),xn(t),r&4&&n!==null&&n.memoizedState.isDehydrated)try{Sa(e.containerInfo)}catch(E){ze(t,t.return,E)}break;case 4:ln(e,t),xn(t);break;case 13:ln(e,t),xn(t),s=t.child,s.flags&8192&&(a=s.memoizedState!==null,s.stateNode.isHidden=a,!a||s.alternate!==null&&s.alternate.memoizedState!==null||(gm=We())),r&4&&bg(t);break;case 22:if(m=n!==null&&n.memoizedState!==null,t.mode&1?(bt=(d=bt)||m,ln(e,t),bt=d):ln(e,t),xn(t),r&8192){if(d=t.memoizedState!==null,(t.stateNode.isHidden=d)&&!m&&t.mode&1)for(ie=t,m=t.child;m!==null;){for(y=ie=m;ie!==null;){switch(g=ie,x=g.child,g.tag){case 0:case 11:case 14:case 15:fa(4,g,g.return);break;case 1:qs(g,g.return);var C=g.stateNode;if(typeof C.componentWillUnmount=="function"){r=g,n=g.return;try{e=r,C.props=e.memoizedProps,C.state=e.memoizedState,C.componentWillUnmount()}catch(E){ze(r,n,E)}}break;case 5:qs(g,g.return);break;case 22:if(g.memoizedState!==null){_g(y);continue}}x!==null?(x.return=g,ie=x):_g(y)}m=m.sibling}e:for(m=null,y=t;;){if(y.tag===5){if(m===null){m=y;try{s=y.stateNode,d?(a=s.style,typeof a.setProperty=="function"?a.setProperty("display","none","important"):a.display="none"):(c=y.stateNode,u=y.memoizedProps.style,o=u!=null&&u.hasOwnProperty("display")?u.display:null,c.style.display=_0("display",o))}catch(E){ze(t,t.return,E)}}}else if(y.tag===6){if(m===null)try{y.stateNode.nodeValue=d?"":y.memoizedProps}catch(E){ze(t,t.return,E)}}else if((y.tag!==22&&y.tag!==23||y.memoizedState===null||y===t)&&y.child!==null){y.child.return=y,y=y.child;continue}if(y===t)break e;for(;y.sibling===null;){if(y.return===null||y.return===t)break e;m===y&&(m=null),y=y.return}m===y&&(m=null),y.sibling.return=y.return,y=y.sibling}}break;case 19:ln(e,t),xn(t),r&4&&bg(t);break;case 21:break;default:ln(e,t),xn(t)}}function xn(t){var e=t.flags;if(e&2){try{e:{for(var n=t.return;n!==null;){if(Kx(n)){var r=n;break e}n=n.return}throw Error(Z(160))}switch(r.tag){case 5:var s=r.stateNode;r.flags&32&&(Na(s,""),r.flags&=-33);var a=vg(t);th(t,a,s);break;case 3:case 4:var o=r.stateNode.containerInfo,c=vg(t);eh(t,c,o);break;default:throw Error(Z(161))}}catch(u){ze(t,t.return,u)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function vE(t,e,n){ie=t,Xx(t)}function Xx(t,e,n){for(var r=(t.mode&1)!==0;ie!==null;){var s=ie,a=s.child;if(s.tag===22&&r){var o=s.memoizedState!==null||Xo;if(!o){var c=s.alternate,u=c!==null&&c.memoizedState!==null||bt;c=Xo;var d=bt;if(Xo=o,(bt=u)&&!d)for(ie=s;ie!==null;)o=ie,u=o.child,o.tag===22&&o.memoizedState!==null?Ng(s):u!==null?(u.return=o,ie=u):Ng(s);for(;a!==null;)ie=a,Xx(a),a=a.sibling;ie=s,Xo=c,bt=d}wg(t)}else s.subtreeFlags&8772&&a!==null?(a.return=s,ie=a):wg(t)}}function wg(t){for(;ie!==null;){var e=ie;if(e.flags&8772){var n=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:bt||Ac(5,e);break;case 1:var r=e.stateNode;if(e.flags&4&&!bt)if(n===null)r.componentDidMount();else{var s=e.elementType===e.type?n.memoizedProps:cn(e.type,n.memoizedProps);r.componentDidUpdate(s,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var a=e.updateQueue;a!==null&&ig(e,a,r);break;case 3:var o=e.updateQueue;if(o!==null){if(n=null,e.child!==null)switch(e.child.tag){case 5:n=e.child.stateNode;break;case 1:n=e.child.stateNode}ig(e,o,n)}break;case 5:var c=e.stateNode;if(n===null&&e.flags&4){n=c;var u=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":u.autoFocus&&n.focus();break;case"img":u.src&&(n.src=u.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var d=e.alternate;if(d!==null){var m=d.memoizedState;if(m!==null){var y=m.dehydrated;y!==null&&Sa(y)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(Z(163))}bt||e.flags&512&&Zd(e)}catch(g){ze(e,e.return,g)}}if(e===t){ie=null;break}if(n=e.sibling,n!==null){n.return=e.return,ie=n;break}ie=e.return}}function _g(t){for(;ie!==null;){var e=ie;if(e===t){ie=null;break}var n=e.sibling;if(n!==null){n.return=e.return,ie=n;break}ie=e.return}}function Ng(t){for(;ie!==null;){var e=ie;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{Ac(4,e)}catch(u){ze(e,n,u)}break;case 1:var r=e.stateNode;if(typeof r.componentDidMount=="function"){var s=e.return;try{r.componentDidMount()}catch(u){ze(e,s,u)}}var a=e.return;try{Zd(e)}catch(u){ze(e,a,u)}break;case 5:var o=e.return;try{Zd(e)}catch(u){ze(e,o,u)}}}catch(u){ze(e,e.return,u)}if(e===t){ie=null;break}var c=e.sibling;if(c!==null){c.return=e.return,ie=c;break}ie=e.return}}var bE=Math.ceil,Wl=ir.ReactCurrentDispatcher,fm=ir.ReactCurrentOwner,en=ir.ReactCurrentBatchConfig,we=0,st=null,Qe=null,ct=0,zt=0,Hs=qr(0),Ze=0,Va=null,ms=0,kc=0,pm=0,pa=null,Rt=null,gm=0,ui=1/0,Vn=null,Kl=!1,nh=null,Ir=null,Jo=!1,_r=null,Ql=0,ga=0,rh=null,pl=-1,gl=0;function Ct(){return we&6?We():pl!==-1?pl:pl=We()}function Ar(t){return t.mode&1?we&2&&ct!==0?ct&-ct:rE.transition!==null?(gl===0&&(gl=M0()),gl):(t=Te,t!==0||(t=window.event,t=t===void 0?16:$0(t.type)),t):1}function fn(t,e,n,r){if(50<ga)throw ga=0,rh=null,Error(Z(185));Ya(t,n,r),(!(we&2)||t!==st)&&(t===st&&(!(we&2)&&(kc|=n),Ze===4&&gr(t,ct)),Vt(t,r),n===1&&we===0&&!(e.mode&1)&&(ui=We()+500,Sc&&Hr()))}function Vt(t,e){var n=t.callbackNode;rN(t,e);var r=Pl(t,t===st?ct:0);if(r===0)n!==null&&Pp(n),t.callbackNode=null,t.callbackPriority=0;else if(e=r&-r,t.callbackPriority!==e){if(n!=null&&Pp(n),e===1)t.tag===0?nE(Eg.bind(null,t)):ox(Eg.bind(null,t)),JN(function(){!(we&6)&&Hr()}),n=null;else{switch(O0(r)){case 1:n=$h;break;case 4:n=R0;break;case 16:n=kl;break;case 536870912:n=D0;break;default:n=kl}n=iv(n,Jx.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function Jx(t,e){if(pl=-1,gl=0,we&6)throw Error(Z(327));var n=t.callbackNode;if(Js()&&t.callbackNode!==n)return null;var r=Pl(t,t===st?ct:0);if(r===0)return null;if(r&30||r&t.expiredLanes||e)e=Yl(t,r);else{e=r;var s=we;we|=2;var a=ev();(st!==t||ct!==e)&&(Vn=null,ui=We()+500,is(t,e));do try{NE();break}catch(c){Zx(t,c)}while(!0);tm(),Wl.current=a,we=s,Qe!==null?e=0:(st=null,ct=0,e=Ze)}if(e!==0){if(e===2&&(s=Ad(t),s!==0&&(r=s,e=sh(t,s))),e===1)throw n=Va,is(t,0),gr(t,r),Vt(t,We()),n;if(e===6)gr(t,r);else{if(s=t.current.alternate,!(r&30)&&!wE(s)&&(e=Yl(t,r),e===2&&(a=Ad(t),a!==0&&(r=a,e=sh(t,a))),e===1))throw n=Va,is(t,0),gr(t,r),Vt(t,We()),n;switch(t.finishedWork=s,t.finishedLanes=r,e){case 0:case 1:throw Error(Z(345));case 2:Jr(t,Rt,Vn);break;case 3:if(gr(t,r),(r&130023424)===r&&(e=gm+500-We(),10<e)){if(Pl(t,0)!==0)break;if(s=t.suspendedLanes,(s&r)!==r){Ct(),t.pingedLanes|=t.suspendedLanes&s;break}t.timeoutHandle=Vd(Jr.bind(null,t,Rt,Vn),e);break}Jr(t,Rt,Vn);break;case 4:if(gr(t,r),(r&4194240)===r)break;for(e=t.eventTimes,s=-1;0<r;){var o=31-mn(r);a=1<<o,o=e[o],o>s&&(s=o),r&=~a}if(r=s,r=We()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*bE(r/1960))-r,10<r){t.timeoutHandle=Vd(Jr.bind(null,t,Rt,Vn),r);break}Jr(t,Rt,Vn);break;case 5:Jr(t,Rt,Vn);break;default:throw Error(Z(329))}}}return Vt(t,We()),t.callbackNode===n?Jx.bind(null,t):null}function sh(t,e){var n=pa;return t.current.memoizedState.isDehydrated&&(is(t,e).flags|=256),t=Yl(t,e),t!==2&&(e=Rt,Rt=n,e!==null&&ih(e)),t}function ih(t){Rt===null?Rt=t:Rt.push.apply(Rt,t)}function wE(t){for(var e=t;;){if(e.flags&16384){var n=e.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var r=0;r<n.length;r++){var s=n[r],a=s.getSnapshot;s=s.value;try{if(!pn(a(),s))return!1}catch{return!1}}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function gr(t,e){for(e&=~pm,e&=~kc,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-mn(e),r=1<<n;t[n]=-1,e&=~r}}function Eg(t){if(we&6)throw Error(Z(327));Js();var e=Pl(t,0);if(!(e&1))return Vt(t,We()),null;var n=Yl(t,e);if(t.tag!==0&&n===2){var r=Ad(t);r!==0&&(e=r,n=sh(t,r))}if(n===1)throw n=Va,is(t,0),gr(t,e),Vt(t,We()),n;if(n===6)throw Error(Z(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,Jr(t,Rt,Vn),Vt(t,We()),null}function ym(t,e){var n=we;we|=1;try{return t(e)}finally{we=n,we===0&&(ui=We()+500,Sc&&Hr())}}function fs(t){_r!==null&&_r.tag===0&&!(we&6)&&Js();var e=we;we|=1;var n=en.transition,r=Te;try{if(en.transition=null,Te=1,t)return t()}finally{Te=r,en.transition=n,we=e,!(we&6)&&Hr()}}function xm(){zt=Hs.current,Me(Hs)}function is(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,XN(n)),Qe!==null)for(n=Qe.return;n!==null;){var r=n;switch(Jh(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&Ll();break;case 3:li(),Me(Ot),Me(Nt),om();break;case 5:am(r);break;case 4:li();break;case 13:Me(Ve);break;case 19:Me(Ve);break;case 10:nm(r.type._context);break;case 22:case 23:xm()}n=n.return}if(st=t,Qe=t=kr(t.current,null),ct=zt=e,Ze=0,Va=null,pm=kc=ms=0,Rt=pa=null,ts!==null){for(e=0;e<ts.length;e++)if(n=ts[e],r=n.interleaved,r!==null){n.interleaved=null;var s=r.next,a=n.pending;if(a!==null){var o=a.next;a.next=s,r.next=o}n.pending=r}ts=null}return t}function Zx(t,e){do{var n=Qe;try{if(tm(),hl.current=Gl,Hl){for(var r=Fe.memoizedState;r!==null;){var s=r.queue;s!==null&&(s.pending=null),r=r.next}Hl=!1}if(hs=0,nt=Xe=Fe=null,ma=!1,Ma=0,fm.current=null,n===null||n.return===null){Ze=1,Va=e,Qe=null;break}e:{var a=t,o=n.return,c=n,u=e;if(e=ct,c.flags|=32768,u!==null&&typeof u=="object"&&typeof u.then=="function"){var d=u,m=c,y=m.tag;if(!(m.mode&1)&&(y===0||y===11||y===15)){var g=m.alternate;g?(m.updateQueue=g.updateQueue,m.memoizedState=g.memoizedState,m.lanes=g.lanes):(m.updateQueue=null,m.memoizedState=null)}var x=dg(o);if(x!==null){x.flags&=-257,hg(x,o,c,a,e),x.mode&1&&ug(a,d,e),e=x,u=d;var C=e.updateQueue;if(C===null){var E=new Set;E.add(u),e.updateQueue=E}else C.add(u);break e}else{if(!(e&1)){ug(a,d,e),vm();break e}u=Error(Z(426))}}else if(Oe&&c.mode&1){var A=dg(o);if(A!==null){!(A.flags&65536)&&(A.flags|=256),hg(A,o,c,a,e),Zh(ci(u,c));break e}}a=u=ci(u,c),Ze!==4&&(Ze=2),pa===null?pa=[a]:pa.push(a),a=o;do{switch(a.tag){case 3:a.flags|=65536,e&=-e,a.lanes|=e;var N=Ox(a,u,e);sg(a,N);break e;case 1:c=u;var T=a.type,k=a.stateNode;if(!(a.flags&128)&&(typeof T.getDerivedStateFromError=="function"||k!==null&&typeof k.componentDidCatch=="function"&&(Ir===null||!Ir.has(k)))){a.flags|=65536,e&=-e,a.lanes|=e;var L=Lx(a,c,e);sg(a,L);break e}}a=a.return}while(a!==null)}nv(n)}catch(q){e=q,Qe===n&&n!==null&&(Qe=n=n.return);continue}break}while(!0)}function ev(){var t=Wl.current;return Wl.current=Gl,t===null?Gl:t}function vm(){(Ze===0||Ze===3||Ze===2)&&(Ze=4),st===null||!(ms&268435455)&&!(kc&268435455)||gr(st,ct)}function Yl(t,e){var n=we;we|=2;var r=ev();(st!==t||ct!==e)&&(Vn=null,is(t,e));do try{_E();break}catch(s){Zx(t,s)}while(!0);if(tm(),we=n,Wl.current=r,Qe!==null)throw Error(Z(261));return st=null,ct=0,Ze}function _E(){for(;Qe!==null;)tv(Qe)}function NE(){for(;Qe!==null&&!K_();)tv(Qe)}function tv(t){var e=sv(t.alternate,t,zt);t.memoizedProps=t.pendingProps,e===null?nv(t):Qe=e,fm.current=null}function nv(t){var e=t;do{var n=e.alternate;if(t=e.return,e.flags&32768){if(n=gE(n,e),n!==null){n.flags&=32767,Qe=n;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{Ze=6,Qe=null;return}}else if(n=pE(n,e,zt),n!==null){Qe=n;return}if(e=e.sibling,e!==null){Qe=e;return}Qe=e=t}while(e!==null);Ze===0&&(Ze=5)}function Jr(t,e,n){var r=Te,s=en.transition;try{en.transition=null,Te=1,EE(t,e,n,r)}finally{en.transition=s,Te=r}return null}function EE(t,e,n,r){do Js();while(_r!==null);if(we&6)throw Error(Z(327));n=t.finishedWork;var s=t.finishedLanes;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(Z(177));t.callbackNode=null,t.callbackPriority=0;var a=n.lanes|n.childLanes;if(sN(t,a),t===st&&(Qe=st=null,ct=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||Jo||(Jo=!0,iv(kl,function(){return Js(),null})),a=(n.flags&15990)!==0,n.subtreeFlags&15990||a){a=en.transition,en.transition=null;var o=Te;Te=1;var c=we;we|=4,fm.current=null,xE(t,n),Yx(n,t),qN(Od),Rl=!!Md,Od=Md=null,t.current=n,vE(n),Q_(),we=c,Te=o,en.transition=a}else t.current=n;if(Jo&&(Jo=!1,_r=t,Ql=s),a=t.pendingLanes,a===0&&(Ir=null),J_(n.stateNode),Vt(t,We()),e!==null)for(r=t.onRecoverableError,n=0;n<e.length;n++)s=e[n],r(s.value,{componentStack:s.stack,digest:s.digest});if(Kl)throw Kl=!1,t=nh,nh=null,t;return Ql&1&&t.tag!==0&&Js(),a=t.pendingLanes,a&1?t===rh?ga++:(ga=0,rh=t):ga=0,Hr(),null}function Js(){if(_r!==null){var t=O0(Ql),e=en.transition,n=Te;try{if(en.transition=null,Te=16>t?16:t,_r===null)var r=!1;else{if(t=_r,_r=null,Ql=0,we&6)throw Error(Z(331));var s=we;for(we|=4,ie=t.current;ie!==null;){var a=ie,o=a.child;if(ie.flags&16){var c=a.deletions;if(c!==null){for(var u=0;u<c.length;u++){var d=c[u];for(ie=d;ie!==null;){var m=ie;switch(m.tag){case 0:case 11:case 15:fa(8,m,a)}var y=m.child;if(y!==null)y.return=m,ie=y;else for(;ie!==null;){m=ie;var g=m.sibling,x=m.return;if(Wx(m),m===d){ie=null;break}if(g!==null){g.return=x,ie=g;break}ie=x}}}var C=a.alternate;if(C!==null){var E=C.child;if(E!==null){C.child=null;do{var A=E.sibling;E.sibling=null,E=A}while(E!==null)}}ie=a}}if(a.subtreeFlags&2064&&o!==null)o.return=a,ie=o;else e:for(;ie!==null;){if(a=ie,a.flags&2048)switch(a.tag){case 0:case 11:case 15:fa(9,a,a.return)}var N=a.sibling;if(N!==null){N.return=a.return,ie=N;break e}ie=a.return}}var T=t.current;for(ie=T;ie!==null;){o=ie;var k=o.child;if(o.subtreeFlags&2064&&k!==null)k.return=o,ie=k;else e:for(o=T;ie!==null;){if(c=ie,c.flags&2048)try{switch(c.tag){case 0:case 11:case 15:Ac(9,c)}}catch(q){ze(c,c.return,q)}if(c===o){ie=null;break e}var L=c.sibling;if(L!==null){L.return=c.return,ie=L;break e}ie=c.return}}if(we=s,Hr(),_n&&typeof _n.onPostCommitFiberRoot=="function")try{_n.onPostCommitFiberRoot(_c,t)}catch{}r=!0}return r}finally{Te=n,en.transition=e}}return!1}function Tg(t,e,n){e=ci(n,e),e=Ox(t,e,1),t=Cr(t,e,1),e=Ct(),t!==null&&(Ya(t,1,e),Vt(t,e))}function ze(t,e,n){if(t.tag===3)Tg(t,t,n);else for(;e!==null;){if(e.tag===3){Tg(e,t,n);break}else if(e.tag===1){var r=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(Ir===null||!Ir.has(r))){t=ci(n,t),t=Lx(e,t,1),e=Cr(e,t,1),t=Ct(),e!==null&&(Ya(e,1,t),Vt(e,t));break}}e=e.return}}function TE(t,e,n){var r=t.pingCache;r!==null&&r.delete(e),e=Ct(),t.pingedLanes|=t.suspendedLanes&n,st===t&&(ct&n)===n&&(Ze===4||Ze===3&&(ct&130023424)===ct&&500>We()-gm?is(t,0):pm|=n),Vt(t,e)}function rv(t,e){e===0&&(t.mode&1?(e=$o,$o<<=1,!($o&130023424)&&($o=4194304)):e=1);var n=Ct();t=Yn(t,e),t!==null&&(Ya(t,e,n),Vt(t,n))}function jE(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),rv(t,n)}function SE(t,e){var n=0;switch(t.tag){case 13:var r=t.stateNode,s=t.memoizedState;s!==null&&(n=s.retryLane);break;case 19:r=t.stateNode;break;default:throw Error(Z(314))}r!==null&&r.delete(e),rv(t,n)}var sv;sv=function(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps||Ot.current)Mt=!0;else{if(!(t.lanes&n)&&!(e.flags&128))return Mt=!1,fE(t,e,n);Mt=!!(t.flags&131072)}else Mt=!1,Oe&&e.flags&1048576&&lx(e,Ul,e.index);switch(e.lanes=0,e.tag){case 2:var r=e.type;fl(t,e),t=e.pendingProps;var s=ii(e,Nt.current);Xs(e,n),s=cm(null,e,r,t,s,n);var a=um();return e.flags|=1,typeof s=="object"&&s!==null&&typeof s.render=="function"&&s.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,Lt(r)?(a=!0,Vl(e)):a=!1,e.memoizedState=s.state!==null&&s.state!==void 0?s.state:null,sm(e),s.updater=Ic,e.stateNode=s,s._reactInternals=e,Hd(e,r,t,n),e=Kd(null,e,r,!0,a,n)):(e.tag=0,Oe&&a&&Xh(e),St(null,e,s,n),e=e.child),e;case 16:r=e.elementType;e:{switch(fl(t,e),t=e.pendingProps,s=r._init,r=s(r._payload),e.type=r,s=e.tag=IE(r),t=cn(r,t),s){case 0:e=Wd(null,e,r,t,n);break e;case 1:e=pg(null,e,r,t,n);break e;case 11:e=mg(null,e,r,t,n);break e;case 14:e=fg(null,e,r,cn(r.type,t),n);break e}throw Error(Z(306,r,""))}return e;case 0:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:cn(r,s),Wd(t,e,r,s,n);case 1:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:cn(r,s),pg(t,e,r,s,n);case 3:e:{if(Bx(e),t===null)throw Error(Z(387));r=e.pendingProps,a=e.memoizedState,s=a.element,fx(t,e),zl(e,r,null,n);var o=e.memoizedState;if(r=o.element,a.isDehydrated)if(a={element:r,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=a,e.memoizedState=a,e.flags&256){s=ci(Error(Z(423)),e),e=gg(t,e,r,n,s);break e}else if(r!==s){s=ci(Error(Z(424)),e),e=gg(t,e,r,n,s);break e}else for(qt=Sr(e.stateNode.containerInfo.firstChild),Gt=e,Oe=!0,dn=null,n=hx(e,null,r,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(ai(),r===s){e=Xn(t,e,n);break e}St(t,e,r,n)}e=e.child}return e;case 5:return px(e),t===null&&$d(e),r=e.type,s=e.pendingProps,a=t!==null?t.memoizedProps:null,o=s.children,Ld(r,s)?o=null:a!==null&&Ld(r,a)&&(e.flags|=32),Ux(t,e),St(t,e,o,n),e.child;case 6:return t===null&&$d(e),null;case 13:return $x(t,e,n);case 4:return im(e,e.stateNode.containerInfo),r=e.pendingProps,t===null?e.child=oi(e,null,r,n):St(t,e,r,n),e.child;case 11:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:cn(r,s),mg(t,e,r,s,n);case 7:return St(t,e,e.pendingProps,n),e.child;case 8:return St(t,e,e.pendingProps.children,n),e.child;case 12:return St(t,e,e.pendingProps.children,n),e.child;case 10:e:{if(r=e.type._context,s=e.pendingProps,a=e.memoizedProps,o=s.value,Ae(Bl,r._currentValue),r._currentValue=o,a!==null)if(pn(a.value,o)){if(a.children===s.children&&!Ot.current){e=Xn(t,e,n);break e}}else for(a=e.child,a!==null&&(a.return=e);a!==null;){var c=a.dependencies;if(c!==null){o=a.child;for(var u=c.firstContext;u!==null;){if(u.context===r){if(a.tag===1){u=Hn(-1,n&-n),u.tag=2;var d=a.updateQueue;if(d!==null){d=d.shared;var m=d.pending;m===null?u.next=u:(u.next=m.next,m.next=u),d.pending=u}}a.lanes|=n,u=a.alternate,u!==null&&(u.lanes|=n),zd(a.return,n,e),c.lanes|=n;break}u=u.next}}else if(a.tag===10)o=a.type===e.type?null:a.child;else if(a.tag===18){if(o=a.return,o===null)throw Error(Z(341));o.lanes|=n,c=o.alternate,c!==null&&(c.lanes|=n),zd(o,n,e),o=a.sibling}else o=a.child;if(o!==null)o.return=a;else for(o=a;o!==null;){if(o===e){o=null;break}if(a=o.sibling,a!==null){a.return=o.return,o=a;break}o=o.return}a=o}St(t,e,s.children,n),e=e.child}return e;case 9:return s=e.type,r=e.pendingProps.children,Xs(e,n),s=rn(s),r=r(s),e.flags|=1,St(t,e,r,n),e.child;case 14:return r=e.type,s=cn(r,e.pendingProps),s=cn(r.type,s),fg(t,e,r,s,n);case 15:return Vx(t,e,e.type,e.pendingProps,n);case 17:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:cn(r,s),fl(t,e),e.tag=1,Lt(r)?(t=!0,Vl(e)):t=!1,Xs(e,n),Mx(e,r,s),Hd(e,r,s,n),Kd(null,e,r,!0,t,n);case 19:return zx(t,e,n);case 22:return Fx(t,e,n)}throw Error(Z(156,e.tag))};function iv(t,e){return P0(t,e)}function CE(t,e,n,r){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Zt(t,e,n,r){return new CE(t,e,n,r)}function bm(t){return t=t.prototype,!(!t||!t.isReactComponent)}function IE(t){if(typeof t=="function")return bm(t)?1:0;if(t!=null){if(t=t.$$typeof,t===Fh)return 11;if(t===Uh)return 14}return 2}function kr(t,e){var n=t.alternate;return n===null?(n=Zt(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&14680064,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function yl(t,e,n,r,s,a){var o=2;if(r=t,typeof t=="function")bm(t)&&(o=1);else if(typeof t=="string")o=5;else e:switch(t){case Ms:return as(n.children,s,a,e);case Vh:o=8,s|=8;break;case pd:return t=Zt(12,n,e,s|2),t.elementType=pd,t.lanes=a,t;case gd:return t=Zt(13,n,e,s),t.elementType=gd,t.lanes=a,t;case yd:return t=Zt(19,n,e,s),t.elementType=yd,t.lanes=a,t;case p0:return Pc(n,s,a,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case m0:o=10;break e;case f0:o=9;break e;case Fh:o=11;break e;case Uh:o=14;break e;case mr:o=16,r=null;break e}throw Error(Z(130,t==null?t:typeof t,""))}return e=Zt(o,n,e,s),e.elementType=t,e.type=r,e.lanes=a,e}function as(t,e,n,r){return t=Zt(7,t,r,e),t.lanes=n,t}function Pc(t,e,n,r){return t=Zt(22,t,r,e),t.elementType=p0,t.lanes=n,t.stateNode={isHidden:!1},t}function Zu(t,e,n){return t=Zt(6,t,null,e),t.lanes=n,t}function ed(t,e,n){return e=Zt(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function AE(t,e,n,r,s){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Du(0),this.expirationTimes=Du(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Du(0),this.identifierPrefix=r,this.onRecoverableError=s,this.mutableSourceEagerHydrationData=null}function wm(t,e,n,r,s,a,o,c,u){return t=new AE(t,e,n,c,u),e===1?(e=1,a===!0&&(e|=8)):e=0,a=Zt(3,null,null,e),t.current=a,a.stateNode=t,a.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},sm(a),t}function kE(t,e,n){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Ds,key:r==null?null:""+r,children:t,containerInfo:e,implementation:n}}function av(t){if(!t)return Lr;t=t._reactInternals;e:{if(ws(t)!==t||t.tag!==1)throw Error(Z(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(Lt(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(Z(171))}if(t.tag===1){var n=t.type;if(Lt(n))return ax(t,n,e)}return e}function ov(t,e,n,r,s,a,o,c,u){return t=wm(n,r,!0,t,s,a,o,c,u),t.context=av(null),n=t.current,r=Ct(),s=Ar(n),a=Hn(r,s),a.callback=e??null,Cr(n,a,s),t.current.lanes=s,Ya(t,s,r),Vt(t,r),t}function Rc(t,e,n,r){var s=e.current,a=Ct(),o=Ar(s);return n=av(n),e.context===null?e.context=n:e.pendingContext=n,e=Hn(a,o),e.payload={element:t},r=r===void 0?null:r,r!==null&&(e.callback=r),t=Cr(s,e,o),t!==null&&(fn(t,s,o,a),dl(t,s,o)),o}function Xl(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function jg(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function _m(t,e){jg(t,e),(t=t.alternate)&&jg(t,e)}function PE(){return null}var lv=typeof reportError=="function"?reportError:function(t){console.error(t)};function Nm(t){this._internalRoot=t}Dc.prototype.render=Nm.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(Z(409));Rc(t,e,null,null)};Dc.prototype.unmount=Nm.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;fs(function(){Rc(null,t,null,null)}),e[Qn]=null}};function Dc(t){this._internalRoot=t}Dc.prototype.unstable_scheduleHydration=function(t){if(t){var e=F0();t={blockedOn:null,target:t,priority:e};for(var n=0;n<pr.length&&e!==0&&e<pr[n].priority;n++);pr.splice(n,0,t),n===0&&B0(t)}};function Em(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function Mc(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function Sg(){}function RE(t,e,n,r,s){if(s){if(typeof r=="function"){var a=r;r=function(){var d=Xl(o);a.call(d)}}var o=ov(e,r,t,0,null,!1,!1,"",Sg);return t._reactRootContainer=o,t[Qn]=o.current,Aa(t.nodeType===8?t.parentNode:t),fs(),o}for(;s=t.lastChild;)t.removeChild(s);if(typeof r=="function"){var c=r;r=function(){var d=Xl(u);c.call(d)}}var u=wm(t,0,!1,null,null,!1,!1,"",Sg);return t._reactRootContainer=u,t[Qn]=u.current,Aa(t.nodeType===8?t.parentNode:t),fs(function(){Rc(e,u,n,r)}),u}function Oc(t,e,n,r,s){var a=n._reactRootContainer;if(a){var o=a;if(typeof s=="function"){var c=s;s=function(){var u=Xl(o);c.call(u)}}Rc(e,o,t,s)}else o=RE(n,e,t,s,r);return Xl(o)}L0=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=ea(e.pendingLanes);n!==0&&(zh(e,n|1),Vt(e,We()),!(we&6)&&(ui=We()+500,Hr()))}break;case 13:fs(function(){var r=Yn(t,1);if(r!==null){var s=Ct();fn(r,t,1,s)}}),_m(t,1)}};qh=function(t){if(t.tag===13){var e=Yn(t,134217728);if(e!==null){var n=Ct();fn(e,t,134217728,n)}_m(t,134217728)}};V0=function(t){if(t.tag===13){var e=Ar(t),n=Yn(t,e);if(n!==null){var r=Ct();fn(n,t,e,r)}_m(t,e)}};F0=function(){return Te};U0=function(t,e){var n=Te;try{return Te=t,e()}finally{Te=n}};Sd=function(t,e,n){switch(e){case"input":if(bd(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var r=n[e];if(r!==t&&r.form===t.form){var s=jc(r);if(!s)throw Error(Z(90));y0(r),bd(r,s)}}}break;case"textarea":v0(t,n);break;case"select":e=n.value,e!=null&&Ws(t,!!n.multiple,e,!1)}};j0=ym;S0=fs;var DE={usingClientEntryPoint:!1,Events:[Ja,Fs,jc,E0,T0,ym]},Yi={findFiberByHostInstance:es,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},ME={bundleType:Yi.bundleType,version:Yi.version,rendererPackageName:Yi.rendererPackageName,rendererConfig:Yi.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:ir.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=A0(t),t===null?null:t.stateNode},findFiberByHostInstance:Yi.findFiberByHostInstance||PE,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Zo=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Zo.isDisabled&&Zo.supportsFiber)try{_c=Zo.inject(ME),_n=Zo}catch{}}Kt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=DE;Kt.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Em(e))throw Error(Z(200));return kE(t,e,null,n)};Kt.createRoot=function(t,e){if(!Em(t))throw Error(Z(299));var n=!1,r="",s=lv;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(r=e.identifierPrefix),e.onRecoverableError!==void 0&&(s=e.onRecoverableError)),e=wm(t,1,!1,null,null,n,!1,r,s),t[Qn]=e.current,Aa(t.nodeType===8?t.parentNode:t),new Nm(e)};Kt.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(Z(188)):(t=Object.keys(t).join(","),Error(Z(268,t)));return t=A0(e),t=t===null?null:t.stateNode,t};Kt.flushSync=function(t){return fs(t)};Kt.hydrate=function(t,e,n){if(!Mc(e))throw Error(Z(200));return Oc(null,t,e,!0,n)};Kt.hydrateRoot=function(t,e,n){if(!Em(t))throw Error(Z(405));var r=n!=null&&n.hydratedSources||null,s=!1,a="",o=lv;if(n!=null&&(n.unstable_strictMode===!0&&(s=!0),n.identifierPrefix!==void 0&&(a=n.identifierPrefix),n.onRecoverableError!==void 0&&(o=n.onRecoverableError)),e=ov(e,null,t,1,n??null,s,!1,a,o),t[Qn]=e.current,Aa(t),r)for(t=0;t<r.length;t++)n=r[t],s=n._getVersion,s=s(n._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[n,s]:e.mutableSourceEagerHydrationData.push(n,s);return new Dc(e)};Kt.render=function(t,e,n){if(!Mc(e))throw Error(Z(200));return Oc(null,t,e,!1,n)};Kt.unmountComponentAtNode=function(t){if(!Mc(t))throw Error(Z(40));return t._reactRootContainer?(fs(function(){Oc(null,null,t,!1,function(){t._reactRootContainer=null,t[Qn]=null})}),!0):!1};Kt.unstable_batchedUpdates=ym;Kt.unstable_renderSubtreeIntoContainer=function(t,e,n,r){if(!Mc(n))throw Error(Z(200));if(t==null||t._reactInternals===void 0)throw Error(Z(38));return Oc(t,e,n,!1,r)};Kt.version="18.3.1-next-f1338f8080-20240426";function cv(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(cv)}catch(t){console.error(t)}}cv(),c0.exports=Kt;var OE=c0.exports,Cg=OE;md.createRoot=Cg.createRoot,md.hydrateRoot=Cg.hydrateRoot;var Ig={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uv=function(t){const e=[];let n=0;for(let r=0;r<t.length;r++){let s=t.charCodeAt(r);s<128?e[n++]=s:s<2048?(e[n++]=s>>6|192,e[n++]=s&63|128):(s&64512)===55296&&r+1<t.length&&(t.charCodeAt(r+1)&64512)===56320?(s=65536+((s&1023)<<10)+(t.charCodeAt(++r)&1023),e[n++]=s>>18|240,e[n++]=s>>12&63|128,e[n++]=s>>6&63|128,e[n++]=s&63|128):(e[n++]=s>>12|224,e[n++]=s>>6&63|128,e[n++]=s&63|128)}return e},LE=function(t){const e=[];let n=0,r=0;for(;n<t.length;){const s=t[n++];if(s<128)e[r++]=String.fromCharCode(s);else if(s>191&&s<224){const a=t[n++];e[r++]=String.fromCharCode((s&31)<<6|a&63)}else if(s>239&&s<365){const a=t[n++],o=t[n++],c=t[n++],u=((s&7)<<18|(a&63)<<12|(o&63)<<6|c&63)-65536;e[r++]=String.fromCharCode(55296+(u>>10)),e[r++]=String.fromCharCode(56320+(u&1023))}else{const a=t[n++],o=t[n++];e[r++]=String.fromCharCode((s&15)<<12|(a&63)<<6|o&63)}}return e.join("")},dv={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let s=0;s<t.length;s+=3){const a=t[s],o=s+1<t.length,c=o?t[s+1]:0,u=s+2<t.length,d=u?t[s+2]:0,m=a>>2,y=(a&3)<<4|c>>4;let g=(c&15)<<2|d>>6,x=d&63;u||(x=64,o||(g=64)),r.push(n[m],n[y],n[g],n[x])}return r.join("")},encodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(uv(t),e)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):LE(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const n=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let s=0;s<t.length;){const a=n[t.charAt(s++)],c=s<t.length?n[t.charAt(s)]:0;++s;const d=s<t.length?n[t.charAt(s)]:64;++s;const y=s<t.length?n[t.charAt(s)]:64;if(++s,a==null||c==null||d==null||y==null)throw new VE;const g=a<<2|c>>4;if(r.push(g),d!==64){const x=c<<4&240|d>>2;if(r.push(x),y!==64){const C=d<<6&192|y;r.push(C)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};class VE extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const FE=function(t){const e=uv(t);return dv.encodeByteArray(e,!0)},Jl=function(t){return FE(t).replace(/\./g,"")},hv=function(t){try{return dv.decodeString(t,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function UE(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const BE=()=>UE().__FIREBASE_DEFAULTS__,$E=()=>{if(typeof process>"u"||typeof Ig>"u")return;const t=Ig.__FIREBASE_DEFAULTS__;if(t)return JSON.parse(t)},zE=()=>{if(typeof document>"u")return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=t&&hv(t[1]);return e&&JSON.parse(e)},Lc=()=>{try{return BE()||$E()||zE()}catch(t){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${t}`);return}},mv=t=>{var e,n;return(n=(e=Lc())===null||e===void 0?void 0:e.emulatorHosts)===null||n===void 0?void 0:n[t]},Tm=t=>{const e=mv(t);if(!e)return;const n=e.lastIndexOf(":");if(n<=0||n+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(n+1),10);return e[0]==="["?[e.substring(1,n-1),r]:[e.substring(0,n),r]},fv=()=>{var t;return(t=Lc())===null||t===void 0?void 0:t.config},pv=t=>{var e;return(e=Lc())===null||e===void 0?void 0:e[`_${t}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qE{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}wrapCallback(e){return(n,r)=>{n?this.reject(n):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(n):e(n,r))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gv(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n={alg:"none",type:"JWT"},r=e||"demo-project",s=t.iat||0,a=t.sub||t.user_id;if(!a)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o=Object.assign({iss:`https://securetoken.google.com/${r}`,aud:r,iat:s,exp:s+3600,auth_time:s,sub:a,user_id:a,firebase:{sign_in_provider:"custom",identities:{}}},t);return[Jl(JSON.stringify(n)),Jl(JSON.stringify(o)),""].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Et(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function HE(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Et())}function GE(){var t;const e=(t=Lc())===null||t===void 0?void 0:t.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function WE(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function KE(){const t=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof t=="object"&&t.id!==void 0}function QE(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function YE(){const t=Et();return t.indexOf("MSIE ")>=0||t.indexOf("Trident/")>=0}function XE(){return!GE()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function JE(){try{return typeof indexedDB=="object"}catch{return!1}}function ZE(){return new Promise((t,e)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(r);s.onsuccess=()=>{s.result.close(),n||self.indexedDB.deleteDatabase(r),t(!0)},s.onupgradeneeded=()=>{n=!1},s.onerror=()=>{var a;e(((a=s.error)===null||a===void 0?void 0:a.message)||"")}}catch(n){e(n)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eT="FirebaseError";class Pn extends Error{constructor(e,n,r){super(n),this.code=e,this.customData=r,this.name=eT,Object.setPrototypeOf(this,Pn.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,eo.prototype.create)}}class eo{constructor(e,n,r){this.service=e,this.serviceName=n,this.errors=r}create(e,...n){const r=n[0]||{},s=`${this.service}/${e}`,a=this.errors[e],o=a?tT(a,r):"Error",c=`${this.serviceName}: ${o} (${s}).`;return new Pn(s,c,r)}}function tT(t,e){return t.replace(nT,(n,r)=>{const s=e[r];return s!=null?String(s):`<${r}?>`})}const nT=/\{\$([^}]+)}/g;function rT(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function Zl(t,e){if(t===e)return!0;const n=Object.keys(t),r=Object.keys(e);for(const s of n){if(!r.includes(s))return!1;const a=t[s],o=e[s];if(Ag(a)&&Ag(o)){if(!Zl(a,o))return!1}else if(a!==o)return!1}for(const s of r)if(!n.includes(s))return!1;return!0}function Ag(t){return t!==null&&typeof t=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function to(t){const e=[];for(const[n,r]of Object.entries(t))Array.isArray(r)?r.forEach(s=>{e.push(encodeURIComponent(n)+"="+encodeURIComponent(s))}):e.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function na(t){const e={};return t.replace(/^\?/,"").split("&").forEach(r=>{if(r){const[s,a]=r.split("=");e[decodeURIComponent(s)]=decodeURIComponent(a)}}),e}function ra(t){const e=t.indexOf("?");if(!e)return"";const n=t.indexOf("#",e);return t.substring(e,n>0?n:void 0)}function sT(t,e){const n=new iT(t,e);return n.subscribe.bind(n)}class iT{constructor(e,n){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=n,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(n=>{n.next(e)})}error(e){this.forEachObserver(n=>{n.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,n,r){let s;if(e===void 0&&n===void 0&&r===void 0)throw new Error("Missing Observer.");aT(e,["next","error","complete"])?s=e:s={next:e,error:n,complete:r},s.next===void 0&&(s.next=td),s.error===void 0&&(s.error=td),s.complete===void 0&&(s.complete=td);const a=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?s.error(this.finalError):s.complete()}catch{}}),this.observers.push(s),a}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let n=0;n<this.observers.length;n++)this.sendOne(n,e)}sendOne(e,n){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{n(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function aT(t,e){if(typeof t!="object"||t===null)return!1;for(const n of e)if(n in t&&typeof t[n]=="function")return!0;return!1}function td(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Le(t){return t&&t._delegate?t._delegate:t}class Jn{constructor(e,n,r){this.name=e,this.instanceFactory=n,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Zr="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oT{constructor(e,n){this.name=e,this.container=n,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const n=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(n)){const r=new qE;if(this.instancesDeferred.set(n,r),this.isInitialized(n)||this.shouldAutoInitialize())try{const s=this.getOrInitializeService({instanceIdentifier:n});s&&r.resolve(s)}catch{}}return this.instancesDeferred.get(n).promise}getImmediate(e){var n;const r=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),s=(n=e==null?void 0:e.optional)!==null&&n!==void 0?n:!1;if(this.isInitialized(r)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:r})}catch(a){if(s)return null;throw a}else{if(s)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(cT(e))try{this.getOrInitializeService({instanceIdentifier:Zr})}catch{}for(const[n,r]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(n);try{const a=this.getOrInitializeService({instanceIdentifier:s});r.resolve(a)}catch{}}}}clearInstance(e=Zr){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(n=>"INTERNAL"in n).map(n=>n.INTERNAL.delete()),...e.filter(n=>"_delete"in n).map(n=>n._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=Zr){return this.instances.has(e)}getOptions(e=Zr){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:n={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:r,options:n});for(const[a,o]of this.instancesDeferred.entries()){const c=this.normalizeInstanceIdentifier(a);r===c&&o.resolve(s)}return s}onInit(e,n){var r;const s=this.normalizeInstanceIdentifier(n),a=(r=this.onInitCallbacks.get(s))!==null&&r!==void 0?r:new Set;a.add(e),this.onInitCallbacks.set(s,a);const o=this.instances.get(s);return o&&e(o,s),()=>{a.delete(e)}}invokeOnInitCallbacks(e,n){const r=this.onInitCallbacks.get(n);if(r)for(const s of r)try{s(e,n)}catch{}}getOrInitializeService({instanceIdentifier:e,options:n={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:lT(e),options:n}),this.instances.set(e,r),this.instancesOptions.set(e,n),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=Zr){return this.component?this.component.multipleInstances?e:Zr:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function lT(t){return t===Zr?void 0:t}function cT(t){return t.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uT{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const n=this.getProvider(e.name);if(n.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);n.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const n=new oT(e,this);return this.providers.set(e,n),n}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ve;(function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"})(ve||(ve={}));const dT={debug:ve.DEBUG,verbose:ve.VERBOSE,info:ve.INFO,warn:ve.WARN,error:ve.ERROR,silent:ve.SILENT},hT=ve.INFO,mT={[ve.DEBUG]:"log",[ve.VERBOSE]:"log",[ve.INFO]:"info",[ve.WARN]:"warn",[ve.ERROR]:"error"},fT=(t,e,...n)=>{if(e<t.logLevel)return;const r=new Date().toISOString(),s=mT[e];if(s)console[s](`[${r}]  ${t.name}:`,...n);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class jm{constructor(e){this.name=e,this._logLevel=hT,this._logHandler=fT,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in ve))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?dT[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,ve.DEBUG,...e),this._logHandler(this,ve.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,ve.VERBOSE,...e),this._logHandler(this,ve.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,ve.INFO,...e),this._logHandler(this,ve.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,ve.WARN,...e),this._logHandler(this,ve.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,ve.ERROR,...e),this._logHandler(this,ve.ERROR,...e)}}const pT=(t,e)=>e.some(n=>t instanceof n);let kg,Pg;function gT(){return kg||(kg=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function yT(){return Pg||(Pg=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const yv=new WeakMap,ah=new WeakMap,xv=new WeakMap,nd=new WeakMap,Sm=new WeakMap;function xT(t){const e=new Promise((n,r)=>{const s=()=>{t.removeEventListener("success",a),t.removeEventListener("error",o)},a=()=>{n(Pr(t.result)),s()},o=()=>{r(t.error),s()};t.addEventListener("success",a),t.addEventListener("error",o)});return e.then(n=>{n instanceof IDBCursor&&yv.set(n,t)}).catch(()=>{}),Sm.set(e,t),e}function vT(t){if(ah.has(t))return;const e=new Promise((n,r)=>{const s=()=>{t.removeEventListener("complete",a),t.removeEventListener("error",o),t.removeEventListener("abort",o)},a=()=>{n(),s()},o=()=>{r(t.error||new DOMException("AbortError","AbortError")),s()};t.addEventListener("complete",a),t.addEventListener("error",o),t.addEventListener("abort",o)});ah.set(t,e)}let oh={get(t,e,n){if(t instanceof IDBTransaction){if(e==="done")return ah.get(t);if(e==="objectStoreNames")return t.objectStoreNames||xv.get(t);if(e==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return Pr(t[e])},set(t,e,n){return t[e]=n,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function bT(t){oh=t(oh)}function wT(t){return t===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...n){const r=t.call(rd(this),e,...n);return xv.set(r,e.sort?e.sort():[e]),Pr(r)}:yT().includes(t)?function(...e){return t.apply(rd(this),e),Pr(yv.get(this))}:function(...e){return Pr(t.apply(rd(this),e))}}function _T(t){return typeof t=="function"?wT(t):(t instanceof IDBTransaction&&vT(t),pT(t,gT())?new Proxy(t,oh):t)}function Pr(t){if(t instanceof IDBRequest)return xT(t);if(nd.has(t))return nd.get(t);const e=_T(t);return e!==t&&(nd.set(t,e),Sm.set(e,t)),e}const rd=t=>Sm.get(t);function NT(t,e,{blocked:n,upgrade:r,blocking:s,terminated:a}={}){const o=indexedDB.open(t,e),c=Pr(o);return r&&o.addEventListener("upgradeneeded",u=>{r(Pr(o.result),u.oldVersion,u.newVersion,Pr(o.transaction),u)}),n&&o.addEventListener("blocked",u=>n(u.oldVersion,u.newVersion,u)),c.then(u=>{a&&u.addEventListener("close",()=>a()),s&&u.addEventListener("versionchange",d=>s(d.oldVersion,d.newVersion,d))}).catch(()=>{}),c}const ET=["get","getKey","getAll","getAllKeys","count"],TT=["put","add","delete","clear"],sd=new Map;function Rg(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(sd.get(e))return sd.get(e);const n=e.replace(/FromIndex$/,""),r=e!==n,s=TT.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!(s||ET.includes(n)))return;const a=async function(o,...c){const u=this.transaction(o,s?"readwrite":"readonly");let d=u.store;return r&&(d=d.index(c.shift())),(await Promise.all([d[n](...c),s&&u.done]))[0]};return sd.set(e,a),a}bT(t=>({...t,get:(e,n,r)=>Rg(e,n)||t.get(e,n,r),has:(e,n)=>!!Rg(e,n)||t.has(e,n)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jT{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(n=>{if(ST(n)){const r=n.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(n=>n).join(" ")}}function ST(t){const e=t.getComponent();return(e==null?void 0:e.type)==="VERSION"}const lh="@firebase/app",Dg="0.10.13";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Zn=new jm("@firebase/app"),CT="@firebase/app-compat",IT="@firebase/analytics-compat",AT="@firebase/analytics",kT="@firebase/app-check-compat",PT="@firebase/app-check",RT="@firebase/auth",DT="@firebase/auth-compat",MT="@firebase/database",OT="@firebase/data-connect",LT="@firebase/database-compat",VT="@firebase/functions",FT="@firebase/functions-compat",UT="@firebase/installations",BT="@firebase/installations-compat",$T="@firebase/messaging",zT="@firebase/messaging-compat",qT="@firebase/performance",HT="@firebase/performance-compat",GT="@firebase/remote-config",WT="@firebase/remote-config-compat",KT="@firebase/storage",QT="@firebase/storage-compat",YT="@firebase/firestore",XT="@firebase/vertexai-preview",JT="@firebase/firestore-compat",ZT="firebase",ej="10.14.1";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ch="[DEFAULT]",tj={[lh]:"fire-core",[CT]:"fire-core-compat",[AT]:"fire-analytics",[IT]:"fire-analytics-compat",[PT]:"fire-app-check",[kT]:"fire-app-check-compat",[RT]:"fire-auth",[DT]:"fire-auth-compat",[MT]:"fire-rtdb",[OT]:"fire-data-connect",[LT]:"fire-rtdb-compat",[VT]:"fire-fn",[FT]:"fire-fn-compat",[UT]:"fire-iid",[BT]:"fire-iid-compat",[$T]:"fire-fcm",[zT]:"fire-fcm-compat",[qT]:"fire-perf",[HT]:"fire-perf-compat",[GT]:"fire-rc",[WT]:"fire-rc-compat",[KT]:"fire-gcs",[QT]:"fire-gcs-compat",[YT]:"fire-fst",[JT]:"fire-fst-compat",[XT]:"fire-vertex","fire-js":"fire-js",[ZT]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ec=new Map,nj=new Map,uh=new Map;function Mg(t,e){try{t.container.addComponent(e)}catch(n){Zn.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,n)}}function Vr(t){const e=t.name;if(uh.has(e))return Zn.debug(`There were multiple attempts to register component ${e}.`),!1;uh.set(e,t);for(const n of ec.values())Mg(n,t);for(const n of nj.values())Mg(n,t);return!0}function no(t,e){const n=t.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),t.container.getProvider(e)}function wn(t){return t.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rj={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Rr=new eo("app","Firebase",rj);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sj{constructor(e,n,r){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},n),this._name=n.name,this._automaticDataCollectionEnabled=n.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new Jn("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Rr.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _s=ej;function vv(t,e={}){let n=t;typeof e!="object"&&(e={name:e});const r=Object.assign({name:ch,automaticDataCollectionEnabled:!1},e),s=r.name;if(typeof s!="string"||!s)throw Rr.create("bad-app-name",{appName:String(s)});if(n||(n=fv()),!n)throw Rr.create("no-options");const a=ec.get(s);if(a){if(Zl(n,a.options)&&Zl(r,a.config))return a;throw Rr.create("duplicate-app",{appName:s})}const o=new uT(s);for(const u of uh.values())o.addComponent(u);const c=new sj(n,r,o);return ec.set(s,c),c}function Vc(t=ch){const e=ec.get(t);if(!e&&t===ch&&fv())return vv();if(!e)throw Rr.create("no-app",{appName:t});return e}function tn(t,e,n){var r;let s=(r=tj[t])!==null&&r!==void 0?r:t;n&&(s+=`-${n}`);const a=s.match(/\s|\//),o=e.match(/\s|\//);if(a||o){const c=[`Unable to register library "${s}" with version "${e}":`];a&&c.push(`library name "${s}" contains illegal characters (whitespace or "/")`),a&&o&&c.push("and"),o&&c.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Zn.warn(c.join(" "));return}Vr(new Jn(`${s}-version`,()=>({library:s,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ij="firebase-heartbeat-database",aj=1,Fa="firebase-heartbeat-store";let id=null;function bv(){return id||(id=NT(ij,aj,{upgrade:(t,e)=>{switch(e){case 0:try{t.createObjectStore(Fa)}catch(n){console.warn(n)}}}}).catch(t=>{throw Rr.create("idb-open",{originalErrorMessage:t.message})})),id}async function oj(t){try{const n=(await bv()).transaction(Fa),r=await n.objectStore(Fa).get(wv(t));return await n.done,r}catch(e){if(e instanceof Pn)Zn.warn(e.message);else{const n=Rr.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});Zn.warn(n.message)}}}async function Og(t,e){try{const r=(await bv()).transaction(Fa,"readwrite");await r.objectStore(Fa).put(e,wv(t)),await r.done}catch(n){if(n instanceof Pn)Zn.warn(n.message);else{const r=Rr.create("idb-set",{originalErrorMessage:n==null?void 0:n.message});Zn.warn(r.message)}}}function wv(t){return`${t.name}!${t.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lj=1024,cj=30*24*60*60*1e3;class uj{constructor(e){this.container=e,this._heartbeatsCache=null;const n=this.container.getProvider("app").getImmediate();this._storage=new hj(n),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){var e,n;try{const s=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),a=Lg();return((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((n=this._heartbeatsCache)===null||n===void 0?void 0:n.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===a||this._heartbeatsCache.heartbeats.some(o=>o.date===a)?void 0:(this._heartbeatsCache.heartbeats.push({date:a,agent:s}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(o=>{const c=new Date(o.date).valueOf();return Date.now()-c<=cj}),this._storage.overwrite(this._heartbeatsCache))}catch(r){Zn.warn(r)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const n=Lg(),{heartbeatsToSend:r,unsentEntries:s}=dj(this._heartbeatsCache.heartbeats),a=Jl(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=n,s.length>0?(this._heartbeatsCache.heartbeats=s,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),a}catch(n){return Zn.warn(n),""}}}function Lg(){return new Date().toISOString().substring(0,10)}function dj(t,e=lj){const n=[];let r=t.slice();for(const s of t){const a=n.find(o=>o.agent===s.agent);if(a){if(a.dates.push(s.date),Vg(n)>e){a.dates.pop();break}}else if(n.push({agent:s.agent,dates:[s.date]}),Vg(n)>e){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}class hj{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return JE()?ZE().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const n=await oj(this.app);return n!=null&&n.heartbeats?n:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){var n;if(await this._canUseIndexedDBPromise){const s=await this.read();return Og(this.app,{lastSentHeartbeatDate:(n=e.lastSentHeartbeatDate)!==null&&n!==void 0?n:s.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var n;if(await this._canUseIndexedDBPromise){const s=await this.read();return Og(this.app,{lastSentHeartbeatDate:(n=e.lastSentHeartbeatDate)!==null&&n!==void 0?n:s.lastSentHeartbeatDate,heartbeats:[...s.heartbeats,...e.heartbeats]})}else return}}function Vg(t){return Jl(JSON.stringify({version:2,heartbeats:t})).length}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mj(t){Vr(new Jn("platform-logger",e=>new jT(e),"PRIVATE")),Vr(new Jn("heartbeat",e=>new uj(e),"PRIVATE")),tn(lh,Dg,t),tn(lh,Dg,"esm2017"),tn("fire-js","")}mj("");function Cm(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(t);s<r.length;s++)e.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(t,r[s])&&(n[r[s]]=t[r[s]]);return n}function _v(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const fj=_v,Nv=new eo("auth","Firebase",_v());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tc=new jm("@firebase/auth");function pj(t,...e){tc.logLevel<=ve.WARN&&tc.warn(`Auth (${_s}): ${t}`,...e)}function xl(t,...e){tc.logLevel<=ve.ERROR&&tc.error(`Auth (${_s}): ${t}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gn(t,...e){throw Im(t,...e)}function En(t,...e){return Im(t,...e)}function Ev(t,e,n){const r=Object.assign(Object.assign({},fj()),{[e]:n});return new eo("auth","Firebase",r).create(e,{appName:t.name})}function Gn(t){return Ev(t,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function Im(t,...e){if(typeof t!="string"){const n=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=t.name),t._errorFactory.create(n,...r)}return Nv.create(t,...e)}function de(t,e,...n){if(!t)throw Im(e,...n)}function $n(t){const e="INTERNAL ASSERTION FAILED: "+t;throw xl(e),new Error(e)}function er(t,e){t||$n(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dh(){var t;return typeof self<"u"&&((t=self.location)===null||t===void 0?void 0:t.href)||""}function gj(){return Fg()==="http:"||Fg()==="https:"}function Fg(){var t;return typeof self<"u"&&((t=self.location)===null||t===void 0?void 0:t.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yj(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(gj()||KE()||"connection"in navigator)?navigator.onLine:!0}function xj(){if(typeof navigator>"u")return null;const t=navigator;return t.languages&&t.languages[0]||t.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ro{constructor(e,n){this.shortDelay=e,this.longDelay=n,er(n>e,"Short delay should be less than long delay!"),this.isMobile=HE()||QE()}get(){return yj()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Am(t,e){er(t.emulator,"Emulator should always be set here");const{url:n}=t.emulator;return e?`${n}${e.startsWith("/")?e.slice(1):e}`:n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tv{static initialize(e,n,r){this.fetchImpl=e,n&&(this.headersImpl=n),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;$n("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;$n("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;$n("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vj={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bj=new ro(3e4,6e4);function ar(t,e){return t.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:t.tenantId}):e}async function Rn(t,e,n,r,s={}){return jv(t,s,async()=>{let a={},o={};r&&(e==="GET"?o=r:a={body:JSON.stringify(r)});const c=to(Object.assign({key:t.config.apiKey},o)).slice(1),u=await t._getAdditionalHeaders();u["Content-Type"]="application/json",t.languageCode&&(u["X-Firebase-Locale"]=t.languageCode);const d=Object.assign({method:e,headers:u},a);return WE()||(d.referrerPolicy="no-referrer"),Tv.fetch()(Sv(t,t.config.apiHost,n,c),d)})}async function jv(t,e,n){t._canInitEmulator=!1;const r=Object.assign(Object.assign({},vj),e);try{const s=new _j(t),a=await Promise.race([n(),s.promise]);s.clearNetworkTimeout();const o=await a.json();if("needConfirmation"in o)throw el(t,"account-exists-with-different-credential",o);if(a.ok&&!("errorMessage"in o))return o;{const c=a.ok?o.errorMessage:o.error.message,[u,d]=c.split(" : ");if(u==="FEDERATED_USER_ID_ALREADY_LINKED")throw el(t,"credential-already-in-use",o);if(u==="EMAIL_EXISTS")throw el(t,"email-already-in-use",o);if(u==="USER_DISABLED")throw el(t,"user-disabled",o);const m=r[u]||u.toLowerCase().replace(/[_\s]+/g,"-");if(d)throw Ev(t,m,d);gn(t,m)}}catch(s){if(s instanceof Pn)throw s;gn(t,"network-request-failed",{message:String(s)})}}async function so(t,e,n,r,s={}){const a=await Rn(t,e,n,r,s);return"mfaPendingCredential"in a&&gn(t,"multi-factor-auth-required",{_serverResponse:a}),a}function Sv(t,e,n,r){const s=`${e}${n}?${r}`;return t.config.emulator?Am(t.config,s):`${t.config.apiScheme}://${s}`}function wj(t){switch(t){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class _j{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((n,r)=>{this.timer=setTimeout(()=>r(En(this.auth,"network-request-failed")),bj.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function el(t,e,n){const r={appName:t.name};n.email&&(r.email=n.email),n.phoneNumber&&(r.phoneNumber=n.phoneNumber);const s=En(t,e,r);return s.customData._tokenResponse=n,s}function Ug(t){return t!==void 0&&t.enterprise!==void 0}class Nj{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const n of this.recaptchaEnforcementState)if(n.provider&&n.provider===e)return wj(n.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}}async function Ej(t,e){return Rn(t,"GET","/v2/recaptchaConfig",ar(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Tj(t,e){return Rn(t,"POST","/v1/accounts:delete",e)}async function Cv(t,e){return Rn(t,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ya(t){if(t)try{const e=new Date(Number(t));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function jj(t,e=!1){const n=Le(t),r=await n.getIdToken(e),s=km(r);de(s&&s.exp&&s.auth_time&&s.iat,n.auth,"internal-error");const a=typeof s.firebase=="object"?s.firebase:void 0,o=a==null?void 0:a.sign_in_provider;return{claims:s,token:r,authTime:ya(ad(s.auth_time)),issuedAtTime:ya(ad(s.iat)),expirationTime:ya(ad(s.exp)),signInProvider:o||null,signInSecondFactor:(a==null?void 0:a.sign_in_second_factor)||null}}function ad(t){return Number(t)*1e3}function km(t){const[e,n,r]=t.split(".");if(e===void 0||n===void 0||r===void 0)return xl("JWT malformed, contained fewer than 3 sections"),null;try{const s=hv(n);return s?JSON.parse(s):(xl("Failed to decode base64 JWT payload"),null)}catch(s){return xl("Caught error parsing JWT payload as JSON",s==null?void 0:s.toString()),null}}function Bg(t){const e=km(t);return de(e,"internal-error"),de(typeof e.exp<"u","internal-error"),de(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function di(t,e,n=!1){if(n)return e;try{return await e}catch(r){throw r instanceof Pn&&Sj(r)&&t.auth.currentUser===t&&await t.auth.signOut(),r}}function Sj({code:t}){return t==="auth/user-disabled"||t==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cj{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var n;if(e){const r=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),r}else{this.errorBackoff=3e4;const s=((n=this.user.stsTokenManager.expirationTime)!==null&&n!==void 0?n:0)-Date.now()-3e5;return Math.max(0,s)}}schedule(e=!1){if(!this.isRunning)return;const n=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},n)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hh{constructor(e,n){this.createdAt=e,this.lastLoginAt=n,this._initializeTime()}_initializeTime(){this.lastSignInTime=ya(this.lastLoginAt),this.creationTime=ya(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function nc(t){var e;const n=t.auth,r=await t.getIdToken(),s=await di(t,Cv(n,{idToken:r}));de(s==null?void 0:s.users.length,n,"internal-error");const a=s.users[0];t._notifyReloadListener(a);const o=!((e=a.providerUserInfo)===null||e===void 0)&&e.length?Iv(a.providerUserInfo):[],c=Aj(t.providerData,o),u=t.isAnonymous,d=!(t.email&&a.passwordHash)&&!(c!=null&&c.length),m=u?d:!1,y={uid:a.localId,displayName:a.displayName||null,photoURL:a.photoUrl||null,email:a.email||null,emailVerified:a.emailVerified||!1,phoneNumber:a.phoneNumber||null,tenantId:a.tenantId||null,providerData:c,metadata:new hh(a.createdAt,a.lastLoginAt),isAnonymous:m};Object.assign(t,y)}async function Ij(t){const e=Le(t);await nc(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function Aj(t,e){return[...t.filter(r=>!e.some(s=>s.providerId===r.providerId)),...e]}function Iv(t){return t.map(e=>{var{providerId:n}=e,r=Cm(e,["providerId"]);return{providerId:n,uid:r.rawId||"",displayName:r.displayName||null,email:r.email||null,phoneNumber:r.phoneNumber||null,photoURL:r.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function kj(t,e){const n=await jv(t,{},async()=>{const r=to({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:s,apiKey:a}=t.config,o=Sv(t,s,"/v1/token",`key=${a}`),c=await t._getAdditionalHeaders();return c["Content-Type"]="application/x-www-form-urlencoded",Tv.fetch()(o,{method:"POST",headers:c,body:r})});return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}async function Pj(t,e){return Rn(t,"POST","/v2/accounts:revokeToken",ar(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zs{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){de(e.idToken,"internal-error"),de(typeof e.idToken<"u","internal-error"),de(typeof e.refreshToken<"u","internal-error");const n="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):Bg(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,n)}updateFromIdToken(e){de(e.length!==0,"internal-error");const n=Bg(e);this.updateTokensAndExpiration(e,null,n)}async getToken(e,n=!1){return!n&&this.accessToken&&!this.isExpired?this.accessToken:(de(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,n){const{accessToken:r,refreshToken:s,expiresIn:a}=await kj(e,n);this.updateTokensAndExpiration(r,s,Number(a))}updateTokensAndExpiration(e,n,r){this.refreshToken=n||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,n){const{refreshToken:r,accessToken:s,expirationTime:a}=n,o=new Zs;return r&&(de(typeof r=="string","internal-error",{appName:e}),o.refreshToken=r),s&&(de(typeof s=="string","internal-error",{appName:e}),o.accessToken=s),a&&(de(typeof a=="number","internal-error",{appName:e}),o.expirationTime=a),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new Zs,this.toJSON())}_performRefresh(){return $n("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hr(t,e){de(typeof t=="string"||typeof t>"u","internal-error",{appName:e})}class zn{constructor(e){var{uid:n,auth:r,stsTokenManager:s}=e,a=Cm(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new Cj(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=n,this.auth=r,this.stsTokenManager=s,this.accessToken=s.accessToken,this.displayName=a.displayName||null,this.email=a.email||null,this.emailVerified=a.emailVerified||!1,this.phoneNumber=a.phoneNumber||null,this.photoURL=a.photoURL||null,this.isAnonymous=a.isAnonymous||!1,this.tenantId=a.tenantId||null,this.providerData=a.providerData?[...a.providerData]:[],this.metadata=new hh(a.createdAt||void 0,a.lastLoginAt||void 0)}async getIdToken(e){const n=await di(this,this.stsTokenManager.getToken(this.auth,e));return de(n,this.auth,"internal-error"),this.accessToken!==n&&(this.accessToken=n,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),n}getIdTokenResult(e){return jj(this,e)}reload(){return Ij(this)}_assign(e){this!==e&&(de(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(n=>Object.assign({},n)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const n=new zn(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return n.metadata._copy(this.metadata),n}_onReload(e){de(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,n=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),n&&await nc(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(wn(this.auth.app))return Promise.reject(Gn(this.auth));const e=await this.getIdToken();return await di(this,Tj(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,n){var r,s,a,o,c,u,d,m;const y=(r=n.displayName)!==null&&r!==void 0?r:void 0,g=(s=n.email)!==null&&s!==void 0?s:void 0,x=(a=n.phoneNumber)!==null&&a!==void 0?a:void 0,C=(o=n.photoURL)!==null&&o!==void 0?o:void 0,E=(c=n.tenantId)!==null&&c!==void 0?c:void 0,A=(u=n._redirectEventId)!==null&&u!==void 0?u:void 0,N=(d=n.createdAt)!==null&&d!==void 0?d:void 0,T=(m=n.lastLoginAt)!==null&&m!==void 0?m:void 0,{uid:k,emailVerified:L,isAnonymous:q,providerData:z,stsTokenManager:j}=n;de(k&&j,e,"internal-error");const v=Zs.fromJSON(this.name,j);de(typeof k=="string",e,"internal-error"),hr(y,e.name),hr(g,e.name),de(typeof L=="boolean",e,"internal-error"),de(typeof q=="boolean",e,"internal-error"),hr(x,e.name),hr(C,e.name),hr(E,e.name),hr(A,e.name),hr(N,e.name),hr(T,e.name);const S=new zn({uid:k,auth:e,email:g,emailVerified:L,displayName:y,isAnonymous:q,photoURL:C,phoneNumber:x,tenantId:E,stsTokenManager:v,createdAt:N,lastLoginAt:T});return z&&Array.isArray(z)&&(S.providerData=z.map(p=>Object.assign({},p))),A&&(S._redirectEventId=A),S}static async _fromIdTokenResponse(e,n,r=!1){const s=new Zs;s.updateFromServerResponse(n);const a=new zn({uid:n.localId,auth:e,stsTokenManager:s,isAnonymous:r});return await nc(a),a}static async _fromGetAccountInfoResponse(e,n,r){const s=n.users[0];de(s.localId!==void 0,"internal-error");const a=s.providerUserInfo!==void 0?Iv(s.providerUserInfo):[],o=!(s.email&&s.passwordHash)&&!(a!=null&&a.length),c=new Zs;c.updateFromIdToken(r);const u=new zn({uid:s.localId,auth:e,stsTokenManager:c,isAnonymous:o}),d={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:a,metadata:new hh(s.createdAt,s.lastLoginAt),isAnonymous:!(s.email&&s.passwordHash)&&!(a!=null&&a.length)};return Object.assign(u,d),u}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $g=new Map;function qn(t){er(t instanceof Function,"Expected a class definition");let e=$g.get(t);return e?(er(e instanceof t,"Instance stored in cache mismatched with class"),e):(e=new t,$g.set(t,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Av{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,n){this.storage[e]=n}async _get(e){const n=this.storage[e];return n===void 0?null:n}async _remove(e){delete this.storage[e]}_addListener(e,n){}_removeListener(e,n){}}Av.type="NONE";const zg=Av;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vl(t,e,n){return`firebase:${t}:${e}:${n}`}class ei{constructor(e,n,r){this.persistence=e,this.auth=n,this.userKey=r;const{config:s,name:a}=this.auth;this.fullUserKey=vl(this.userKey,s.apiKey,a),this.fullPersistenceKey=vl("persistence",s.apiKey,a),this.boundEventHandler=n._onStorageEvent.bind(n),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?zn._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const n=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,n)return this.setCurrentUser(n)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,n,r="authUser"){if(!n.length)return new ei(qn(zg),e,r);const s=(await Promise.all(n.map(async d=>{if(await d._isAvailable())return d}))).filter(d=>d);let a=s[0]||qn(zg);const o=vl(r,e.config.apiKey,e.name);let c=null;for(const d of n)try{const m=await d._get(o);if(m){const y=zn._fromJSON(e,m);d!==a&&(c=y),a=d;break}}catch{}const u=s.filter(d=>d._shouldAllowMigration);return!a._shouldAllowMigration||!u.length?new ei(a,e,r):(a=u[0],c&&await a._set(o,c.toJSON()),await Promise.all(n.map(async d=>{if(d!==a)try{await d._remove(o)}catch{}})),new ei(a,e,r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qg(t){const e=t.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(Dv(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(kv(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(Ov(e))return"Blackberry";if(Lv(e))return"Webos";if(Pv(e))return"Safari";if((e.includes("chrome/")||Rv(e))&&!e.includes("edge/"))return"Chrome";if(Mv(e))return"Android";{const n=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=t.match(n);if((r==null?void 0:r.length)===2)return r[1]}return"Other"}function kv(t=Et()){return/firefox\//i.test(t)}function Pv(t=Et()){const e=t.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function Rv(t=Et()){return/crios\//i.test(t)}function Dv(t=Et()){return/iemobile/i.test(t)}function Mv(t=Et()){return/android/i.test(t)}function Ov(t=Et()){return/blackberry/i.test(t)}function Lv(t=Et()){return/webos/i.test(t)}function Pm(t=Et()){return/iphone|ipad|ipod/i.test(t)||/macintosh/i.test(t)&&/mobile/i.test(t)}function Rj(t=Et()){var e;return Pm(t)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function Dj(){return YE()&&document.documentMode===10}function Vv(t=Et()){return Pm(t)||Mv(t)||Lv(t)||Ov(t)||/windows phone/i.test(t)||Dv(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Fv(t,e=[]){let n;switch(t){case"Browser":n=qg(Et());break;case"Worker":n=`${qg(Et())}-${t}`;break;default:n=t}const r=e.length?e.join(","):"FirebaseCore-web";return`${n}/JsCore/${_s}/${r}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mj{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,n){const r=a=>new Promise((o,c)=>{try{const u=e(a);o(u)}catch(u){c(u)}});r.onAbort=n,this.queue.push(r);const s=this.queue.length-1;return()=>{this.queue[s]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const n=[];try{for(const r of this.queue)await r(e),r.onAbort&&n.push(r.onAbort)}catch(r){n.reverse();for(const s of n)try{s()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r==null?void 0:r.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Oj(t,e={}){return Rn(t,"GET","/v2/passwordPolicy",ar(t,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Lj=6;class Vj{constructor(e){var n,r,s,a;const o=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(n=o.minPasswordLength)!==null&&n!==void 0?n:Lj,o.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=o.maxPasswordLength),o.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=o.containsLowercaseCharacter),o.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=o.containsUppercaseCharacter),o.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=o.containsNumericCharacter),o.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=o.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(s=(r=e.allowedNonAlphanumericCharacters)===null||r===void 0?void 0:r.join(""))!==null&&s!==void 0?s:"",this.forceUpgradeOnSignin=(a=e.forceUpgradeOnSignin)!==null&&a!==void 0?a:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var n,r,s,a,o,c;const u={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,u),this.validatePasswordCharacterOptions(e,u),u.isValid&&(u.isValid=(n=u.meetsMinPasswordLength)!==null&&n!==void 0?n:!0),u.isValid&&(u.isValid=(r=u.meetsMaxPasswordLength)!==null&&r!==void 0?r:!0),u.isValid&&(u.isValid=(s=u.containsLowercaseLetter)!==null&&s!==void 0?s:!0),u.isValid&&(u.isValid=(a=u.containsUppercaseLetter)!==null&&a!==void 0?a:!0),u.isValid&&(u.isValid=(o=u.containsNumericCharacter)!==null&&o!==void 0?o:!0),u.isValid&&(u.isValid=(c=u.containsNonAlphanumericCharacter)!==null&&c!==void 0?c:!0),u}validatePasswordLengthOptions(e,n){const r=this.customStrengthOptions.minPasswordLength,s=this.customStrengthOptions.maxPasswordLength;r&&(n.meetsMinPasswordLength=e.length>=r),s&&(n.meetsMaxPasswordLength=e.length<=s)}validatePasswordCharacterOptions(e,n){this.updatePasswordCharacterOptionsStatuses(n,!1,!1,!1,!1);let r;for(let s=0;s<e.length;s++)r=e.charAt(s),this.updatePasswordCharacterOptionsStatuses(n,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,n,r,s,a){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=n)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=s)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=a))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fj{constructor(e,n,r,s){this.app=e,this.heartbeatServiceProvider=n,this.appCheckServiceProvider=r,this.config=s,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Hg(this),this.idTokenSubscription=new Hg(this),this.beforeStateQueue=new Mj(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=Nv,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=s.sdkClientVersion}_initializeWithPersistence(e,n){return n&&(this._popupRedirectResolver=qn(n)),this._initializationPromise=this.queue(async()=>{var r,s;if(!this._deleted&&(this.persistenceManager=await ei.create(this,e),!this._deleted)){if(!((r=this._popupRedirectResolver)===null||r===void 0)&&r._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(n),this.lastNotifiedUid=((s=this.currentUser)===null||s===void 0?void 0:s.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const n=await Cv(this,{idToken:e}),r=await zn._fromGetAccountInfoResponse(this,n,e);await this.directlySetCurrentUser(r)}catch(n){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",n),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var n;if(wn(this.app)){const o=this.app.settings.authIdToken;return o?new Promise(c=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(o).then(c,c))}):this.directlySetCurrentUser(null)}const r=await this.assertedPersistence.getCurrentUser();let s=r,a=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const o=(n=this.redirectUser)===null||n===void 0?void 0:n._redirectEventId,c=s==null?void 0:s._redirectEventId,u=await this.tryRedirectSignIn(e);(!o||o===c)&&(u!=null&&u.user)&&(s=u.user,a=!0)}if(!s)return this.directlySetCurrentUser(null);if(!s._redirectEventId){if(a)try{await this.beforeStateQueue.runMiddleware(s)}catch(o){s=r,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return s?this.reloadAndSetCurrentUserOrClear(s):this.directlySetCurrentUser(null)}return de(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===s._redirectEventId?this.directlySetCurrentUser(s):this.reloadAndSetCurrentUserOrClear(s)}async tryRedirectSignIn(e){let n=null;try{n=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return n}async reloadAndSetCurrentUserOrClear(e){try{await nc(e)}catch(n){if((n==null?void 0:n.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=xj()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(wn(this.app))return Promise.reject(Gn(this));const n=e?Le(e):null;return n&&de(n.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(n&&n._clone(this))}async _updateCurrentUser(e,n=!1){if(!this._deleted)return e&&de(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),n||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return wn(this.app)?Promise.reject(Gn(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return wn(this.app)?Promise.reject(Gn(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(qn(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const n=this._getPasswordPolicyInternal();return n.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):n.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await Oj(this),n=new Vj(e);this.tenantId===null?this._projectPasswordPolicy=n:this._tenantPasswordPolicies[this.tenantId]=n}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new eo("auth","Firebase",e())}onAuthStateChanged(e,n,r){return this.registerStateListener(this.authStateSubscription,e,n,r)}beforeAuthStateChanged(e,n){return this.beforeStateQueue.pushCallback(e,n)}onIdTokenChanged(e,n,r){return this.registerStateListener(this.idTokenSubscription,e,n,r)}authStateReady(){return new Promise((e,n)=>{if(this.currentUser)e();else{const r=this.onAuthStateChanged(()=>{r(),e()},n)}})}async revokeAccessToken(e){if(this.currentUser){const n=await this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:n};this.tenantId!=null&&(r.tenantId=this.tenantId),await Pj(this,r)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}async _setRedirectUser(e,n){const r=await this.getOrInitRedirectPersistenceManager(n);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const n=e&&qn(e)||this._popupRedirectResolver;de(n,this,"argument-error"),this.redirectPersistenceManager=await ei.create(this,[qn(n._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var n,r;return this._isInitialized&&await this.queue(async()=>{}),((n=this._currentUser)===null||n===void 0?void 0:n._redirectEventId)===e?this._currentUser:((r=this.redirectUser)===null||r===void 0?void 0:r._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,n;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const r=(n=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&n!==void 0?n:null;this.lastNotifiedUid!==r&&(this.lastNotifiedUid=r,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,n,r,s){if(this._deleted)return()=>{};const a=typeof n=="function"?n:n.next.bind(n);let o=!1;const c=this._isInitialized?Promise.resolve():this._initializationPromise;if(de(c,this,"internal-error"),c.then(()=>{o||a(this.currentUser)}),typeof n=="function"){const u=e.addObserver(n,r,s);return()=>{o=!0,u()}}else{const u=e.addObserver(n);return()=>{o=!0,u()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return de(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=Fv(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const n={"X-Client-Version":this.clientVersion};this.app.options.appId&&(n["X-Firebase-gmpid"]=this.app.options.appId);const r=await((e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader());r&&(n["X-Firebase-Client"]=r);const s=await this._getAppCheckToken();return s&&(n["X-Firebase-AppCheck"]=s),n}async _getAppCheckToken(){var e;const n=await((e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken());return n!=null&&n.error&&pj(`Error while retrieving App Check token: ${n.error}`),n==null?void 0:n.token}}function Ns(t){return Le(t)}class Hg{constructor(e){this.auth=e,this.observer=null,this.addObserver=sT(n=>this.observer=n)}get next(){return de(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Fc={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function Uj(t){Fc=t}function Uv(t){return Fc.loadJS(t)}function Bj(){return Fc.recaptchaEnterpriseScript}function $j(){return Fc.gapiScript}function zj(t){return`__${t}${Math.floor(Math.random()*1e6)}`}const qj="recaptcha-enterprise",Hj="NO_RECAPTCHA";class Gj{constructor(e){this.type=qj,this.auth=Ns(e)}async verify(e="verify",n=!1){async function r(a){if(!n){if(a.tenantId==null&&a._agentRecaptchaConfig!=null)return a._agentRecaptchaConfig.siteKey;if(a.tenantId!=null&&a._tenantRecaptchaConfigs[a.tenantId]!==void 0)return a._tenantRecaptchaConfigs[a.tenantId].siteKey}return new Promise(async(o,c)=>{Ej(a,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(u=>{if(u.recaptchaKey===void 0)c(new Error("recaptcha Enterprise site key undefined"));else{const d=new Nj(u);return a.tenantId==null?a._agentRecaptchaConfig=d:a._tenantRecaptchaConfigs[a.tenantId]=d,o(d.siteKey)}}).catch(u=>{c(u)})})}function s(a,o,c){const u=window.grecaptcha;Ug(u)?u.enterprise.ready(()=>{u.enterprise.execute(a,{action:e}).then(d=>{o(d)}).catch(()=>{o(Hj)})}):c(Error("No reCAPTCHA enterprise script loaded."))}return new Promise((a,o)=>{r(this.auth).then(c=>{if(!n&&Ug(window.grecaptcha))s(c,a,o);else{if(typeof window>"u"){o(new Error("RecaptchaVerifier is only supported in browser"));return}let u=Bj();u.length!==0&&(u+=c),Uv(u).then(()=>{s(c,a,o)}).catch(d=>{o(d)})}}).catch(c=>{o(c)})})}}async function Gg(t,e,n,r=!1){const s=new Gj(t);let a;try{a=await s.verify(n)}catch{a=await s.verify(n,!0)}const o=Object.assign({},e);return r?Object.assign(o,{captchaResp:a}):Object.assign(o,{captchaResponse:a}),Object.assign(o,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(o,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),o}async function mh(t,e,n,r){var s;if(!((s=t._getRecaptchaConfig())===null||s===void 0)&&s.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const a=await Gg(t,e,n,n==="getOobCode");return r(t,a)}else return r(t,e).catch(async a=>{if(a.code==="auth/missing-recaptcha-token"){console.log(`${n} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const o=await Gg(t,e,n,n==="getOobCode");return r(t,o)}else return Promise.reject(a)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Wj(t,e){const n=no(t,"auth");if(n.isInitialized()){const s=n.getImmediate(),a=n.getOptions();if(Zl(a,e??{}))return s;gn(s,"already-initialized")}return n.initialize({options:e})}function Kj(t,e){const n=(e==null?void 0:e.persistence)||[],r=(Array.isArray(n)?n:[n]).map(qn);e!=null&&e.errorMap&&t._updateErrorMap(e.errorMap),t._initializeWithPersistence(r,e==null?void 0:e.popupRedirectResolver)}function Qj(t,e,n){const r=Ns(t);de(r._canInitEmulator,r,"emulator-config-failed"),de(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");const s=!1,a=Bv(e),{host:o,port:c}=Yj(e),u=c===null?"":`:${c}`;r.config.emulator={url:`${a}//${o}${u}/`},r.settings.appVerificationDisabledForTesting=!0,r.emulatorConfig=Object.freeze({host:o,port:c,protocol:a.replace(":",""),options:Object.freeze({disableWarnings:s})}),Xj()}function Bv(t){const e=t.indexOf(":");return e<0?"":t.substr(0,e+1)}function Yj(t){const e=Bv(t),n=/(\/\/)?([^?#/]+)/.exec(t.substr(e.length));if(!n)return{host:"",port:null};const r=n[2].split("@").pop()||"",s=/^(\[[^\]]+\])(:|$)/.exec(r);if(s){const a=s[1];return{host:a,port:Wg(r.substr(a.length+1))}}else{const[a,o]=r.split(":");return{host:a,port:Wg(o)}}}function Wg(t){if(!t)return null;const e=Number(t);return isNaN(e)?null:e}function Xj(){function t(){const e=document.createElement("p"),n=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",n.position="fixed",n.width="100%",n.backgroundColor="#ffffff",n.border=".1em solid #000000",n.color="#b50000",n.bottom="0px",n.left="0px",n.margin="0px",n.zIndex="10000",n.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",t):t())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rm{constructor(e,n){this.providerId=e,this.signInMethod=n}toJSON(){return $n("not implemented")}_getIdTokenResponse(e){return $n("not implemented")}_linkToIdToken(e,n){return $n("not implemented")}_getReauthenticationResolver(e){return $n("not implemented")}}async function Jj(t,e){return Rn(t,"POST","/v1/accounts:update",e)}async function Zj(t,e){return Rn(t,"POST","/v1/accounts:signUp",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function eS(t,e){return so(t,"POST","/v1/accounts:signInWithPassword",ar(t,e))}async function tS(t,e){return Rn(t,"POST","/v1/accounts:sendOobCode",ar(t,e))}async function nS(t,e){return tS(t,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function rS(t,e){return so(t,"POST","/v1/accounts:signInWithEmailLink",ar(t,e))}async function sS(t,e){return so(t,"POST","/v1/accounts:signInWithEmailLink",ar(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ua extends Rm{constructor(e,n,r,s=null){super("password",r),this._email=e,this._password=n,this._tenantId=s}static _fromEmailAndPassword(e,n){return new Ua(e,n,"password")}static _fromEmailAndCode(e,n,r=null){return new Ua(e,n,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const n=typeof e=="string"?JSON.parse(e):e;if(n!=null&&n.email&&(n!=null&&n.password)){if(n.signInMethod==="password")return this._fromEmailAndPassword(n.email,n.password);if(n.signInMethod==="emailLink")return this._fromEmailAndCode(n.email,n.password,n.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const n={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return mh(e,n,"signInWithPassword",eS);case"emailLink":return rS(e,{email:this._email,oobCode:this._password});default:gn(e,"internal-error")}}async _linkToIdToken(e,n){switch(this.signInMethod){case"password":const r={idToken:n,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return mh(e,r,"signUpPassword",Zj);case"emailLink":return sS(e,{idToken:n,email:this._email,oobCode:this._password});default:gn(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ti(t,e){return so(t,"POST","/v1/accounts:signInWithIdp",ar(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const iS="http://localhost";class ps extends Rm{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const n=new ps(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(n.idToken=e.idToken),e.accessToken&&(n.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(n.nonce=e.nonce),e.pendingToken&&(n.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(n.accessToken=e.oauthToken,n.secret=e.oauthTokenSecret):gn("argument-error"),n}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const n=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:s}=n,a=Cm(n,["providerId","signInMethod"]);if(!r||!s)return null;const o=new ps(r,s);return o.idToken=a.idToken||void 0,o.accessToken=a.accessToken||void 0,o.secret=a.secret,o.nonce=a.nonce,o.pendingToken=a.pendingToken||null,o}_getIdTokenResponse(e){const n=this.buildRequest();return ti(e,n)}_linkToIdToken(e,n){const r=this.buildRequest();return r.idToken=n,ti(e,r)}_getReauthenticationResolver(e){const n=this.buildRequest();return n.autoCreate=!1,ti(e,n)}buildRequest(){const e={requestUri:iS,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const n={};this.idToken&&(n.id_token=this.idToken),this.accessToken&&(n.access_token=this.accessToken),this.secret&&(n.oauth_token_secret=this.secret),n.providerId=this.providerId,this.nonce&&!this.pendingToken&&(n.nonce=this.nonce),e.postBody=to(n)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function aS(t){switch(t){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function oS(t){const e=na(ra(t)).link,n=e?na(ra(e)).deep_link_id:null,r=na(ra(t)).deep_link_id;return(r?na(ra(r)).link:null)||r||n||e||t}class Dm{constructor(e){var n,r,s,a,o,c;const u=na(ra(e)),d=(n=u.apiKey)!==null&&n!==void 0?n:null,m=(r=u.oobCode)!==null&&r!==void 0?r:null,y=aS((s=u.mode)!==null&&s!==void 0?s:null);de(d&&m&&y,"argument-error"),this.apiKey=d,this.operation=y,this.code=m,this.continueUrl=(a=u.continueUrl)!==null&&a!==void 0?a:null,this.languageCode=(o=u.languageCode)!==null&&o!==void 0?o:null,this.tenantId=(c=u.tenantId)!==null&&c!==void 0?c:null}static parseLink(e){const n=oS(e);try{return new Dm(n)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ei{constructor(){this.providerId=Ei.PROVIDER_ID}static credential(e,n){return Ua._fromEmailAndPassword(e,n)}static credentialWithLink(e,n){const r=Dm.parseLink(n);return de(r,"argument-error"),Ua._fromEmailAndCode(e,r.code,r.tenantId)}}Ei.PROVIDER_ID="password";Ei.EMAIL_PASSWORD_SIGN_IN_METHOD="password";Ei.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $v{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class io extends $v{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yr extends io{constructor(){super("facebook.com")}static credential(e){return ps._fromParams({providerId:yr.PROVIDER_ID,signInMethod:yr.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return yr.credentialFromTaggedObject(e)}static credentialFromError(e){return yr.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return yr.credential(e.oauthAccessToken)}catch{return null}}}yr.FACEBOOK_SIGN_IN_METHOD="facebook.com";yr.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xr extends io{constructor(){super("google.com"),this.addScope("profile")}static credential(e,n){return ps._fromParams({providerId:xr.PROVIDER_ID,signInMethod:xr.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:n})}static credentialFromResult(e){return xr.credentialFromTaggedObject(e)}static credentialFromError(e){return xr.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:n,oauthAccessToken:r}=e;if(!n&&!r)return null;try{return xr.credential(n,r)}catch{return null}}}xr.GOOGLE_SIGN_IN_METHOD="google.com";xr.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vr extends io{constructor(){super("github.com")}static credential(e){return ps._fromParams({providerId:vr.PROVIDER_ID,signInMethod:vr.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return vr.credentialFromTaggedObject(e)}static credentialFromError(e){return vr.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return vr.credential(e.oauthAccessToken)}catch{return null}}}vr.GITHUB_SIGN_IN_METHOD="github.com";vr.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class br extends io{constructor(){super("twitter.com")}static credential(e,n){return ps._fromParams({providerId:br.PROVIDER_ID,signInMethod:br.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:n})}static credentialFromResult(e){return br.credentialFromTaggedObject(e)}static credentialFromError(e){return br.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:n,oauthTokenSecret:r}=e;if(!n||!r)return null;try{return br.credential(n,r)}catch{return null}}}br.TWITTER_SIGN_IN_METHOD="twitter.com";br.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function lS(t,e){return so(t,"POST","/v1/accounts:signUp",ar(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gs{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,n,r,s=!1){const a=await zn._fromIdTokenResponse(e,r,s),o=Kg(r);return new gs({user:a,providerId:o,_tokenResponse:r,operationType:n})}static async _forOperation(e,n,r){await e._updateTokensIfNecessary(r,!0);const s=Kg(r);return new gs({user:e,providerId:s,_tokenResponse:r,operationType:n})}}function Kg(t){return t.providerId?t.providerId:"phoneNumber"in t?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rc extends Pn{constructor(e,n,r,s){var a;super(n.code,n.message),this.operationType=r,this.user=s,Object.setPrototypeOf(this,rc.prototype),this.customData={appName:e.name,tenantId:(a=e.tenantId)!==null&&a!==void 0?a:void 0,_serverResponse:n.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,n,r,s){return new rc(e,n,r,s)}}function zv(t,e,n,r){return(e==="reauthenticate"?n._getReauthenticationResolver(t):n._getIdTokenResponse(t)).catch(a=>{throw a.code==="auth/multi-factor-auth-required"?rc._fromErrorAndOperation(t,a,e,r):a})}async function cS(t,e,n=!1){const r=await di(t,e._linkToIdToken(t.auth,await t.getIdToken()),n);return gs._forOperation(t,"link",r)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function uS(t,e,n=!1){const{auth:r}=t;if(wn(r.app))return Promise.reject(Gn(r));const s="reauthenticate";try{const a=await di(t,zv(r,s,e,t),n);de(a.idToken,r,"internal-error");const o=km(a.idToken);de(o,r,"internal-error");const{sub:c}=o;return de(t.uid===c,r,"user-mismatch"),gs._forOperation(t,s,a)}catch(a){throw(a==null?void 0:a.code)==="auth/user-not-found"&&gn(r,"user-mismatch"),a}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function qv(t,e,n=!1){if(wn(t.app))return Promise.reject(Gn(t));const r="signIn",s=await zv(t,r,e),a=await gs._fromIdTokenResponse(t,r,s);return n||await t._updateCurrentUser(a.user),a}async function dS(t,e){return qv(Ns(t),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Hv(t){const e=Ns(t);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function Uc(t,e,n){if(wn(t.app))return Promise.reject(Gn(t));const r=Ns(t),o=await mh(r,{returnSecureToken:!0,email:e,password:n,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",lS).catch(u=>{throw u.code==="auth/password-does-not-meet-requirements"&&Hv(t),u}),c=await gs._fromIdTokenResponse(r,"signIn",o);return await r._updateCurrentUser(c.user),c}function sc(t,e,n){return wn(t.app)?Promise.reject(Gn(t)):dS(Le(t),Ei.credential(e,n)).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&Hv(t),r})}async function Gv(t,e){const n=Le(t),s={requestType:"VERIFY_EMAIL",idToken:await t.getIdToken()},{email:a}=await nS(n.auth,s);a!==t.email&&await t.reload()}function hS(t,e){return mS(Le(t),null,e)}async function mS(t,e,n){const{auth:r}=t,a={idToken:await t.getIdToken(),returnSecureToken:!0};n&&(a.password=n);const o=await di(t,Jj(r,a));await t._updateTokensIfNecessary(o,!0)}function fS(t,e,n,r){return Le(t).onIdTokenChanged(e,n,r)}function pS(t,e,n){return Le(t).beforeAuthStateChanged(e,n)}function gS(t,e,n,r){return Le(t).onAuthStateChanged(e,n,r)}function rs(t){return Le(t).signOut()}const ic="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wv{constructor(e,n){this.storageRetriever=e,this.type=n}_isAvailable(){try{return this.storage?(this.storage.setItem(ic,"1"),this.storage.removeItem(ic),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,n){return this.storage.setItem(e,JSON.stringify(n)),Promise.resolve()}_get(e){const n=this.storage.getItem(e);return Promise.resolve(n?JSON.parse(n):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yS=1e3,xS=10;class Kv extends Wv{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,n)=>this.onStorageEvent(e,n),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=Vv(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const n of Object.keys(this.listeners)){const r=this.storage.getItem(n),s=this.localCache[n];r!==s&&e(n,s,r)}}onStorageEvent(e,n=!1){if(!e.key){this.forAllChangedKeys((o,c,u)=>{this.notifyListeners(o,u)});return}const r=e.key;n?this.detachListener():this.stopPolling();const s=()=>{const o=this.storage.getItem(r);!n&&this.localCache[r]===o||this.notifyListeners(r,o)},a=this.storage.getItem(r);Dj()&&a!==e.newValue&&e.newValue!==e.oldValue?setTimeout(s,xS):s()}notifyListeners(e,n){this.localCache[e]=n;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(n&&JSON.parse(n))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,n,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:n,newValue:r}),!0)})},yS)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,n){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(n)}_removeListener(e,n){this.listeners[e]&&(this.listeners[e].delete(n),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,n){await super._set(e,n),this.localCache[e]=JSON.stringify(n)}async _get(e){const n=await super._get(e);return this.localCache[e]=JSON.stringify(n),n}async _remove(e){await super._remove(e),delete this.localCache[e]}}Kv.type="LOCAL";const vS=Kv;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qv extends Wv{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,n){}_removeListener(e,n){}}Qv.type="SESSION";const Yv=Qv;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bS(t){return Promise.all(t.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(n){return{fulfilled:!1,reason:n}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bc{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const n=this.receivers.find(s=>s.isListeningto(e));if(n)return n;const r=new Bc(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const n=e,{eventId:r,eventType:s,data:a}=n.data,o=this.handlersMap[s];if(!(o!=null&&o.size))return;n.ports[0].postMessage({status:"ack",eventId:r,eventType:s});const c=Array.from(o).map(async d=>d(n.origin,a)),u=await bS(c);n.ports[0].postMessage({status:"done",eventId:r,eventType:s,response:u})}_subscribe(e,n){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(n)}_unsubscribe(e,n){this.handlersMap[e]&&n&&this.handlersMap[e].delete(n),(!n||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}Bc.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Mm(t="",e=10){let n="";for(let r=0;r<e;r++)n+=Math.floor(Math.random()*10);return t+n}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wS{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,n,r=50){const s=typeof MessageChannel<"u"?new MessageChannel:null;if(!s)throw new Error("connection_unavailable");let a,o;return new Promise((c,u)=>{const d=Mm("",20);s.port1.start();const m=setTimeout(()=>{u(new Error("unsupported_event"))},r);o={messageChannel:s,onMessage(y){const g=y;if(g.data.eventId===d)switch(g.data.status){case"ack":clearTimeout(m),a=setTimeout(()=>{u(new Error("timeout"))},3e3);break;case"done":clearTimeout(a),c(g.data.response);break;default:clearTimeout(m),clearTimeout(a),u(new Error("invalid_response"));break}}},this.handlers.add(o),s.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:e,eventId:d,data:n},[s.port2])}).finally(()=>{o&&this.removeMessageHandler(o)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Tn(){return window}function _S(t){Tn().location.href=t}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Xv(){return typeof Tn().WorkerGlobalScope<"u"&&typeof Tn().importScripts=="function"}async function NS(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function ES(){var t;return((t=navigator==null?void 0:navigator.serviceWorker)===null||t===void 0?void 0:t.controller)||null}function TS(){return Xv()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Jv="firebaseLocalStorageDb",jS=1,ac="firebaseLocalStorage",Zv="fbase_key";class ao{constructor(e){this.request=e}toPromise(){return new Promise((e,n)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{n(this.request.error)})})}}function $c(t,e){return t.transaction([ac],e?"readwrite":"readonly").objectStore(ac)}function SS(){const t=indexedDB.deleteDatabase(Jv);return new ao(t).toPromise()}function fh(){const t=indexedDB.open(Jv,jS);return new Promise((e,n)=>{t.addEventListener("error",()=>{n(t.error)}),t.addEventListener("upgradeneeded",()=>{const r=t.result;try{r.createObjectStore(ac,{keyPath:Zv})}catch(s){n(s)}}),t.addEventListener("success",async()=>{const r=t.result;r.objectStoreNames.contains(ac)?e(r):(r.close(),await SS(),e(await fh()))})})}async function Qg(t,e,n){const r=$c(t,!0).put({[Zv]:e,value:n});return new ao(r).toPromise()}async function CS(t,e){const n=$c(t,!1).get(e),r=await new ao(n).toPromise();return r===void 0?null:r.value}function Yg(t,e){const n=$c(t,!0).delete(e);return new ao(n).toPromise()}const IS=800,AS=3;class eb{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await fh(),this.db)}async _withRetries(e){let n=0;for(;;)try{const r=await this._openDb();return await e(r)}catch(r){if(n++>AS)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return Xv()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Bc._getInstance(TS()),this.receiver._subscribe("keyChanged",async(e,n)=>({keyProcessed:(await this._poll()).includes(n.key)})),this.receiver._subscribe("ping",async(e,n)=>["keyChanged"])}async initializeSender(){var e,n;if(this.activeServiceWorker=await NS(),!this.activeServiceWorker)return;this.sender=new wS(this.activeServiceWorker);const r=await this.sender._send("ping",{},800);r&&!((e=r[0])===null||e===void 0)&&e.fulfilled&&!((n=r[0])===null||n===void 0)&&n.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||ES()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await fh();return await Qg(e,ic,"1"),await Yg(e,ic),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,n){return this._withPendingWrite(async()=>(await this._withRetries(r=>Qg(r,e,n)),this.localCache[e]=n,this.notifyServiceWorker(e)))}async _get(e){const n=await this._withRetries(r=>CS(r,e));return this.localCache[e]=n,n}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(n=>Yg(n,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(s=>{const a=$c(s,!1).getAll();return new ao(a).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const n=[],r=new Set;if(e.length!==0)for(const{fbase_key:s,value:a}of e)r.add(s),JSON.stringify(this.localCache[s])!==JSON.stringify(a)&&(this.notifyListeners(s,a),n.push(s));for(const s of Object.keys(this.localCache))this.localCache[s]&&!r.has(s)&&(this.notifyListeners(s,null),n.push(s));return n}notifyListeners(e,n){this.localCache[e]=n;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(n)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),IS)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,n){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(n)}_removeListener(e,n){this.listeners[e]&&(this.listeners[e].delete(n),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}eb.type="LOCAL";const kS=eb;new ro(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function PS(t,e){return e?qn(e):(de(t._popupRedirectResolver,t,"argument-error"),t._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Om extends Rm{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return ti(e,this._buildIdpRequest())}_linkToIdToken(e,n){return ti(e,this._buildIdpRequest(n))}_getReauthenticationResolver(e){return ti(e,this._buildIdpRequest())}_buildIdpRequest(e){const n={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(n.idToken=e),n}}function RS(t){return qv(t.auth,new Om(t),t.bypassAuthState)}function DS(t){const{auth:e,user:n}=t;return de(n,e,"internal-error"),uS(n,new Om(t),t.bypassAuthState)}async function MS(t){const{auth:e,user:n}=t;return de(n,e,"internal-error"),cS(n,new Om(t),t.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tb{constructor(e,n,r,s,a=!1){this.auth=e,this.resolver=r,this.user=s,this.bypassAuthState=a,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(n)?n:[n]}execute(){return new Promise(async(e,n)=>{this.pendingPromise={resolve:e,reject:n};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(e){const{urlResponse:n,sessionId:r,postBody:s,tenantId:a,error:o,type:c}=e;if(o){this.reject(o);return}const u={auth:this.auth,requestUri:n,sessionId:r,tenantId:a||void 0,postBody:s||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(c)(u))}catch(d){this.reject(d)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return RS;case"linkViaPopup":case"linkViaRedirect":return MS;case"reauthViaPopup":case"reauthViaRedirect":return DS;default:gn(this.auth,"internal-error")}}resolve(e){er(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){er(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const OS=new ro(2e3,1e4);class Gs extends tb{constructor(e,n,r,s,a){super(e,n,s,a),this.provider=r,this.authWindow=null,this.pollId=null,Gs.currentPopupAction&&Gs.currentPopupAction.cancel(),Gs.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return de(e,this.auth,"internal-error"),e}async onExecution(){er(this.filter.length===1,"Popup operations only handle one event");const e=Mm();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(n=>{this.reject(n)}),this.resolver._isIframeWebStorageSupported(this.auth,n=>{n||this.reject(En(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)===null||e===void 0?void 0:e.associatedEvent)||null}cancel(){this.reject(En(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Gs.currentPopupAction=null}pollUserCancellation(){const e=()=>{var n,r;if(!((r=(n=this.authWindow)===null||n===void 0?void 0:n.window)===null||r===void 0)&&r.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(En(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,OS.get())};e()}}Gs.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const LS="pendingRedirect",bl=new Map;class VS extends tb{constructor(e,n,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],n,void 0,r),this.eventId=null}async execute(){let e=bl.get(this.auth._key());if(!e){try{const r=await FS(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(r)}catch(n){e=()=>Promise.reject(n)}bl.set(this.auth._key(),e)}return this.bypassAuthState||bl.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const n=await this.auth._redirectUserForId(e.eventId);if(n)return this.user=n,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function FS(t,e){const n=$S(e),r=BS(t);if(!await r._isAvailable())return!1;const s=await r._get(n)==="true";return await r._remove(n),s}function US(t,e){bl.set(t._key(),e)}function BS(t){return qn(t._redirectPersistence)}function $S(t){return vl(LS,t.config.apiKey,t.name)}async function zS(t,e,n=!1){if(wn(t.app))return Promise.reject(Gn(t));const r=Ns(t),s=PS(r,e),o=await new VS(r,s,n).execute();return o&&!n&&(delete o.user._redirectEventId,await r._persistUserIfCurrent(o.user),await r._setRedirectUser(null,e)),o}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qS=10*60*1e3;class HS{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let n=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(n=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!GS(e)||(this.hasHandledPotentialRedirect=!0,n||(this.queuedRedirectEvent=e,n=!0)),n}sendToConsumer(e,n){var r;if(e.error&&!nb(e)){const s=((r=e.error.code)===null||r===void 0?void 0:r.split("auth/")[1])||"internal-error";n.onError(En(this.auth,s))}else n.onAuthEvent(e)}isEventForConsumer(e,n){const r=n.eventId===null||!!e.eventId&&e.eventId===n.eventId;return n.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=qS&&this.cachedEventUids.clear(),this.cachedEventUids.has(Xg(e))}saveEventToCache(e){this.cachedEventUids.add(Xg(e)),this.lastProcessedEventTime=Date.now()}}function Xg(t){return[t.type,t.eventId,t.sessionId,t.tenantId].filter(e=>e).join("-")}function nb({type:t,error:e}){return t==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function GS(t){switch(t.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return nb(t);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function WS(t,e={}){return Rn(t,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const KS=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,QS=/^https?/;async function YS(t){if(t.config.emulator)return;const{authorizedDomains:e}=await WS(t);for(const n of e)try{if(XS(n))return}catch{}gn(t,"unauthorized-domain")}function XS(t){const e=dh(),{protocol:n,hostname:r}=new URL(e);if(t.startsWith("chrome-extension://")){const o=new URL(t);return o.hostname===""&&r===""?n==="chrome-extension:"&&t.replace("chrome-extension://","")===e.replace("chrome-extension://",""):n==="chrome-extension:"&&o.hostname===r}if(!QS.test(n))return!1;if(KS.test(t))return r===t;const s=t.replace(/\./g,"\\.");return new RegExp("^(.+\\."+s+"|"+s+")$","i").test(r)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const JS=new ro(3e4,6e4);function Jg(){const t=Tn().___jsl;if(t!=null&&t.H){for(const e of Object.keys(t.H))if(t.H[e].r=t.H[e].r||[],t.H[e].L=t.H[e].L||[],t.H[e].r=[...t.H[e].L],t.CP)for(let n=0;n<t.CP.length;n++)t.CP[n]=null}}function ZS(t){return new Promise((e,n)=>{var r,s,a;function o(){Jg(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{Jg(),n(En(t,"network-request-failed"))},timeout:JS.get()})}if(!((s=(r=Tn().gapi)===null||r===void 0?void 0:r.iframes)===null||s===void 0)&&s.Iframe)e(gapi.iframes.getContext());else if(!((a=Tn().gapi)===null||a===void 0)&&a.load)o();else{const c=zj("iframefcb");return Tn()[c]=()=>{gapi.load?o():n(En(t,"network-request-failed"))},Uv(`${$j()}?onload=${c}`).catch(u=>n(u))}}).catch(e=>{throw wl=null,e})}let wl=null;function e1(t){return wl=wl||ZS(t),wl}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const t1=new ro(5e3,15e3),n1="__/auth/iframe",r1="emulator/auth/iframe",s1={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},i1=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function a1(t){const e=t.config;de(e.authDomain,t,"auth-domain-config-required");const n=e.emulator?Am(e,r1):`https://${t.config.authDomain}/${n1}`,r={apiKey:e.apiKey,appName:t.name,v:_s},s=i1.get(t.config.apiHost);s&&(r.eid=s);const a=t._getFrameworks();return a.length&&(r.fw=a.join(",")),`${n}?${to(r).slice(1)}`}async function o1(t){const e=await e1(t),n=Tn().gapi;return de(n,t,"internal-error"),e.open({where:document.body,url:a1(t),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:s1,dontclear:!0},r=>new Promise(async(s,a)=>{await r.restyle({setHideOnLeave:!1});const o=En(t,"network-request-failed"),c=Tn().setTimeout(()=>{a(o)},t1.get());function u(){Tn().clearTimeout(c),s(r)}r.ping(u).then(u,()=>{a(o)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const l1={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},c1=500,u1=600,d1="_blank",h1="http://localhost";class Zg{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function m1(t,e,n,r=c1,s=u1){const a=Math.max((window.screen.availHeight-s)/2,0).toString(),o=Math.max((window.screen.availWidth-r)/2,0).toString();let c="";const u=Object.assign(Object.assign({},l1),{width:r.toString(),height:s.toString(),top:a,left:o}),d=Et().toLowerCase();n&&(c=Rv(d)?d1:n),kv(d)&&(e=e||h1,u.scrollbars="yes");const m=Object.entries(u).reduce((g,[x,C])=>`${g}${x}=${C},`,"");if(Rj(d)&&c!=="_self")return f1(e||"",c),new Zg(null);const y=window.open(e||"",c,m);de(y,t,"popup-blocked");try{y.focus()}catch{}return new Zg(y)}function f1(t,e){const n=document.createElement("a");n.href=t,n.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(r)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const p1="__/auth/handler",g1="emulator/auth/handler",y1=encodeURIComponent("fac");async function ey(t,e,n,r,s,a){de(t.config.authDomain,t,"auth-domain-config-required"),de(t.config.apiKey,t,"invalid-api-key");const o={apiKey:t.config.apiKey,appName:t.name,authType:n,redirectUrl:r,v:_s,eventId:s};if(e instanceof $v){e.setDefaultLanguage(t.languageCode),o.providerId=e.providerId||"",rT(e.getCustomParameters())||(o.customParameters=JSON.stringify(e.getCustomParameters()));for(const[m,y]of Object.entries({}))o[m]=y}if(e instanceof io){const m=e.getScopes().filter(y=>y!=="");m.length>0&&(o.scopes=m.join(","))}t.tenantId&&(o.tid=t.tenantId);const c=o;for(const m of Object.keys(c))c[m]===void 0&&delete c[m];const u=await t._getAppCheckToken(),d=u?`#${y1}=${encodeURIComponent(u)}`:"";return`${x1(t)}?${to(c).slice(1)}${d}`}function x1({config:t}){return t.emulator?Am(t,g1):`https://${t.authDomain}/${p1}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const od="webStorageSupport";class v1{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=Yv,this._completeRedirectFn=zS,this._overrideRedirectResult=US}async _openPopup(e,n,r,s){var a;er((a=this.eventManagers[e._key()])===null||a===void 0?void 0:a.manager,"_initialize() not called before _openPopup()");const o=await ey(e,n,r,dh(),s);return m1(e,o,Mm())}async _openRedirect(e,n,r,s){await this._originValidation(e);const a=await ey(e,n,r,dh(),s);return _S(a),new Promise(()=>{})}_initialize(e){const n=e._key();if(this.eventManagers[n]){const{manager:s,promise:a}=this.eventManagers[n];return s?Promise.resolve(s):(er(a,"If manager is not set, promise should be"),a)}const r=this.initAndGetManager(e);return this.eventManagers[n]={promise:r},r.catch(()=>{delete this.eventManagers[n]}),r}async initAndGetManager(e){const n=await o1(e),r=new HS(e);return n.register("authEvent",s=>(de(s==null?void 0:s.authEvent,e,"invalid-auth-event"),{status:r.onEvent(s.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=n,r}_isIframeWebStorageSupported(e,n){this.iframes[e._key()].send(od,{type:od},s=>{var a;const o=(a=s==null?void 0:s[0])===null||a===void 0?void 0:a[od];o!==void 0&&n(!!o),gn(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const n=e._key();return this.originValidationPromises[n]||(this.originValidationPromises[n]=YS(e)),this.originValidationPromises[n]}get _shouldInitProactively(){return Vv()||Pv()||Pm()}}const b1=v1;var ty="@firebase/auth",ny="1.7.9";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class w1{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const n=this.auth.onIdTokenChanged(r=>{e((r==null?void 0:r.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,n),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const n=this.internalListeners.get(e);n&&(this.internalListeners.delete(e),n(),this.updateProactiveRefresh())}assertAuthConfigured(){de(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _1(t){switch(t){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function N1(t){Vr(new Jn("auth",(e,{options:n})=>{const r=e.getProvider("app").getImmediate(),s=e.getProvider("heartbeat"),a=e.getProvider("app-check-internal"),{apiKey:o,authDomain:c}=r.options;de(o&&!o.includes(":"),"invalid-api-key",{appName:r.name});const u={apiKey:o,authDomain:c,clientPlatform:t,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Fv(t)},d=new Fj(r,s,a,u);return Kj(d,n),d},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,n,r)=>{e.getProvider("auth-internal").initialize()})),Vr(new Jn("auth-internal",e=>{const n=Ns(e.getProvider("auth").getImmediate());return(r=>new w1(r))(n)},"PRIVATE").setInstantiationMode("EXPLICIT")),tn(ty,ny,_1(t)),tn(ty,ny,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const E1=5*60,T1=pv("authIdTokenMaxAge")||E1;let ry=null;const j1=t=>async e=>{const n=e&&await e.getIdTokenResult(),r=n&&(new Date().getTime()-Date.parse(n.issuedAtTime))/1e3;if(r&&r>T1)return;const s=n==null?void 0:n.token;ry!==s&&(ry=s,await fetch(t,{method:s?"POST":"DELETE",headers:s?{Authorization:`Bearer ${s}`}:{}}))};function S1(t=Vc()){const e=no(t,"auth");if(e.isInitialized())return e.getImmediate();const n=Wj(t,{popupRedirectResolver:b1,persistence:[kS,vS,Yv]}),r=pv("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){const a=new URL(r,location.origin);if(location.origin===a.origin){const o=j1(a.toString());pS(n,o,()=>o(n.currentUser)),fS(n,c=>o(c))}}const s=mv("auth");return s&&Qj(n,`http://${s}`),n}function C1(){var t,e;return(e=(t=document.getElementsByTagName("head"))===null||t===void 0?void 0:t[0])!==null&&e!==void 0?e:document}Uj({loadJS(t){return new Promise((e,n)=>{const r=document.createElement("script");r.setAttribute("src",t),r.onload=e,r.onerror=s=>{const a=En("internal-error");a.customData=s,n(a)},r.type="text/javascript",r.charset="UTF-8",C1().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});N1("Browser");var sy=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var os,rb;(function(){var t;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(j,v){function S(){}S.prototype=v.prototype,j.D=v.prototype,j.prototype=new S,j.prototype.constructor=j,j.C=function(p,I,b){for(var _=Array(arguments.length-2),$=2;$<arguments.length;$++)_[$-2]=arguments[$];return v.prototype[I].apply(p,_)}}function n(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(r,n),r.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function s(j,v,S){S||(S=0);var p=Array(16);if(typeof v=="string")for(var I=0;16>I;++I)p[I]=v.charCodeAt(S++)|v.charCodeAt(S++)<<8|v.charCodeAt(S++)<<16|v.charCodeAt(S++)<<24;else for(I=0;16>I;++I)p[I]=v[S++]|v[S++]<<8|v[S++]<<16|v[S++]<<24;v=j.g[0],S=j.g[1],I=j.g[2];var b=j.g[3],_=v+(b^S&(I^b))+p[0]+3614090360&4294967295;v=S+(_<<7&4294967295|_>>>25),_=b+(I^v&(S^I))+p[1]+3905402710&4294967295,b=v+(_<<12&4294967295|_>>>20),_=I+(S^b&(v^S))+p[2]+606105819&4294967295,I=b+(_<<17&4294967295|_>>>15),_=S+(v^I&(b^v))+p[3]+3250441966&4294967295,S=I+(_<<22&4294967295|_>>>10),_=v+(b^S&(I^b))+p[4]+4118548399&4294967295,v=S+(_<<7&4294967295|_>>>25),_=b+(I^v&(S^I))+p[5]+1200080426&4294967295,b=v+(_<<12&4294967295|_>>>20),_=I+(S^b&(v^S))+p[6]+2821735955&4294967295,I=b+(_<<17&4294967295|_>>>15),_=S+(v^I&(b^v))+p[7]+4249261313&4294967295,S=I+(_<<22&4294967295|_>>>10),_=v+(b^S&(I^b))+p[8]+1770035416&4294967295,v=S+(_<<7&4294967295|_>>>25),_=b+(I^v&(S^I))+p[9]+2336552879&4294967295,b=v+(_<<12&4294967295|_>>>20),_=I+(S^b&(v^S))+p[10]+4294925233&4294967295,I=b+(_<<17&4294967295|_>>>15),_=S+(v^I&(b^v))+p[11]+2304563134&4294967295,S=I+(_<<22&4294967295|_>>>10),_=v+(b^S&(I^b))+p[12]+1804603682&4294967295,v=S+(_<<7&4294967295|_>>>25),_=b+(I^v&(S^I))+p[13]+4254626195&4294967295,b=v+(_<<12&4294967295|_>>>20),_=I+(S^b&(v^S))+p[14]+2792965006&4294967295,I=b+(_<<17&4294967295|_>>>15),_=S+(v^I&(b^v))+p[15]+1236535329&4294967295,S=I+(_<<22&4294967295|_>>>10),_=v+(I^b&(S^I))+p[1]+4129170786&4294967295,v=S+(_<<5&4294967295|_>>>27),_=b+(S^I&(v^S))+p[6]+3225465664&4294967295,b=v+(_<<9&4294967295|_>>>23),_=I+(v^S&(b^v))+p[11]+643717713&4294967295,I=b+(_<<14&4294967295|_>>>18),_=S+(b^v&(I^b))+p[0]+3921069994&4294967295,S=I+(_<<20&4294967295|_>>>12),_=v+(I^b&(S^I))+p[5]+3593408605&4294967295,v=S+(_<<5&4294967295|_>>>27),_=b+(S^I&(v^S))+p[10]+38016083&4294967295,b=v+(_<<9&4294967295|_>>>23),_=I+(v^S&(b^v))+p[15]+3634488961&4294967295,I=b+(_<<14&4294967295|_>>>18),_=S+(b^v&(I^b))+p[4]+3889429448&4294967295,S=I+(_<<20&4294967295|_>>>12),_=v+(I^b&(S^I))+p[9]+568446438&4294967295,v=S+(_<<5&4294967295|_>>>27),_=b+(S^I&(v^S))+p[14]+3275163606&4294967295,b=v+(_<<9&4294967295|_>>>23),_=I+(v^S&(b^v))+p[3]+4107603335&4294967295,I=b+(_<<14&4294967295|_>>>18),_=S+(b^v&(I^b))+p[8]+1163531501&4294967295,S=I+(_<<20&4294967295|_>>>12),_=v+(I^b&(S^I))+p[13]+2850285829&4294967295,v=S+(_<<5&4294967295|_>>>27),_=b+(S^I&(v^S))+p[2]+4243563512&4294967295,b=v+(_<<9&4294967295|_>>>23),_=I+(v^S&(b^v))+p[7]+1735328473&4294967295,I=b+(_<<14&4294967295|_>>>18),_=S+(b^v&(I^b))+p[12]+2368359562&4294967295,S=I+(_<<20&4294967295|_>>>12),_=v+(S^I^b)+p[5]+4294588738&4294967295,v=S+(_<<4&4294967295|_>>>28),_=b+(v^S^I)+p[8]+2272392833&4294967295,b=v+(_<<11&4294967295|_>>>21),_=I+(b^v^S)+p[11]+1839030562&4294967295,I=b+(_<<16&4294967295|_>>>16),_=S+(I^b^v)+p[14]+4259657740&4294967295,S=I+(_<<23&4294967295|_>>>9),_=v+(S^I^b)+p[1]+2763975236&4294967295,v=S+(_<<4&4294967295|_>>>28),_=b+(v^S^I)+p[4]+1272893353&4294967295,b=v+(_<<11&4294967295|_>>>21),_=I+(b^v^S)+p[7]+4139469664&4294967295,I=b+(_<<16&4294967295|_>>>16),_=S+(I^b^v)+p[10]+3200236656&4294967295,S=I+(_<<23&4294967295|_>>>9),_=v+(S^I^b)+p[13]+681279174&4294967295,v=S+(_<<4&4294967295|_>>>28),_=b+(v^S^I)+p[0]+3936430074&4294967295,b=v+(_<<11&4294967295|_>>>21),_=I+(b^v^S)+p[3]+3572445317&4294967295,I=b+(_<<16&4294967295|_>>>16),_=S+(I^b^v)+p[6]+76029189&4294967295,S=I+(_<<23&4294967295|_>>>9),_=v+(S^I^b)+p[9]+3654602809&4294967295,v=S+(_<<4&4294967295|_>>>28),_=b+(v^S^I)+p[12]+3873151461&4294967295,b=v+(_<<11&4294967295|_>>>21),_=I+(b^v^S)+p[15]+530742520&4294967295,I=b+(_<<16&4294967295|_>>>16),_=S+(I^b^v)+p[2]+3299628645&4294967295,S=I+(_<<23&4294967295|_>>>9),_=v+(I^(S|~b))+p[0]+4096336452&4294967295,v=S+(_<<6&4294967295|_>>>26),_=b+(S^(v|~I))+p[7]+1126891415&4294967295,b=v+(_<<10&4294967295|_>>>22),_=I+(v^(b|~S))+p[14]+2878612391&4294967295,I=b+(_<<15&4294967295|_>>>17),_=S+(b^(I|~v))+p[5]+4237533241&4294967295,S=I+(_<<21&4294967295|_>>>11),_=v+(I^(S|~b))+p[12]+1700485571&4294967295,v=S+(_<<6&4294967295|_>>>26),_=b+(S^(v|~I))+p[3]+2399980690&4294967295,b=v+(_<<10&4294967295|_>>>22),_=I+(v^(b|~S))+p[10]+4293915773&4294967295,I=b+(_<<15&4294967295|_>>>17),_=S+(b^(I|~v))+p[1]+2240044497&4294967295,S=I+(_<<21&4294967295|_>>>11),_=v+(I^(S|~b))+p[8]+1873313359&4294967295,v=S+(_<<6&4294967295|_>>>26),_=b+(S^(v|~I))+p[15]+4264355552&4294967295,b=v+(_<<10&4294967295|_>>>22),_=I+(v^(b|~S))+p[6]+2734768916&4294967295,I=b+(_<<15&4294967295|_>>>17),_=S+(b^(I|~v))+p[13]+1309151649&4294967295,S=I+(_<<21&4294967295|_>>>11),_=v+(I^(S|~b))+p[4]+4149444226&4294967295,v=S+(_<<6&4294967295|_>>>26),_=b+(S^(v|~I))+p[11]+3174756917&4294967295,b=v+(_<<10&4294967295|_>>>22),_=I+(v^(b|~S))+p[2]+718787259&4294967295,I=b+(_<<15&4294967295|_>>>17),_=S+(b^(I|~v))+p[9]+3951481745&4294967295,j.g[0]=j.g[0]+v&4294967295,j.g[1]=j.g[1]+(I+(_<<21&4294967295|_>>>11))&4294967295,j.g[2]=j.g[2]+I&4294967295,j.g[3]=j.g[3]+b&4294967295}r.prototype.u=function(j,v){v===void 0&&(v=j.length);for(var S=v-this.blockSize,p=this.B,I=this.h,b=0;b<v;){if(I==0)for(;b<=S;)s(this,j,b),b+=this.blockSize;if(typeof j=="string"){for(;b<v;)if(p[I++]=j.charCodeAt(b++),I==this.blockSize){s(this,p),I=0;break}}else for(;b<v;)if(p[I++]=j[b++],I==this.blockSize){s(this,p),I=0;break}}this.h=I,this.o+=v},r.prototype.v=function(){var j=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);j[0]=128;for(var v=1;v<j.length-8;++v)j[v]=0;var S=8*this.o;for(v=j.length-8;v<j.length;++v)j[v]=S&255,S/=256;for(this.u(j),j=Array(16),v=S=0;4>v;++v)for(var p=0;32>p;p+=8)j[S++]=this.g[v]>>>p&255;return j};function a(j,v){var S=c;return Object.prototype.hasOwnProperty.call(S,j)?S[j]:S[j]=v(j)}function o(j,v){this.h=v;for(var S=[],p=!0,I=j.length-1;0<=I;I--){var b=j[I]|0;p&&b==v||(S[I]=b,p=!1)}this.g=S}var c={};function u(j){return-128<=j&&128>j?a(j,function(v){return new o([v|0],0>v?-1:0)}):new o([j|0],0>j?-1:0)}function d(j){if(isNaN(j)||!isFinite(j))return y;if(0>j)return A(d(-j));for(var v=[],S=1,p=0;j>=S;p++)v[p]=j/S|0,S*=4294967296;return new o(v,0)}function m(j,v){if(j.length==0)throw Error("number format error: empty string");if(v=v||10,2>v||36<v)throw Error("radix out of range: "+v);if(j.charAt(0)=="-")return A(m(j.substring(1),v));if(0<=j.indexOf("-"))throw Error('number format error: interior "-" character');for(var S=d(Math.pow(v,8)),p=y,I=0;I<j.length;I+=8){var b=Math.min(8,j.length-I),_=parseInt(j.substring(I,I+b),v);8>b?(b=d(Math.pow(v,b)),p=p.j(b).add(d(_))):(p=p.j(S),p=p.add(d(_)))}return p}var y=u(0),g=u(1),x=u(16777216);t=o.prototype,t.m=function(){if(E(this))return-A(this).m();for(var j=0,v=1,S=0;S<this.g.length;S++){var p=this.i(S);j+=(0<=p?p:4294967296+p)*v,v*=4294967296}return j},t.toString=function(j){if(j=j||10,2>j||36<j)throw Error("radix out of range: "+j);if(C(this))return"0";if(E(this))return"-"+A(this).toString(j);for(var v=d(Math.pow(j,6)),S=this,p="";;){var I=L(S,v).g;S=N(S,I.j(v));var b=((0<S.g.length?S.g[0]:S.h)>>>0).toString(j);if(S=I,C(S))return b+p;for(;6>b.length;)b="0"+b;p=b+p}},t.i=function(j){return 0>j?0:j<this.g.length?this.g[j]:this.h};function C(j){if(j.h!=0)return!1;for(var v=0;v<j.g.length;v++)if(j.g[v]!=0)return!1;return!0}function E(j){return j.h==-1}t.l=function(j){return j=N(this,j),E(j)?-1:C(j)?0:1};function A(j){for(var v=j.g.length,S=[],p=0;p<v;p++)S[p]=~j.g[p];return new o(S,~j.h).add(g)}t.abs=function(){return E(this)?A(this):this},t.add=function(j){for(var v=Math.max(this.g.length,j.g.length),S=[],p=0,I=0;I<=v;I++){var b=p+(this.i(I)&65535)+(j.i(I)&65535),_=(b>>>16)+(this.i(I)>>>16)+(j.i(I)>>>16);p=_>>>16,b&=65535,_&=65535,S[I]=_<<16|b}return new o(S,S[S.length-1]&-2147483648?-1:0)};function N(j,v){return j.add(A(v))}t.j=function(j){if(C(this)||C(j))return y;if(E(this))return E(j)?A(this).j(A(j)):A(A(this).j(j));if(E(j))return A(this.j(A(j)));if(0>this.l(x)&&0>j.l(x))return d(this.m()*j.m());for(var v=this.g.length+j.g.length,S=[],p=0;p<2*v;p++)S[p]=0;for(p=0;p<this.g.length;p++)for(var I=0;I<j.g.length;I++){var b=this.i(p)>>>16,_=this.i(p)&65535,$=j.i(I)>>>16,D=j.i(I)&65535;S[2*p+2*I]+=_*D,T(S,2*p+2*I),S[2*p+2*I+1]+=b*D,T(S,2*p+2*I+1),S[2*p+2*I+1]+=_*$,T(S,2*p+2*I+1),S[2*p+2*I+2]+=b*$,T(S,2*p+2*I+2)}for(p=0;p<v;p++)S[p]=S[2*p+1]<<16|S[2*p];for(p=v;p<2*v;p++)S[p]=0;return new o(S,0)};function T(j,v){for(;(j[v]&65535)!=j[v];)j[v+1]+=j[v]>>>16,j[v]&=65535,v++}function k(j,v){this.g=j,this.h=v}function L(j,v){if(C(v))throw Error("division by zero");if(C(j))return new k(y,y);if(E(j))return v=L(A(j),v),new k(A(v.g),A(v.h));if(E(v))return v=L(j,A(v)),new k(A(v.g),v.h);if(30<j.g.length){if(E(j)||E(v))throw Error("slowDivide_ only works with positive integers.");for(var S=g,p=v;0>=p.l(j);)S=q(S),p=q(p);var I=z(S,1),b=z(p,1);for(p=z(p,2),S=z(S,2);!C(p);){var _=b.add(p);0>=_.l(j)&&(I=I.add(S),b=_),p=z(p,1),S=z(S,1)}return v=N(j,I.j(v)),new k(I,v)}for(I=y;0<=j.l(v);){for(S=Math.max(1,Math.floor(j.m()/v.m())),p=Math.ceil(Math.log(S)/Math.LN2),p=48>=p?1:Math.pow(2,p-48),b=d(S),_=b.j(v);E(_)||0<_.l(j);)S-=p,b=d(S),_=b.j(v);C(b)&&(b=g),I=I.add(b),j=N(j,_)}return new k(I,j)}t.A=function(j){return L(this,j).h},t.and=function(j){for(var v=Math.max(this.g.length,j.g.length),S=[],p=0;p<v;p++)S[p]=this.i(p)&j.i(p);return new o(S,this.h&j.h)},t.or=function(j){for(var v=Math.max(this.g.length,j.g.length),S=[],p=0;p<v;p++)S[p]=this.i(p)|j.i(p);return new o(S,this.h|j.h)},t.xor=function(j){for(var v=Math.max(this.g.length,j.g.length),S=[],p=0;p<v;p++)S[p]=this.i(p)^j.i(p);return new o(S,this.h^j.h)};function q(j){for(var v=j.g.length+1,S=[],p=0;p<v;p++)S[p]=j.i(p)<<1|j.i(p-1)>>>31;return new o(S,j.h)}function z(j,v){var S=v>>5;v%=32;for(var p=j.g.length-S,I=[],b=0;b<p;b++)I[b]=0<v?j.i(b+S)>>>v|j.i(b+S+1)<<32-v:j.i(b+S);return new o(I,j.h)}r.prototype.digest=r.prototype.v,r.prototype.reset=r.prototype.s,r.prototype.update=r.prototype.u,rb=r,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.A,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=d,o.fromString=m,os=o}).apply(typeof sy<"u"?sy:typeof self<"u"?self:typeof window<"u"?window:{});var tl=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var sb,sa,ib,_l,ph,ab,ob,lb;(function(){var t,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(l,h,f){return l==Array.prototype||l==Object.prototype||(l[h]=f.value),l};function n(l){l=[typeof globalThis=="object"&&globalThis,l,typeof window=="object"&&window,typeof self=="object"&&self,typeof tl=="object"&&tl];for(var h=0;h<l.length;++h){var f=l[h];if(f&&f.Math==Math)return f}throw Error("Cannot find global object")}var r=n(this);function s(l,h){if(h)e:{var f=r;l=l.split(".");for(var w=0;w<l.length-1;w++){var B=l[w];if(!(B in f))break e;f=f[B]}l=l[l.length-1],w=f[l],h=h(w),h!=w&&h!=null&&e(f,l,{configurable:!0,writable:!0,value:h})}}function a(l,h){l instanceof String&&(l+="");var f=0,w=!1,B={next:function(){if(!w&&f<l.length){var G=f++;return{value:h(G,l[G]),done:!1}}return w=!0,{done:!0,value:void 0}}};return B[Symbol.iterator]=function(){return B},B}s("Array.prototype.values",function(l){return l||function(){return a(this,function(h,f){return f})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var o=o||{},c=this||self;function u(l){var h=typeof l;return h=h!="object"?h:l?Array.isArray(l)?"array":h:"null",h=="array"||h=="object"&&typeof l.length=="number"}function d(l){var h=typeof l;return h=="object"&&l!=null||h=="function"}function m(l,h,f){return l.call.apply(l.bind,arguments)}function y(l,h,f){if(!l)throw Error();if(2<arguments.length){var w=Array.prototype.slice.call(arguments,2);return function(){var B=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(B,w),l.apply(h,B)}}return function(){return l.apply(h,arguments)}}function g(l,h,f){return g=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?m:y,g.apply(null,arguments)}function x(l,h){var f=Array.prototype.slice.call(arguments,1);return function(){var w=f.slice();return w.push.apply(w,arguments),l.apply(this,w)}}function C(l,h){function f(){}f.prototype=h.prototype,l.aa=h.prototype,l.prototype=new f,l.prototype.constructor=l,l.Qb=function(w,B,G){for(var re=Array(arguments.length-2),Se=2;Se<arguments.length;Se++)re[Se-2]=arguments[Se];return h.prototype[B].apply(w,re)}}function E(l){const h=l.length;if(0<h){const f=Array(h);for(let w=0;w<h;w++)f[w]=l[w];return f}return[]}function A(l,h){for(let f=1;f<arguments.length;f++){const w=arguments[f];if(u(w)){const B=l.length||0,G=w.length||0;l.length=B+G;for(let re=0;re<G;re++)l[B+re]=w[re]}else l.push(w)}}class N{constructor(h,f){this.i=h,this.j=f,this.h=0,this.g=null}get(){let h;return 0<this.h?(this.h--,h=this.g,this.g=h.next,h.next=null):h=this.i(),h}}function T(l){return/^[\s\xa0]*$/.test(l)}function k(){var l=c.navigator;return l&&(l=l.userAgent)?l:""}function L(l){return L[" "](l),l}L[" "]=function(){};var q=k().indexOf("Gecko")!=-1&&!(k().toLowerCase().indexOf("webkit")!=-1&&k().indexOf("Edge")==-1)&&!(k().indexOf("Trident")!=-1||k().indexOf("MSIE")!=-1)&&k().indexOf("Edge")==-1;function z(l,h,f){for(const w in l)h.call(f,l[w],w,l)}function j(l,h){for(const f in l)h.call(void 0,l[f],f,l)}function v(l){const h={};for(const f in l)h[f]=l[f];return h}const S="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function p(l,h){let f,w;for(let B=1;B<arguments.length;B++){w=arguments[B];for(f in w)l[f]=w[f];for(let G=0;G<S.length;G++)f=S[G],Object.prototype.hasOwnProperty.call(w,f)&&(l[f]=w[f])}}function I(l){var h=1;l=l.split(":");const f=[];for(;0<h&&l.length;)f.push(l.shift()),h--;return l.length&&f.push(l.join(":")),f}function b(l){c.setTimeout(()=>{throw l},0)}function _(){var l=W;let h=null;return l.g&&(h=l.g,l.g=l.g.next,l.g||(l.h=null),h.next=null),h}class ${constructor(){this.h=this.g=null}add(h,f){const w=D.get();w.set(h,f),this.h?this.h.next=w:this.g=w,this.h=w}}var D=new N(()=>new F,l=>l.reset());class F{constructor(){this.next=this.g=this.h=null}set(h,f){this.h=h,this.g=f,this.next=null}reset(){this.next=this.g=this.h=null}}let O,M=!1,W=new $,U=()=>{const l=c.Promise.resolve(void 0);O=()=>{l.then(Q)}};var Q=()=>{for(var l;l=_();){try{l.h.call(l.g)}catch(f){b(f)}var h=D;h.j(l),100>h.h&&(h.h++,l.next=h.g,h.g=l)}M=!1};function P(){this.s=this.s,this.C=this.C}P.prototype.s=!1,P.prototype.ma=function(){this.s||(this.s=!0,this.N())},P.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function H(l,h){this.type=l,this.g=this.target=h,this.defaultPrevented=!1}H.prototype.h=function(){this.defaultPrevented=!0};var R=function(){if(!c.addEventListener||!Object.defineProperty)return!1;var l=!1,h=Object.defineProperty({},"passive",{get:function(){l=!0}});try{const f=()=>{};c.addEventListener("test",f,h),c.removeEventListener("test",f,h)}catch{}return l}();function K(l,h){if(H.call(this,l?l.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,l){var f=this.type=l.type,w=l.changedTouches&&l.changedTouches.length?l.changedTouches[0]:null;if(this.target=l.target||l.srcElement,this.g=h,h=l.relatedTarget){if(q){e:{try{L(h.nodeName);var B=!0;break e}catch{}B=!1}B||(h=null)}}else f=="mouseover"?h=l.fromElement:f=="mouseout"&&(h=l.toElement);this.relatedTarget=h,w?(this.clientX=w.clientX!==void 0?w.clientX:w.pageX,this.clientY=w.clientY!==void 0?w.clientY:w.pageY,this.screenX=w.screenX||0,this.screenY=w.screenY||0):(this.clientX=l.clientX!==void 0?l.clientX:l.pageX,this.clientY=l.clientY!==void 0?l.clientY:l.pageY,this.screenX=l.screenX||0,this.screenY=l.screenY||0),this.button=l.button,this.key=l.key||"",this.ctrlKey=l.ctrlKey,this.altKey=l.altKey,this.shiftKey=l.shiftKey,this.metaKey=l.metaKey,this.pointerId=l.pointerId||0,this.pointerType=typeof l.pointerType=="string"?l.pointerType:Y[l.pointerType]||"",this.state=l.state,this.i=l,l.defaultPrevented&&K.aa.h.call(this)}}C(K,H);var Y={2:"touch",3:"pen",4:"mouse"};K.prototype.h=function(){K.aa.h.call(this);var l=this.i;l.preventDefault?l.preventDefault():l.returnValue=!1};var ne="closure_listenable_"+(1e6*Math.random()|0),pe=0;function Ce(l,h,f,w,B){this.listener=l,this.proxy=null,this.src=h,this.type=f,this.capture=!!w,this.ha=B,this.key=++pe,this.da=this.fa=!1}function ce(l){l.da=!0,l.listener=null,l.proxy=null,l.src=null,l.ha=null}function Ie(l){this.src=l,this.g={},this.h=0}Ie.prototype.add=function(l,h,f,w,B){var G=l.toString();l=this.g[G],l||(l=this.g[G]=[],this.h++);var re=an(l,h,w,B);return-1<re?(h=l[re],f||(h.fa=!1)):(h=new Ce(h,this.src,G,!!w,B),h.fa=f,l.push(h)),h};function kt(l,h){var f=h.type;if(f in l.g){var w=l.g[f],B=Array.prototype.indexOf.call(w,h,void 0),G;(G=0<=B)&&Array.prototype.splice.call(w,B,1),G&&(ce(h),l.g[f].length==0&&(delete l.g[f],l.h--))}}function an(l,h,f,w){for(var B=0;B<l.length;++B){var G=l[B];if(!G.da&&G.listener==h&&G.capture==!!f&&G.ha==w)return B}return-1}var Bt="closure_lm_"+(1e6*Math.random()|0),Pt={};function Mn(l,h,f,w,B){if(Array.isArray(h)){for(var G=0;G<h.length;G++)Mn(l,h[G],f,w,B);return null}return f=Ef(f),l&&l[ne]?l.K(h,f,d(w)?!!w.capture:!1,B):et(l,h,f,!1,w,B)}function et(l,h,f,w,B,G){if(!h)throw Error("Invalid event type");var re=d(B)?!!B.capture:!!B,Se=du(l);if(Se||(l[Bt]=Se=new Ie(l)),f=Se.add(h,f,w,re,G),f.proxy)return f;if(w=xo(),f.proxy=w,w.src=l,w.listener=f,l.addEventListener)R||(B=re),B===void 0&&(B=!1),l.addEventListener(h.toString(),w,B);else if(l.attachEvent)l.attachEvent(Nf(h.toString()),w);else if(l.addListener&&l.removeListener)l.addListener(w);else throw Error("addEventListener and attachEvent are unavailable.");return f}function xo(){function l(f){return h.call(l.src,l.listener,f)}const h=Ow;return l}function vo(l,h,f,w,B){if(Array.isArray(h))for(var G=0;G<h.length;G++)vo(l,h[G],f,w,B);else w=d(w)?!!w.capture:!!w,f=Ef(f),l&&l[ne]?(l=l.i,h=String(h).toString(),h in l.g&&(G=l.g[h],f=an(G,f,w,B),-1<f&&(ce(G[f]),Array.prototype.splice.call(G,f,1),G.length==0&&(delete l.g[h],l.h--)))):l&&(l=du(l))&&(h=l.g[h.toString()],l=-1,h&&(l=an(h,f,w,B)),(f=-1<l?h[l]:null)&&bo(f))}function bo(l){if(typeof l!="number"&&l&&!l.da){var h=l.src;if(h&&h[ne])kt(h.i,l);else{var f=l.type,w=l.proxy;h.removeEventListener?h.removeEventListener(f,w,l.capture):h.detachEvent?h.detachEvent(Nf(f),w):h.addListener&&h.removeListener&&h.removeListener(w),(f=du(h))?(kt(f,l),f.h==0&&(f.src=null,h[Bt]=null)):ce(l)}}}function Nf(l){return l in Pt?Pt[l]:Pt[l]="on"+l}function Ow(l,h){if(l.da)l=!0;else{h=new K(h,this);var f=l.listener,w=l.ha||l.src;l.fa&&bo(l),l=f.call(w,h)}return l}function du(l){return l=l[Bt],l instanceof Ie?l:null}var hu="__closure_events_fn_"+(1e9*Math.random()>>>0);function Ef(l){return typeof l=="function"?l:(l[hu]||(l[hu]=function(h){return l.handleEvent(h)}),l[hu])}function mt(){P.call(this),this.i=new Ie(this),this.M=this,this.F=null}C(mt,P),mt.prototype[ne]=!0,mt.prototype.removeEventListener=function(l,h,f,w){vo(this,l,h,f,w)};function Tt(l,h){var f,w=l.F;if(w)for(f=[];w;w=w.F)f.push(w);if(l=l.M,w=h.type||h,typeof h=="string")h=new H(h,l);else if(h instanceof H)h.target=h.target||l;else{var B=h;h=new H(w,l),p(h,B)}if(B=!0,f)for(var G=f.length-1;0<=G;G--){var re=h.g=f[G];B=wo(re,w,!0,h)&&B}if(re=h.g=l,B=wo(re,w,!0,h)&&B,B=wo(re,w,!1,h)&&B,f)for(G=0;G<f.length;G++)re=h.g=f[G],B=wo(re,w,!1,h)&&B}mt.prototype.N=function(){if(mt.aa.N.call(this),this.i){var l=this.i,h;for(h in l.g){for(var f=l.g[h],w=0;w<f.length;w++)ce(f[w]);delete l.g[h],l.h--}}this.F=null},mt.prototype.K=function(l,h,f,w){return this.i.add(String(l),h,!1,f,w)},mt.prototype.L=function(l,h,f,w){return this.i.add(String(l),h,!0,f,w)};function wo(l,h,f,w){if(h=l.i.g[String(h)],!h)return!0;h=h.concat();for(var B=!0,G=0;G<h.length;++G){var re=h[G];if(re&&!re.da&&re.capture==f){var Se=re.listener,it=re.ha||re.src;re.fa&&kt(l.i,re),B=Se.call(it,w)!==!1&&B}}return B&&!w.defaultPrevented}function Tf(l,h,f){if(typeof l=="function")f&&(l=g(l,f));else if(l&&typeof l.handleEvent=="function")l=g(l.handleEvent,l);else throw Error("Invalid listener argument");return 2147483647<Number(h)?-1:c.setTimeout(l,h||0)}function jf(l){l.g=Tf(()=>{l.g=null,l.i&&(l.i=!1,jf(l))},l.l);const h=l.h;l.h=null,l.m.apply(null,h)}class Lw extends P{constructor(h,f){super(),this.m=h,this.l=f,this.h=null,this.i=!1,this.g=null}j(h){this.h=arguments,this.g?this.i=!0:jf(this)}N(){super.N(),this.g&&(c.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Ai(l){P.call(this),this.h=l,this.g={}}C(Ai,P);var Sf=[];function Cf(l){z(l.g,function(h,f){this.g.hasOwnProperty(f)&&bo(h)},l),l.g={}}Ai.prototype.N=function(){Ai.aa.N.call(this),Cf(this)},Ai.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var mu=c.JSON.stringify,Vw=c.JSON.parse,Fw=class{stringify(l){return c.JSON.stringify(l,void 0)}parse(l){return c.JSON.parse(l,void 0)}};function fu(){}fu.prototype.h=null;function If(l){return l.h||(l.h=l.i())}function Af(){}var ki={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function pu(){H.call(this,"d")}C(pu,H);function gu(){H.call(this,"c")}C(gu,H);var Wr={},kf=null;function _o(){return kf=kf||new mt}Wr.La="serverreachability";function Pf(l){H.call(this,Wr.La,l)}C(Pf,H);function Pi(l){const h=_o();Tt(h,new Pf(h))}Wr.STAT_EVENT="statevent";function Rf(l,h){H.call(this,Wr.STAT_EVENT,l),this.stat=h}C(Rf,H);function jt(l){const h=_o();Tt(h,new Rf(h,l))}Wr.Ma="timingevent";function Df(l,h){H.call(this,Wr.Ma,l),this.size=h}C(Df,H);function Ri(l,h){if(typeof l!="function")throw Error("Fn must not be null and must be a function");return c.setTimeout(function(){l()},h)}function Di(){this.g=!0}Di.prototype.xa=function(){this.g=!1};function Uw(l,h,f,w,B,G){l.info(function(){if(l.g)if(G)for(var re="",Se=G.split("&"),it=0;it<Se.length;it++){var _e=Se[it].split("=");if(1<_e.length){var ft=_e[0];_e=_e[1];var pt=ft.split("_");re=2<=pt.length&&pt[1]=="type"?re+(ft+"="+_e+"&"):re+(ft+"=redacted&")}}else re=null;else re=G;return"XMLHTTP REQ ("+w+") [attempt "+B+"]: "+h+`
`+f+`
`+re})}function Bw(l,h,f,w,B,G,re){l.info(function(){return"XMLHTTP RESP ("+w+") [ attempt "+B+"]: "+h+`
`+f+`
`+G+" "+re})}function js(l,h,f,w){l.info(function(){return"XMLHTTP TEXT ("+h+"): "+zw(l,f)+(w?" "+w:"")})}function $w(l,h){l.info(function(){return"TIMEOUT: "+h})}Di.prototype.info=function(){};function zw(l,h){if(!l.g)return h;if(!h)return null;try{var f=JSON.parse(h);if(f){for(l=0;l<f.length;l++)if(Array.isArray(f[l])){var w=f[l];if(!(2>w.length)){var B=w[1];if(Array.isArray(B)&&!(1>B.length)){var G=B[0];if(G!="noop"&&G!="stop"&&G!="close")for(var re=1;re<B.length;re++)B[re]=""}}}}return mu(f)}catch{return h}}var No={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},Mf={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},yu;function Eo(){}C(Eo,fu),Eo.prototype.g=function(){return new XMLHttpRequest},Eo.prototype.i=function(){return{}},yu=new Eo;function lr(l,h,f,w){this.j=l,this.i=h,this.l=f,this.R=w||1,this.U=new Ai(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Of}function Of(){this.i=null,this.g="",this.h=!1}var Lf={},xu={};function vu(l,h,f){l.L=1,l.v=Co(On(h)),l.m=f,l.P=!0,Vf(l,null)}function Vf(l,h){l.F=Date.now(),To(l),l.A=On(l.v);var f=l.A,w=l.R;Array.isArray(w)||(w=[String(w)]),Jf(f.i,"t",w),l.C=0,f=l.j.J,l.h=new Of,l.g=gp(l.j,f?h:null,!l.m),0<l.O&&(l.M=new Lw(g(l.Y,l,l.g),l.O)),h=l.U,f=l.g,w=l.ca;var B="readystatechange";Array.isArray(B)||(B&&(Sf[0]=B.toString()),B=Sf);for(var G=0;G<B.length;G++){var re=Mn(f,B[G],w||h.handleEvent,!1,h.h||h);if(!re)break;h.g[re.key]=re}h=l.H?v(l.H):{},l.m?(l.u||(l.u="POST"),h["Content-Type"]="application/x-www-form-urlencoded",l.g.ea(l.A,l.u,l.m,h)):(l.u="GET",l.g.ea(l.A,l.u,null,h)),Pi(),Uw(l.i,l.u,l.A,l.l,l.R,l.m)}lr.prototype.ca=function(l){l=l.target;const h=this.M;h&&Ln(l)==3?h.j():this.Y(l)},lr.prototype.Y=function(l){try{if(l==this.g)e:{const pt=Ln(this.g);var h=this.g.Ba();const Is=this.g.Z();if(!(3>pt)&&(pt!=3||this.g&&(this.h.h||this.g.oa()||ip(this.g)))){this.J||pt!=4||h==7||(h==8||0>=Is?Pi(3):Pi(2)),bu(this);var f=this.g.Z();this.X=f;t:if(Ff(this)){var w=ip(this.g);l="";var B=w.length,G=Ln(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){Kr(this),Mi(this);var re="";break t}this.h.i=new c.TextDecoder}for(h=0;h<B;h++)this.h.h=!0,l+=this.h.i.decode(w[h],{stream:!(G&&h==B-1)});w.length=0,this.h.g+=l,this.C=0,re=this.h.g}else re=this.g.oa();if(this.o=f==200,Bw(this.i,this.u,this.A,this.l,this.R,pt,f),this.o){if(this.T&&!this.K){t:{if(this.g){var Se,it=this.g;if((Se=it.g?it.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!T(Se)){var _e=Se;break t}}_e=null}if(f=_e)js(this.i,this.l,f,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,wu(this,f);else{this.o=!1,this.s=3,jt(12),Kr(this),Mi(this);break e}}if(this.P){f=!0;let on;for(;!this.J&&this.C<re.length;)if(on=qw(this,re),on==xu){pt==4&&(this.s=4,jt(14),f=!1),js(this.i,this.l,null,"[Incomplete Response]");break}else if(on==Lf){this.s=4,jt(15),js(this.i,this.l,re,"[Invalid Chunk]"),f=!1;break}else js(this.i,this.l,on,null),wu(this,on);if(Ff(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),pt!=4||re.length!=0||this.h.h||(this.s=1,jt(16),f=!1),this.o=this.o&&f,!f)js(this.i,this.l,re,"[Invalid Chunked Response]"),Kr(this),Mi(this);else if(0<re.length&&!this.W){this.W=!0;var ft=this.j;ft.g==this&&ft.ba&&!ft.M&&(ft.j.info("Great, no buffering proxy detected. Bytes received: "+re.length),Su(ft),ft.M=!0,jt(11))}}else js(this.i,this.l,re,null),wu(this,re);pt==4&&Kr(this),this.o&&!this.J&&(pt==4?hp(this.j,this):(this.o=!1,To(this)))}else o_(this.g),f==400&&0<re.indexOf("Unknown SID")?(this.s=3,jt(12)):(this.s=0,jt(13)),Kr(this),Mi(this)}}}catch{}finally{}};function Ff(l){return l.g?l.u=="GET"&&l.L!=2&&l.j.Ca:!1}function qw(l,h){var f=l.C,w=h.indexOf(`
`,f);return w==-1?xu:(f=Number(h.substring(f,w)),isNaN(f)?Lf:(w+=1,w+f>h.length?xu:(h=h.slice(w,w+f),l.C=w+f,h)))}lr.prototype.cancel=function(){this.J=!0,Kr(this)};function To(l){l.S=Date.now()+l.I,Uf(l,l.I)}function Uf(l,h){if(l.B!=null)throw Error("WatchDog timer not null");l.B=Ri(g(l.ba,l),h)}function bu(l){l.B&&(c.clearTimeout(l.B),l.B=null)}lr.prototype.ba=function(){this.B=null;const l=Date.now();0<=l-this.S?($w(this.i,this.A),this.L!=2&&(Pi(),jt(17)),Kr(this),this.s=2,Mi(this)):Uf(this,this.S-l)};function Mi(l){l.j.G==0||l.J||hp(l.j,l)}function Kr(l){bu(l);var h=l.M;h&&typeof h.ma=="function"&&h.ma(),l.M=null,Cf(l.U),l.g&&(h=l.g,l.g=null,h.abort(),h.ma())}function wu(l,h){try{var f=l.j;if(f.G!=0&&(f.g==l||_u(f.h,l))){if(!l.K&&_u(f.h,l)&&f.G==3){try{var w=f.Da.g.parse(h)}catch{w=null}if(Array.isArray(w)&&w.length==3){var B=w;if(B[0]==0){e:if(!f.u){if(f.g)if(f.g.F+3e3<l.F)Do(f),Po(f);else break e;ju(f),jt(18)}}else f.za=B[1],0<f.za-f.T&&37500>B[2]&&f.F&&f.v==0&&!f.C&&(f.C=Ri(g(f.Za,f),6e3));if(1>=zf(f.h)&&f.ca){try{f.ca()}catch{}f.ca=void 0}}else Yr(f,11)}else if((l.K||f.g==l)&&Do(f),!T(h))for(B=f.Da.g.parse(h),h=0;h<B.length;h++){let _e=B[h];if(f.T=_e[0],_e=_e[1],f.G==2)if(_e[0]=="c"){f.K=_e[1],f.ia=_e[2];const ft=_e[3];ft!=null&&(f.la=ft,f.j.info("VER="+f.la));const pt=_e[4];pt!=null&&(f.Aa=pt,f.j.info("SVER="+f.Aa));const Is=_e[5];Is!=null&&typeof Is=="number"&&0<Is&&(w=1.5*Is,f.L=w,f.j.info("backChannelRequestTimeoutMs_="+w)),w=f;const on=l.g;if(on){const Oo=on.g?on.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Oo){var G=w.h;G.g||Oo.indexOf("spdy")==-1&&Oo.indexOf("quic")==-1&&Oo.indexOf("h2")==-1||(G.j=G.l,G.g=new Set,G.h&&(Nu(G,G.h),G.h=null))}if(w.D){const Cu=on.g?on.g.getResponseHeader("X-HTTP-Session-Id"):null;Cu&&(w.ya=Cu,Pe(w.I,w.D,Cu))}}f.G=3,f.l&&f.l.ua(),f.ba&&(f.R=Date.now()-l.F,f.j.info("Handshake RTT: "+f.R+"ms")),w=f;var re=l;if(w.qa=pp(w,w.J?w.ia:null,w.W),re.K){qf(w.h,re);var Se=re,it=w.L;it&&(Se.I=it),Se.B&&(bu(Se),To(Se)),w.g=re}else up(w);0<f.i.length&&Ro(f)}else _e[0]!="stop"&&_e[0]!="close"||Yr(f,7);else f.G==3&&(_e[0]=="stop"||_e[0]=="close"?_e[0]=="stop"?Yr(f,7):Tu(f):_e[0]!="noop"&&f.l&&f.l.ta(_e),f.v=0)}}Pi(4)}catch{}}var Hw=class{constructor(l,h){this.g=l,this.map=h}};function Bf(l){this.l=l||10,c.PerformanceNavigationTiming?(l=c.performance.getEntriesByType("navigation"),l=0<l.length&&(l[0].nextHopProtocol=="hq"||l[0].nextHopProtocol=="h2")):l=!!(c.chrome&&c.chrome.loadTimes&&c.chrome.loadTimes()&&c.chrome.loadTimes().wasFetchedViaSpdy),this.j=l?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function $f(l){return l.h?!0:l.g?l.g.size>=l.j:!1}function zf(l){return l.h?1:l.g?l.g.size:0}function _u(l,h){return l.h?l.h==h:l.g?l.g.has(h):!1}function Nu(l,h){l.g?l.g.add(h):l.h=h}function qf(l,h){l.h&&l.h==h?l.h=null:l.g&&l.g.has(h)&&l.g.delete(h)}Bf.prototype.cancel=function(){if(this.i=Hf(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const l of this.g.values())l.cancel();this.g.clear()}};function Hf(l){if(l.h!=null)return l.i.concat(l.h.D);if(l.g!=null&&l.g.size!==0){let h=l.i;for(const f of l.g.values())h=h.concat(f.D);return h}return E(l.i)}function Gw(l){if(l.V&&typeof l.V=="function")return l.V();if(typeof Map<"u"&&l instanceof Map||typeof Set<"u"&&l instanceof Set)return Array.from(l.values());if(typeof l=="string")return l.split("");if(u(l)){for(var h=[],f=l.length,w=0;w<f;w++)h.push(l[w]);return h}h=[],f=0;for(w in l)h[f++]=l[w];return h}function Ww(l){if(l.na&&typeof l.na=="function")return l.na();if(!l.V||typeof l.V!="function"){if(typeof Map<"u"&&l instanceof Map)return Array.from(l.keys());if(!(typeof Set<"u"&&l instanceof Set)){if(u(l)||typeof l=="string"){var h=[];l=l.length;for(var f=0;f<l;f++)h.push(f);return h}h=[],f=0;for(const w in l)h[f++]=w;return h}}}function Gf(l,h){if(l.forEach&&typeof l.forEach=="function")l.forEach(h,void 0);else if(u(l)||typeof l=="string")Array.prototype.forEach.call(l,h,void 0);else for(var f=Ww(l),w=Gw(l),B=w.length,G=0;G<B;G++)h.call(void 0,w[G],f&&f[G],l)}var Wf=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Kw(l,h){if(l){l=l.split("&");for(var f=0;f<l.length;f++){var w=l[f].indexOf("="),B=null;if(0<=w){var G=l[f].substring(0,w);B=l[f].substring(w+1)}else G=l[f];h(G,B?decodeURIComponent(B.replace(/\+/g," ")):"")}}}function Qr(l){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,l instanceof Qr){this.h=l.h,jo(this,l.j),this.o=l.o,this.g=l.g,So(this,l.s),this.l=l.l;var h=l.i,f=new Vi;f.i=h.i,h.g&&(f.g=new Map(h.g),f.h=h.h),Kf(this,f),this.m=l.m}else l&&(h=String(l).match(Wf))?(this.h=!1,jo(this,h[1]||"",!0),this.o=Oi(h[2]||""),this.g=Oi(h[3]||"",!0),So(this,h[4]),this.l=Oi(h[5]||"",!0),Kf(this,h[6]||"",!0),this.m=Oi(h[7]||"")):(this.h=!1,this.i=new Vi(null,this.h))}Qr.prototype.toString=function(){var l=[],h=this.j;h&&l.push(Li(h,Qf,!0),":");var f=this.g;return(f||h=="file")&&(l.push("//"),(h=this.o)&&l.push(Li(h,Qf,!0),"@"),l.push(encodeURIComponent(String(f)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),f=this.s,f!=null&&l.push(":",String(f))),(f=this.l)&&(this.g&&f.charAt(0)!="/"&&l.push("/"),l.push(Li(f,f.charAt(0)=="/"?Xw:Yw,!0))),(f=this.i.toString())&&l.push("?",f),(f=this.m)&&l.push("#",Li(f,Zw)),l.join("")};function On(l){return new Qr(l)}function jo(l,h,f){l.j=f?Oi(h,!0):h,l.j&&(l.j=l.j.replace(/:$/,""))}function So(l,h){if(h){if(h=Number(h),isNaN(h)||0>h)throw Error("Bad port number "+h);l.s=h}else l.s=null}function Kf(l,h,f){h instanceof Vi?(l.i=h,e_(l.i,l.h)):(f||(h=Li(h,Jw)),l.i=new Vi(h,l.h))}function Pe(l,h,f){l.i.set(h,f)}function Co(l){return Pe(l,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),l}function Oi(l,h){return l?h?decodeURI(l.replace(/%25/g,"%2525")):decodeURIComponent(l):""}function Li(l,h,f){return typeof l=="string"?(l=encodeURI(l).replace(h,Qw),f&&(l=l.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),l):null}function Qw(l){return l=l.charCodeAt(0),"%"+(l>>4&15).toString(16)+(l&15).toString(16)}var Qf=/[#\/\?@]/g,Yw=/[#\?:]/g,Xw=/[#\?]/g,Jw=/[#\?@]/g,Zw=/#/g;function Vi(l,h){this.h=this.g=null,this.i=l||null,this.j=!!h}function cr(l){l.g||(l.g=new Map,l.h=0,l.i&&Kw(l.i,function(h,f){l.add(decodeURIComponent(h.replace(/\+/g," ")),f)}))}t=Vi.prototype,t.add=function(l,h){cr(this),this.i=null,l=Ss(this,l);var f=this.g.get(l);return f||this.g.set(l,f=[]),f.push(h),this.h+=1,this};function Yf(l,h){cr(l),h=Ss(l,h),l.g.has(h)&&(l.i=null,l.h-=l.g.get(h).length,l.g.delete(h))}function Xf(l,h){return cr(l),h=Ss(l,h),l.g.has(h)}t.forEach=function(l,h){cr(this),this.g.forEach(function(f,w){f.forEach(function(B){l.call(h,B,w,this)},this)},this)},t.na=function(){cr(this);const l=Array.from(this.g.values()),h=Array.from(this.g.keys()),f=[];for(let w=0;w<h.length;w++){const B=l[w];for(let G=0;G<B.length;G++)f.push(h[w])}return f},t.V=function(l){cr(this);let h=[];if(typeof l=="string")Xf(this,l)&&(h=h.concat(this.g.get(Ss(this,l))));else{l=Array.from(this.g.values());for(let f=0;f<l.length;f++)h=h.concat(l[f])}return h},t.set=function(l,h){return cr(this),this.i=null,l=Ss(this,l),Xf(this,l)&&(this.h-=this.g.get(l).length),this.g.set(l,[h]),this.h+=1,this},t.get=function(l,h){return l?(l=this.V(l),0<l.length?String(l[0]):h):h};function Jf(l,h,f){Yf(l,h),0<f.length&&(l.i=null,l.g.set(Ss(l,h),E(f)),l.h+=f.length)}t.toString=function(){if(this.i)return this.i;if(!this.g)return"";const l=[],h=Array.from(this.g.keys());for(var f=0;f<h.length;f++){var w=h[f];const G=encodeURIComponent(String(w)),re=this.V(w);for(w=0;w<re.length;w++){var B=G;re[w]!==""&&(B+="="+encodeURIComponent(String(re[w]))),l.push(B)}}return this.i=l.join("&")};function Ss(l,h){return h=String(h),l.j&&(h=h.toLowerCase()),h}function e_(l,h){h&&!l.j&&(cr(l),l.i=null,l.g.forEach(function(f,w){var B=w.toLowerCase();w!=B&&(Yf(this,w),Jf(this,B,f))},l)),l.j=h}function t_(l,h){const f=new Di;if(c.Image){const w=new Image;w.onload=x(ur,f,"TestLoadImage: loaded",!0,h,w),w.onerror=x(ur,f,"TestLoadImage: error",!1,h,w),w.onabort=x(ur,f,"TestLoadImage: abort",!1,h,w),w.ontimeout=x(ur,f,"TestLoadImage: timeout",!1,h,w),c.setTimeout(function(){w.ontimeout&&w.ontimeout()},1e4),w.src=l}else h(!1)}function n_(l,h){const f=new Di,w=new AbortController,B=setTimeout(()=>{w.abort(),ur(f,"TestPingServer: timeout",!1,h)},1e4);fetch(l,{signal:w.signal}).then(G=>{clearTimeout(B),G.ok?ur(f,"TestPingServer: ok",!0,h):ur(f,"TestPingServer: server error",!1,h)}).catch(()=>{clearTimeout(B),ur(f,"TestPingServer: error",!1,h)})}function ur(l,h,f,w,B){try{B&&(B.onload=null,B.onerror=null,B.onabort=null,B.ontimeout=null),w(f)}catch{}}function r_(){this.g=new Fw}function s_(l,h,f){const w=f||"";try{Gf(l,function(B,G){let re=B;d(B)&&(re=mu(B)),h.push(w+G+"="+encodeURIComponent(re))})}catch(B){throw h.push(w+"type="+encodeURIComponent("_badmap")),B}}function Io(l){this.l=l.Ub||null,this.j=l.eb||!1}C(Io,fu),Io.prototype.g=function(){return new Ao(this.l,this.j)},Io.prototype.i=function(l){return function(){return l}}({});function Ao(l,h){mt.call(this),this.D=l,this.o=h,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}C(Ao,mt),t=Ao.prototype,t.open=function(l,h){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=l,this.A=h,this.readyState=1,Ui(this)},t.send=function(l){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const h={headers:this.u,method:this.B,credentials:this.m,cache:void 0};l&&(h.body=l),(this.D||c).fetch(new Request(this.A,h)).then(this.Sa.bind(this),this.ga.bind(this))},t.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,Fi(this)),this.readyState=0},t.Sa=function(l){if(this.g&&(this.l=l,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=l.headers,this.readyState=2,Ui(this)),this.g&&(this.readyState=3,Ui(this),this.g)))if(this.responseType==="arraybuffer")l.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof c.ReadableStream<"u"&&"body"in l){if(this.j=l.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;Zf(this)}else l.text().then(this.Ra.bind(this),this.ga.bind(this))};function Zf(l){l.j.read().then(l.Pa.bind(l)).catch(l.ga.bind(l))}t.Pa=function(l){if(this.g){if(this.o&&l.value)this.response.push(l.value);else if(!this.o){var h=l.value?l.value:new Uint8Array(0);(h=this.v.decode(h,{stream:!l.done}))&&(this.response=this.responseText+=h)}l.done?Fi(this):Ui(this),this.readyState==3&&Zf(this)}},t.Ra=function(l){this.g&&(this.response=this.responseText=l,Fi(this))},t.Qa=function(l){this.g&&(this.response=l,Fi(this))},t.ga=function(){this.g&&Fi(this)};function Fi(l){l.readyState=4,l.l=null,l.j=null,l.v=null,Ui(l)}t.setRequestHeader=function(l,h){this.u.append(l,h)},t.getResponseHeader=function(l){return this.h&&this.h.get(l.toLowerCase())||""},t.getAllResponseHeaders=function(){if(!this.h)return"";const l=[],h=this.h.entries();for(var f=h.next();!f.done;)f=f.value,l.push(f[0]+": "+f[1]),f=h.next();return l.join(`\r
`)};function Ui(l){l.onreadystatechange&&l.onreadystatechange.call(l)}Object.defineProperty(Ao.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(l){this.m=l?"include":"same-origin"}});function ep(l){let h="";return z(l,function(f,w){h+=w,h+=":",h+=f,h+=`\r
`}),h}function Eu(l,h,f){e:{for(w in f){var w=!1;break e}w=!0}w||(f=ep(f),typeof l=="string"?f!=null&&encodeURIComponent(String(f)):Pe(l,h,f))}function $e(l){mt.call(this),this.headers=new Map,this.o=l||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}C($e,mt);var i_=/^https?$/i,a_=["POST","PUT"];t=$e.prototype,t.Ha=function(l){this.J=l},t.ea=function(l,h,f,w){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+l);h=h?h.toUpperCase():"GET",this.D=l,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():yu.g(),this.v=this.o?If(this.o):If(yu),this.g.onreadystatechange=g(this.Ea,this);try{this.B=!0,this.g.open(h,String(l),!0),this.B=!1}catch(G){tp(this,G);return}if(l=f||"",f=new Map(this.headers),w)if(Object.getPrototypeOf(w)===Object.prototype)for(var B in w)f.set(B,w[B]);else if(typeof w.keys=="function"&&typeof w.get=="function")for(const G of w.keys())f.set(G,w.get(G));else throw Error("Unknown input type for opt_headers: "+String(w));w=Array.from(f.keys()).find(G=>G.toLowerCase()=="content-type"),B=c.FormData&&l instanceof c.FormData,!(0<=Array.prototype.indexOf.call(a_,h,void 0))||w||B||f.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[G,re]of f)this.g.setRequestHeader(G,re);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{sp(this),this.u=!0,this.g.send(l),this.u=!1}catch(G){tp(this,G)}};function tp(l,h){l.h=!1,l.g&&(l.j=!0,l.g.abort(),l.j=!1),l.l=h,l.m=5,np(l),ko(l)}function np(l){l.A||(l.A=!0,Tt(l,"complete"),Tt(l,"error"))}t.abort=function(l){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=l||7,Tt(this,"complete"),Tt(this,"abort"),ko(this))},t.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),ko(this,!0)),$e.aa.N.call(this)},t.Ea=function(){this.s||(this.B||this.u||this.j?rp(this):this.bb())},t.bb=function(){rp(this)};function rp(l){if(l.h&&typeof o<"u"&&(!l.v[1]||Ln(l)!=4||l.Z()!=2)){if(l.u&&Ln(l)==4)Tf(l.Ea,0,l);else if(Tt(l,"readystatechange"),Ln(l)==4){l.h=!1;try{const re=l.Z();e:switch(re){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var h=!0;break e;default:h=!1}var f;if(!(f=h)){var w;if(w=re===0){var B=String(l.D).match(Wf)[1]||null;!B&&c.self&&c.self.location&&(B=c.self.location.protocol.slice(0,-1)),w=!i_.test(B?B.toLowerCase():"")}f=w}if(f)Tt(l,"complete"),Tt(l,"success");else{l.m=6;try{var G=2<Ln(l)?l.g.statusText:""}catch{G=""}l.l=G+" ["+l.Z()+"]",np(l)}}finally{ko(l)}}}}function ko(l,h){if(l.g){sp(l);const f=l.g,w=l.v[0]?()=>{}:null;l.g=null,l.v=null,h||Tt(l,"ready");try{f.onreadystatechange=w}catch{}}}function sp(l){l.I&&(c.clearTimeout(l.I),l.I=null)}t.isActive=function(){return!!this.g};function Ln(l){return l.g?l.g.readyState:0}t.Z=function(){try{return 2<Ln(this)?this.g.status:-1}catch{return-1}},t.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},t.Oa=function(l){if(this.g){var h=this.g.responseText;return l&&h.indexOf(l)==0&&(h=h.substring(l.length)),Vw(h)}};function ip(l){try{if(!l.g)return null;if("response"in l.g)return l.g.response;switch(l.H){case"":case"text":return l.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in l.g)return l.g.mozResponseArrayBuffer}return null}catch{return null}}function o_(l){const h={};l=(l.g&&2<=Ln(l)&&l.g.getAllResponseHeaders()||"").split(`\r
`);for(let w=0;w<l.length;w++){if(T(l[w]))continue;var f=I(l[w]);const B=f[0];if(f=f[1],typeof f!="string")continue;f=f.trim();const G=h[B]||[];h[B]=G,G.push(f)}j(h,function(w){return w.join(", ")})}t.Ba=function(){return this.m},t.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function Bi(l,h,f){return f&&f.internalChannelParams&&f.internalChannelParams[l]||h}function ap(l){this.Aa=0,this.i=[],this.j=new Di,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=Bi("failFast",!1,l),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=Bi("baseRetryDelayMs",5e3,l),this.cb=Bi("retryDelaySeedMs",1e4,l),this.Wa=Bi("forwardChannelMaxRetries",2,l),this.wa=Bi("forwardChannelRequestTimeoutMs",2e4,l),this.pa=l&&l.xmlHttpFactory||void 0,this.Xa=l&&l.Tb||void 0,this.Ca=l&&l.useFetchStreams||!1,this.L=void 0,this.J=l&&l.supportsCrossDomainXhr||!1,this.K="",this.h=new Bf(l&&l.concurrentRequestLimit),this.Da=new r_,this.P=l&&l.fastHandshake||!1,this.O=l&&l.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=l&&l.Rb||!1,l&&l.xa&&this.j.xa(),l&&l.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&l&&l.detectBufferingProxy||!1,this.ja=void 0,l&&l.longPollingTimeout&&0<l.longPollingTimeout&&(this.ja=l.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}t=ap.prototype,t.la=8,t.G=1,t.connect=function(l,h,f,w){jt(0),this.W=l,this.H=h||{},f&&w!==void 0&&(this.H.OSID=f,this.H.OAID=w),this.F=this.X,this.I=pp(this,null,this.W),Ro(this)};function Tu(l){if(op(l),l.G==3){var h=l.U++,f=On(l.I);if(Pe(f,"SID",l.K),Pe(f,"RID",h),Pe(f,"TYPE","terminate"),$i(l,f),h=new lr(l,l.j,h),h.L=2,h.v=Co(On(f)),f=!1,c.navigator&&c.navigator.sendBeacon)try{f=c.navigator.sendBeacon(h.v.toString(),"")}catch{}!f&&c.Image&&(new Image().src=h.v,f=!0),f||(h.g=gp(h.j,null),h.g.ea(h.v)),h.F=Date.now(),To(h)}fp(l)}function Po(l){l.g&&(Su(l),l.g.cancel(),l.g=null)}function op(l){Po(l),l.u&&(c.clearTimeout(l.u),l.u=null),Do(l),l.h.cancel(),l.s&&(typeof l.s=="number"&&c.clearTimeout(l.s),l.s=null)}function Ro(l){if(!$f(l.h)&&!l.s){l.s=!0;var h=l.Ga;O||U(),M||(O(),M=!0),W.add(h,l),l.B=0}}function l_(l,h){return zf(l.h)>=l.h.j-(l.s?1:0)?!1:l.s?(l.i=h.D.concat(l.i),!0):l.G==1||l.G==2||l.B>=(l.Va?0:l.Wa)?!1:(l.s=Ri(g(l.Ga,l,h),mp(l,l.B)),l.B++,!0)}t.Ga=function(l){if(this.s)if(this.s=null,this.G==1){if(!l){this.U=Math.floor(1e5*Math.random()),l=this.U++;const B=new lr(this,this.j,l);let G=this.o;if(this.S&&(G?(G=v(G),p(G,this.S)):G=this.S),this.m!==null||this.O||(B.H=G,G=null),this.P)e:{for(var h=0,f=0;f<this.i.length;f++){t:{var w=this.i[f];if("__data__"in w.map&&(w=w.map.__data__,typeof w=="string")){w=w.length;break t}w=void 0}if(w===void 0)break;if(h+=w,4096<h){h=f;break e}if(h===4096||f===this.i.length-1){h=f+1;break e}}h=1e3}else h=1e3;h=cp(this,B,h),f=On(this.I),Pe(f,"RID",l),Pe(f,"CVER",22),this.D&&Pe(f,"X-HTTP-Session-Id",this.D),$i(this,f),G&&(this.O?h="headers="+encodeURIComponent(String(ep(G)))+"&"+h:this.m&&Eu(f,this.m,G)),Nu(this.h,B),this.Ua&&Pe(f,"TYPE","init"),this.P?(Pe(f,"$req",h),Pe(f,"SID","null"),B.T=!0,vu(B,f,null)):vu(B,f,h),this.G=2}}else this.G==3&&(l?lp(this,l):this.i.length==0||$f(this.h)||lp(this))};function lp(l,h){var f;h?f=h.l:f=l.U++;const w=On(l.I);Pe(w,"SID",l.K),Pe(w,"RID",f),Pe(w,"AID",l.T),$i(l,w),l.m&&l.o&&Eu(w,l.m,l.o),f=new lr(l,l.j,f,l.B+1),l.m===null&&(f.H=l.o),h&&(l.i=h.D.concat(l.i)),h=cp(l,f,1e3),f.I=Math.round(.5*l.wa)+Math.round(.5*l.wa*Math.random()),Nu(l.h,f),vu(f,w,h)}function $i(l,h){l.H&&z(l.H,function(f,w){Pe(h,w,f)}),l.l&&Gf({},function(f,w){Pe(h,w,f)})}function cp(l,h,f){f=Math.min(l.i.length,f);var w=l.l?g(l.l.Na,l.l,l):null;e:{var B=l.i;let G=-1;for(;;){const re=["count="+f];G==-1?0<f?(G=B[0].g,re.push("ofs="+G)):G=0:re.push("ofs="+G);let Se=!0;for(let it=0;it<f;it++){let _e=B[it].g;const ft=B[it].map;if(_e-=G,0>_e)G=Math.max(0,B[it].g-100),Se=!1;else try{s_(ft,re,"req"+_e+"_")}catch{w&&w(ft)}}if(Se){w=re.join("&");break e}}}return l=l.i.splice(0,f),h.D=l,w}function up(l){if(!l.g&&!l.u){l.Y=1;var h=l.Fa;O||U(),M||(O(),M=!0),W.add(h,l),l.v=0}}function ju(l){return l.g||l.u||3<=l.v?!1:(l.Y++,l.u=Ri(g(l.Fa,l),mp(l,l.v)),l.v++,!0)}t.Fa=function(){if(this.u=null,dp(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var l=2*this.R;this.j.info("BP detection timer enabled: "+l),this.A=Ri(g(this.ab,this),l)}},t.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,jt(10),Po(this),dp(this))};function Su(l){l.A!=null&&(c.clearTimeout(l.A),l.A=null)}function dp(l){l.g=new lr(l,l.j,"rpc",l.Y),l.m===null&&(l.g.H=l.o),l.g.O=0;var h=On(l.qa);Pe(h,"RID","rpc"),Pe(h,"SID",l.K),Pe(h,"AID",l.T),Pe(h,"CI",l.F?"0":"1"),!l.F&&l.ja&&Pe(h,"TO",l.ja),Pe(h,"TYPE","xmlhttp"),$i(l,h),l.m&&l.o&&Eu(h,l.m,l.o),l.L&&(l.g.I=l.L);var f=l.g;l=l.ia,f.L=1,f.v=Co(On(h)),f.m=null,f.P=!0,Vf(f,l)}t.Za=function(){this.C!=null&&(this.C=null,Po(this),ju(this),jt(19))};function Do(l){l.C!=null&&(c.clearTimeout(l.C),l.C=null)}function hp(l,h){var f=null;if(l.g==h){Do(l),Su(l),l.g=null;var w=2}else if(_u(l.h,h))f=h.D,qf(l.h,h),w=1;else return;if(l.G!=0){if(h.o)if(w==1){f=h.m?h.m.length:0,h=Date.now()-h.F;var B=l.B;w=_o(),Tt(w,new Df(w,f)),Ro(l)}else up(l);else if(B=h.s,B==3||B==0&&0<h.X||!(w==1&&l_(l,h)||w==2&&ju(l)))switch(f&&0<f.length&&(h=l.h,h.i=h.i.concat(f)),B){case 1:Yr(l,5);break;case 4:Yr(l,10);break;case 3:Yr(l,6);break;default:Yr(l,2)}}}function mp(l,h){let f=l.Ta+Math.floor(Math.random()*l.cb);return l.isActive()||(f*=2),f*h}function Yr(l,h){if(l.j.info("Error code "+h),h==2){var f=g(l.fb,l),w=l.Xa;const B=!w;w=new Qr(w||"//www.google.com/images/cleardot.gif"),c.location&&c.location.protocol=="http"||jo(w,"https"),Co(w),B?t_(w.toString(),f):n_(w.toString(),f)}else jt(2);l.G=0,l.l&&l.l.sa(h),fp(l),op(l)}t.fb=function(l){l?(this.j.info("Successfully pinged google.com"),jt(2)):(this.j.info("Failed to ping google.com"),jt(1))};function fp(l){if(l.G=0,l.ka=[],l.l){const h=Hf(l.h);(h.length!=0||l.i.length!=0)&&(A(l.ka,h),A(l.ka,l.i),l.h.i.length=0,E(l.i),l.i.length=0),l.l.ra()}}function pp(l,h,f){var w=f instanceof Qr?On(f):new Qr(f);if(w.g!="")h&&(w.g=h+"."+w.g),So(w,w.s);else{var B=c.location;w=B.protocol,h=h?h+"."+B.hostname:B.hostname,B=+B.port;var G=new Qr(null);w&&jo(G,w),h&&(G.g=h),B&&So(G,B),f&&(G.l=f),w=G}return f=l.D,h=l.ya,f&&h&&Pe(w,f,h),Pe(w,"VER",l.la),$i(l,w),w}function gp(l,h,f){if(h&&!l.J)throw Error("Can't create secondary domain capable XhrIo object.");return h=l.Ca&&!l.pa?new $e(new Io({eb:f})):new $e(l.pa),h.Ha(l.J),h}t.isActive=function(){return!!this.l&&this.l.isActive(this)};function yp(){}t=yp.prototype,t.ua=function(){},t.ta=function(){},t.sa=function(){},t.ra=function(){},t.isActive=function(){return!0},t.Na=function(){};function Mo(){}Mo.prototype.g=function(l,h){return new $t(l,h)};function $t(l,h){mt.call(this),this.g=new ap(h),this.l=l,this.h=h&&h.messageUrlParams||null,l=h&&h.messageHeaders||null,h&&h.clientProtocolHeaderRequired&&(l?l["X-Client-Protocol"]="webchannel":l={"X-Client-Protocol":"webchannel"}),this.g.o=l,l=h&&h.initMessageHeaders||null,h&&h.messageContentType&&(l?l["X-WebChannel-Content-Type"]=h.messageContentType:l={"X-WebChannel-Content-Type":h.messageContentType}),h&&h.va&&(l?l["X-WebChannel-Client-Profile"]=h.va:l={"X-WebChannel-Client-Profile":h.va}),this.g.S=l,(l=h&&h.Sb)&&!T(l)&&(this.g.m=l),this.v=h&&h.supportsCrossDomainXhr||!1,this.u=h&&h.sendRawJson||!1,(h=h&&h.httpSessionIdParam)&&!T(h)&&(this.g.D=h,l=this.h,l!==null&&h in l&&(l=this.h,h in l&&delete l[h])),this.j=new Cs(this)}C($t,mt),$t.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},$t.prototype.close=function(){Tu(this.g)},$t.prototype.o=function(l){var h=this.g;if(typeof l=="string"){var f={};f.__data__=l,l=f}else this.u&&(f={},f.__data__=mu(l),l=f);h.i.push(new Hw(h.Ya++,l)),h.G==3&&Ro(h)},$t.prototype.N=function(){this.g.l=null,delete this.j,Tu(this.g),delete this.g,$t.aa.N.call(this)};function xp(l){pu.call(this),l.__headers__&&(this.headers=l.__headers__,this.statusCode=l.__status__,delete l.__headers__,delete l.__status__);var h=l.__sm__;if(h){e:{for(const f in h){l=f;break e}l=void 0}(this.i=l)&&(l=this.i,h=h!==null&&l in h?h[l]:void 0),this.data=h}else this.data=l}C(xp,pu);function vp(){gu.call(this),this.status=1}C(vp,gu);function Cs(l){this.g=l}C(Cs,yp),Cs.prototype.ua=function(){Tt(this.g,"a")},Cs.prototype.ta=function(l){Tt(this.g,new xp(l))},Cs.prototype.sa=function(l){Tt(this.g,new vp)},Cs.prototype.ra=function(){Tt(this.g,"b")},Mo.prototype.createWebChannel=Mo.prototype.g,$t.prototype.send=$t.prototype.o,$t.prototype.open=$t.prototype.m,$t.prototype.close=$t.prototype.close,lb=function(){return new Mo},ob=function(){return _o()},ab=Wr,ph={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},No.NO_ERROR=0,No.TIMEOUT=8,No.HTTP_ERROR=6,_l=No,Mf.COMPLETE="complete",ib=Mf,Af.EventType=ki,ki.OPEN="a",ki.CLOSE="b",ki.ERROR="c",ki.MESSAGE="d",mt.prototype.listen=mt.prototype.K,sa=Af,$e.prototype.listenOnce=$e.prototype.L,$e.prototype.getLastError=$e.prototype.Ka,$e.prototype.getLastErrorCode=$e.prototype.Ba,$e.prototype.getStatus=$e.prototype.Z,$e.prototype.getResponseJson=$e.prototype.Oa,$e.prototype.getResponseText=$e.prototype.oa,$e.prototype.send=$e.prototype.ea,$e.prototype.setWithCredentials=$e.prototype.Ha,sb=$e}).apply(typeof tl<"u"?tl:typeof self<"u"?self:typeof window<"u"?window:{});const iy="@firebase/firestore";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vt{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}vt.UNAUTHENTICATED=new vt(null),vt.GOOGLE_CREDENTIALS=new vt("google-credentials-uid"),vt.FIRST_PARTY=new vt("first-party-uid"),vt.MOCK_USER=new vt("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Ti="10.14.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ys=new jm("@firebase/firestore");function Xi(){return ys.logLevel}function ae(t,...e){if(ys.logLevel<=ve.DEBUG){const n=e.map(Lm);ys.debug(`Firestore (${Ti}): ${t}`,...n)}}function tr(t,...e){if(ys.logLevel<=ve.ERROR){const n=e.map(Lm);ys.error(`Firestore (${Ti}): ${t}`,...n)}}function hi(t,...e){if(ys.logLevel<=ve.WARN){const n=e.map(Lm);ys.warn(`Firestore (${Ti}): ${t}`,...n)}}function Lm(t){if(typeof t=="string")return t;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(n){return JSON.stringify(n)}(t)}catch{return t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function he(t="Unexpected state"){const e=`FIRESTORE (${Ti}) INTERNAL ASSERTION FAILED: `+t;throw tr(e),new Error(e)}function je(t,e){t||he()}function fe(t,e){return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const X={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class se extends Pn{constructor(e,n){super(e,n),this.code=e,this.message=n,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wn{constructor(){this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cb{constructor(e,n){this.user=n,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class I1{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,n){e.enqueueRetryable(()=>n(vt.UNAUTHENTICATED))}shutdown(){}}class A1{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,n){this.changeListener=n,e.enqueueRetryable(()=>n(this.token.user))}shutdown(){this.changeListener=null}}class k1{constructor(e){this.t=e,this.currentUser=vt.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,n){je(this.o===void 0);let r=this.i;const s=u=>this.i!==r?(r=this.i,n(u)):Promise.resolve();let a=new Wn;this.o=()=>{this.i++,this.currentUser=this.u(),a.resolve(),a=new Wn,e.enqueueRetryable(()=>s(this.currentUser))};const o=()=>{const u=a;e.enqueueRetryable(async()=>{await u.promise,await s(this.currentUser)})},c=u=>{ae("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=u,this.o&&(this.auth.addAuthTokenListener(this.o),o())};this.t.onInit(u=>c(u)),setTimeout(()=>{if(!this.auth){const u=this.t.getImmediate({optional:!0});u?c(u):(ae("FirebaseAuthCredentialsProvider","Auth not yet detected"),a.resolve(),a=new Wn)}},0),o()}getToken(){const e=this.i,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then(r=>this.i!==e?(ae("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(je(typeof r.accessToken=="string"),new cb(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return je(e===null||typeof e=="string"),new vt(e)}}class P1{constructor(e,n,r){this.l=e,this.h=n,this.P=r,this.type="FirstParty",this.user=vt.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class R1{constructor(e,n,r){this.l=e,this.h=n,this.P=r}getToken(){return Promise.resolve(new P1(this.l,this.h,this.P))}start(e,n){e.enqueueRetryable(()=>n(vt.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class D1{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class M1{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,n){je(this.o===void 0);const r=a=>{a.error!=null&&ae("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${a.error.message}`);const o=a.token!==this.R;return this.R=a.token,ae("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?n(a.token):Promise.resolve()};this.o=a=>{e.enqueueRetryable(()=>r(a))};const s=a=>{ae("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=a,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(a=>s(a)),setTimeout(()=>{if(!this.appCheck){const a=this.A.getImmediate({optional:!0});a?s(a):ae("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(n=>n?(je(typeof n.token=="string"),this.R=n.token,new D1(n.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function O1(t){const e=typeof self<"u"&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(n);else for(let r=0;r<t;r++)n[r]=Math.floor(256*Math.random());return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ub{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=Math.floor(256/e.length)*e.length;let r="";for(;r.length<20;){const s=O1(40);for(let a=0;a<s.length;++a)r.length<20&&s[a]<n&&(r+=e.charAt(s[a]%e.length))}return r}}function Ne(t,e){return t<e?-1:t>e?1:0}function mi(t,e,n){return t.length===e.length&&t.every((r,s)=>n(r,e[s]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oe{constructor(e,n){if(this.seconds=e,this.nanoseconds=n,n<0)throw new se(X.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(n>=1e9)throw new se(X.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(e<-62135596800)throw new se(X.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new se(X.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return oe.fromMillis(Date.now())}static fromDate(e){return oe.fromMillis(e.getTime())}static fromMillis(e){const n=Math.floor(e/1e3),r=Math.floor(1e6*(e-1e3*n));return new oe(n,r)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?Ne(this.nanoseconds,e.nanoseconds):Ne(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class me{constructor(e){this.timestamp=e}static fromTimestamp(e){return new me(e)}static min(){return new me(new oe(0,0))}static max(){return new me(new oe(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ba{constructor(e,n,r){n===void 0?n=0:n>e.length&&he(),r===void 0?r=e.length-n:r>e.length-n&&he(),this.segments=e,this.offset=n,this.len=r}get length(){return this.len}isEqual(e){return Ba.comparator(this,e)===0}child(e){const n=this.segments.slice(this.offset,this.limit());return e instanceof Ba?e.forEach(r=>{n.push(r)}):n.push(e),this.construct(n)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==e.get(n))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==e.get(n))return!1;return!0}forEach(e){for(let n=this.offset,r=this.limit();n<r;n++)e(this.segments[n])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,n){const r=Math.min(e.length,n.length);for(let s=0;s<r;s++){const a=e.get(s),o=n.get(s);if(a<o)return-1;if(a>o)return 1}return e.length<n.length?-1:e.length>n.length?1:0}}class De extends Ba{construct(e,n,r){return new De(e,n,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const n=[];for(const r of e){if(r.indexOf("//")>=0)throw new se(X.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);n.push(...r.split("/").filter(s=>s.length>0))}return new De(n)}static emptyPath(){return new De([])}}const L1=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class lt extends Ba{construct(e,n,r){return new lt(e,n,r)}static isValidIdentifier(e){return L1.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),lt.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new lt(["__name__"])}static fromServerFormat(e){const n=[];let r="",s=0;const a=()=>{if(r.length===0)throw new se(X.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);n.push(r),r=""};let o=!1;for(;s<e.length;){const c=e[s];if(c==="\\"){if(s+1===e.length)throw new se(X.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const u=e[s+1];if(u!=="\\"&&u!=="."&&u!=="`")throw new se(X.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=u,s+=2}else c==="`"?(o=!o,s++):c!=="."||o?(r+=c,s++):(a(),s++)}if(a(),o)throw new se(X.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new lt(n)}static emptyPath(){return new lt([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class le{constructor(e){this.path=e}static fromPath(e){return new le(De.fromString(e))}static fromName(e){return new le(De.fromString(e).popFirst(5))}static empty(){return new le(De.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&De.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,n){return De.comparator(e.path,n.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new le(new De(e.slice()))}}function V1(t,e){const n=t.toTimestamp().seconds,r=t.toTimestamp().nanoseconds+1,s=me.fromTimestamp(r===1e9?new oe(n+1,0):new oe(n,r));return new Fr(s,le.empty(),e)}function F1(t){return new Fr(t.readTime,t.key,-1)}class Fr{constructor(e,n,r){this.readTime=e,this.documentKey=n,this.largestBatchId=r}static min(){return new Fr(me.min(),le.empty(),-1)}static max(){return new Fr(me.max(),le.empty(),-1)}}function U1(t,e){let n=t.readTime.compareTo(e.readTime);return n!==0?n:(n=le.comparator(t.documentKey,e.documentKey),n!==0?n:Ne(t.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const B1="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class $1{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function oo(t){if(t.code!==X.FAILED_PRECONDITION||t.message!==B1)throw t;ae("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class J{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(n=>{this.isDone=!0,this.result=n,this.nextCallback&&this.nextCallback(n)},n=>{this.isDone=!0,this.error=n,this.catchCallback&&this.catchCallback(n)})}catch(e){return this.next(void 0,e)}next(e,n){return this.callbackAttached&&he(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(e,this.result):new J((r,s)=>{this.nextCallback=a=>{this.wrapSuccess(e,a).next(r,s)},this.catchCallback=a=>{this.wrapFailure(n,a).next(r,s)}})}toPromise(){return new Promise((e,n)=>{this.next(e,n)})}wrapUserFunction(e){try{const n=e();return n instanceof J?n:J.resolve(n)}catch(n){return J.reject(n)}}wrapSuccess(e,n){return e?this.wrapUserFunction(()=>e(n)):J.resolve(n)}wrapFailure(e,n){return e?this.wrapUserFunction(()=>e(n)):J.reject(n)}static resolve(e){return new J((n,r)=>{n(e)})}static reject(e){return new J((n,r)=>{r(e)})}static waitFor(e){return new J((n,r)=>{let s=0,a=0,o=!1;e.forEach(c=>{++s,c.next(()=>{++a,o&&a===s&&n()},u=>r(u))}),o=!0,a===s&&n()})}static or(e){let n=J.resolve(!1);for(const r of e)n=n.next(s=>s?J.resolve(s):r());return n}static forEach(e,n){const r=[];return e.forEach((s,a)=>{r.push(n.call(this,s,a))}),this.waitFor(r)}static mapArray(e,n){return new J((r,s)=>{const a=e.length,o=new Array(a);let c=0;for(let u=0;u<a;u++){const d=u;n(e[d]).next(m=>{o[d]=m,++c,c===a&&r(o)},m=>s(m))}})}static doWhile(e,n){return new J((r,s)=>{const a=()=>{e()===!0?n().next(()=>{a()},s):r()};a()})}}function z1(t){const e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)}function lo(t){return t.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vm{constructor(e,n){this.previousValue=e,n&&(n.sequenceNumberHandler=r=>this.ie(r),this.se=r=>n.writeSequenceNumber(r))}ie(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.se&&this.se(e),e}}Vm.oe=-1;function zc(t){return t==null}function oc(t){return t===0&&1/t==-1/0}function q1(t){return typeof t=="number"&&Number.isInteger(t)&&!oc(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ay(t){let e=0;for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function Es(t,e){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function db(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Be{constructor(e,n){this.comparator=e,this.root=n||ot.EMPTY}insert(e,n){return new Be(this.comparator,this.root.insert(e,n,this.comparator).copy(null,null,ot.BLACK,null,null))}remove(e){return new Be(this.comparator,this.root.remove(e,this.comparator).copy(null,null,ot.BLACK,null,null))}get(e){let n=this.root;for(;!n.isEmpty();){const r=this.comparator(e,n.key);if(r===0)return n.value;r<0?n=n.left:r>0&&(n=n.right)}return null}indexOf(e){let n=0,r=this.root;for(;!r.isEmpty();){const s=this.comparator(e,r.key);if(s===0)return n+r.left.size;s<0?r=r.left:(n+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((n,r)=>(e(n,r),!1))}toString(){const e=[];return this.inorderTraversal((n,r)=>(e.push(`${n}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new nl(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new nl(this.root,e,this.comparator,!1)}getReverseIterator(){return new nl(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new nl(this.root,e,this.comparator,!0)}}class nl{constructor(e,n,r,s){this.isReverse=s,this.nodeStack=[];let a=1;for(;!e.isEmpty();)if(a=n?r(e.key,n):1,n&&s&&(a*=-1),a<0)e=this.isReverse?e.left:e.right;else{if(a===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const n={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return n}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class ot{constructor(e,n,r,s,a){this.key=e,this.value=n,this.color=r??ot.RED,this.left=s??ot.EMPTY,this.right=a??ot.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,n,r,s,a){return new ot(e??this.key,n??this.value,r??this.color,s??this.left,a??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,n,r){let s=this;const a=r(e,s.key);return s=a<0?s.copy(null,null,null,s.left.insert(e,n,r),null):a===0?s.copy(null,n,null,null,null):s.copy(null,null,null,null,s.right.insert(e,n,r)),s.fixUp()}removeMin(){if(this.left.isEmpty())return ot.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,n){let r,s=this;if(n(e,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(e,n),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),n(e,s.key)===0){if(s.right.isEmpty())return ot.EMPTY;r=s.right.min(),s=s.copy(r.key,r.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(e,n))}return s.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,ot.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,ot.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),n=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,n)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw he();const e=this.left.check();if(e!==this.right.check())throw he();return e+(this.isRed()?0:1)}}ot.EMPTY=null,ot.RED=!0,ot.BLACK=!1;ot.EMPTY=new class{constructor(){this.size=0}get key(){throw he()}get value(){throw he()}get color(){throw he()}get left(){throw he()}get right(){throw he()}copy(e,n,r,s,a){return this}insert(e,n,r){return new ot(e,n)}remove(e,n){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ut{constructor(e){this.comparator=e,this.data=new Be(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((n,r)=>(e(n),!1))}forEachInRange(e,n){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const s=r.getNext();if(this.comparator(s.key,e[1])>=0)return;n(s.key)}}forEachWhile(e,n){let r;for(r=n!==void 0?this.data.getIteratorFrom(n):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const n=this.data.getIteratorFrom(e);return n.hasNext()?n.getNext().key:null}getIterator(){return new oy(this.data.getIterator())}getIteratorFrom(e){return new oy(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let n=this;return n.size<e.size&&(n=e,e=this),e.forEach(r=>{n=n.add(r)}),n}isEqual(e){if(!(e instanceof ut)||this.size!==e.size)return!1;const n=this.data.getIterator(),r=e.data.getIterator();for(;n.hasNext();){const s=n.getNext().key,a=r.getNext().key;if(this.comparator(s,a)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(n=>{e.push(n)}),e}toString(){const e=[];return this.forEach(n=>e.push(n)),"SortedSet("+e.toString()+")"}copy(e){const n=new ut(this.comparator);return n.data=e,n}}class oy{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ht{constructor(e){this.fields=e,e.sort(lt.comparator)}static empty(){return new Ht([])}unionWith(e){let n=new ut(lt.comparator);for(const r of this.fields)n=n.add(r);for(const r of e)n=n.add(r);return new Ht(n.toArray())}covers(e){for(const n of this.fields)if(n.isPrefixOf(e))return!0;return!1}isEqual(e){return mi(this.fields,e.fields,(n,r)=>n.isEqual(r))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hb extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ht{constructor(e){this.binaryString=e}static fromBase64String(e){const n=function(s){try{return atob(s)}catch(a){throw typeof DOMException<"u"&&a instanceof DOMException?new hb("Invalid base64 string: "+a):a}}(e);return new ht(n)}static fromUint8Array(e){const n=function(s){let a="";for(let o=0;o<s.length;++o)a+=String.fromCharCode(s[o]);return a}(e);return new ht(n)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(n){return btoa(n)}(this.binaryString)}toUint8Array(){return function(n){const r=new Uint8Array(n.length);for(let s=0;s<n.length;s++)r[s]=n.charCodeAt(s);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Ne(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}ht.EMPTY_BYTE_STRING=new ht("");const H1=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Ur(t){if(je(!!t),typeof t=="string"){let e=0;const n=H1.exec(t);if(je(!!n),n[1]){let s=n[1];s=(s+"000000000").substr(0,9),e=Number(s)}const r=new Date(t);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:Ge(t.seconds),nanos:Ge(t.nanos)}}function Ge(t){return typeof t=="number"?t:typeof t=="string"?Number(t):0}function xs(t){return typeof t=="string"?ht.fromBase64String(t):ht.fromUint8Array(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Fm(t){var e,n;return((n=(((e=t==null?void 0:t.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||n===void 0?void 0:n.stringValue)==="server_timestamp"}function Um(t){const e=t.mapValue.fields.__previous_value__;return Fm(e)?Um(e):e}function $a(t){const e=Ur(t.mapValue.fields.__local_write_time__.timestampValue);return new oe(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class G1{constructor(e,n,r,s,a,o,c,u,d){this.databaseId=e,this.appId=n,this.persistenceKey=r,this.host=s,this.ssl=a,this.forceLongPolling=o,this.autoDetectLongPolling=c,this.longPollingOptions=u,this.useFetchStreams=d}}class za{constructor(e,n){this.projectId=e,this.database=n||"(default)"}static empty(){return new za("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof za&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rl={mapValue:{}};function vs(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?Fm(t)?4:K1(t)?9007199254740991:W1(t)?10:11:he()}function Cn(t,e){if(t===e)return!0;const n=vs(t);if(n!==vs(e))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return $a(t).isEqual($a(e));case 3:return function(s,a){if(typeof s.timestampValue=="string"&&typeof a.timestampValue=="string"&&s.timestampValue.length===a.timestampValue.length)return s.timestampValue===a.timestampValue;const o=Ur(s.timestampValue),c=Ur(a.timestampValue);return o.seconds===c.seconds&&o.nanos===c.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(s,a){return xs(s.bytesValue).isEqual(xs(a.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(s,a){return Ge(s.geoPointValue.latitude)===Ge(a.geoPointValue.latitude)&&Ge(s.geoPointValue.longitude)===Ge(a.geoPointValue.longitude)}(t,e);case 2:return function(s,a){if("integerValue"in s&&"integerValue"in a)return Ge(s.integerValue)===Ge(a.integerValue);if("doubleValue"in s&&"doubleValue"in a){const o=Ge(s.doubleValue),c=Ge(a.doubleValue);return o===c?oc(o)===oc(c):isNaN(o)&&isNaN(c)}return!1}(t,e);case 9:return mi(t.arrayValue.values||[],e.arrayValue.values||[],Cn);case 10:case 11:return function(s,a){const o=s.mapValue.fields||{},c=a.mapValue.fields||{};if(ay(o)!==ay(c))return!1;for(const u in o)if(o.hasOwnProperty(u)&&(c[u]===void 0||!Cn(o[u],c[u])))return!1;return!0}(t,e);default:return he()}}function qa(t,e){return(t.values||[]).find(n=>Cn(n,e))!==void 0}function fi(t,e){if(t===e)return 0;const n=vs(t),r=vs(e);if(n!==r)return Ne(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return Ne(t.booleanValue,e.booleanValue);case 2:return function(a,o){const c=Ge(a.integerValue||a.doubleValue),u=Ge(o.integerValue||o.doubleValue);return c<u?-1:c>u?1:c===u?0:isNaN(c)?isNaN(u)?0:-1:1}(t,e);case 3:return ly(t.timestampValue,e.timestampValue);case 4:return ly($a(t),$a(e));case 5:return Ne(t.stringValue,e.stringValue);case 6:return function(a,o){const c=xs(a),u=xs(o);return c.compareTo(u)}(t.bytesValue,e.bytesValue);case 7:return function(a,o){const c=a.split("/"),u=o.split("/");for(let d=0;d<c.length&&d<u.length;d++){const m=Ne(c[d],u[d]);if(m!==0)return m}return Ne(c.length,u.length)}(t.referenceValue,e.referenceValue);case 8:return function(a,o){const c=Ne(Ge(a.latitude),Ge(o.latitude));return c!==0?c:Ne(Ge(a.longitude),Ge(o.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return cy(t.arrayValue,e.arrayValue);case 10:return function(a,o){var c,u,d,m;const y=a.fields||{},g=o.fields||{},x=(c=y.value)===null||c===void 0?void 0:c.arrayValue,C=(u=g.value)===null||u===void 0?void 0:u.arrayValue,E=Ne(((d=x==null?void 0:x.values)===null||d===void 0?void 0:d.length)||0,((m=C==null?void 0:C.values)===null||m===void 0?void 0:m.length)||0);return E!==0?E:cy(x,C)}(t.mapValue,e.mapValue);case 11:return function(a,o){if(a===rl.mapValue&&o===rl.mapValue)return 0;if(a===rl.mapValue)return 1;if(o===rl.mapValue)return-1;const c=a.fields||{},u=Object.keys(c),d=o.fields||{},m=Object.keys(d);u.sort(),m.sort();for(let y=0;y<u.length&&y<m.length;++y){const g=Ne(u[y],m[y]);if(g!==0)return g;const x=fi(c[u[y]],d[m[y]]);if(x!==0)return x}return Ne(u.length,m.length)}(t.mapValue,e.mapValue);default:throw he()}}function ly(t,e){if(typeof t=="string"&&typeof e=="string"&&t.length===e.length)return Ne(t,e);const n=Ur(t),r=Ur(e),s=Ne(n.seconds,r.seconds);return s!==0?s:Ne(n.nanos,r.nanos)}function cy(t,e){const n=t.values||[],r=e.values||[];for(let s=0;s<n.length&&s<r.length;++s){const a=fi(n[s],r[s]);if(a)return a}return Ne(n.length,r.length)}function pi(t){return gh(t)}function gh(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(n){const r=Ur(n);return`time(${r.seconds},${r.nanos})`}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?function(n){return xs(n).toBase64()}(t.bytesValue):"referenceValue"in t?function(n){return le.fromName(n).toString()}(t.referenceValue):"geoPointValue"in t?function(n){return`geo(${n.latitude},${n.longitude})`}(t.geoPointValue):"arrayValue"in t?function(n){let r="[",s=!0;for(const a of n.values||[])s?s=!1:r+=",",r+=gh(a);return r+"]"}(t.arrayValue):"mapValue"in t?function(n){const r=Object.keys(n.fields||{}).sort();let s="{",a=!0;for(const o of r)a?a=!1:s+=",",s+=`${o}:${gh(n.fields[o])}`;return s+"}"}(t.mapValue):he()}function uy(t,e){return{referenceValue:`projects/${t.projectId}/databases/${t.database}/documents/${e.path.canonicalString()}`}}function yh(t){return!!t&&"integerValue"in t}function Bm(t){return!!t&&"arrayValue"in t}function dy(t){return!!t&&"nullValue"in t}function hy(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function Nl(t){return!!t&&"mapValue"in t}function W1(t){var e,n;return((n=(((e=t==null?void 0:t.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||n===void 0?void 0:n.stringValue)==="__vector__"}function xa(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue&&typeof t.timestampValue=="object")return{timestampValue:Object.assign({},t.timestampValue)};if(t.mapValue){const e={mapValue:{fields:{}}};return Es(t.mapValue.fields,(n,r)=>e.mapValue.fields[n]=xa(r)),e}if(t.arrayValue){const e={arrayValue:{values:[]}};for(let n=0;n<(t.arrayValue.values||[]).length;++n)e.arrayValue.values[n]=xa(t.arrayValue.values[n]);return e}return Object.assign({},t)}function K1(t){return(((t.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dt{constructor(e){this.value=e}static empty(){return new Dt({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let n=this.value;for(let r=0;r<e.length-1;++r)if(n=(n.mapValue.fields||{})[e.get(r)],!Nl(n))return null;return n=(n.mapValue.fields||{})[e.lastSegment()],n||null}}set(e,n){this.getFieldsMap(e.popLast())[e.lastSegment()]=xa(n)}setAll(e){let n=lt.emptyPath(),r={},s=[];e.forEach((o,c)=>{if(!n.isImmediateParentOf(c)){const u=this.getFieldsMap(n);this.applyChanges(u,r,s),r={},s=[],n=c.popLast()}o?r[c.lastSegment()]=xa(o):s.push(c.lastSegment())});const a=this.getFieldsMap(n);this.applyChanges(a,r,s)}delete(e){const n=this.field(e.popLast());Nl(n)&&n.mapValue.fields&&delete n.mapValue.fields[e.lastSegment()]}isEqual(e){return Cn(this.value,e.value)}getFieldsMap(e){let n=this.value;n.mapValue.fields||(n.mapValue={fields:{}});for(let r=0;r<e.length;++r){let s=n.mapValue.fields[e.get(r)];Nl(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},n.mapValue.fields[e.get(r)]=s),n=s}return n.mapValue.fields}applyChanges(e,n,r){Es(n,(s,a)=>e[s]=a);for(const s of r)delete e[s]}clone(){return new Dt(xa(this.value))}}function mb(t){const e=[];return Es(t.fields,(n,r)=>{const s=new lt([n]);if(Nl(r)){const a=mb(r.mapValue).fields;if(a.length===0)e.push(s);else for(const o of a)e.push(s.child(o))}else e.push(s)}),new Ht(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wt{constructor(e,n,r,s,a,o,c){this.key=e,this.documentType=n,this.version=r,this.readTime=s,this.createTime=a,this.data=o,this.documentState=c}static newInvalidDocument(e){return new wt(e,0,me.min(),me.min(),me.min(),Dt.empty(),0)}static newFoundDocument(e,n,r,s){return new wt(e,1,n,me.min(),r,s,0)}static newNoDocument(e,n){return new wt(e,2,n,me.min(),me.min(),Dt.empty(),0)}static newUnknownDocument(e,n){return new wt(e,3,n,me.min(),me.min(),Dt.empty(),2)}convertToFoundDocument(e,n){return!this.createTime.isEqual(me.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=n,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Dt.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Dt.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=me.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof wt&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new wt(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lc{constructor(e,n){this.position=e,this.inclusive=n}}function my(t,e,n){let r=0;for(let s=0;s<t.position.length;s++){const a=e[s],o=t.position[s];if(a.field.isKeyField()?r=le.comparator(le.fromName(o.referenceValue),n.key):r=fi(o,n.data.field(a.field)),a.dir==="desc"&&(r*=-1),r!==0)break}return r}function fy(t,e){if(t===null)return e===null;if(e===null||t.inclusive!==e.inclusive||t.position.length!==e.position.length)return!1;for(let n=0;n<t.position.length;n++)if(!Cn(t.position[n],e.position[n]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ha{constructor(e,n="asc"){this.field=e,this.dir=n}}function Q1(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fb{}class Ye extends fb{constructor(e,n,r){super(),this.field=e,this.op=n,this.value=r}static create(e,n,r){return e.isKeyField()?n==="in"||n==="not-in"?this.createKeyFieldInFilter(e,n,r):new X1(e,n,r):n==="array-contains"?new eC(e,r):n==="in"?new tC(e,r):n==="not-in"?new nC(e,r):n==="array-contains-any"?new rC(e,r):new Ye(e,n,r)}static createKeyFieldInFilter(e,n,r){return n==="in"?new J1(e,r):new Z1(e,r)}matches(e){const n=e.data.field(this.field);return this.op==="!="?n!==null&&this.matchesComparison(fi(n,this.value)):n!==null&&vs(this.value)===vs(n)&&this.matchesComparison(fi(n,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return he()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class yn extends fb{constructor(e,n){super(),this.filters=e,this.op=n,this.ae=null}static create(e,n){return new yn(e,n)}matches(e){return pb(this)?this.filters.find(n=>!n.matches(e))===void 0:this.filters.find(n=>n.matches(e))!==void 0}getFlattenedFilters(){return this.ae!==null||(this.ae=this.filters.reduce((e,n)=>e.concat(n.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}}function pb(t){return t.op==="and"}function gb(t){return Y1(t)&&pb(t)}function Y1(t){for(const e of t.filters)if(e instanceof yn)return!1;return!0}function xh(t){if(t instanceof Ye)return t.field.canonicalString()+t.op.toString()+pi(t.value);if(gb(t))return t.filters.map(e=>xh(e)).join(",");{const e=t.filters.map(n=>xh(n)).join(",");return`${t.op}(${e})`}}function yb(t,e){return t instanceof Ye?function(r,s){return s instanceof Ye&&r.op===s.op&&r.field.isEqual(s.field)&&Cn(r.value,s.value)}(t,e):t instanceof yn?function(r,s){return s instanceof yn&&r.op===s.op&&r.filters.length===s.filters.length?r.filters.reduce((a,o,c)=>a&&yb(o,s.filters[c]),!0):!1}(t,e):void he()}function xb(t){return t instanceof Ye?function(n){return`${n.field.canonicalString()} ${n.op} ${pi(n.value)}`}(t):t instanceof yn?function(n){return n.op.toString()+" {"+n.getFilters().map(xb).join(" ,")+"}"}(t):"Filter"}class X1 extends Ye{constructor(e,n,r){super(e,n,r),this.key=le.fromName(r.referenceValue)}matches(e){const n=le.comparator(e.key,this.key);return this.matchesComparison(n)}}class J1 extends Ye{constructor(e,n){super(e,"in",n),this.keys=vb("in",n)}matches(e){return this.keys.some(n=>n.isEqual(e.key))}}class Z1 extends Ye{constructor(e,n){super(e,"not-in",n),this.keys=vb("not-in",n)}matches(e){return!this.keys.some(n=>n.isEqual(e.key))}}function vb(t,e){var n;return(((n=e.arrayValue)===null||n===void 0?void 0:n.values)||[]).map(r=>le.fromName(r.referenceValue))}class eC extends Ye{constructor(e,n){super(e,"array-contains",n)}matches(e){const n=e.data.field(this.field);return Bm(n)&&qa(n.arrayValue,this.value)}}class tC extends Ye{constructor(e,n){super(e,"in",n)}matches(e){const n=e.data.field(this.field);return n!==null&&qa(this.value.arrayValue,n)}}class nC extends Ye{constructor(e,n){super(e,"not-in",n)}matches(e){if(qa(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const n=e.data.field(this.field);return n!==null&&!qa(this.value.arrayValue,n)}}class rC extends Ye{constructor(e,n){super(e,"array-contains-any",n)}matches(e){const n=e.data.field(this.field);return!(!Bm(n)||!n.arrayValue.values)&&n.arrayValue.values.some(r=>qa(this.value.arrayValue,r))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sC{constructor(e,n=null,r=[],s=[],a=null,o=null,c=null){this.path=e,this.collectionGroup=n,this.orderBy=r,this.filters=s,this.limit=a,this.startAt=o,this.endAt=c,this.ue=null}}function py(t,e=null,n=[],r=[],s=null,a=null,o=null){return new sC(t,e,n,r,s,a,o)}function $m(t){const e=fe(t);if(e.ue===null){let n=e.path.canonicalString();e.collectionGroup!==null&&(n+="|cg:"+e.collectionGroup),n+="|f:",n+=e.filters.map(r=>xh(r)).join(","),n+="|ob:",n+=e.orderBy.map(r=>function(a){return a.field.canonicalString()+a.dir}(r)).join(","),zc(e.limit)||(n+="|l:",n+=e.limit),e.startAt&&(n+="|lb:",n+=e.startAt.inclusive?"b:":"a:",n+=e.startAt.position.map(r=>pi(r)).join(",")),e.endAt&&(n+="|ub:",n+=e.endAt.inclusive?"a:":"b:",n+=e.endAt.position.map(r=>pi(r)).join(",")),e.ue=n}return e.ue}function zm(t,e){if(t.limit!==e.limit||t.orderBy.length!==e.orderBy.length)return!1;for(let n=0;n<t.orderBy.length;n++)if(!Q1(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let n=0;n<t.filters.length;n++)if(!yb(t.filters[n],e.filters[n]))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!fy(t.startAt,e.startAt)&&fy(t.endAt,e.endAt)}function vh(t){return le.isDocumentKey(t.path)&&t.collectionGroup===null&&t.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ji{constructor(e,n=null,r=[],s=[],a=null,o="F",c=null,u=null){this.path=e,this.collectionGroup=n,this.explicitOrderBy=r,this.filters=s,this.limit=a,this.limitType=o,this.startAt=c,this.endAt=u,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}}function iC(t,e,n,r,s,a,o,c){return new ji(t,e,n,r,s,a,o,c)}function qc(t){return new ji(t)}function gy(t){return t.filters.length===0&&t.limit===null&&t.startAt==null&&t.endAt==null&&(t.explicitOrderBy.length===0||t.explicitOrderBy.length===1&&t.explicitOrderBy[0].field.isKeyField())}function bb(t){return t.collectionGroup!==null}function va(t){const e=fe(t);if(e.ce===null){e.ce=[];const n=new Set;for(const a of e.explicitOrderBy)e.ce.push(a),n.add(a.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let c=new ut(lt.comparator);return o.filters.forEach(u=>{u.getFlattenedFilters().forEach(d=>{d.isInequality()&&(c=c.add(d.field))})}),c})(e).forEach(a=>{n.has(a.canonicalString())||a.isKeyField()||e.ce.push(new Ha(a,r))}),n.has(lt.keyField().canonicalString())||e.ce.push(new Ha(lt.keyField(),r))}return e.ce}function jn(t){const e=fe(t);return e.le||(e.le=aC(e,va(t))),e.le}function aC(t,e){if(t.limitType==="F")return py(t.path,t.collectionGroup,e,t.filters,t.limit,t.startAt,t.endAt);{e=e.map(s=>{const a=s.dir==="desc"?"asc":"desc";return new Ha(s.field,a)});const n=t.endAt?new lc(t.endAt.position,t.endAt.inclusive):null,r=t.startAt?new lc(t.startAt.position,t.startAt.inclusive):null;return py(t.path,t.collectionGroup,e,t.filters,t.limit,n,r)}}function bh(t,e){const n=t.filters.concat([e]);return new ji(t.path,t.collectionGroup,t.explicitOrderBy.slice(),n,t.limit,t.limitType,t.startAt,t.endAt)}function cc(t,e,n){return new ji(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function Hc(t,e){return zm(jn(t),jn(e))&&t.limitType===e.limitType}function wb(t){return`${$m(jn(t))}|lt:${t.limitType}`}function ks(t){return`Query(target=${function(n){let r=n.path.canonicalString();return n.collectionGroup!==null&&(r+=" collectionGroup="+n.collectionGroup),n.filters.length>0&&(r+=`, filters: [${n.filters.map(s=>xb(s)).join(", ")}]`),zc(n.limit)||(r+=", limit: "+n.limit),n.orderBy.length>0&&(r+=`, orderBy: [${n.orderBy.map(s=>function(o){return`${o.field.canonicalString()} (${o.dir})`}(s)).join(", ")}]`),n.startAt&&(r+=", startAt: ",r+=n.startAt.inclusive?"b:":"a:",r+=n.startAt.position.map(s=>pi(s)).join(",")),n.endAt&&(r+=", endAt: ",r+=n.endAt.inclusive?"a:":"b:",r+=n.endAt.position.map(s=>pi(s)).join(",")),`Target(${r})`}(jn(t))}; limitType=${t.limitType})`}function Gc(t,e){return e.isFoundDocument()&&function(r,s){const a=s.key.path;return r.collectionGroup!==null?s.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(a):le.isDocumentKey(r.path)?r.path.isEqual(a):r.path.isImmediateParentOf(a)}(t,e)&&function(r,s){for(const a of va(r))if(!a.field.isKeyField()&&s.data.field(a.field)===null)return!1;return!0}(t,e)&&function(r,s){for(const a of r.filters)if(!a.matches(s))return!1;return!0}(t,e)&&function(r,s){return!(r.startAt&&!function(o,c,u){const d=my(o,c,u);return o.inclusive?d<=0:d<0}(r.startAt,va(r),s)||r.endAt&&!function(o,c,u){const d=my(o,c,u);return o.inclusive?d>=0:d>0}(r.endAt,va(r),s))}(t,e)}function oC(t){return t.collectionGroup||(t.path.length%2==1?t.path.lastSegment():t.path.get(t.path.length-2))}function _b(t){return(e,n)=>{let r=!1;for(const s of va(t)){const a=lC(s,e,n);if(a!==0)return a;r=r||s.field.isKeyField()}return 0}}function lC(t,e,n){const r=t.field.isKeyField()?le.comparator(e.key,n.key):function(a,o,c){const u=o.data.field(a),d=c.data.field(a);return u!==null&&d!==null?fi(u,d):he()}(t.field,e,n);switch(t.dir){case"asc":return r;case"desc":return-1*r;default:return he()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Si{constructor(e,n){this.mapKeyFn=e,this.equalsFn=n,this.inner={},this.innerSize=0}get(e){const n=this.mapKeyFn(e),r=this.inner[n];if(r!==void 0){for(const[s,a]of r)if(this.equalsFn(s,e))return a}}has(e){return this.get(e)!==void 0}set(e,n){const r=this.mapKeyFn(e),s=this.inner[r];if(s===void 0)return this.inner[r]=[[e,n]],void this.innerSize++;for(let a=0;a<s.length;a++)if(this.equalsFn(s[a][0],e))return void(s[a]=[e,n]);s.push([e,n]),this.innerSize++}delete(e){const n=this.mapKeyFn(e),r=this.inner[n];if(r===void 0)return!1;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],e))return r.length===1?delete this.inner[n]:r.splice(s,1),this.innerSize--,!0;return!1}forEach(e){Es(this.inner,(n,r)=>{for(const[s,a]of r)e(s,a)})}isEmpty(){return db(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cC=new Be(le.comparator);function nr(){return cC}const Nb=new Be(le.comparator);function ia(...t){let e=Nb;for(const n of t)e=e.insert(n.key,n);return e}function Eb(t){let e=Nb;return t.forEach((n,r)=>e=e.insert(n,r.overlayedDocument)),e}function ss(){return ba()}function Tb(){return ba()}function ba(){return new Si(t=>t.toString(),(t,e)=>t.isEqual(e))}const uC=new Be(le.comparator),dC=new ut(le.comparator);function ye(...t){let e=dC;for(const n of t)e=e.add(n);return e}const hC=new ut(Ne);function mC(){return hC}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qm(t,e){if(t.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:oc(e)?"-0":e}}function jb(t){return{integerValue:""+t}}function fC(t,e){return q1(e)?jb(e):qm(t,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wc{constructor(){this._=void 0}}function pC(t,e,n){return t instanceof uc?function(s,a){const o={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return a&&Fm(a)&&(a=Um(a)),a&&(o.fields.__previous_value__=a),{mapValue:o}}(n,e):t instanceof Ga?Cb(t,e):t instanceof Wa?Ib(t,e):function(s,a){const o=Sb(s,a),c=yy(o)+yy(s.Pe);return yh(o)&&yh(s.Pe)?jb(c):qm(s.serializer,c)}(t,e)}function gC(t,e,n){return t instanceof Ga?Cb(t,e):t instanceof Wa?Ib(t,e):n}function Sb(t,e){return t instanceof dc?function(r){return yh(r)||function(a){return!!a&&"doubleValue"in a}(r)}(e)?e:{integerValue:0}:null}class uc extends Wc{}class Ga extends Wc{constructor(e){super(),this.elements=e}}function Cb(t,e){const n=Ab(e);for(const r of t.elements)n.some(s=>Cn(s,r))||n.push(r);return{arrayValue:{values:n}}}class Wa extends Wc{constructor(e){super(),this.elements=e}}function Ib(t,e){let n=Ab(e);for(const r of t.elements)n=n.filter(s=>!Cn(s,r));return{arrayValue:{values:n}}}class dc extends Wc{constructor(e,n){super(),this.serializer=e,this.Pe=n}}function yy(t){return Ge(t.integerValue||t.doubleValue)}function Ab(t){return Bm(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}function yC(t,e){return t.field.isEqual(e.field)&&function(r,s){return r instanceof Ga&&s instanceof Ga||r instanceof Wa&&s instanceof Wa?mi(r.elements,s.elements,Cn):r instanceof dc&&s instanceof dc?Cn(r.Pe,s.Pe):r instanceof uc&&s instanceof uc}(t.transform,e.transform)}class xC{constructor(e,n){this.version=e,this.transformResults=n}}class nn{constructor(e,n){this.updateTime=e,this.exists=n}static none(){return new nn}static exists(e){return new nn(void 0,e)}static updateTime(e){return new nn(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function El(t,e){return t.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(t.updateTime):t.exists===void 0||t.exists===e.isFoundDocument()}class Kc{}function kb(t,e){if(!t.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return t.isNoDocument()?new Hm(t.key,nn.none()):new co(t.key,t.data,nn.none());{const n=t.data,r=Dt.empty();let s=new ut(lt.comparator);for(let a of e.fields)if(!s.has(a)){let o=n.field(a);o===null&&a.length>1&&(a=a.popLast(),o=n.field(a)),o===null?r.delete(a):r.set(a,o),s=s.add(a)}return new Gr(t.key,r,new Ht(s.toArray()),nn.none())}}function vC(t,e,n){t instanceof co?function(s,a,o){const c=s.value.clone(),u=vy(s.fieldTransforms,a,o.transformResults);c.setAll(u),a.convertToFoundDocument(o.version,c).setHasCommittedMutations()}(t,e,n):t instanceof Gr?function(s,a,o){if(!El(s.precondition,a))return void a.convertToUnknownDocument(o.version);const c=vy(s.fieldTransforms,a,o.transformResults),u=a.data;u.setAll(Pb(s)),u.setAll(c),a.convertToFoundDocument(o.version,u).setHasCommittedMutations()}(t,e,n):function(s,a,o){a.convertToNoDocument(o.version).setHasCommittedMutations()}(0,e,n)}function wa(t,e,n,r){return t instanceof co?function(a,o,c,u){if(!El(a.precondition,o))return c;const d=a.value.clone(),m=by(a.fieldTransforms,u,o);return d.setAll(m),o.convertToFoundDocument(o.version,d).setHasLocalMutations(),null}(t,e,n,r):t instanceof Gr?function(a,o,c,u){if(!El(a.precondition,o))return c;const d=by(a.fieldTransforms,u,o),m=o.data;return m.setAll(Pb(a)),m.setAll(d),o.convertToFoundDocument(o.version,m).setHasLocalMutations(),c===null?null:c.unionWith(a.fieldMask.fields).unionWith(a.fieldTransforms.map(y=>y.field))}(t,e,n,r):function(a,o,c){return El(a.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):c}(t,e,n)}function bC(t,e){let n=null;for(const r of t.fieldTransforms){const s=e.data.field(r.field),a=Sb(r.transform,s||null);a!=null&&(n===null&&(n=Dt.empty()),n.set(r.field,a))}return n||null}function xy(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(r,s){return r===void 0&&s===void 0||!(!r||!s)&&mi(r,s,(a,o)=>yC(a,o))}(t.fieldTransforms,e.fieldTransforms)&&(t.type===0?t.value.isEqual(e.value):t.type!==1||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}class co extends Kc{constructor(e,n,r,s=[]){super(),this.key=e,this.value=n,this.precondition=r,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class Gr extends Kc{constructor(e,n,r,s,a=[]){super(),this.key=e,this.data=n,this.fieldMask=r,this.precondition=s,this.fieldTransforms=a,this.type=1}getFieldMask(){return this.fieldMask}}function Pb(t){const e=new Map;return t.fieldMask.fields.forEach(n=>{if(!n.isEmpty()){const r=t.data.field(n);e.set(n,r)}}),e}function vy(t,e,n){const r=new Map;je(t.length===n.length);for(let s=0;s<n.length;s++){const a=t[s],o=a.transform,c=e.data.field(a.field);r.set(a.field,gC(o,c,n[s]))}return r}function by(t,e,n){const r=new Map;for(const s of t){const a=s.transform,o=n.data.field(s.field);r.set(s.field,pC(a,o,e))}return r}class Hm extends Kc{constructor(e,n){super(),this.key=e,this.precondition=n,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class wC extends Kc{constructor(e,n){super(),this.key=e,this.precondition=n,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _C{constructor(e,n,r,s){this.batchId=e,this.localWriteTime=n,this.baseMutations=r,this.mutations=s}applyToRemoteDocument(e,n){const r=n.mutationResults;for(let s=0;s<this.mutations.length;s++){const a=this.mutations[s];a.key.isEqual(e.key)&&vC(a,e,r[s])}}applyToLocalView(e,n){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(n=wa(r,e,n,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(n=wa(r,e,n,this.localWriteTime));return n}applyToLocalDocumentSet(e,n){const r=Tb();return this.mutations.forEach(s=>{const a=e.get(s.key),o=a.overlayedDocument;let c=this.applyToLocalView(o,a.mutatedFields);c=n.has(s.key)?null:c;const u=kb(o,c);u!==null&&r.set(s.key,u),o.isValidDocument()||o.convertToNoDocument(me.min())}),r}keys(){return this.mutations.reduce((e,n)=>e.add(n.key),ye())}isEqual(e){return this.batchId===e.batchId&&mi(this.mutations,e.mutations,(n,r)=>xy(n,r))&&mi(this.baseMutations,e.baseMutations,(n,r)=>xy(n,r))}}class Gm{constructor(e,n,r,s){this.batch=e,this.commitVersion=n,this.mutationResults=r,this.docVersions=s}static from(e,n,r){je(e.mutations.length===r.length);let s=function(){return uC}();const a=e.mutations;for(let o=0;o<a.length;o++)s=s.insert(a[o].key,r[o].version);return new Gm(e,n,r,s)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NC{constructor(e,n){this.largestBatchId=e,this.mutation=n}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EC{constructor(e,n){this.count=e,this.unchangedNames=n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Ke,be;function TC(t){switch(t){default:return he();case X.CANCELLED:case X.UNKNOWN:case X.DEADLINE_EXCEEDED:case X.RESOURCE_EXHAUSTED:case X.INTERNAL:case X.UNAVAILABLE:case X.UNAUTHENTICATED:return!1;case X.INVALID_ARGUMENT:case X.NOT_FOUND:case X.ALREADY_EXISTS:case X.PERMISSION_DENIED:case X.FAILED_PRECONDITION:case X.ABORTED:case X.OUT_OF_RANGE:case X.UNIMPLEMENTED:case X.DATA_LOSS:return!0}}function Rb(t){if(t===void 0)return tr("GRPC error has no .code"),X.UNKNOWN;switch(t){case Ke.OK:return X.OK;case Ke.CANCELLED:return X.CANCELLED;case Ke.UNKNOWN:return X.UNKNOWN;case Ke.DEADLINE_EXCEEDED:return X.DEADLINE_EXCEEDED;case Ke.RESOURCE_EXHAUSTED:return X.RESOURCE_EXHAUSTED;case Ke.INTERNAL:return X.INTERNAL;case Ke.UNAVAILABLE:return X.UNAVAILABLE;case Ke.UNAUTHENTICATED:return X.UNAUTHENTICATED;case Ke.INVALID_ARGUMENT:return X.INVALID_ARGUMENT;case Ke.NOT_FOUND:return X.NOT_FOUND;case Ke.ALREADY_EXISTS:return X.ALREADY_EXISTS;case Ke.PERMISSION_DENIED:return X.PERMISSION_DENIED;case Ke.FAILED_PRECONDITION:return X.FAILED_PRECONDITION;case Ke.ABORTED:return X.ABORTED;case Ke.OUT_OF_RANGE:return X.OUT_OF_RANGE;case Ke.UNIMPLEMENTED:return X.UNIMPLEMENTED;case Ke.DATA_LOSS:return X.DATA_LOSS;default:return he()}}(be=Ke||(Ke={}))[be.OK=0]="OK",be[be.CANCELLED=1]="CANCELLED",be[be.UNKNOWN=2]="UNKNOWN",be[be.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",be[be.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",be[be.NOT_FOUND=5]="NOT_FOUND",be[be.ALREADY_EXISTS=6]="ALREADY_EXISTS",be[be.PERMISSION_DENIED=7]="PERMISSION_DENIED",be[be.UNAUTHENTICATED=16]="UNAUTHENTICATED",be[be.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",be[be.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",be[be.ABORTED=10]="ABORTED",be[be.OUT_OF_RANGE=11]="OUT_OF_RANGE",be[be.UNIMPLEMENTED=12]="UNIMPLEMENTED",be[be.INTERNAL=13]="INTERNAL",be[be.UNAVAILABLE=14]="UNAVAILABLE",be[be.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jC(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const SC=new os([4294967295,4294967295],0);function wy(t){const e=jC().encode(t),n=new rb;return n.update(e),new Uint8Array(n.digest())}function _y(t){const e=new DataView(t.buffer),n=e.getUint32(0,!0),r=e.getUint32(4,!0),s=e.getUint32(8,!0),a=e.getUint32(12,!0);return[new os([n,r],0),new os([s,a],0)]}class Wm{constructor(e,n,r){if(this.bitmap=e,this.padding=n,this.hashCount=r,n<0||n>=8)throw new aa(`Invalid padding: ${n}`);if(r<0)throw new aa(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new aa(`Invalid hash count: ${r}`);if(e.length===0&&n!==0)throw new aa(`Invalid padding when bitmap length is 0: ${n}`);this.Ie=8*e.length-n,this.Te=os.fromNumber(this.Ie)}Ee(e,n,r){let s=e.add(n.multiply(os.fromNumber(r)));return s.compare(SC)===1&&(s=new os([s.getBits(0),s.getBits(1)],0)),s.modulo(this.Te).toNumber()}de(e){return(this.bitmap[Math.floor(e/8)]&1<<e%8)!=0}mightContain(e){if(this.Ie===0)return!1;const n=wy(e),[r,s]=_y(n);for(let a=0;a<this.hashCount;a++){const o=this.Ee(r,s,a);if(!this.de(o))return!1}return!0}static create(e,n,r){const s=e%8==0?0:8-e%8,a=new Uint8Array(Math.ceil(e/8)),o=new Wm(a,s,n);return r.forEach(c=>o.insert(c)),o}insert(e){if(this.Ie===0)return;const n=wy(e),[r,s]=_y(n);for(let a=0;a<this.hashCount;a++){const o=this.Ee(r,s,a);this.Ae(o)}}Ae(e){const n=Math.floor(e/8),r=e%8;this.bitmap[n]|=1<<r}}class aa extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qc{constructor(e,n,r,s,a){this.snapshotVersion=e,this.targetChanges=n,this.targetMismatches=r,this.documentUpdates=s,this.resolvedLimboDocuments=a}static createSynthesizedRemoteEventForCurrentChange(e,n,r){const s=new Map;return s.set(e,uo.createSynthesizedTargetChangeForCurrentChange(e,n,r)),new Qc(me.min(),s,new Be(Ne),nr(),ye())}}class uo{constructor(e,n,r,s,a){this.resumeToken=e,this.current=n,this.addedDocuments=r,this.modifiedDocuments=s,this.removedDocuments=a}static createSynthesizedTargetChangeForCurrentChange(e,n,r){return new uo(r,n,ye(),ye(),ye())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tl{constructor(e,n,r,s){this.Re=e,this.removedTargetIds=n,this.key=r,this.Ve=s}}class Db{constructor(e,n){this.targetId=e,this.me=n}}class Mb{constructor(e,n,r=ht.EMPTY_BYTE_STRING,s=null){this.state=e,this.targetIds=n,this.resumeToken=r,this.cause=s}}class Ny{constructor(){this.fe=0,this.ge=Ty(),this.pe=ht.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return this.fe!==0}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}ve(){let e=ye(),n=ye(),r=ye();return this.ge.forEach((s,a)=>{switch(a){case 0:e=e.add(s);break;case 2:n=n.add(s);break;case 1:r=r.add(s);break;default:he()}}),new uo(this.pe,this.ye,e,n,r)}Ce(){this.we=!1,this.ge=Ty()}Fe(e,n){this.we=!0,this.ge=this.ge.insert(e,n)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,je(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}}class CC{constructor(e){this.Le=e,this.Be=new Map,this.ke=nr(),this.qe=Ey(),this.Qe=new Be(Ne)}Ke(e){for(const n of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.$e(n,e.Ve):this.Ue(n,e.key,e.Ve);for(const n of e.removedTargetIds)this.Ue(n,e.key,e.Ve)}We(e){this.forEachTarget(e,n=>{const r=this.Ge(n);switch(e.state){case 0:this.ze(n)&&r.De(e.resumeToken);break;case 1:r.Oe(),r.Se||r.Ce(),r.De(e.resumeToken);break;case 2:r.Oe(),r.Se||this.removeTarget(n);break;case 3:this.ze(n)&&(r.Ne(),r.De(e.resumeToken));break;case 4:this.ze(n)&&(this.je(n),r.De(e.resumeToken));break;default:he()}})}forEachTarget(e,n){e.targetIds.length>0?e.targetIds.forEach(n):this.Be.forEach((r,s)=>{this.ze(s)&&n(s)})}He(e){const n=e.targetId,r=e.me.count,s=this.Je(n);if(s){const a=s.target;if(vh(a))if(r===0){const o=new le(a.path);this.Ue(n,o,wt.newNoDocument(o,me.min()))}else je(r===1);else{const o=this.Ye(n);if(o!==r){const c=this.Ze(e),u=c?this.Xe(c,e,o):1;if(u!==0){this.je(n);const d=u===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Qe=this.Qe.insert(n,d)}}}}}Ze(e){const n=e.me.unchangedNames;if(!n||!n.bits)return null;const{bits:{bitmap:r="",padding:s=0},hashCount:a=0}=n;let o,c;try{o=xs(r).toUint8Array()}catch(u){if(u instanceof hb)return hi("Decoding the base64 bloom filter in existence filter failed ("+u.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw u}try{c=new Wm(o,s,a)}catch(u){return hi(u instanceof aa?"BloomFilter error: ":"Applying bloom filter failed: ",u),null}return c.Ie===0?null:c}Xe(e,n,r){return n.me.count===r-this.nt(e,n.targetId)?0:2}nt(e,n){const r=this.Le.getRemoteKeysForTarget(n);let s=0;return r.forEach(a=>{const o=this.Le.tt(),c=`projects/${o.projectId}/databases/${o.database}/documents/${a.path.canonicalString()}`;e.mightContain(c)||(this.Ue(n,a,null),s++)}),s}rt(e){const n=new Map;this.Be.forEach((a,o)=>{const c=this.Je(o);if(c){if(a.current&&vh(c.target)){const u=new le(c.target.path);this.ke.get(u)!==null||this.it(o,u)||this.Ue(o,u,wt.newNoDocument(u,e))}a.be&&(n.set(o,a.ve()),a.Ce())}});let r=ye();this.qe.forEach((a,o)=>{let c=!0;o.forEachWhile(u=>{const d=this.Je(u);return!d||d.purpose==="TargetPurposeLimboResolution"||(c=!1,!1)}),c&&(r=r.add(a))}),this.ke.forEach((a,o)=>o.setReadTime(e));const s=new Qc(e,n,this.Qe,this.ke,r);return this.ke=nr(),this.qe=Ey(),this.Qe=new Be(Ne),s}$e(e,n){if(!this.ze(e))return;const r=this.it(e,n.key)?2:0;this.Ge(e).Fe(n.key,r),this.ke=this.ke.insert(n.key,n),this.qe=this.qe.insert(n.key,this.st(n.key).add(e))}Ue(e,n,r){if(!this.ze(e))return;const s=this.Ge(e);this.it(e,n)?s.Fe(n,1):s.Me(n),this.qe=this.qe.insert(n,this.st(n).delete(e)),r&&(this.ke=this.ke.insert(n,r))}removeTarget(e){this.Be.delete(e)}Ye(e){const n=this.Ge(e).ve();return this.Le.getRemoteKeysForTarget(e).size+n.addedDocuments.size-n.removedDocuments.size}xe(e){this.Ge(e).xe()}Ge(e){let n=this.Be.get(e);return n||(n=new Ny,this.Be.set(e,n)),n}st(e){let n=this.qe.get(e);return n||(n=new ut(Ne),this.qe=this.qe.insert(e,n)),n}ze(e){const n=this.Je(e)!==null;return n||ae("WatchChangeAggregator","Detected inactive target",e),n}Je(e){const n=this.Be.get(e);return n&&n.Se?null:this.Le.ot(e)}je(e){this.Be.set(e,new Ny),this.Le.getRemoteKeysForTarget(e).forEach(n=>{this.Ue(e,n,null)})}it(e,n){return this.Le.getRemoteKeysForTarget(e).has(n)}}function Ey(){return new Be(le.comparator)}function Ty(){return new Be(le.comparator)}const IC={asc:"ASCENDING",desc:"DESCENDING"},AC={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},kC={and:"AND",or:"OR"};class PC{constructor(e,n){this.databaseId=e,this.useProto3Json=n}}function wh(t,e){return t.useProto3Json||zc(e)?e:{value:e}}function hc(t,e){return t.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function Ob(t,e){return t.useProto3Json?e.toBase64():e.toUint8Array()}function RC(t,e){return hc(t,e.toTimestamp())}function Sn(t){return je(!!t),me.fromTimestamp(function(n){const r=Ur(n);return new oe(r.seconds,r.nanos)}(t))}function Km(t,e){return _h(t,e).canonicalString()}function _h(t,e){const n=function(s){return new De(["projects",s.projectId,"databases",s.database])}(t).child("documents");return e===void 0?n:n.child(e)}function Lb(t){const e=De.fromString(t);return je($b(e)),e}function Nh(t,e){return Km(t.databaseId,e.path)}function ld(t,e){const n=Lb(e);if(n.get(1)!==t.databaseId.projectId)throw new se(X.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new se(X.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new le(Fb(n))}function Vb(t,e){return Km(t.databaseId,e)}function DC(t){const e=Lb(t);return e.length===4?De.emptyPath():Fb(e)}function Eh(t){return new De(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function Fb(t){return je(t.length>4&&t.get(4)==="documents"),t.popFirst(5)}function jy(t,e,n){return{name:Nh(t,e),fields:n.value.mapValue.fields}}function MC(t,e){let n;if("targetChange"in e){e.targetChange;const r=function(d){return d==="NO_CHANGE"?0:d==="ADD"?1:d==="REMOVE"?2:d==="CURRENT"?3:d==="RESET"?4:he()}(e.targetChange.targetChangeType||"NO_CHANGE"),s=e.targetChange.targetIds||[],a=function(d,m){return d.useProto3Json?(je(m===void 0||typeof m=="string"),ht.fromBase64String(m||"")):(je(m===void 0||m instanceof Buffer||m instanceof Uint8Array),ht.fromUint8Array(m||new Uint8Array))}(t,e.targetChange.resumeToken),o=e.targetChange.cause,c=o&&function(d){const m=d.code===void 0?X.UNKNOWN:Rb(d.code);return new se(m,d.message||"")}(o);n=new Mb(r,s,a,c||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const s=ld(t,r.document.name),a=Sn(r.document.updateTime),o=r.document.createTime?Sn(r.document.createTime):me.min(),c=new Dt({mapValue:{fields:r.document.fields}}),u=wt.newFoundDocument(s,a,o,c),d=r.targetIds||[],m=r.removedTargetIds||[];n=new Tl(d,m,u.key,u)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const s=ld(t,r.document),a=r.readTime?Sn(r.readTime):me.min(),o=wt.newNoDocument(s,a),c=r.removedTargetIds||[];n=new Tl([],c,o.key,o)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const s=ld(t,r.document),a=r.removedTargetIds||[];n=new Tl([],a,s,null)}else{if(!("filter"in e))return he();{e.filter;const r=e.filter;r.targetId;const{count:s=0,unchangedNames:a}=r,o=new EC(s,a),c=r.targetId;n=new Db(c,o)}}return n}function OC(t,e){let n;if(e instanceof co)n={update:jy(t,e.key,e.value)};else if(e instanceof Hm)n={delete:Nh(t,e.key)};else if(e instanceof Gr)n={update:jy(t,e.key,e.data),updateMask:HC(e.fieldMask)};else{if(!(e instanceof wC))return he();n={verify:Nh(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map(r=>function(a,o){const c=o.transform;if(c instanceof uc)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(c instanceof Ga)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:c.elements}};if(c instanceof Wa)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:c.elements}};if(c instanceof dc)return{fieldPath:o.field.canonicalString(),increment:c.Pe};throw he()}(0,r))),e.precondition.isNone||(n.currentDocument=function(s,a){return a.updateTime!==void 0?{updateTime:RC(s,a.updateTime)}:a.exists!==void 0?{exists:a.exists}:he()}(t,e.precondition)),n}function LC(t,e){return t&&t.length>0?(je(e!==void 0),t.map(n=>function(s,a){let o=s.updateTime?Sn(s.updateTime):Sn(a);return o.isEqual(me.min())&&(o=Sn(a)),new xC(o,s.transformResults||[])}(n,e))):[]}function VC(t,e){return{documents:[Vb(t,e.path)]}}function FC(t,e){const n={structuredQuery:{}},r=e.path;let s;e.collectionGroup!==null?(s=r,n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(s=r.popLast(),n.structuredQuery.from=[{collectionId:r.lastSegment()}]),n.parent=Vb(t,s);const a=function(d){if(d.length!==0)return Bb(yn.create(d,"and"))}(e.filters);a&&(n.structuredQuery.where=a);const o=function(d){if(d.length!==0)return d.map(m=>function(g){return{field:Ps(g.field),direction:$C(g.dir)}}(m))}(e.orderBy);o&&(n.structuredQuery.orderBy=o);const c=wh(t,e.limit);return c!==null&&(n.structuredQuery.limit=c),e.startAt&&(n.structuredQuery.startAt=function(d){return{before:d.inclusive,values:d.position}}(e.startAt)),e.endAt&&(n.structuredQuery.endAt=function(d){return{before:!d.inclusive,values:d.position}}(e.endAt)),{_t:n,parent:s}}function UC(t){let e=DC(t.parent);const n=t.structuredQuery,r=n.from?n.from.length:0;let s=null;if(r>0){je(r===1);const m=n.from[0];m.allDescendants?s=m.collectionId:e=e.child(m.collectionId)}let a=[];n.where&&(a=function(y){const g=Ub(y);return g instanceof yn&&gb(g)?g.getFilters():[g]}(n.where));let o=[];n.orderBy&&(o=function(y){return y.map(g=>function(C){return new Ha(Rs(C.field),function(A){switch(A){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(C.direction))}(g))}(n.orderBy));let c=null;n.limit&&(c=function(y){let g;return g=typeof y=="object"?y.value:y,zc(g)?null:g}(n.limit));let u=null;n.startAt&&(u=function(y){const g=!!y.before,x=y.values||[];return new lc(x,g)}(n.startAt));let d=null;return n.endAt&&(d=function(y){const g=!y.before,x=y.values||[];return new lc(x,g)}(n.endAt)),iC(e,s,o,a,c,"F",u,d)}function BC(t,e){const n=function(s){switch(s){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return he()}}(e.purpose);return n==null?null:{"goog-listen-tags":n}}function Ub(t){return t.unaryFilter!==void 0?function(n){switch(n.unaryFilter.op){case"IS_NAN":const r=Rs(n.unaryFilter.field);return Ye.create(r,"==",{doubleValue:NaN});case"IS_NULL":const s=Rs(n.unaryFilter.field);return Ye.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const a=Rs(n.unaryFilter.field);return Ye.create(a,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const o=Rs(n.unaryFilter.field);return Ye.create(o,"!=",{nullValue:"NULL_VALUE"});default:return he()}}(t):t.fieldFilter!==void 0?function(n){return Ye.create(Rs(n.fieldFilter.field),function(s){switch(s){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return he()}}(n.fieldFilter.op),n.fieldFilter.value)}(t):t.compositeFilter!==void 0?function(n){return yn.create(n.compositeFilter.filters.map(r=>Ub(r)),function(s){switch(s){case"AND":return"and";case"OR":return"or";default:return he()}}(n.compositeFilter.op))}(t):he()}function $C(t){return IC[t]}function zC(t){return AC[t]}function qC(t){return kC[t]}function Ps(t){return{fieldPath:t.canonicalString()}}function Rs(t){return lt.fromServerFormat(t.fieldPath)}function Bb(t){return t instanceof Ye?function(n){if(n.op==="=="){if(hy(n.value))return{unaryFilter:{field:Ps(n.field),op:"IS_NAN"}};if(dy(n.value))return{unaryFilter:{field:Ps(n.field),op:"IS_NULL"}}}else if(n.op==="!="){if(hy(n.value))return{unaryFilter:{field:Ps(n.field),op:"IS_NOT_NAN"}};if(dy(n.value))return{unaryFilter:{field:Ps(n.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Ps(n.field),op:zC(n.op),value:n.value}}}(t):t instanceof yn?function(n){const r=n.getFilters().map(s=>Bb(s));return r.length===1?r[0]:{compositeFilter:{op:qC(n.op),filters:r}}}(t):he()}function HC(t){const e=[];return t.fields.forEach(n=>e.push(n.canonicalString())),{fieldPaths:e}}function $b(t){return t.length>=4&&t.get(0)==="projects"&&t.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nr{constructor(e,n,r,s,a=me.min(),o=me.min(),c=ht.EMPTY_BYTE_STRING,u=null){this.target=e,this.targetId=n,this.purpose=r,this.sequenceNumber=s,this.snapshotVersion=a,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=c,this.expectedCount=u}withSequenceNumber(e){return new Nr(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,n){return new Nr(this.target,this.targetId,this.purpose,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Nr(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Nr(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GC{constructor(e){this.ct=e}}function WC(t){const e=UC({parent:t.parent,structuredQuery:t.structuredQuery});return t.limitType==="LAST"?cc(e,e.limit,"L"):e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KC{constructor(){this.un=new QC}addToCollectionParentIndex(e,n){return this.un.add(n),J.resolve()}getCollectionParents(e,n){return J.resolve(this.un.getEntries(n))}addFieldIndex(e,n){return J.resolve()}deleteFieldIndex(e,n){return J.resolve()}deleteAllFieldIndexes(e){return J.resolve()}createTargetIndexes(e,n){return J.resolve()}getDocumentsMatchingTarget(e,n){return J.resolve(null)}getIndexType(e,n){return J.resolve(0)}getFieldIndexes(e,n){return J.resolve([])}getNextCollectionGroupToUpdate(e){return J.resolve(null)}getMinOffset(e,n){return J.resolve(Fr.min())}getMinOffsetFromCollectionGroup(e,n){return J.resolve(Fr.min())}updateCollectionGroup(e,n,r){return J.resolve()}updateIndexEntries(e,n){return J.resolve()}}class QC{constructor(){this.index={}}add(e){const n=e.lastSegment(),r=e.popLast(),s=this.index[n]||new ut(De.comparator),a=!s.has(r);return this.index[n]=s.add(r),a}has(e){const n=e.lastSegment(),r=e.popLast(),s=this.index[n];return s&&s.has(r)}getEntries(e){return(this.index[e]||new ut(De.comparator)).toArray()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gi{constructor(e){this.Ln=e}next(){return this.Ln+=2,this.Ln}static Bn(){return new gi(0)}static kn(){return new gi(-1)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class YC{constructor(){this.changes=new Si(e=>e.toString(),(e,n)=>e.isEqual(n)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,n){this.assertNotApplied(),this.changes.set(e,wt.newInvalidDocument(e).setReadTime(n))}getEntry(e,n){this.assertNotApplied();const r=this.changes.get(n);return r!==void 0?J.resolve(r):this.getFromCache(e,n)}getEntries(e,n){return this.getAllFromCache(e,n)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class XC{constructor(e,n){this.overlayedDocument=e,this.mutatedFields=n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class JC{constructor(e,n,r,s){this.remoteDocumentCache=e,this.mutationQueue=n,this.documentOverlayCache=r,this.indexManager=s}getDocument(e,n){let r=null;return this.documentOverlayCache.getOverlay(e,n).next(s=>(r=s,this.remoteDocumentCache.getEntry(e,n))).next(s=>(r!==null&&wa(r.mutation,s,Ht.empty(),oe.now()),s))}getDocuments(e,n){return this.remoteDocumentCache.getEntries(e,n).next(r=>this.getLocalViewOfDocuments(e,r,ye()).next(()=>r))}getLocalViewOfDocuments(e,n,r=ye()){const s=ss();return this.populateOverlays(e,s,n).next(()=>this.computeViews(e,n,s,r).next(a=>{let o=ia();return a.forEach((c,u)=>{o=o.insert(c,u.overlayedDocument)}),o}))}getOverlayedDocuments(e,n){const r=ss();return this.populateOverlays(e,r,n).next(()=>this.computeViews(e,n,r,ye()))}populateOverlays(e,n,r){const s=[];return r.forEach(a=>{n.has(a)||s.push(a)}),this.documentOverlayCache.getOverlays(e,s).next(a=>{a.forEach((o,c)=>{n.set(o,c)})})}computeViews(e,n,r,s){let a=nr();const o=ba(),c=function(){return ba()}();return n.forEach((u,d)=>{const m=r.get(d.key);s.has(d.key)&&(m===void 0||m.mutation instanceof Gr)?a=a.insert(d.key,d):m!==void 0?(o.set(d.key,m.mutation.getFieldMask()),wa(m.mutation,d,m.mutation.getFieldMask(),oe.now())):o.set(d.key,Ht.empty())}),this.recalculateAndSaveOverlays(e,a).next(u=>(u.forEach((d,m)=>o.set(d,m)),n.forEach((d,m)=>{var y;return c.set(d,new XC(m,(y=o.get(d))!==null&&y!==void 0?y:null))}),c))}recalculateAndSaveOverlays(e,n){const r=ba();let s=new Be((o,c)=>o-c),a=ye();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,n).next(o=>{for(const c of o)c.keys().forEach(u=>{const d=n.get(u);if(d===null)return;let m=r.get(u)||Ht.empty();m=c.applyToLocalView(d,m),r.set(u,m);const y=(s.get(c.batchId)||ye()).add(u);s=s.insert(c.batchId,y)})}).next(()=>{const o=[],c=s.getReverseIterator();for(;c.hasNext();){const u=c.getNext(),d=u.key,m=u.value,y=Tb();m.forEach(g=>{if(!a.has(g)){const x=kb(n.get(g),r.get(g));x!==null&&y.set(g,x),a=a.add(g)}}),o.push(this.documentOverlayCache.saveOverlays(e,d,y))}return J.waitFor(o)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,n){return this.remoteDocumentCache.getEntries(e,n).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,n,r,s){return function(o){return le.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0}(n)?this.getDocumentsMatchingDocumentQuery(e,n.path):bb(n)?this.getDocumentsMatchingCollectionGroupQuery(e,n,r,s):this.getDocumentsMatchingCollectionQuery(e,n,r,s)}getNextDocuments(e,n,r,s){return this.remoteDocumentCache.getAllFromCollectionGroup(e,n,r,s).next(a=>{const o=s-a.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,n,r.largestBatchId,s-a.size):J.resolve(ss());let c=-1,u=a;return o.next(d=>J.forEach(d,(m,y)=>(c<y.largestBatchId&&(c=y.largestBatchId),a.get(m)?J.resolve():this.remoteDocumentCache.getEntry(e,m).next(g=>{u=u.insert(m,g)}))).next(()=>this.populateOverlays(e,d,a)).next(()=>this.computeViews(e,u,d,ye())).next(m=>({batchId:c,changes:Eb(m)})))})}getDocumentsMatchingDocumentQuery(e,n){return this.getDocument(e,new le(n)).next(r=>{let s=ia();return r.isFoundDocument()&&(s=s.insert(r.key,r)),s})}getDocumentsMatchingCollectionGroupQuery(e,n,r,s){const a=n.collectionGroup;let o=ia();return this.indexManager.getCollectionParents(e,a).next(c=>J.forEach(c,u=>{const d=function(y,g){return new ji(g,null,y.explicitOrderBy.slice(),y.filters.slice(),y.limit,y.limitType,y.startAt,y.endAt)}(n,u.child(a));return this.getDocumentsMatchingCollectionQuery(e,d,r,s).next(m=>{m.forEach((y,g)=>{o=o.insert(y,g)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,n,r,s){let a;return this.documentOverlayCache.getOverlaysForCollection(e,n.path,r.largestBatchId).next(o=>(a=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,n,r,a,s))).next(o=>{a.forEach((u,d)=>{const m=d.getKey();o.get(m)===null&&(o=o.insert(m,wt.newInvalidDocument(m)))});let c=ia();return o.forEach((u,d)=>{const m=a.get(u);m!==void 0&&wa(m.mutation,d,Ht.empty(),oe.now()),Gc(n,d)&&(c=c.insert(u,d))}),c})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZC{constructor(e){this.serializer=e,this.hr=new Map,this.Pr=new Map}getBundleMetadata(e,n){return J.resolve(this.hr.get(n))}saveBundleMetadata(e,n){return this.hr.set(n.id,function(s){return{id:s.id,version:s.version,createTime:Sn(s.createTime)}}(n)),J.resolve()}getNamedQuery(e,n){return J.resolve(this.Pr.get(n))}saveNamedQuery(e,n){return this.Pr.set(n.name,function(s){return{name:s.name,query:WC(s.bundledQuery),readTime:Sn(s.readTime)}}(n)),J.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eI{constructor(){this.overlays=new Be(le.comparator),this.Ir=new Map}getOverlay(e,n){return J.resolve(this.overlays.get(n))}getOverlays(e,n){const r=ss();return J.forEach(n,s=>this.getOverlay(e,s).next(a=>{a!==null&&r.set(s,a)})).next(()=>r)}saveOverlays(e,n,r){return r.forEach((s,a)=>{this.ht(e,n,a)}),J.resolve()}removeOverlaysForBatchId(e,n,r){const s=this.Ir.get(r);return s!==void 0&&(s.forEach(a=>this.overlays=this.overlays.remove(a)),this.Ir.delete(r)),J.resolve()}getOverlaysForCollection(e,n,r){const s=ss(),a=n.length+1,o=new le(n.child("")),c=this.overlays.getIteratorFrom(o);for(;c.hasNext();){const u=c.getNext().value,d=u.getKey();if(!n.isPrefixOf(d.path))break;d.path.length===a&&u.largestBatchId>r&&s.set(u.getKey(),u)}return J.resolve(s)}getOverlaysForCollectionGroup(e,n,r,s){let a=new Be((d,m)=>d-m);const o=this.overlays.getIterator();for(;o.hasNext();){const d=o.getNext().value;if(d.getKey().getCollectionGroup()===n&&d.largestBatchId>r){let m=a.get(d.largestBatchId);m===null&&(m=ss(),a=a.insert(d.largestBatchId,m)),m.set(d.getKey(),d)}}const c=ss(),u=a.getIterator();for(;u.hasNext()&&(u.getNext().value.forEach((d,m)=>c.set(d,m)),!(c.size()>=s)););return J.resolve(c)}ht(e,n,r){const s=this.overlays.get(r.key);if(s!==null){const o=this.Ir.get(s.largestBatchId).delete(r.key);this.Ir.set(s.largestBatchId,o)}this.overlays=this.overlays.insert(r.key,new NC(n,r));let a=this.Ir.get(n);a===void 0&&(a=ye(),this.Ir.set(n,a)),this.Ir.set(n,a.add(r.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tI{constructor(){this.sessionToken=ht.EMPTY_BYTE_STRING}getSessionToken(e){return J.resolve(this.sessionToken)}setSessionToken(e,n){return this.sessionToken=n,J.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qm{constructor(){this.Tr=new ut(tt.Er),this.dr=new ut(tt.Ar)}isEmpty(){return this.Tr.isEmpty()}addReference(e,n){const r=new tt(e,n);this.Tr=this.Tr.add(r),this.dr=this.dr.add(r)}Rr(e,n){e.forEach(r=>this.addReference(r,n))}removeReference(e,n){this.Vr(new tt(e,n))}mr(e,n){e.forEach(r=>this.removeReference(r,n))}gr(e){const n=new le(new De([])),r=new tt(n,e),s=new tt(n,e+1),a=[];return this.dr.forEachInRange([r,s],o=>{this.Vr(o),a.push(o.key)}),a}pr(){this.Tr.forEach(e=>this.Vr(e))}Vr(e){this.Tr=this.Tr.delete(e),this.dr=this.dr.delete(e)}yr(e){const n=new le(new De([])),r=new tt(n,e),s=new tt(n,e+1);let a=ye();return this.dr.forEachInRange([r,s],o=>{a=a.add(o.key)}),a}containsKey(e){const n=new tt(e,0),r=this.Tr.firstAfterOrEqual(n);return r!==null&&e.isEqual(r.key)}}class tt{constructor(e,n){this.key=e,this.wr=n}static Er(e,n){return le.comparator(e.key,n.key)||Ne(e.wr,n.wr)}static Ar(e,n){return Ne(e.wr,n.wr)||le.comparator(e.key,n.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nI{constructor(e,n){this.indexManager=e,this.referenceDelegate=n,this.mutationQueue=[],this.Sr=1,this.br=new ut(tt.Er)}checkEmpty(e){return J.resolve(this.mutationQueue.length===0)}addMutationBatch(e,n,r,s){const a=this.Sr;this.Sr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const o=new _C(a,n,r,s);this.mutationQueue.push(o);for(const c of s)this.br=this.br.add(new tt(c.key,a)),this.indexManager.addToCollectionParentIndex(e,c.key.path.popLast());return J.resolve(o)}lookupMutationBatch(e,n){return J.resolve(this.Dr(n))}getNextMutationBatchAfterBatchId(e,n){const r=n+1,s=this.vr(r),a=s<0?0:s;return J.resolve(this.mutationQueue.length>a?this.mutationQueue[a]:null)}getHighestUnacknowledgedBatchId(){return J.resolve(this.mutationQueue.length===0?-1:this.Sr-1)}getAllMutationBatches(e){return J.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,n){const r=new tt(n,0),s=new tt(n,Number.POSITIVE_INFINITY),a=[];return this.br.forEachInRange([r,s],o=>{const c=this.Dr(o.wr);a.push(c)}),J.resolve(a)}getAllMutationBatchesAffectingDocumentKeys(e,n){let r=new ut(Ne);return n.forEach(s=>{const a=new tt(s,0),o=new tt(s,Number.POSITIVE_INFINITY);this.br.forEachInRange([a,o],c=>{r=r.add(c.wr)})}),J.resolve(this.Cr(r))}getAllMutationBatchesAffectingQuery(e,n){const r=n.path,s=r.length+1;let a=r;le.isDocumentKey(a)||(a=a.child(""));const o=new tt(new le(a),0);let c=new ut(Ne);return this.br.forEachWhile(u=>{const d=u.key.path;return!!r.isPrefixOf(d)&&(d.length===s&&(c=c.add(u.wr)),!0)},o),J.resolve(this.Cr(c))}Cr(e){const n=[];return e.forEach(r=>{const s=this.Dr(r);s!==null&&n.push(s)}),n}removeMutationBatch(e,n){je(this.Fr(n.batchId,"removed")===0),this.mutationQueue.shift();let r=this.br;return J.forEach(n.mutations,s=>{const a=new tt(s.key,n.batchId);return r=r.delete(a),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)}).next(()=>{this.br=r})}On(e){}containsKey(e,n){const r=new tt(n,0),s=this.br.firstAfterOrEqual(r);return J.resolve(n.isEqual(s&&s.key))}performConsistencyCheck(e){return this.mutationQueue.length,J.resolve()}Fr(e,n){return this.vr(e)}vr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Dr(e){const n=this.vr(e);return n<0||n>=this.mutationQueue.length?null:this.mutationQueue[n]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rI{constructor(e){this.Mr=e,this.docs=function(){return new Be(le.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,n){const r=n.key,s=this.docs.get(r),a=s?s.size:0,o=this.Mr(n);return this.docs=this.docs.insert(r,{document:n.mutableCopy(),size:o}),this.size+=o-a,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const n=this.docs.get(e);n&&(this.docs=this.docs.remove(e),this.size-=n.size)}getEntry(e,n){const r=this.docs.get(n);return J.resolve(r?r.document.mutableCopy():wt.newInvalidDocument(n))}getEntries(e,n){let r=nr();return n.forEach(s=>{const a=this.docs.get(s);r=r.insert(s,a?a.document.mutableCopy():wt.newInvalidDocument(s))}),J.resolve(r)}getDocumentsMatchingQuery(e,n,r,s){let a=nr();const o=n.path,c=new le(o.child("")),u=this.docs.getIteratorFrom(c);for(;u.hasNext();){const{key:d,value:{document:m}}=u.getNext();if(!o.isPrefixOf(d.path))break;d.path.length>o.length+1||U1(F1(m),r)<=0||(s.has(m.key)||Gc(n,m))&&(a=a.insert(m.key,m.mutableCopy()))}return J.resolve(a)}getAllFromCollectionGroup(e,n,r,s){he()}Or(e,n){return J.forEach(this.docs,r=>n(r))}newChangeBuffer(e){return new sI(this)}getSize(e){return J.resolve(this.size)}}class sI extends YC{constructor(e){super(),this.cr=e}applyChanges(e){const n=[];return this.changes.forEach((r,s)=>{s.isValidDocument()?n.push(this.cr.addEntry(e,s)):this.cr.removeEntry(r)}),J.waitFor(n)}getFromCache(e,n){return this.cr.getEntry(e,n)}getAllFromCache(e,n){return this.cr.getEntries(e,n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iI{constructor(e){this.persistence=e,this.Nr=new Si(n=>$m(n),zm),this.lastRemoteSnapshotVersion=me.min(),this.highestTargetId=0,this.Lr=0,this.Br=new Qm,this.targetCount=0,this.kr=gi.Bn()}forEachTarget(e,n){return this.Nr.forEach((r,s)=>n(s)),J.resolve()}getLastRemoteSnapshotVersion(e){return J.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return J.resolve(this.Lr)}allocateTargetId(e){return this.highestTargetId=this.kr.next(),J.resolve(this.highestTargetId)}setTargetsMetadata(e,n,r){return r&&(this.lastRemoteSnapshotVersion=r),n>this.Lr&&(this.Lr=n),J.resolve()}Kn(e){this.Nr.set(e.target,e);const n=e.targetId;n>this.highestTargetId&&(this.kr=new gi(n),this.highestTargetId=n),e.sequenceNumber>this.Lr&&(this.Lr=e.sequenceNumber)}addTargetData(e,n){return this.Kn(n),this.targetCount+=1,J.resolve()}updateTargetData(e,n){return this.Kn(n),J.resolve()}removeTargetData(e,n){return this.Nr.delete(n.target),this.Br.gr(n.targetId),this.targetCount-=1,J.resolve()}removeTargets(e,n,r){let s=0;const a=[];return this.Nr.forEach((o,c)=>{c.sequenceNumber<=n&&r.get(c.targetId)===null&&(this.Nr.delete(o),a.push(this.removeMatchingKeysForTargetId(e,c.targetId)),s++)}),J.waitFor(a).next(()=>s)}getTargetCount(e){return J.resolve(this.targetCount)}getTargetData(e,n){const r=this.Nr.get(n)||null;return J.resolve(r)}addMatchingKeys(e,n,r){return this.Br.Rr(n,r),J.resolve()}removeMatchingKeys(e,n,r){this.Br.mr(n,r);const s=this.persistence.referenceDelegate,a=[];return s&&n.forEach(o=>{a.push(s.markPotentiallyOrphaned(e,o))}),J.waitFor(a)}removeMatchingKeysForTargetId(e,n){return this.Br.gr(n),J.resolve()}getMatchingKeysForTargetId(e,n){const r=this.Br.yr(n);return J.resolve(r)}containsKey(e,n){return J.resolve(this.Br.containsKey(n))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aI{constructor(e,n){this.qr={},this.overlays={},this.Qr=new Vm(0),this.Kr=!1,this.Kr=!0,this.$r=new tI,this.referenceDelegate=e(this),this.Ur=new iI(this),this.indexManager=new KC,this.remoteDocumentCache=function(s){return new rI(s)}(r=>this.referenceDelegate.Wr(r)),this.serializer=new GC(n),this.Gr=new ZC(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Kr=!1,Promise.resolve()}get started(){return this.Kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let n=this.overlays[e.toKey()];return n||(n=new eI,this.overlays[e.toKey()]=n),n}getMutationQueue(e,n){let r=this.qr[e.toKey()];return r||(r=new nI(n,this.referenceDelegate),this.qr[e.toKey()]=r),r}getGlobalsCache(){return this.$r}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Gr}runTransaction(e,n,r){ae("MemoryPersistence","Starting transaction:",e);const s=new oI(this.Qr.next());return this.referenceDelegate.zr(),r(s).next(a=>this.referenceDelegate.jr(s).next(()=>a)).toPromise().then(a=>(s.raiseOnCommittedEvent(),a))}Hr(e,n){return J.or(Object.values(this.qr).map(r=>()=>r.containsKey(e,n)))}}class oI extends $1{constructor(e){super(),this.currentSequenceNumber=e}}class Ym{constructor(e){this.persistence=e,this.Jr=new Qm,this.Yr=null}static Zr(e){return new Ym(e)}get Xr(){if(this.Yr)return this.Yr;throw he()}addReference(e,n,r){return this.Jr.addReference(r,n),this.Xr.delete(r.toString()),J.resolve()}removeReference(e,n,r){return this.Jr.removeReference(r,n),this.Xr.add(r.toString()),J.resolve()}markPotentiallyOrphaned(e,n){return this.Xr.add(n.toString()),J.resolve()}removeTarget(e,n){this.Jr.gr(n.targetId).forEach(s=>this.Xr.add(s.toString()));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,n.targetId).next(s=>{s.forEach(a=>this.Xr.add(a.toString()))}).next(()=>r.removeTargetData(e,n))}zr(){this.Yr=new Set}jr(e){const n=this.persistence.getRemoteDocumentCache().newChangeBuffer();return J.forEach(this.Xr,r=>{const s=le.fromPath(r);return this.ei(e,s).next(a=>{a||n.removeEntry(s,me.min())})}).next(()=>(this.Yr=null,n.apply(e)))}updateLimboDocument(e,n){return this.ei(e,n).next(r=>{r?this.Xr.delete(n.toString()):this.Xr.add(n.toString())})}Wr(e){return 0}ei(e,n){return J.or([()=>J.resolve(this.Jr.containsKey(n)),()=>this.persistence.getTargetCache().containsKey(e,n),()=>this.persistence.Hr(e,n)])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xm{constructor(e,n,r,s){this.targetId=e,this.fromCache=n,this.$i=r,this.Ui=s}static Wi(e,n){let r=ye(),s=ye();for(const a of n.docChanges)switch(a.type){case 0:r=r.add(a.doc.key);break;case 1:s=s.add(a.doc.key)}return new Xm(e,n.fromCache,r,s)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lI{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cI{constructor(){this.Gi=!1,this.zi=!1,this.ji=100,this.Hi=function(){return XE()?8:z1(Et())>0?6:4}()}initialize(e,n){this.Ji=e,this.indexManager=n,this.Gi=!0}getDocumentsMatchingQuery(e,n,r,s){const a={result:null};return this.Yi(e,n).next(o=>{a.result=o}).next(()=>{if(!a.result)return this.Zi(e,n,s,r).next(o=>{a.result=o})}).next(()=>{if(a.result)return;const o=new lI;return this.Xi(e,n,o).next(c=>{if(a.result=c,this.zi)return this.es(e,n,o,c.size)})}).next(()=>a.result)}es(e,n,r,s){return r.documentReadCount<this.ji?(Xi()<=ve.DEBUG&&ae("QueryEngine","SDK will not create cache indexes for query:",ks(n),"since it only creates cache indexes for collection contains","more than or equal to",this.ji,"documents"),J.resolve()):(Xi()<=ve.DEBUG&&ae("QueryEngine","Query:",ks(n),"scans",r.documentReadCount,"local documents and returns",s,"documents as results."),r.documentReadCount>this.Hi*s?(Xi()<=ve.DEBUG&&ae("QueryEngine","The SDK decides to create cache indexes for query:",ks(n),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,jn(n))):J.resolve())}Yi(e,n){if(gy(n))return J.resolve(null);let r=jn(n);return this.indexManager.getIndexType(e,r).next(s=>s===0?null:(n.limit!==null&&s===1&&(n=cc(n,null,"F"),r=jn(n)),this.indexManager.getDocumentsMatchingTarget(e,r).next(a=>{const o=ye(...a);return this.Ji.getDocuments(e,o).next(c=>this.indexManager.getMinOffset(e,r).next(u=>{const d=this.ts(n,c);return this.ns(n,d,o,u.readTime)?this.Yi(e,cc(n,null,"F")):this.rs(e,d,n,u)}))})))}Zi(e,n,r,s){return gy(n)||s.isEqual(me.min())?J.resolve(null):this.Ji.getDocuments(e,r).next(a=>{const o=this.ts(n,a);return this.ns(n,o,r,s)?J.resolve(null):(Xi()<=ve.DEBUG&&ae("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),ks(n)),this.rs(e,o,n,V1(s,-1)).next(c=>c))})}ts(e,n){let r=new ut(_b(e));return n.forEach((s,a)=>{Gc(e,a)&&(r=r.add(a))}),r}ns(e,n,r,s){if(e.limit===null)return!1;if(r.size!==n.size)return!0;const a=e.limitType==="F"?n.last():n.first();return!!a&&(a.hasPendingWrites||a.version.compareTo(s)>0)}Xi(e,n,r){return Xi()<=ve.DEBUG&&ae("QueryEngine","Using full collection scan to execute query:",ks(n)),this.Ji.getDocumentsMatchingQuery(e,n,Fr.min(),r)}rs(e,n,r,s){return this.Ji.getDocumentsMatchingQuery(e,r,s).next(a=>(n.forEach(o=>{a=a.insert(o.key,o)}),a))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uI{constructor(e,n,r,s){this.persistence=e,this.ss=n,this.serializer=s,this.os=new Be(Ne),this._s=new Si(a=>$m(a),zm),this.us=new Map,this.cs=e.getRemoteDocumentCache(),this.Ur=e.getTargetCache(),this.Gr=e.getBundleCache(),this.ls(r)}ls(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new JC(this.cs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.cs.setIndexManager(this.indexManager),this.ss.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",n=>e.collect(n,this.os))}}function dI(t,e,n,r){return new uI(t,e,n,r)}async function zb(t,e){const n=fe(t);return await n.persistence.runTransaction("Handle user change","readonly",r=>{let s;return n.mutationQueue.getAllMutationBatches(r).next(a=>(s=a,n.ls(e),n.mutationQueue.getAllMutationBatches(r))).next(a=>{const o=[],c=[];let u=ye();for(const d of s){o.push(d.batchId);for(const m of d.mutations)u=u.add(m.key)}for(const d of a){c.push(d.batchId);for(const m of d.mutations)u=u.add(m.key)}return n.localDocuments.getDocuments(r,u).next(d=>({hs:d,removedBatchIds:o,addedBatchIds:c}))})})}function hI(t,e){const n=fe(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{const s=e.batch.keys(),a=n.cs.newChangeBuffer({trackRemovals:!0});return function(c,u,d,m){const y=d.batch,g=y.keys();let x=J.resolve();return g.forEach(C=>{x=x.next(()=>m.getEntry(u,C)).next(E=>{const A=d.docVersions.get(C);je(A!==null),E.version.compareTo(A)<0&&(y.applyToRemoteDocument(E,d),E.isValidDocument()&&(E.setReadTime(d.commitVersion),m.addEntry(E)))})}),x.next(()=>c.mutationQueue.removeMutationBatch(u,y))}(n,r,e,a).next(()=>a.apply(r)).next(()=>n.mutationQueue.performConsistencyCheck(r)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(r,s,e.batch.batchId)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(c){let u=ye();for(let d=0;d<c.mutationResults.length;++d)c.mutationResults[d].transformResults.length>0&&(u=u.add(c.batch.mutations[d].key));return u}(e))).next(()=>n.localDocuments.getDocuments(r,s))})}function qb(t){const e=fe(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",n=>e.Ur.getLastRemoteSnapshotVersion(n))}function mI(t,e){const n=fe(t),r=e.snapshotVersion;let s=n.os;return n.persistence.runTransaction("Apply remote event","readwrite-primary",a=>{const o=n.cs.newChangeBuffer({trackRemovals:!0});s=n.os;const c=[];e.targetChanges.forEach((m,y)=>{const g=s.get(y);if(!g)return;c.push(n.Ur.removeMatchingKeys(a,m.removedDocuments,y).next(()=>n.Ur.addMatchingKeys(a,m.addedDocuments,y)));let x=g.withSequenceNumber(a.currentSequenceNumber);e.targetMismatches.get(y)!==null?x=x.withResumeToken(ht.EMPTY_BYTE_STRING,me.min()).withLastLimboFreeSnapshotVersion(me.min()):m.resumeToken.approximateByteSize()>0&&(x=x.withResumeToken(m.resumeToken,r)),s=s.insert(y,x),function(E,A,N){return E.resumeToken.approximateByteSize()===0||A.snapshotVersion.toMicroseconds()-E.snapshotVersion.toMicroseconds()>=3e8?!0:N.addedDocuments.size+N.modifiedDocuments.size+N.removedDocuments.size>0}(g,x,m)&&c.push(n.Ur.updateTargetData(a,x))});let u=nr(),d=ye();if(e.documentUpdates.forEach(m=>{e.resolvedLimboDocuments.has(m)&&c.push(n.persistence.referenceDelegate.updateLimboDocument(a,m))}),c.push(fI(a,o,e.documentUpdates).next(m=>{u=m.Ps,d=m.Is})),!r.isEqual(me.min())){const m=n.Ur.getLastRemoteSnapshotVersion(a).next(y=>n.Ur.setTargetsMetadata(a,a.currentSequenceNumber,r));c.push(m)}return J.waitFor(c).next(()=>o.apply(a)).next(()=>n.localDocuments.getLocalViewOfDocuments(a,u,d)).next(()=>u)}).then(a=>(n.os=s,a))}function fI(t,e,n){let r=ye(),s=ye();return n.forEach(a=>r=r.add(a)),e.getEntries(t,r).next(a=>{let o=nr();return n.forEach((c,u)=>{const d=a.get(c);u.isFoundDocument()!==d.isFoundDocument()&&(s=s.add(c)),u.isNoDocument()&&u.version.isEqual(me.min())?(e.removeEntry(c,u.readTime),o=o.insert(c,u)):!d.isValidDocument()||u.version.compareTo(d.version)>0||u.version.compareTo(d.version)===0&&d.hasPendingWrites?(e.addEntry(u),o=o.insert(c,u)):ae("LocalStore","Ignoring outdated watch update for ",c,". Current version:",d.version," Watch version:",u.version)}),{Ps:o,Is:s}})}function pI(t,e){const n=fe(t);return n.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=-1),n.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function gI(t,e){const n=fe(t);return n.persistence.runTransaction("Allocate target","readwrite",r=>{let s;return n.Ur.getTargetData(r,e).next(a=>a?(s=a,J.resolve(s)):n.Ur.allocateTargetId(r).next(o=>(s=new Nr(e,o,"TargetPurposeListen",r.currentSequenceNumber),n.Ur.addTargetData(r,s).next(()=>s))))}).then(r=>{const s=n.os.get(r.targetId);return(s===null||r.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(n.os=n.os.insert(r.targetId,r),n._s.set(e,r.targetId)),r})}async function Th(t,e,n){const r=fe(t),s=r.os.get(e),a=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",a,o=>r.persistence.referenceDelegate.removeTarget(o,s))}catch(o){if(!lo(o))throw o;ae("LocalStore",`Failed to update sequence numbers for target ${e}: ${o}`)}r.os=r.os.remove(e),r._s.delete(s.target)}function Sy(t,e,n){const r=fe(t);let s=me.min(),a=ye();return r.persistence.runTransaction("Execute query","readwrite",o=>function(u,d,m){const y=fe(u),g=y._s.get(m);return g!==void 0?J.resolve(y.os.get(g)):y.Ur.getTargetData(d,m)}(r,o,jn(e)).next(c=>{if(c)return s=c.lastLimboFreeSnapshotVersion,r.Ur.getMatchingKeysForTargetId(o,c.targetId).next(u=>{a=u})}).next(()=>r.ss.getDocumentsMatchingQuery(o,e,n?s:me.min(),n?a:ye())).next(c=>(yI(r,oC(e),c),{documents:c,Ts:a})))}function yI(t,e,n){let r=t.us.get(e)||me.min();n.forEach((s,a)=>{a.readTime.compareTo(r)>0&&(r=a.readTime)}),t.us.set(e,r)}class Cy{constructor(){this.activeTargetIds=mC()}fs(e){this.activeTargetIds=this.activeTargetIds.add(e)}gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Vs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class xI{constructor(){this.so=new Cy,this.oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,n,r){}addLocalQueryTarget(e,n=!0){return n&&this.so.fs(e),this.oo[e]||"not-current"}updateQueryState(e,n,r){this.oo[e]=n}removeLocalQueryTarget(e){this.so.gs(e)}isLocalQueryTarget(e){return this.so.activeTargetIds.has(e)}clearQueryState(e){delete this.oo[e]}getAllActiveQueryTargets(){return this.so.activeTargetIds}isActiveQueryTarget(e){return this.so.activeTargetIds.has(e)}start(){return this.so=new Cy,Promise.resolve()}handleUserChange(e,n,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vI{_o(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Iy{constructor(){this.ao=()=>this.uo(),this.co=()=>this.lo(),this.ho=[],this.Po()}_o(e){this.ho.push(e)}shutdown(){window.removeEventListener("online",this.ao),window.removeEventListener("offline",this.co)}Po(){window.addEventListener("online",this.ao),window.addEventListener("offline",this.co)}uo(){ae("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.ho)e(0)}lo(){ae("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.ho)e(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let sl=null;function cd(){return sl===null?sl=function(){return 268435456+Math.round(2147483648*Math.random())}():sl++,"0x"+sl.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bI={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wI{constructor(e){this.Io=e.Io,this.To=e.To}Eo(e){this.Ao=e}Ro(e){this.Vo=e}mo(e){this.fo=e}onMessage(e){this.po=e}close(){this.To()}send(e){this.Io(e)}yo(){this.Ao()}wo(){this.Vo()}So(e){this.fo(e)}bo(e){this.po(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xt="WebChannelConnection";class _I extends class{constructor(n){this.databaseInfo=n,this.databaseId=n.databaseId;const r=n.ssl?"https":"http",s=encodeURIComponent(this.databaseId.projectId),a=encodeURIComponent(this.databaseId.database);this.Do=r+"://"+n.host,this.vo=`projects/${s}/databases/${a}`,this.Co=this.databaseId.database==="(default)"?`project_id=${s}`:`project_id=${s}&database_id=${a}`}get Fo(){return!1}Mo(n,r,s,a,o){const c=cd(),u=this.xo(n,r.toUriEncodedString());ae("RestConnection",`Sending RPC '${n}' ${c}:`,u,s);const d={"google-cloud-resource-prefix":this.vo,"x-goog-request-params":this.Co};return this.Oo(d,a,o),this.No(n,u,d,s).then(m=>(ae("RestConnection",`Received RPC '${n}' ${c}: `,m),m),m=>{throw hi("RestConnection",`RPC '${n}' ${c} failed with error: `,m,"url: ",u,"request:",s),m})}Lo(n,r,s,a,o,c){return this.Mo(n,r,s,a,o)}Oo(n,r,s){n["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+Ti}(),n["Content-Type"]="text/plain",this.databaseInfo.appId&&(n["X-Firebase-GMPID"]=this.databaseInfo.appId),r&&r.headers.forEach((a,o)=>n[o]=a),s&&s.headers.forEach((a,o)=>n[o]=a)}xo(n,r){const s=bI[n];return`${this.Do}/v1/${r}:${s}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}No(e,n,r,s){const a=cd();return new Promise((o,c)=>{const u=new sb;u.setWithCredentials(!0),u.listenOnce(ib.COMPLETE,()=>{try{switch(u.getLastErrorCode()){case _l.NO_ERROR:const m=u.getResponseJson();ae(xt,`XHR for RPC '${e}' ${a} received:`,JSON.stringify(m)),o(m);break;case _l.TIMEOUT:ae(xt,`RPC '${e}' ${a} timed out`),c(new se(X.DEADLINE_EXCEEDED,"Request time out"));break;case _l.HTTP_ERROR:const y=u.getStatus();if(ae(xt,`RPC '${e}' ${a} failed with status:`,y,"response text:",u.getResponseText()),y>0){let g=u.getResponseJson();Array.isArray(g)&&(g=g[0]);const x=g==null?void 0:g.error;if(x&&x.status&&x.message){const C=function(A){const N=A.toLowerCase().replace(/_/g,"-");return Object.values(X).indexOf(N)>=0?N:X.UNKNOWN}(x.status);c(new se(C,x.message))}else c(new se(X.UNKNOWN,"Server responded with status "+u.getStatus()))}else c(new se(X.UNAVAILABLE,"Connection failed."));break;default:he()}}finally{ae(xt,`RPC '${e}' ${a} completed.`)}});const d=JSON.stringify(s);ae(xt,`RPC '${e}' ${a} sending request:`,s),u.send(n,"POST",d,r,15)})}Bo(e,n,r){const s=cd(),a=[this.Do,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=lb(),c=ob(),u={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},d=this.longPollingOptions.timeoutSeconds;d!==void 0&&(u.longPollingTimeout=Math.round(1e3*d)),this.useFetchStreams&&(u.useFetchStreams=!0),this.Oo(u.initMessageHeaders,n,r),u.encodeInitMessageHeaders=!0;const m=a.join("");ae(xt,`Creating RPC '${e}' stream ${s}: ${m}`,u);const y=o.createWebChannel(m,u);let g=!1,x=!1;const C=new wI({Io:A=>{x?ae(xt,`Not sending because RPC '${e}' stream ${s} is closed:`,A):(g||(ae(xt,`Opening RPC '${e}' stream ${s} transport.`),y.open(),g=!0),ae(xt,`RPC '${e}' stream ${s} sending:`,A),y.send(A))},To:()=>y.close()}),E=(A,N,T)=>{A.listen(N,k=>{try{T(k)}catch(L){setTimeout(()=>{throw L},0)}})};return E(y,sa.EventType.OPEN,()=>{x||(ae(xt,`RPC '${e}' stream ${s} transport opened.`),C.yo())}),E(y,sa.EventType.CLOSE,()=>{x||(x=!0,ae(xt,`RPC '${e}' stream ${s} transport closed`),C.So())}),E(y,sa.EventType.ERROR,A=>{x||(x=!0,hi(xt,`RPC '${e}' stream ${s} transport errored:`,A),C.So(new se(X.UNAVAILABLE,"The operation could not be completed")))}),E(y,sa.EventType.MESSAGE,A=>{var N;if(!x){const T=A.data[0];je(!!T);const k=T,L=k.error||((N=k[0])===null||N===void 0?void 0:N.error);if(L){ae(xt,`RPC '${e}' stream ${s} received error:`,L);const q=L.status;let z=function(S){const p=Ke[S];if(p!==void 0)return Rb(p)}(q),j=L.message;z===void 0&&(z=X.INTERNAL,j="Unknown error status: "+q+" with message "+L.message),x=!0,C.So(new se(z,j)),y.close()}else ae(xt,`RPC '${e}' stream ${s} received:`,T),C.bo(T)}}),E(c,ab.STAT_EVENT,A=>{A.stat===ph.PROXY?ae(xt,`RPC '${e}' stream ${s} detected buffering proxy`):A.stat===ph.NOPROXY&&ae(xt,`RPC '${e}' stream ${s} detected no buffering proxy`)}),setTimeout(()=>{C.wo()},0),C}}function ud(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Yc(t){return new PC(t,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hb{constructor(e,n,r=1e3,s=1.5,a=6e4){this.ui=e,this.timerId=n,this.ko=r,this.qo=s,this.Qo=a,this.Ko=0,this.$o=null,this.Uo=Date.now(),this.reset()}reset(){this.Ko=0}Wo(){this.Ko=this.Qo}Go(e){this.cancel();const n=Math.floor(this.Ko+this.zo()),r=Math.max(0,Date.now()-this.Uo),s=Math.max(0,n-r);s>0&&ae("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.Ko} ms, delay with jitter: ${n} ms, last attempt: ${r} ms ago)`),this.$o=this.ui.enqueueAfterDelay(this.timerId,s,()=>(this.Uo=Date.now(),e())),this.Ko*=this.qo,this.Ko<this.ko&&(this.Ko=this.ko),this.Ko>this.Qo&&(this.Ko=this.Qo)}jo(){this.$o!==null&&(this.$o.skipDelay(),this.$o=null)}cancel(){this.$o!==null&&(this.$o.cancel(),this.$o=null)}zo(){return(Math.random()-.5)*this.Ko}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gb{constructor(e,n,r,s,a,o,c,u){this.ui=e,this.Ho=r,this.Jo=s,this.connection=a,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=c,this.listener=u,this.state=0,this.Yo=0,this.Zo=null,this.Xo=null,this.stream=null,this.e_=0,this.t_=new Hb(e,n)}n_(){return this.state===1||this.state===5||this.r_()}r_(){return this.state===2||this.state===3}start(){this.e_=0,this.state!==4?this.auth():this.i_()}async stop(){this.n_()&&await this.close(0)}s_(){this.state=0,this.t_.reset()}o_(){this.r_()&&this.Zo===null&&(this.Zo=this.ui.enqueueAfterDelay(this.Ho,6e4,()=>this.__()))}a_(e){this.u_(),this.stream.send(e)}async __(){if(this.r_())return this.close(0)}u_(){this.Zo&&(this.Zo.cancel(),this.Zo=null)}c_(){this.Xo&&(this.Xo.cancel(),this.Xo=null)}async close(e,n){this.u_(),this.c_(),this.t_.cancel(),this.Yo++,e!==4?this.t_.reset():n&&n.code===X.RESOURCE_EXHAUSTED?(tr(n.toString()),tr("Using maximum backoff delay to prevent overloading the backend."),this.t_.Wo()):n&&n.code===X.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.l_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.mo(n)}l_(){}auth(){this.state=1;const e=this.h_(this.Yo),n=this.Yo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,s])=>{this.Yo===n&&this.P_(r,s)},r=>{e(()=>{const s=new se(X.UNKNOWN,"Fetching auth token failed: "+r.message);return this.I_(s)})})}P_(e,n){const r=this.h_(this.Yo);this.stream=this.T_(e,n),this.stream.Eo(()=>{r(()=>this.listener.Eo())}),this.stream.Ro(()=>{r(()=>(this.state=2,this.Xo=this.ui.enqueueAfterDelay(this.Jo,1e4,()=>(this.r_()&&(this.state=3),Promise.resolve())),this.listener.Ro()))}),this.stream.mo(s=>{r(()=>this.I_(s))}),this.stream.onMessage(s=>{r(()=>++this.e_==1?this.E_(s):this.onNext(s))})}i_(){this.state=5,this.t_.Go(async()=>{this.state=0,this.start()})}I_(e){return ae("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}h_(e){return n=>{this.ui.enqueueAndForget(()=>this.Yo===e?n():(ae("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class NI extends Gb{constructor(e,n,r,s,a,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",n,r,s,o),this.serializer=a}T_(e,n){return this.connection.Bo("Listen",e,n)}E_(e){return this.onNext(e)}onNext(e){this.t_.reset();const n=MC(this.serializer,e),r=function(a){if(!("targetChange"in a))return me.min();const o=a.targetChange;return o.targetIds&&o.targetIds.length?me.min():o.readTime?Sn(o.readTime):me.min()}(e);return this.listener.d_(n,r)}A_(e){const n={};n.database=Eh(this.serializer),n.addTarget=function(a,o){let c;const u=o.target;if(c=vh(u)?{documents:VC(a,u)}:{query:FC(a,u)._t},c.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){c.resumeToken=Ob(a,o.resumeToken);const d=wh(a,o.expectedCount);d!==null&&(c.expectedCount=d)}else if(o.snapshotVersion.compareTo(me.min())>0){c.readTime=hc(a,o.snapshotVersion.toTimestamp());const d=wh(a,o.expectedCount);d!==null&&(c.expectedCount=d)}return c}(this.serializer,e);const r=BC(this.serializer,e);r&&(n.labels=r),this.a_(n)}R_(e){const n={};n.database=Eh(this.serializer),n.removeTarget=e,this.a_(n)}}class EI extends Gb{constructor(e,n,r,s,a,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",n,r,s,o),this.serializer=a}get V_(){return this.e_>0}start(){this.lastStreamToken=void 0,super.start()}l_(){this.V_&&this.m_([])}T_(e,n){return this.connection.Bo("Write",e,n)}E_(e){return je(!!e.streamToken),this.lastStreamToken=e.streamToken,je(!e.writeResults||e.writeResults.length===0),this.listener.f_()}onNext(e){je(!!e.streamToken),this.lastStreamToken=e.streamToken,this.t_.reset();const n=LC(e.writeResults,e.commitTime),r=Sn(e.commitTime);return this.listener.g_(r,n)}p_(){const e={};e.database=Eh(this.serializer),this.a_(e)}m_(e){const n={streamToken:this.lastStreamToken,writes:e.map(r=>OC(this.serializer,r))};this.a_(n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TI extends class{}{constructor(e,n,r,s){super(),this.authCredentials=e,this.appCheckCredentials=n,this.connection=r,this.serializer=s,this.y_=!1}w_(){if(this.y_)throw new se(X.FAILED_PRECONDITION,"The client has already been terminated.")}Mo(e,n,r,s){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([a,o])=>this.connection.Mo(e,_h(n,r),s,a,o)).catch(a=>{throw a.name==="FirebaseError"?(a.code===X.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new se(X.UNKNOWN,a.toString())})}Lo(e,n,r,s,a){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,c])=>this.connection.Lo(e,_h(n,r),s,o,c,a)).catch(o=>{throw o.name==="FirebaseError"?(o.code===X.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new se(X.UNKNOWN,o.toString())})}terminate(){this.y_=!0,this.connection.terminate()}}class jI{constructor(e,n){this.asyncQueue=e,this.onlineStateHandler=n,this.state="Unknown",this.S_=0,this.b_=null,this.D_=!0}v_(){this.S_===0&&(this.C_("Unknown"),this.b_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.b_=null,this.F_("Backend didn't respond within 10 seconds."),this.C_("Offline"),Promise.resolve())))}M_(e){this.state==="Online"?this.C_("Unknown"):(this.S_++,this.S_>=1&&(this.x_(),this.F_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.C_("Offline")))}set(e){this.x_(),this.S_=0,e==="Online"&&(this.D_=!1),this.C_(e)}C_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}F_(e){const n=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.D_?(tr(n),this.D_=!1):ae("OnlineStateTracker",n)}x_(){this.b_!==null&&(this.b_.cancel(),this.b_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SI{constructor(e,n,r,s,a){this.localStore=e,this.datastore=n,this.asyncQueue=r,this.remoteSyncer={},this.O_=[],this.N_=new Map,this.L_=new Set,this.B_=[],this.k_=a,this.k_._o(o=>{r.enqueueAndForget(async()=>{Ts(this)&&(ae("RemoteStore","Restarting streams for network reachability change."),await async function(u){const d=fe(u);d.L_.add(4),await ho(d),d.q_.set("Unknown"),d.L_.delete(4),await Xc(d)}(this))})}),this.q_=new jI(r,s)}}async function Xc(t){if(Ts(t))for(const e of t.B_)await e(!0)}async function ho(t){for(const e of t.B_)await e(!1)}function Wb(t,e){const n=fe(t);n.N_.has(e.targetId)||(n.N_.set(e.targetId,e),tf(n)?ef(n):Ci(n).r_()&&Zm(n,e))}function Jm(t,e){const n=fe(t),r=Ci(n);n.N_.delete(e),r.r_()&&Kb(n,e),n.N_.size===0&&(r.r_()?r.o_():Ts(n)&&n.q_.set("Unknown"))}function Zm(t,e){if(t.Q_.xe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(me.min())>0){const n=t.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(n)}Ci(t).A_(e)}function Kb(t,e){t.Q_.xe(e),Ci(t).R_(e)}function ef(t){t.Q_=new CC({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),ot:e=>t.N_.get(e)||null,tt:()=>t.datastore.serializer.databaseId}),Ci(t).start(),t.q_.v_()}function tf(t){return Ts(t)&&!Ci(t).n_()&&t.N_.size>0}function Ts(t){return fe(t).L_.size===0}function Qb(t){t.Q_=void 0}async function CI(t){t.q_.set("Online")}async function II(t){t.N_.forEach((e,n)=>{Zm(t,e)})}async function AI(t,e){Qb(t),tf(t)?(t.q_.M_(e),ef(t)):t.q_.set("Unknown")}async function kI(t,e,n){if(t.q_.set("Online"),e instanceof Mb&&e.state===2&&e.cause)try{await async function(s,a){const o=a.cause;for(const c of a.targetIds)s.N_.has(c)&&(await s.remoteSyncer.rejectListen(c,o),s.N_.delete(c),s.Q_.removeTarget(c))}(t,e)}catch(r){ae("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),await mc(t,r)}else if(e instanceof Tl?t.Q_.Ke(e):e instanceof Db?t.Q_.He(e):t.Q_.We(e),!n.isEqual(me.min()))try{const r=await qb(t.localStore);n.compareTo(r)>=0&&await function(a,o){const c=a.Q_.rt(o);return c.targetChanges.forEach((u,d)=>{if(u.resumeToken.approximateByteSize()>0){const m=a.N_.get(d);m&&a.N_.set(d,m.withResumeToken(u.resumeToken,o))}}),c.targetMismatches.forEach((u,d)=>{const m=a.N_.get(u);if(!m)return;a.N_.set(u,m.withResumeToken(ht.EMPTY_BYTE_STRING,m.snapshotVersion)),Kb(a,u);const y=new Nr(m.target,u,d,m.sequenceNumber);Zm(a,y)}),a.remoteSyncer.applyRemoteEvent(c)}(t,n)}catch(r){ae("RemoteStore","Failed to raise snapshot:",r),await mc(t,r)}}async function mc(t,e,n){if(!lo(e))throw e;t.L_.add(1),await ho(t),t.q_.set("Offline"),n||(n=()=>qb(t.localStore)),t.asyncQueue.enqueueRetryable(async()=>{ae("RemoteStore","Retrying IndexedDB access"),await n(),t.L_.delete(1),await Xc(t)})}function Yb(t,e){return e().catch(n=>mc(t,n,e))}async function Jc(t){const e=fe(t),n=Br(e);let r=e.O_.length>0?e.O_[e.O_.length-1].batchId:-1;for(;PI(e);)try{const s=await pI(e.localStore,r);if(s===null){e.O_.length===0&&n.o_();break}r=s.batchId,RI(e,s)}catch(s){await mc(e,s)}Xb(e)&&Jb(e)}function PI(t){return Ts(t)&&t.O_.length<10}function RI(t,e){t.O_.push(e);const n=Br(t);n.r_()&&n.V_&&n.m_(e.mutations)}function Xb(t){return Ts(t)&&!Br(t).n_()&&t.O_.length>0}function Jb(t){Br(t).start()}async function DI(t){Br(t).p_()}async function MI(t){const e=Br(t);for(const n of t.O_)e.m_(n.mutations)}async function OI(t,e,n){const r=t.O_.shift(),s=Gm.from(r,e,n);await Yb(t,()=>t.remoteSyncer.applySuccessfulWrite(s)),await Jc(t)}async function LI(t,e){e&&Br(t).V_&&await async function(r,s){if(function(o){return TC(o)&&o!==X.ABORTED}(s.code)){const a=r.O_.shift();Br(r).s_(),await Yb(r,()=>r.remoteSyncer.rejectFailedWrite(a.batchId,s)),await Jc(r)}}(t,e),Xb(t)&&Jb(t)}async function Ay(t,e){const n=fe(t);n.asyncQueue.verifyOperationInProgress(),ae("RemoteStore","RemoteStore received new credentials");const r=Ts(n);n.L_.add(3),await ho(n),r&&n.q_.set("Unknown"),await n.remoteSyncer.handleCredentialChange(e),n.L_.delete(3),await Xc(n)}async function VI(t,e){const n=fe(t);e?(n.L_.delete(2),await Xc(n)):e||(n.L_.add(2),await ho(n),n.q_.set("Unknown"))}function Ci(t){return t.K_||(t.K_=function(n,r,s){const a=fe(n);return a.w_(),new NI(r,a.connection,a.authCredentials,a.appCheckCredentials,a.serializer,s)}(t.datastore,t.asyncQueue,{Eo:CI.bind(null,t),Ro:II.bind(null,t),mo:AI.bind(null,t),d_:kI.bind(null,t)}),t.B_.push(async e=>{e?(t.K_.s_(),tf(t)?ef(t):t.q_.set("Unknown")):(await t.K_.stop(),Qb(t))})),t.K_}function Br(t){return t.U_||(t.U_=function(n,r,s){const a=fe(n);return a.w_(),new EI(r,a.connection,a.authCredentials,a.appCheckCredentials,a.serializer,s)}(t.datastore,t.asyncQueue,{Eo:()=>Promise.resolve(),Ro:DI.bind(null,t),mo:LI.bind(null,t),f_:MI.bind(null,t),g_:OI.bind(null,t)}),t.B_.push(async e=>{e?(t.U_.s_(),await Jc(t)):(await t.U_.stop(),t.O_.length>0&&(ae("RemoteStore",`Stopping write stream with ${t.O_.length} pending writes`),t.O_=[]))})),t.U_}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nf{constructor(e,n,r,s,a){this.asyncQueue=e,this.timerId=n,this.targetTimeMs=r,this.op=s,this.removalCallback=a,this.deferred=new Wn,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,n,r,s,a){const o=Date.now()+r,c=new nf(e,n,o,s,a);return c.start(r),c}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new se(X.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function rf(t,e){if(tr("AsyncQueue",`${e}: ${t}`),lo(t))return new se(X.UNAVAILABLE,`${e}: ${t}`);throw t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ni{constructor(e){this.comparator=e?(n,r)=>e(n,r)||le.comparator(n.key,r.key):(n,r)=>le.comparator(n.key,r.key),this.keyedMap=ia(),this.sortedSet=new Be(this.comparator)}static emptySet(e){return new ni(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const n=this.keyedMap.get(e);return n?this.sortedSet.indexOf(n):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((n,r)=>(e(n),!1))}add(e){const n=this.delete(e.key);return n.copy(n.keyedMap.insert(e.key,e),n.sortedSet.insert(e,null))}delete(e){const n=this.get(e);return n?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(n)):this}isEqual(e){if(!(e instanceof ni)||this.size!==e.size)return!1;const n=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;n.hasNext();){const s=n.getNext().key,a=r.getNext().key;if(!s.isEqual(a))return!1}return!0}toString(){const e=[];return this.forEach(n=>{e.push(n.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,n){const r=new ni;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=n,r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ky{constructor(){this.W_=new Be(le.comparator)}track(e){const n=e.doc.key,r=this.W_.get(n);r?e.type!==0&&r.type===3?this.W_=this.W_.insert(n,e):e.type===3&&r.type!==1?this.W_=this.W_.insert(n,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.W_=this.W_.insert(n,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.W_=this.W_.insert(n,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.W_=this.W_.remove(n):e.type===1&&r.type===2?this.W_=this.W_.insert(n,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.W_=this.W_.insert(n,{type:2,doc:e.doc}):he():this.W_=this.W_.insert(n,e)}G_(){const e=[];return this.W_.inorderTraversal((n,r)=>{e.push(r)}),e}}class yi{constructor(e,n,r,s,a,o,c,u,d){this.query=e,this.docs=n,this.oldDocs=r,this.docChanges=s,this.mutatedKeys=a,this.fromCache=o,this.syncStateChanged=c,this.excludesMetadataChanges=u,this.hasCachedResults=d}static fromInitialDocuments(e,n,r,s,a){const o=[];return n.forEach(c=>{o.push({type:0,doc:c})}),new yi(e,n,ni.emptySet(n),o,r,s,!0,!1,a)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Hc(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const n=this.docChanges,r=e.docChanges;if(n.length!==r.length)return!1;for(let s=0;s<n.length;s++)if(n[s].type!==r[s].type||!n[s].doc.isEqual(r[s].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FI{constructor(){this.z_=void 0,this.j_=[]}H_(){return this.j_.some(e=>e.J_())}}class UI{constructor(){this.queries=Py(),this.onlineState="Unknown",this.Y_=new Set}terminate(){(function(n,r){const s=fe(n),a=s.queries;s.queries=Py(),a.forEach((o,c)=>{for(const u of c.j_)u.onError(r)})})(this,new se(X.ABORTED,"Firestore shutting down"))}}function Py(){return new Si(t=>wb(t),Hc)}async function sf(t,e){const n=fe(t);let r=3;const s=e.query;let a=n.queries.get(s);a?!a.H_()&&e.J_()&&(r=2):(a=new FI,r=e.J_()?0:1);try{switch(r){case 0:a.z_=await n.onListen(s,!0);break;case 1:a.z_=await n.onListen(s,!1);break;case 2:await n.onFirstRemoteStoreListen(s)}}catch(o){const c=rf(o,`Initialization of query '${ks(e.query)}' failed`);return void e.onError(c)}n.queries.set(s,a),a.j_.push(e),e.Z_(n.onlineState),a.z_&&e.X_(a.z_)&&of(n)}async function af(t,e){const n=fe(t),r=e.query;let s=3;const a=n.queries.get(r);if(a){const o=a.j_.indexOf(e);o>=0&&(a.j_.splice(o,1),a.j_.length===0?s=e.J_()?0:1:!a.H_()&&e.J_()&&(s=2))}switch(s){case 0:return n.queries.delete(r),n.onUnlisten(r,!0);case 1:return n.queries.delete(r),n.onUnlisten(r,!1);case 2:return n.onLastRemoteStoreUnlisten(r);default:return}}function BI(t,e){const n=fe(t);let r=!1;for(const s of e){const a=s.query,o=n.queries.get(a);if(o){for(const c of o.j_)c.X_(s)&&(r=!0);o.z_=s}}r&&of(n)}function $I(t,e,n){const r=fe(t),s=r.queries.get(e);if(s)for(const a of s.j_)a.onError(n);r.queries.delete(e)}function of(t){t.Y_.forEach(e=>{e.next()})}var jh,Ry;(Ry=jh||(jh={})).ea="default",Ry.Cache="cache";class lf{constructor(e,n,r){this.query=e,this.ta=n,this.na=!1,this.ra=null,this.onlineState="Unknown",this.options=r||{}}X_(e){if(!this.options.includeMetadataChanges){const r=[];for(const s of e.docChanges)s.type!==3&&r.push(s);e=new yi(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let n=!1;return this.na?this.ia(e)&&(this.ta.next(e),n=!0):this.sa(e,this.onlineState)&&(this.oa(e),n=!0),this.ra=e,n}onError(e){this.ta.error(e)}Z_(e){this.onlineState=e;let n=!1;return this.ra&&!this.na&&this.sa(this.ra,e)&&(this.oa(this.ra),n=!0),n}sa(e,n){if(!e.fromCache||!this.J_())return!0;const r=n!=="Offline";return(!this.options._a||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||n==="Offline")}ia(e){if(e.docChanges.length>0)return!0;const n=this.ra&&this.ra.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!n)&&this.options.includeMetadataChanges===!0}oa(e){e=yi.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.na=!0,this.ta.next(e)}J_(){return this.options.source!==jh.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zb{constructor(e){this.key=e}}class ew{constructor(e){this.key=e}}class zI{constructor(e,n){this.query=e,this.Ta=n,this.Ea=null,this.hasCachedResults=!1,this.current=!1,this.da=ye(),this.mutatedKeys=ye(),this.Aa=_b(e),this.Ra=new ni(this.Aa)}get Va(){return this.Ta}ma(e,n){const r=n?n.fa:new ky,s=n?n.Ra:this.Ra;let a=n?n.mutatedKeys:this.mutatedKeys,o=s,c=!1;const u=this.query.limitType==="F"&&s.size===this.query.limit?s.last():null,d=this.query.limitType==="L"&&s.size===this.query.limit?s.first():null;if(e.inorderTraversal((m,y)=>{const g=s.get(m),x=Gc(this.query,y)?y:null,C=!!g&&this.mutatedKeys.has(g.key),E=!!x&&(x.hasLocalMutations||this.mutatedKeys.has(x.key)&&x.hasCommittedMutations);let A=!1;g&&x?g.data.isEqual(x.data)?C!==E&&(r.track({type:3,doc:x}),A=!0):this.ga(g,x)||(r.track({type:2,doc:x}),A=!0,(u&&this.Aa(x,u)>0||d&&this.Aa(x,d)<0)&&(c=!0)):!g&&x?(r.track({type:0,doc:x}),A=!0):g&&!x&&(r.track({type:1,doc:g}),A=!0,(u||d)&&(c=!0)),A&&(x?(o=o.add(x),a=E?a.add(m):a.delete(m)):(o=o.delete(m),a=a.delete(m)))}),this.query.limit!==null)for(;o.size>this.query.limit;){const m=this.query.limitType==="F"?o.last():o.first();o=o.delete(m.key),a=a.delete(m.key),r.track({type:1,doc:m})}return{Ra:o,fa:r,ns:c,mutatedKeys:a}}ga(e,n){return e.hasLocalMutations&&n.hasCommittedMutations&&!n.hasLocalMutations}applyChanges(e,n,r,s){const a=this.Ra;this.Ra=e.Ra,this.mutatedKeys=e.mutatedKeys;const o=e.fa.G_();o.sort((m,y)=>function(x,C){const E=A=>{switch(A){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return he()}};return E(x)-E(C)}(m.type,y.type)||this.Aa(m.doc,y.doc)),this.pa(r),s=s!=null&&s;const c=n&&!s?this.ya():[],u=this.da.size===0&&this.current&&!s?1:0,d=u!==this.Ea;return this.Ea=u,o.length!==0||d?{snapshot:new yi(this.query,e.Ra,a,o,e.mutatedKeys,u===0,d,!1,!!r&&r.resumeToken.approximateByteSize()>0),wa:c}:{wa:c}}Z_(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({Ra:this.Ra,fa:new ky,mutatedKeys:this.mutatedKeys,ns:!1},!1)):{wa:[]}}Sa(e){return!this.Ta.has(e)&&!!this.Ra.has(e)&&!this.Ra.get(e).hasLocalMutations}pa(e){e&&(e.addedDocuments.forEach(n=>this.Ta=this.Ta.add(n)),e.modifiedDocuments.forEach(n=>{}),e.removedDocuments.forEach(n=>this.Ta=this.Ta.delete(n)),this.current=e.current)}ya(){if(!this.current)return[];const e=this.da;this.da=ye(),this.Ra.forEach(r=>{this.Sa(r.key)&&(this.da=this.da.add(r.key))});const n=[];return e.forEach(r=>{this.da.has(r)||n.push(new ew(r))}),this.da.forEach(r=>{e.has(r)||n.push(new Zb(r))}),n}ba(e){this.Ta=e.Ts,this.da=ye();const n=this.ma(e.documents);return this.applyChanges(n,!0)}Da(){return yi.fromInitialDocuments(this.query,this.Ra,this.mutatedKeys,this.Ea===0,this.hasCachedResults)}}class qI{constructor(e,n,r){this.query=e,this.targetId=n,this.view=r}}class HI{constructor(e){this.key=e,this.va=!1}}class GI{constructor(e,n,r,s,a,o){this.localStore=e,this.remoteStore=n,this.eventManager=r,this.sharedClientState=s,this.currentUser=a,this.maxConcurrentLimboResolutions=o,this.Ca={},this.Fa=new Si(c=>wb(c),Hc),this.Ma=new Map,this.xa=new Set,this.Oa=new Be(le.comparator),this.Na=new Map,this.La=new Qm,this.Ba={},this.ka=new Map,this.qa=gi.kn(),this.onlineState="Unknown",this.Qa=void 0}get isPrimaryClient(){return this.Qa===!0}}async function WI(t,e,n=!0){const r=aw(t);let s;const a=r.Fa.get(e);return a?(r.sharedClientState.addLocalQueryTarget(a.targetId),s=a.view.Da()):s=await tw(r,e,n,!0),s}async function KI(t,e){const n=aw(t);await tw(n,e,!0,!1)}async function tw(t,e,n,r){const s=await gI(t.localStore,jn(e)),a=s.targetId,o=t.sharedClientState.addLocalQueryTarget(a,n);let c;return r&&(c=await QI(t,e,a,o==="current",s.resumeToken)),t.isPrimaryClient&&n&&Wb(t.remoteStore,s),c}async function QI(t,e,n,r,s){t.Ka=(y,g,x)=>async function(E,A,N,T){let k=A.view.ma(N);k.ns&&(k=await Sy(E.localStore,A.query,!1).then(({documents:j})=>A.view.ma(j,k)));const L=T&&T.targetChanges.get(A.targetId),q=T&&T.targetMismatches.get(A.targetId)!=null,z=A.view.applyChanges(k,E.isPrimaryClient,L,q);return My(E,A.targetId,z.wa),z.snapshot}(t,y,g,x);const a=await Sy(t.localStore,e,!0),o=new zI(e,a.Ts),c=o.ma(a.documents),u=uo.createSynthesizedTargetChangeForCurrentChange(n,r&&t.onlineState!=="Offline",s),d=o.applyChanges(c,t.isPrimaryClient,u);My(t,n,d.wa);const m=new qI(e,n,o);return t.Fa.set(e,m),t.Ma.has(n)?t.Ma.get(n).push(e):t.Ma.set(n,[e]),d.snapshot}async function YI(t,e,n){const r=fe(t),s=r.Fa.get(e),a=r.Ma.get(s.targetId);if(a.length>1)return r.Ma.set(s.targetId,a.filter(o=>!Hc(o,e))),void r.Fa.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(s.targetId),r.sharedClientState.isActiveQueryTarget(s.targetId)||await Th(r.localStore,s.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(s.targetId),n&&Jm(r.remoteStore,s.targetId),Sh(r,s.targetId)}).catch(oo)):(Sh(r,s.targetId),await Th(r.localStore,s.targetId,!0))}async function XI(t,e){const n=fe(t),r=n.Fa.get(e),s=n.Ma.get(r.targetId);n.isPrimaryClient&&s.length===1&&(n.sharedClientState.removeLocalQueryTarget(r.targetId),Jm(n.remoteStore,r.targetId))}async function JI(t,e,n){const r=iA(t);try{const s=await function(o,c){const u=fe(o),d=oe.now(),m=c.reduce((x,C)=>x.add(C.key),ye());let y,g;return u.persistence.runTransaction("Locally write mutations","readwrite",x=>{let C=nr(),E=ye();return u.cs.getEntries(x,m).next(A=>{C=A,C.forEach((N,T)=>{T.isValidDocument()||(E=E.add(N))})}).next(()=>u.localDocuments.getOverlayedDocuments(x,C)).next(A=>{y=A;const N=[];for(const T of c){const k=bC(T,y.get(T.key).overlayedDocument);k!=null&&N.push(new Gr(T.key,k,mb(k.value.mapValue),nn.exists(!0)))}return u.mutationQueue.addMutationBatch(x,d,N,c)}).next(A=>{g=A;const N=A.applyToLocalDocumentSet(y,E);return u.documentOverlayCache.saveOverlays(x,A.batchId,N)})}).then(()=>({batchId:g.batchId,changes:Eb(y)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(s.batchId),function(o,c,u){let d=o.Ba[o.currentUser.toKey()];d||(d=new Be(Ne)),d=d.insert(c,u),o.Ba[o.currentUser.toKey()]=d}(r,s.batchId,n),await mo(r,s.changes),await Jc(r.remoteStore)}catch(s){const a=rf(s,"Failed to persist write");n.reject(a)}}async function nw(t,e){const n=fe(t);try{const r=await mI(n.localStore,e);e.targetChanges.forEach((s,a)=>{const o=n.Na.get(a);o&&(je(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1),s.addedDocuments.size>0?o.va=!0:s.modifiedDocuments.size>0?je(o.va):s.removedDocuments.size>0&&(je(o.va),o.va=!1))}),await mo(n,r,e)}catch(r){await oo(r)}}function Dy(t,e,n){const r=fe(t);if(r.isPrimaryClient&&n===0||!r.isPrimaryClient&&n===1){const s=[];r.Fa.forEach((a,o)=>{const c=o.view.Z_(e);c.snapshot&&s.push(c.snapshot)}),function(o,c){const u=fe(o);u.onlineState=c;let d=!1;u.queries.forEach((m,y)=>{for(const g of y.j_)g.Z_(c)&&(d=!0)}),d&&of(u)}(r.eventManager,e),s.length&&r.Ca.d_(s),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function ZI(t,e,n){const r=fe(t);r.sharedClientState.updateQueryState(e,"rejected",n);const s=r.Na.get(e),a=s&&s.key;if(a){let o=new Be(le.comparator);o=o.insert(a,wt.newNoDocument(a,me.min()));const c=ye().add(a),u=new Qc(me.min(),new Map,new Be(Ne),o,c);await nw(r,u),r.Oa=r.Oa.remove(a),r.Na.delete(e),cf(r)}else await Th(r.localStore,e,!1).then(()=>Sh(r,e,n)).catch(oo)}async function eA(t,e){const n=fe(t),r=e.batch.batchId;try{const s=await hI(n.localStore,e);sw(n,r,null),rw(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await mo(n,s)}catch(s){await oo(s)}}async function tA(t,e,n){const r=fe(t);try{const s=await function(o,c){const u=fe(o);return u.persistence.runTransaction("Reject batch","readwrite-primary",d=>{let m;return u.mutationQueue.lookupMutationBatch(d,c).next(y=>(je(y!==null),m=y.keys(),u.mutationQueue.removeMutationBatch(d,y))).next(()=>u.mutationQueue.performConsistencyCheck(d)).next(()=>u.documentOverlayCache.removeOverlaysForBatchId(d,m,c)).next(()=>u.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(d,m)).next(()=>u.localDocuments.getDocuments(d,m))})}(r.localStore,e);sw(r,e,n),rw(r,e),r.sharedClientState.updateMutationState(e,"rejected",n),await mo(r,s)}catch(s){await oo(s)}}function rw(t,e){(t.ka.get(e)||[]).forEach(n=>{n.resolve()}),t.ka.delete(e)}function sw(t,e,n){const r=fe(t);let s=r.Ba[r.currentUser.toKey()];if(s){const a=s.get(e);a&&(n?a.reject(n):a.resolve(),s=s.remove(e)),r.Ba[r.currentUser.toKey()]=s}}function Sh(t,e,n=null){t.sharedClientState.removeLocalQueryTarget(e);for(const r of t.Ma.get(e))t.Fa.delete(r),n&&t.Ca.$a(r,n);t.Ma.delete(e),t.isPrimaryClient&&t.La.gr(e).forEach(r=>{t.La.containsKey(r)||iw(t,r)})}function iw(t,e){t.xa.delete(e.path.canonicalString());const n=t.Oa.get(e);n!==null&&(Jm(t.remoteStore,n),t.Oa=t.Oa.remove(e),t.Na.delete(n),cf(t))}function My(t,e,n){for(const r of n)r instanceof Zb?(t.La.addReference(r.key,e),nA(t,r)):r instanceof ew?(ae("SyncEngine","Document no longer in limbo: "+r.key),t.La.removeReference(r.key,e),t.La.containsKey(r.key)||iw(t,r.key)):he()}function nA(t,e){const n=e.key,r=n.path.canonicalString();t.Oa.get(n)||t.xa.has(r)||(ae("SyncEngine","New document in limbo: "+n),t.xa.add(r),cf(t))}function cf(t){for(;t.xa.size>0&&t.Oa.size<t.maxConcurrentLimboResolutions;){const e=t.xa.values().next().value;t.xa.delete(e);const n=new le(De.fromString(e)),r=t.qa.next();t.Na.set(r,new HI(n)),t.Oa=t.Oa.insert(n,r),Wb(t.remoteStore,new Nr(jn(qc(n.path)),r,"TargetPurposeLimboResolution",Vm.oe))}}async function mo(t,e,n){const r=fe(t),s=[],a=[],o=[];r.Fa.isEmpty()||(r.Fa.forEach((c,u)=>{o.push(r.Ka(u,e,n).then(d=>{var m;if((d||n)&&r.isPrimaryClient){const y=d?!d.fromCache:(m=n==null?void 0:n.targetChanges.get(u.targetId))===null||m===void 0?void 0:m.current;r.sharedClientState.updateQueryState(u.targetId,y?"current":"not-current")}if(d){s.push(d);const y=Xm.Wi(u.targetId,d);a.push(y)}}))}),await Promise.all(o),r.Ca.d_(s),await async function(u,d){const m=fe(u);try{await m.persistence.runTransaction("notifyLocalViewChanges","readwrite",y=>J.forEach(d,g=>J.forEach(g.$i,x=>m.persistence.referenceDelegate.addReference(y,g.targetId,x)).next(()=>J.forEach(g.Ui,x=>m.persistence.referenceDelegate.removeReference(y,g.targetId,x)))))}catch(y){if(!lo(y))throw y;ae("LocalStore","Failed to update sequence numbers: "+y)}for(const y of d){const g=y.targetId;if(!y.fromCache){const x=m.os.get(g),C=x.snapshotVersion,E=x.withLastLimboFreeSnapshotVersion(C);m.os=m.os.insert(g,E)}}}(r.localStore,a))}async function rA(t,e){const n=fe(t);if(!n.currentUser.isEqual(e)){ae("SyncEngine","User change. New user:",e.toKey());const r=await zb(n.localStore,e);n.currentUser=e,function(a,o){a.ka.forEach(c=>{c.forEach(u=>{u.reject(new se(X.CANCELLED,o))})}),a.ka.clear()}(n,"'waitForPendingWrites' promise is rejected due to a user change."),n.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await mo(n,r.hs)}}function sA(t,e){const n=fe(t),r=n.Na.get(e);if(r&&r.va)return ye().add(r.key);{let s=ye();const a=n.Ma.get(e);if(!a)return s;for(const o of a){const c=n.Fa.get(o);s=s.unionWith(c.view.Va)}return s}}function aw(t){const e=fe(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=nw.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=sA.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=ZI.bind(null,e),e.Ca.d_=BI.bind(null,e.eventManager),e.Ca.$a=$I.bind(null,e.eventManager),e}function iA(t){const e=fe(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=eA.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=tA.bind(null,e),e}class fc{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=Yc(e.databaseInfo.databaseId),this.sharedClientState=this.Wa(e),this.persistence=this.Ga(e),await this.persistence.start(),this.localStore=this.za(e),this.gcScheduler=this.ja(e,this.localStore),this.indexBackfillerScheduler=this.Ha(e,this.localStore)}ja(e,n){return null}Ha(e,n){return null}za(e){return dI(this.persistence,new cI,e.initialUser,this.serializer)}Ga(e){return new aI(Ym.Zr,this.serializer)}Wa(e){return new xI}async terminate(){var e,n;(e=this.gcScheduler)===null||e===void 0||e.stop(),(n=this.indexBackfillerScheduler)===null||n===void 0||n.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}fc.provider={build:()=>new fc};class Ch{async initialize(e,n){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(n),this.remoteStore=this.createRemoteStore(n),this.eventManager=this.createEventManager(n),this.syncEngine=this.createSyncEngine(n,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>Dy(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=rA.bind(null,this.syncEngine),await VI(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new UI}()}createDatastore(e){const n=Yc(e.databaseInfo.databaseId),r=function(a){return new _I(a)}(e.databaseInfo);return function(a,o,c,u){return new TI(a,o,c,u)}(e.authCredentials,e.appCheckCredentials,r,n)}createRemoteStore(e){return function(r,s,a,o,c){return new SI(r,s,a,o,c)}(this.localStore,this.datastore,e.asyncQueue,n=>Dy(this.syncEngine,n,0),function(){return Iy.D()?new Iy:new vI}())}createSyncEngine(e,n){return function(s,a,o,c,u,d,m){const y=new GI(s,a,o,c,u,d);return m&&(y.Qa=!0),y}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,n)}async terminate(){var e,n;await async function(s){const a=fe(s);ae("RemoteStore","RemoteStore shutting down."),a.L_.add(5),await ho(a),a.k_.shutdown(),a.q_.set("Unknown")}(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate(),(n=this.eventManager)===null||n===void 0||n.terminate()}}Ch.provider={build:()=>new Ch};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uf{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ya(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ya(this.observer.error,e):tr("Uncaught Error in snapshot listener:",e.toString()))}Za(){this.muted=!0}Ya(e,n){setTimeout(()=>{this.muted||e(n)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aA{constructor(e,n,r,s,a){this.authCredentials=e,this.appCheckCredentials=n,this.asyncQueue=r,this.databaseInfo=s,this.user=vt.UNAUTHENTICATED,this.clientId=ub.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=a,this.authCredentials.start(r,async o=>{ae("FirestoreClient","Received user=",o.uid),await this.authCredentialListener(o),this.user=o}),this.appCheckCredentials.start(r,o=>(ae("FirestoreClient","Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Wn;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(n){const r=rf(n,"Failed to shutdown persistence");e.reject(r)}}),e.promise}}async function dd(t,e){t.asyncQueue.verifyOperationInProgress(),ae("FirestoreClient","Initializing OfflineComponentProvider");const n=t.configuration;await e.initialize(n);let r=n.initialUser;t.setCredentialChangeListener(async s=>{r.isEqual(s)||(await zb(e.localStore,s),r=s)}),e.persistence.setDatabaseDeletedListener(()=>t.terminate()),t._offlineComponents=e}async function Oy(t,e){t.asyncQueue.verifyOperationInProgress();const n=await oA(t);ae("FirestoreClient","Initializing OnlineComponentProvider"),await e.initialize(n,t.configuration),t.setCredentialChangeListener(r=>Ay(e.remoteStore,r)),t.setAppCheckTokenChangeListener((r,s)=>Ay(e.remoteStore,s)),t._onlineComponents=e}async function oA(t){if(!t._offlineComponents)if(t._uninitializedComponentsProvider){ae("FirestoreClient","Using user provided OfflineComponentProvider");try{await dd(t,t._uninitializedComponentsProvider._offline)}catch(e){const n=e;if(!function(s){return s.name==="FirebaseError"?s.code===X.FAILED_PRECONDITION||s.code===X.UNIMPLEMENTED:!(typeof DOMException<"u"&&s instanceof DOMException)||s.code===22||s.code===20||s.code===11}(n))throw n;hi("Error using user provided cache. Falling back to memory cache: "+n),await dd(t,new fc)}}else ae("FirestoreClient","Using default OfflineComponentProvider"),await dd(t,new fc);return t._offlineComponents}async function ow(t){return t._onlineComponents||(t._uninitializedComponentsProvider?(ae("FirestoreClient","Using user provided OnlineComponentProvider"),await Oy(t,t._uninitializedComponentsProvider._online)):(ae("FirestoreClient","Using default OnlineComponentProvider"),await Oy(t,new Ch))),t._onlineComponents}function lA(t){return ow(t).then(e=>e.syncEngine)}async function pc(t){const e=await ow(t),n=e.eventManager;return n.onListen=WI.bind(null,e.syncEngine),n.onUnlisten=YI.bind(null,e.syncEngine),n.onFirstRemoteStoreListen=KI.bind(null,e.syncEngine),n.onLastRemoteStoreUnlisten=XI.bind(null,e.syncEngine),n}function cA(t,e,n={}){const r=new Wn;return t.asyncQueue.enqueueAndForget(async()=>function(a,o,c,u,d){const m=new uf({next:g=>{m.Za(),o.enqueueAndForget(()=>af(a,y));const x=g.docs.has(c);!x&&g.fromCache?d.reject(new se(X.UNAVAILABLE,"Failed to get document because the client is offline.")):x&&g.fromCache&&u&&u.source==="server"?d.reject(new se(X.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):d.resolve(g)},error:g=>d.reject(g)}),y=new lf(qc(c.path),m,{includeMetadataChanges:!0,_a:!0});return sf(a,y)}(await pc(t),t.asyncQueue,e,n,r)),r.promise}function uA(t,e,n={}){const r=new Wn;return t.asyncQueue.enqueueAndForget(async()=>function(a,o,c,u,d){const m=new uf({next:g=>{m.Za(),o.enqueueAndForget(()=>af(a,y)),g.fromCache&&u.source==="server"?d.reject(new se(X.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):d.resolve(g)},error:g=>d.reject(g)}),y=new lf(c,m,{includeMetadataChanges:!0,_a:!0});return sf(a,y)}(await pc(t),t.asyncQueue,e,n,r)),r.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lw(t){const e={};return t.timeoutSeconds!==void 0&&(e.timeoutSeconds=t.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ly=new Map;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cw(t,e,n){if(!n)throw new se(X.INVALID_ARGUMENT,`Function ${t}() cannot be called with an empty ${e}.`)}function dA(t,e,n,r){if(e===!0&&r===!0)throw new se(X.INVALID_ARGUMENT,`${t} and ${n} cannot be used together.`)}function Vy(t){if(!le.isDocumentKey(t))throw new se(X.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${t} has ${t.length}.`)}function Fy(t){if(le.isDocumentKey(t))throw new se(X.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${t} has ${t.length}.`)}function Zc(t){if(t===void 0)return"undefined";if(t===null)return"null";if(typeof t=="string")return t.length>20&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if(typeof t=="number"||typeof t=="boolean")return""+t;if(typeof t=="object"){if(t instanceof Array)return"an array";{const e=function(r){return r.constructor?r.constructor.name:null}(t);return e?`a custom ${e} object`:"an object"}}return typeof t=="function"?"a function":he()}function Ft(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new se(X.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=Zc(t);throw new se(X.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${n}`)}}return t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Uy{constructor(e){var n,r;if(e.host===void 0){if(e.ssl!==void 0)throw new se(X.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(n=e.ssl)===null||n===void 0||n;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new se(X.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}dA("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=lw((r=e.experimentalLongPollingOptions)!==null&&r!==void 0?r:{}),function(a){if(a.timeoutSeconds!==void 0){if(isNaN(a.timeoutSeconds))throw new se(X.INVALID_ARGUMENT,`invalid long polling timeout: ${a.timeoutSeconds} (must not be NaN)`);if(a.timeoutSeconds<5)throw new se(X.INVALID_ARGUMENT,`invalid long polling timeout: ${a.timeoutSeconds} (minimum allowed value is 5)`);if(a.timeoutSeconds>30)throw new se(X.INVALID_ARGUMENT,`invalid long polling timeout: ${a.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(r,s){return r.timeoutSeconds===s.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class eu{constructor(e,n,r,s){this._authCredentials=e,this._appCheckCredentials=n,this._databaseId=r,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Uy({}),this._settingsFrozen=!1,this._terminateTask="notTerminated"}get app(){if(!this._app)throw new se(X.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new se(X.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Uy(e),e.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new I1;switch(r.type){case"firstParty":return new R1(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new se(X.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(n){const r=Ly.get(n);r&&(ae("ComponentProvider","Removing Datastore"),Ly.delete(n),r.terminate())}(this),Promise.resolve()}}function hA(t,e,n,r={}){var s;const a=(t=Ft(t,eu))._getSettings(),o=`${e}:${n}`;if(a.host!=="firestore.googleapis.com"&&a.host!==o&&hi("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),t._setSettings(Object.assign(Object.assign({},a),{host:o,ssl:!1})),r.mockUserToken){let c,u;if(typeof r.mockUserToken=="string")c=r.mockUserToken,u=vt.MOCK_USER;else{c=gv(r.mockUserToken,(s=t._app)===null||s===void 0?void 0:s.options.projectId);const d=r.mockUserToken.sub||r.mockUserToken.user_id;if(!d)throw new se(X.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");u=new vt(d)}t._authCredentials=new A1(new cb(c,u))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class or{constructor(e,n,r){this.converter=n,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new or(this.firestore,e,this._query)}}class _t{constructor(e,n,r){this.converter=n,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Dr(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new _t(this.firestore,e,this._key)}}class Dr extends or{constructor(e,n,r){super(e,n,qc(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new _t(this.firestore,null,new le(e))}withConverter(e){return new Dr(this.firestore,e,this._path)}}function xe(t,e,...n){if(t=Le(t),cw("collection","path",e),t instanceof eu){const r=De.fromString(e,...n);return Fy(r),new Dr(t,null,r)}{if(!(t instanceof _t||t instanceof Dr))throw new se(X.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child(De.fromString(e,...n));return Fy(r),new Dr(t.firestore,null,r)}}function ue(t,e,...n){if(t=Le(t),arguments.length===1&&(e=ub.newId()),cw("doc","path",e),t instanceof eu){const r=De.fromString(e,...n);return Vy(r),new _t(t,null,new le(r))}{if(!(t instanceof _t||t instanceof Dr))throw new se(X.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child(De.fromString(e,...n));return Vy(r),new _t(t.firestore,t instanceof Dr?t.converter:null,new le(r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class By{constructor(e=Promise.resolve()){this.Pu=[],this.Iu=!1,this.Tu=[],this.Eu=null,this.du=!1,this.Au=!1,this.Ru=[],this.t_=new Hb(this,"async_queue_retry"),this.Vu=()=>{const r=ud();r&&ae("AsyncQueue","Visibility state changed to "+r.visibilityState),this.t_.jo()},this.mu=e;const n=ud();n&&typeof n.addEventListener=="function"&&n.addEventListener("visibilitychange",this.Vu)}get isShuttingDown(){return this.Iu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.fu(),this.gu(e)}enterRestrictedMode(e){if(!this.Iu){this.Iu=!0,this.Au=e||!1;const n=ud();n&&typeof n.removeEventListener=="function"&&n.removeEventListener("visibilitychange",this.Vu)}}enqueue(e){if(this.fu(),this.Iu)return new Promise(()=>{});const n=new Wn;return this.gu(()=>this.Iu&&this.Au?Promise.resolve():(e().then(n.resolve,n.reject),n.promise)).then(()=>n.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Pu.push(e),this.pu()))}async pu(){if(this.Pu.length!==0){try{await this.Pu[0](),this.Pu.shift(),this.t_.reset()}catch(e){if(!lo(e))throw e;ae("AsyncQueue","Operation failed with retryable error: "+e)}this.Pu.length>0&&this.t_.Go(()=>this.pu())}}gu(e){const n=this.mu.then(()=>(this.du=!0,e().catch(r=>{this.Eu=r,this.du=!1;const s=function(o){let c=o.message||"";return o.stack&&(c=o.stack.includes(o.message)?o.stack:o.message+`
`+o.stack),c}(r);throw tr("INTERNAL UNHANDLED ERROR: ",s),r}).then(r=>(this.du=!1,r))));return this.mu=n,n}enqueueAfterDelay(e,n,r){this.fu(),this.Ru.indexOf(e)>-1&&(n=0);const s=nf.createAndSchedule(this,e,n,r,a=>this.yu(a));return this.Tu.push(s),s}fu(){this.Eu&&he()}verifyOperationInProgress(){}async wu(){let e;do e=this.mu,await e;while(e!==this.mu)}Su(e){for(const n of this.Tu)if(n.timerId===e)return!0;return!1}bu(e){return this.wu().then(()=>{this.Tu.sort((n,r)=>n.targetTimeMs-r.targetTimeMs);for(const n of this.Tu)if(n.skipDelay(),e!=="all"&&n.timerId===e)break;return this.wu()})}Du(e){this.Ru.push(e)}yu(e){const n=this.Tu.indexOf(e);this.Tu.splice(n,1)}}function $y(t){return function(n,r){if(typeof n!="object"||n===null)return!1;const s=n;for(const a of r)if(a in s&&typeof s[a]=="function")return!0;return!1}(t,["next","error","complete"])}class rr extends eu{constructor(e,n,r,s){super(e,n,r,s),this.type="firestore",this._queue=new By,this._persistenceKey=(s==null?void 0:s.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new By(e),this._firestoreClient=void 0,await e}}}function mA(t,e){const n=typeof t=="object"?t:Vc(),r=typeof t=="string"?t:"(default)",s=no(n,"firestore").getImmediate({identifier:r});if(!s._initialized){const a=Tm("firestore");a&&hA(s,...a)}return s}function tu(t){if(t._terminated)throw new se(X.FAILED_PRECONDITION,"The client has already been terminated.");return t._firestoreClient||fA(t),t._firestoreClient}function fA(t){var e,n,r;const s=t._freezeSettings(),a=function(c,u,d,m){return new G1(c,u,d,m.host,m.ssl,m.experimentalForceLongPolling,m.experimentalAutoDetectLongPolling,lw(m.experimentalLongPollingOptions),m.useFetchStreams)}(t._databaseId,((e=t._app)===null||e===void 0?void 0:e.options.appId)||"",t._persistenceKey,s);t._componentsProvider||!((n=s.localCache)===null||n===void 0)&&n._offlineComponentProvider&&(!((r=s.localCache)===null||r===void 0)&&r._onlineComponentProvider)&&(t._componentsProvider={_offline:s.localCache._offlineComponentProvider,_online:s.localCache._onlineComponentProvider}),t._firestoreClient=new aA(t._authCredentials,t._appCheckCredentials,t._queue,a,t._componentsProvider&&function(c){const u=c==null?void 0:c._online.build();return{_offline:c==null?void 0:c._offline.build(u),_online:u}}(t._componentsProvider))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xi{constructor(e){this._byteString=e}static fromBase64String(e){try{return new xi(ht.fromBase64String(e))}catch(n){throw new se(X.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+n)}}static fromUint8Array(e){return new xi(ht.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nu{constructor(...e){for(let n=0;n<e.length;++n)if(e[n].length===0)throw new se(X.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new lt(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class df{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hf{constructor(e,n){if(!isFinite(e)||e<-90||e>90)throw new se(X.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(n)||n<-180||n>180)throw new se(X.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+n);this._lat=e,this._long=n}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return Ne(this._lat,e._lat)||Ne(this._long,e._long)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mf{constructor(e){this._values=(e||[]).map(n=>n)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(r,s){if(r.length!==s.length)return!1;for(let a=0;a<r.length;++a)if(r[a]!==s[a])return!1;return!0}(this._values,e._values)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pA=/^__.*__$/;class gA{constructor(e,n,r){this.data=e,this.fieldMask=n,this.fieldTransforms=r}toMutation(e,n){return this.fieldMask!==null?new Gr(e,this.data,this.fieldMask,n,this.fieldTransforms):new co(e,this.data,n,this.fieldTransforms)}}class uw{constructor(e,n,r){this.data=e,this.fieldMask=n,this.fieldTransforms=r}toMutation(e,n){return new Gr(e,this.data,this.fieldMask,n,this.fieldTransforms)}}function dw(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw he()}}class ff{constructor(e,n,r,s,a,o){this.settings=e,this.databaseId=n,this.serializer=r,this.ignoreUndefinedProperties=s,a===void 0&&this.vu(),this.fieldTransforms=a||[],this.fieldMask=o||[]}get path(){return this.settings.path}get Cu(){return this.settings.Cu}Fu(e){return new ff(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Mu(e){var n;const r=(n=this.path)===null||n===void 0?void 0:n.child(e),s=this.Fu({path:r,xu:!1});return s.Ou(e),s}Nu(e){var n;const r=(n=this.path)===null||n===void 0?void 0:n.child(e),s=this.Fu({path:r,xu:!1});return s.vu(),s}Lu(e){return this.Fu({path:void 0,xu:!0})}Bu(e){return gc(e,this.settings.methodName,this.settings.ku||!1,this.path,this.settings.qu)}contains(e){return this.fieldMask.find(n=>e.isPrefixOf(n))!==void 0||this.fieldTransforms.find(n=>e.isPrefixOf(n.field))!==void 0}vu(){if(this.path)for(let e=0;e<this.path.length;e++)this.Ou(this.path.get(e))}Ou(e){if(e.length===0)throw this.Bu("Document fields must not be empty");if(dw(this.Cu)&&pA.test(e))throw this.Bu('Document fields cannot begin and end with "__"')}}class yA{constructor(e,n,r){this.databaseId=e,this.ignoreUndefinedProperties=n,this.serializer=r||Yc(e)}Qu(e,n,r,s=!1){return new ff({Cu:e,methodName:n,qu:r,path:lt.emptyPath(),xu:!1,ku:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function ru(t){const e=t._freezeSettings(),n=Yc(t._databaseId);return new yA(t._databaseId,!!e.ignoreUndefinedProperties,n)}function hw(t,e,n,r,s,a={}){const o=t.Qu(a.merge||a.mergeFields?2:0,e,n,s);pf("Data must be an object, but it was:",o,r);const c=mw(r,o);let u,d;if(a.merge)u=new Ht(o.fieldMask),d=o.fieldTransforms;else if(a.mergeFields){const m=[];for(const y of a.mergeFields){const g=Ih(e,y,n);if(!o.contains(g))throw new se(X.INVALID_ARGUMENT,`Field '${g}' is specified in your field mask but missing from your input data.`);pw(m,g)||m.push(g)}u=new Ht(m),d=o.fieldTransforms.filter(y=>u.covers(y.field))}else u=null,d=o.fieldTransforms;return new gA(new Dt(c),u,d)}class su extends df{_toFieldTransform(e){if(e.Cu!==2)throw e.Cu===1?e.Bu(`${this._methodName}() can only appear at the top level of your update data`):e.Bu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof su}}function xA(t,e,n,r){const s=t.Qu(1,e,n);pf("Data must be an object, but it was:",s,r);const a=[],o=Dt.empty();Es(r,(u,d)=>{const m=gf(e,u,n);d=Le(d);const y=s.Nu(m);if(d instanceof su)a.push(m);else{const g=fo(d,y);g!=null&&(a.push(m),o.set(m,g))}});const c=new Ht(a);return new uw(o,c,s.fieldTransforms)}function vA(t,e,n,r,s,a){const o=t.Qu(1,e,n),c=[Ih(e,r,n)],u=[s];if(a.length%2!=0)throw new se(X.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let g=0;g<a.length;g+=2)c.push(Ih(e,a[g])),u.push(a[g+1]);const d=[],m=Dt.empty();for(let g=c.length-1;g>=0;--g)if(!pw(d,c[g])){const x=c[g];let C=u[g];C=Le(C);const E=o.Nu(x);if(C instanceof su)d.push(x);else{const A=fo(C,E);A!=null&&(d.push(x),m.set(x,A))}}const y=new Ht(d);return new uw(m,y,o.fieldTransforms)}function bA(t,e,n,r=!1){return fo(n,t.Qu(r?4:3,e))}function fo(t,e){if(fw(t=Le(t)))return pf("Unsupported field value:",e,t),mw(t,e);if(t instanceof df)return function(r,s){if(!dw(s.Cu))throw s.Bu(`${r._methodName}() can only be used with update() and set()`);if(!s.path)throw s.Bu(`${r._methodName}() is not currently supported inside arrays`);const a=r._toFieldTransform(s);a&&s.fieldTransforms.push(a)}(t,e),null;if(t===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.xu&&e.Cu!==4)throw e.Bu("Nested arrays are not supported");return function(r,s){const a=[];let o=0;for(const c of r){let u=fo(c,s.Lu(o));u==null&&(u={nullValue:"NULL_VALUE"}),a.push(u),o++}return{arrayValue:{values:a}}}(t,e)}return function(r,s){if((r=Le(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return fC(s.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const a=oe.fromDate(r);return{timestampValue:hc(s.serializer,a)}}if(r instanceof oe){const a=new oe(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:hc(s.serializer,a)}}if(r instanceof hf)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof xi)return{bytesValue:Ob(s.serializer,r._byteString)};if(r instanceof _t){const a=s.databaseId,o=r.firestore._databaseId;if(!o.isEqual(a))throw s.Bu(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${a.projectId}/${a.database}`);return{referenceValue:Km(r.firestore._databaseId||s.databaseId,r._key.path)}}if(r instanceof mf)return function(o,c){return{mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{values:o.toArray().map(u=>{if(typeof u!="number")throw c.Bu("VectorValues must only contain numeric values.");return qm(c.serializer,u)})}}}}}}(r,s);throw s.Bu(`Unsupported field value: ${Zc(r)}`)}(t,e)}function mw(t,e){const n={};return db(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Es(t,(r,s)=>{const a=fo(s,e.Mu(r));a!=null&&(n[r]=a)}),{mapValue:{fields:n}}}function fw(t){return!(typeof t!="object"||t===null||t instanceof Array||t instanceof Date||t instanceof oe||t instanceof hf||t instanceof xi||t instanceof _t||t instanceof df||t instanceof mf)}function pf(t,e,n){if(!fw(n)||!function(s){return typeof s=="object"&&s!==null&&(Object.getPrototypeOf(s)===Object.prototype||Object.getPrototypeOf(s)===null)}(n)){const r=Zc(n);throw r==="an object"?e.Bu(t+" a custom object"):e.Bu(t+" "+r)}}function Ih(t,e,n){if((e=Le(e))instanceof nu)return e._internalPath;if(typeof e=="string")return gf(t,e);throw gc("Field path arguments must be of type string or ",t,!1,void 0,n)}const wA=new RegExp("[~\\*/\\[\\]]");function gf(t,e,n){if(e.search(wA)>=0)throw gc(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,n);try{return new nu(...e.split("."))._internalPath}catch{throw gc(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,n)}}function gc(t,e,n,r,s){const a=r&&!r.isEmpty(),o=s!==void 0;let c=`Function ${e}() called with invalid data`;n&&(c+=" (via `toFirestore()`)"),c+=". ";let u="";return(a||o)&&(u+=" (found",a&&(u+=` in field ${r}`),o&&(u+=` in document ${s}`),u+=")"),new se(X.INVALID_ARGUMENT,c+t+u)}function pw(t,e){return t.some(n=>n.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gw{constructor(e,n,r,s,a){this._firestore=e,this._userDataWriter=n,this._key=r,this._document=s,this._converter=a}get id(){return this._key.path.lastSegment()}get ref(){return new _t(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new _A(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const n=this._document.data.field(iu("DocumentSnapshot.get",e));if(n!==null)return this._userDataWriter.convertValue(n)}}}class _A extends gw{data(){return super.data()}}function iu(t,e){return typeof e=="string"?gf(t,e):e instanceof nu?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yw(t){if(t.limitType==="L"&&t.explicitOrderBy.length===0)throw new se(X.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class yf{}class xf extends yf{}function He(t,e,...n){let r=[];e instanceof yf&&r.push(e),r=r.concat(n),function(a){const o=a.filter(u=>u instanceof vf).length,c=a.filter(u=>u instanceof au).length;if(o>1||o>0&&c>0)throw new se(X.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const s of r)t=s._apply(t);return t}class au extends xf{constructor(e,n,r){super(),this._field=e,this._op=n,this._value=r,this.type="where"}static _create(e,n,r){return new au(e,n,r)}_apply(e){const n=this._parse(e);return vw(e._query,n),new or(e.firestore,e.converter,bh(e._query,n))}_parse(e){const n=ru(e.firestore);return function(a,o,c,u,d,m,y){let g;if(d.isKeyField()){if(m==="array-contains"||m==="array-contains-any")throw new se(X.INVALID_ARGUMENT,`Invalid Query. You can't perform '${m}' queries on documentId().`);if(m==="in"||m==="not-in"){qy(y,m);const x=[];for(const C of y)x.push(zy(u,a,C));g={arrayValue:{values:x}}}else g=zy(u,a,y)}else m!=="in"&&m!=="not-in"&&m!=="array-contains-any"||qy(y,m),g=bA(c,o,y,m==="in"||m==="not-in");return Ye.create(d,m,g)}(e._query,"where",n,e.firestore._databaseId,this._field,this._op,this._value)}}function rt(t,e,n){const r=e,s=iu("where",t);return au._create(s,r,n)}class vf extends yf{constructor(e,n){super(),this.type=e,this._queryConstraints=n}static _create(e,n){return new vf(e,n)}_parse(e){const n=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return n.length===1?n[0]:yn.create(n,this._getOperator())}_apply(e){const n=this._parse(e);return n.getFilters().length===0?e:(function(s,a){let o=s;const c=a.getFlattenedFilters();for(const u of c)vw(o,u),o=bh(o,u)}(e._query,n),new or(e.firestore,e.converter,bh(e._query,n)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}class bf extends xf{constructor(e,n){super(),this._field=e,this._direction=n,this.type="orderBy"}static _create(e,n){return new bf(e,n)}_apply(e){const n=function(s,a,o){if(s.startAt!==null)throw new se(X.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(s.endAt!==null)throw new se(X.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new Ha(a,o)}(e._query,this._field,this._direction);return new or(e.firestore,e.converter,function(s,a){const o=s.explicitOrderBy.concat([a]);return new ji(s.path,s.collectionGroup,o,s.filters.slice(),s.limit,s.limitType,s.startAt,s.endAt)}(e._query,n))}}function po(t,e="asc"){const n=e,r=iu("orderBy",t);return bf._create(r,n)}class wf extends xf{constructor(e,n,r){super(),this.type=e,this._limit=n,this._limitType=r}static _create(e,n,r){return new wf(e,n,r)}_apply(e){return new or(e.firestore,e.converter,cc(e._query,this._limit,this._limitType))}}function xw(t){return wf._create("limit",t,"F")}function zy(t,e,n){if(typeof(n=Le(n))=="string"){if(n==="")throw new se(X.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!bb(e)&&n.indexOf("/")!==-1)throw new se(X.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const r=e.path.child(De.fromString(n));if(!le.isDocumentKey(r))throw new se(X.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return uy(t,new le(r))}if(n instanceof _t)return uy(t,n._key);throw new se(X.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Zc(n)}.`)}function qy(t,e){if(!Array.isArray(t)||t.length===0)throw new se(X.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function vw(t,e){const n=function(s,a){for(const o of s)for(const c of o.getFlattenedFilters())if(a.indexOf(c.op)>=0)return c.op;return null}(t.filters,function(s){switch(s){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(n!==null)throw n===e.op?new se(X.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new se(X.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${n.toString()}' filters.`)}class NA{convertValue(e,n="none"){switch(vs(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Ge(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,n);case 5:return e.stringValue;case 6:return this.convertBytes(xs(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,n);case 11:return this.convertObject(e.mapValue,n);case 10:return this.convertVectorValue(e.mapValue);default:throw he()}}convertObject(e,n){return this.convertObjectMap(e.fields,n)}convertObjectMap(e,n="none"){const r={};return Es(e,(s,a)=>{r[s]=this.convertValue(a,n)}),r}convertVectorValue(e){var n,r,s;const a=(s=(r=(n=e.fields)===null||n===void 0?void 0:n.value.arrayValue)===null||r===void 0?void 0:r.values)===null||s===void 0?void 0:s.map(o=>Ge(o.doubleValue));return new mf(a)}convertGeoPoint(e){return new hf(Ge(e.latitude),Ge(e.longitude))}convertArray(e,n){return(e.values||[]).map(r=>this.convertValue(r,n))}convertServerTimestamp(e,n){switch(n){case"previous":const r=Um(e);return r==null?null:this.convertValue(r,n);case"estimate":return this.convertTimestamp($a(e));default:return null}}convertTimestamp(e){const n=Ur(e);return new oe(n.seconds,n.nanos)}convertDocumentKey(e,n){const r=De.fromString(e);je($b(r));const s=new za(r.get(1),r.get(3)),a=new le(r.popFirst(5));return s.isEqual(n)||tr(`Document ${a} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${n.projectId}/${n.database}) instead.`),a}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bw(t,e,n){let r;return r=t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e,r}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oa{constructor(e,n){this.hasPendingWrites=e,this.fromCache=n}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class ww extends gw{constructor(e,n,r,s,a,o){super(e,n,r,s,o),this._firestore=e,this._firestoreImpl=e,this.metadata=a}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const n=new jl(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(n,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,n={}){if(this._document){const r=this._document.data.field(iu("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,n.serverTimestamps)}}}class jl extends ww{data(e={}){return super.data(e)}}class _w{constructor(e,n,r,s){this._firestore=e,this._userDataWriter=n,this._snapshot=s,this.metadata=new oa(s.hasPendingWrites,s.fromCache),this.query=r}get docs(){const e=[];return this.forEach(n=>e.push(n)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,n){this._snapshot.docs.forEach(r=>{e.call(n,new jl(this._firestore,this._userDataWriter,r.key,r,new oa(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const n=!!e.includeMetadataChanges;if(n&&this._snapshot.excludesMetadataChanges)throw new se(X.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===n||(this._cachedChanges=function(s,a){if(s._snapshot.oldDocs.isEmpty()){let o=0;return s._snapshot.docChanges.map(c=>{const u=new jl(s._firestore,s._userDataWriter,c.doc.key,c.doc,new oa(s._snapshot.mutatedKeys.has(c.doc.key),s._snapshot.fromCache),s.query.converter);return c.doc,{type:"added",doc:u,oldIndex:-1,newIndex:o++}})}{let o=s._snapshot.oldDocs;return s._snapshot.docChanges.filter(c=>a||c.type!==3).map(c=>{const u=new jl(s._firestore,s._userDataWriter,c.doc.key,c.doc,new oa(s._snapshot.mutatedKeys.has(c.doc.key),s._snapshot.fromCache),s.query.converter);let d=-1,m=-1;return c.type!==0&&(d=o.indexOf(c.doc.key),o=o.delete(c.doc.key)),c.type!==1&&(o=o.add(c.doc),m=o.indexOf(c.doc.key)),{type:EA(c.type),doc:u,oldIndex:d,newIndex:m}})}}(this,n),this._cachedChangesIncludeMetadataChanges=n),this._cachedChanges}}function EA(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return he()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ls(t){t=Ft(t,_t);const e=Ft(t.firestore,rr);return cA(tu(e),t._key).then(n=>Nw(e,t,n))}class _f extends NA{constructor(e){super(),this.firestore=e}convertBytes(e){return new xi(e)}convertReference(e){const n=this.convertDocumentKey(e,this.firestore._databaseId);return new _t(this.firestore,null,n)}}function In(t){t=Ft(t,or);const e=Ft(t.firestore,rr),n=tu(e),r=new _f(e);return yw(t._query),uA(n,t._query).then(s=>new _w(e,r,t,s))}function An(t,e,n){t=Ft(t,_t);const r=Ft(t.firestore,rr),s=bw(t.converter,e,n);return ou(r,[hw(ru(r),"setDoc",t._key,s,t.converter!==null,n).toMutation(t._key,nn.none())])}function qe(t,e,n,...r){t=Ft(t,_t);const s=Ft(t.firestore,rr),a=ru(s);let o;return o=typeof(e=Le(e))=="string"||e instanceof nu?vA(a,"updateDoc",t._key,e,n,r):xA(a,"updateDoc",t._key,e),ou(s,[o.toMutation(t._key,nn.exists(!0))])}function vi(t){return ou(Ft(t.firestore,rr),[new Hm(t._key,nn.none())])}function sr(t,e){const n=Ft(t.firestore,rr),r=ue(t),s=bw(t.converter,e);return ou(n,[hw(ru(t.firestore),"addDoc",r._key,s,t.converter!==null,{}).toMutation(r._key,nn.exists(!1))]).then(()=>r)}function Ee(t,...e){var n,r,s;t=Le(t);let a={includeMetadataChanges:!1,source:"default"},o=0;typeof e[o]!="object"||$y(e[o])||(a=e[o],o++);const c={includeMetadataChanges:a.includeMetadataChanges,source:a.source};if($y(e[o])){const y=e[o];e[o]=(n=y.next)===null||n===void 0?void 0:n.bind(y),e[o+1]=(r=y.error)===null||r===void 0?void 0:r.bind(y),e[o+2]=(s=y.complete)===null||s===void 0?void 0:s.bind(y)}let u,d,m;if(t instanceof _t)d=Ft(t.firestore,rr),m=qc(t._key.path),u={next:y=>{e[o]&&e[o](Nw(d,t,y))},error:e[o+1],complete:e[o+2]};else{const y=Ft(t,or);d=Ft(y.firestore,rr),m=y._query;const g=new _f(d);u={next:x=>{e[o]&&e[o](new _w(d,g,y,x))},error:e[o+1],complete:e[o+2]},yw(t._query)}return function(g,x,C,E){const A=new uf(E),N=new lf(x,A,C);return g.asyncQueue.enqueueAndForget(async()=>sf(await pc(g),N)),()=>{A.Za(),g.asyncQueue.enqueueAndForget(async()=>af(await pc(g),N))}}(tu(d),m,c,u)}function ou(t,e){return function(r,s){const a=new Wn;return r.asyncQueue.enqueueAndForget(async()=>JI(await lA(r),s,a)),a.promise}(tu(t),e)}function Nw(t,e,n){const r=n.docs.get(e._key),s=new _f(t);return new ww(t,s,e._key,r,new oa(n.hasPendingWrites,n.fromCache),e.converter)}(function(e,n=!0){(function(s){Ti=s})(_s),Vr(new Jn("firestore",(r,{instanceIdentifier:s,options:a})=>{const o=r.getProvider("app").getImmediate(),c=new rr(new k1(r.getProvider("auth-internal")),new M1(r.getProvider("app-check-internal")),function(d,m){if(!Object.prototype.hasOwnProperty.apply(d.options,["projectId"]))throw new se(X.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new za(d.options.projectId,m)}(o,s),o);return a=Object.assign({useFetchStreams:n},a),c._setSettings(a),c},"PUBLIC").setMultipleInstances(!0)),tn(iy,"4.7.3",e),tn(iy,"4.7.3","esm2017")})();var TA="firebase",jA="10.14.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */tn(TA,jA,"app");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ew="firebasestorage.googleapis.com",SA="storageBucket",CA=2*60*1e3,IA=10*60*1e3;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dn extends Pn{constructor(e,n,r=0){super(hd(e),`Firebase Storage: ${n} (${hd(e)})`),this.status_=r,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,Dn.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return hd(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}var kn;(function(t){t.UNKNOWN="unknown",t.OBJECT_NOT_FOUND="object-not-found",t.BUCKET_NOT_FOUND="bucket-not-found",t.PROJECT_NOT_FOUND="project-not-found",t.QUOTA_EXCEEDED="quota-exceeded",t.UNAUTHENTICATED="unauthenticated",t.UNAUTHORIZED="unauthorized",t.UNAUTHORIZED_APP="unauthorized-app",t.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",t.INVALID_CHECKSUM="invalid-checksum",t.CANCELED="canceled",t.INVALID_EVENT_NAME="invalid-event-name",t.INVALID_URL="invalid-url",t.INVALID_DEFAULT_BUCKET="invalid-default-bucket",t.NO_DEFAULT_BUCKET="no-default-bucket",t.CANNOT_SLICE_BLOB="cannot-slice-blob",t.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",t.NO_DOWNLOAD_URL="no-download-url",t.INVALID_ARGUMENT="invalid-argument",t.INVALID_ARGUMENT_COUNT="invalid-argument-count",t.APP_DELETED="app-deleted",t.INVALID_ROOT_OPERATION="invalid-root-operation",t.INVALID_FORMAT="invalid-format",t.INTERNAL_ERROR="internal-error",t.UNSUPPORTED_ENVIRONMENT="unsupported-environment"})(kn||(kn={}));function hd(t){return"storage/"+t}function AA(){const t="An unknown error occurred, please check the error payload for server response.";return new Dn(kn.UNKNOWN,t)}function kA(){return new Dn(kn.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function PA(){return new Dn(kn.CANCELED,"User canceled the upload/download.")}function RA(t){return new Dn(kn.INVALID_URL,"Invalid URL '"+t+"'.")}function DA(t){return new Dn(kn.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+t+"'.")}function Hy(t){return new Dn(kn.INVALID_ARGUMENT,t)}function Tw(){return new Dn(kn.APP_DELETED,"The Firebase app was deleted.")}function MA(t){return new Dn(kn.INVALID_ROOT_OPERATION,"The operation '"+t+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hn{constructor(e,n){this.bucket=e,this.path_=n}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,n){let r;try{r=hn.makeFromUrl(e,n)}catch{return new hn(e,"")}if(r.path==="")return r;throw DA(e)}static makeFromUrl(e,n){let r=null;const s="([A-Za-z0-9.\\-_]+)";function a(L){L.path.charAt(L.path.length-1)==="/"&&(L.path_=L.path_.slice(0,-1))}const o="(/(.*))?$",c=new RegExp("^gs://"+s+o,"i"),u={bucket:1,path:3};function d(L){L.path_=decodeURIComponent(L.path)}const m="v[A-Za-z0-9_]+",y=n.replace(/[.]/g,"\\."),g="(/([^?#]*).*)?$",x=new RegExp(`^https?://${y}/${m}/b/${s}/o${g}`,"i"),C={bucket:1,path:3},E=n===Ew?"(?:storage.googleapis.com|storage.cloud.google.com)":n,A="([^?#]*)",N=new RegExp(`^https?://${E}/${s}/${A}`,"i"),k=[{regex:c,indices:u,postModify:a},{regex:x,indices:C,postModify:d},{regex:N,indices:{bucket:1,path:2},postModify:d}];for(let L=0;L<k.length;L++){const q=k[L],z=q.regex.exec(e);if(z){const j=z[q.indices.bucket];let v=z[q.indices.path];v||(v=""),r=new hn(j,v),q.postModify(r);break}}if(r==null)throw RA(e);return r}}class OA{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function LA(t,e,n){let r=1,s=null,a=null,o=!1,c=0;function u(){return c===2}let d=!1;function m(...A){d||(d=!0,e.apply(null,A))}function y(A){s=setTimeout(()=>{s=null,t(x,u())},A)}function g(){a&&clearTimeout(a)}function x(A,...N){if(d){g();return}if(A){g(),m.call(null,A,...N);return}if(u()||o){g(),m.call(null,A,...N);return}r<64&&(r*=2);let k;c===1?(c=2,k=0):k=(r+Math.random())*1e3,y(k)}let C=!1;function E(A){C||(C=!0,g(),!d&&(s!==null?(A||(c=2),clearTimeout(s),y(0)):A||(c=1)))}return y(0),a=setTimeout(()=>{o=!0,E(!0)},n),E}function VA(t){t(!1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function FA(t){return t!==void 0}function Gy(t,e,n,r){if(r<e)throw Hy(`Invalid value for '${t}'. Expected ${e} or greater.`);if(r>n)throw Hy(`Invalid value for '${t}'. Expected ${n} or less.`)}function UA(t){const e=encodeURIComponent;let n="?";for(const r in t)if(t.hasOwnProperty(r)){const s=e(r)+"="+e(t[r]);n=n+s+"&"}return n=n.slice(0,-1),n}var yc;(function(t){t[t.NO_ERROR=0]="NO_ERROR",t[t.NETWORK_ERROR=1]="NETWORK_ERROR",t[t.ABORT=2]="ABORT"})(yc||(yc={}));/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function BA(t,e){const n=t>=500&&t<600,s=[408,429].indexOf(t)!==-1,a=e.indexOf(t)!==-1;return n||s||a}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $A{constructor(e,n,r,s,a,o,c,u,d,m,y,g=!0){this.url_=e,this.method_=n,this.headers_=r,this.body_=s,this.successCodes_=a,this.additionalRetryCodes_=o,this.callback_=c,this.errorCallback_=u,this.timeout_=d,this.progressCallback_=m,this.connectionFactory_=y,this.retry=g,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((x,C)=>{this.resolve_=x,this.reject_=C,this.start_()})}start_(){const e=(r,s)=>{if(s){r(!1,new il(!1,null,!0));return}const a=this.connectionFactory_();this.pendingConnection_=a;const o=c=>{const u=c.loaded,d=c.lengthComputable?c.total:-1;this.progressCallback_!==null&&this.progressCallback_(u,d)};this.progressCallback_!==null&&a.addUploadProgressListener(o),a.send(this.url_,this.method_,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&a.removeUploadProgressListener(o),this.pendingConnection_=null;const c=a.getErrorCode()===yc.NO_ERROR,u=a.getStatus();if(!c||BA(u,this.additionalRetryCodes_)&&this.retry){const m=a.getErrorCode()===yc.ABORT;r(!1,new il(!1,null,m));return}const d=this.successCodes_.indexOf(u)!==-1;r(!0,new il(d,a))})},n=(r,s)=>{const a=this.resolve_,o=this.reject_,c=s.connection;if(s.wasSuccessCode)try{const u=this.callback_(c,c.getResponse());FA(u)?a(u):a()}catch(u){o(u)}else if(c!==null){const u=AA();u.serverResponse=c.getErrorText(),this.errorCallback_?o(this.errorCallback_(c,u)):o(u)}else if(s.canceled){const u=this.appDelete_?Tw():PA();o(u)}else{const u=kA();o(u)}};this.canceled_?n(!1,new il(!1,null,!0)):this.backoffId_=LA(e,n,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,this.backoffId_!==null&&VA(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}}class il{constructor(e,n,r){this.wasSuccessCode=e,this.connection=n,this.canceled=!!r}}function zA(t,e){e!==null&&e.length>0&&(t.Authorization="Firebase "+e)}function qA(t,e){t["X-Firebase-Storage-Version"]="webjs/"+(e??"AppManager")}function HA(t,e){e&&(t["X-Firebase-GMPID"]=e)}function GA(t,e){e!==null&&(t["X-Firebase-AppCheck"]=e)}function WA(t,e,n,r,s,a,o=!0){const c=UA(t.urlParams),u=t.url+c,d=Object.assign({},t.headers);return HA(d,e),zA(d,n),qA(d,a),GA(d,r),new $A(u,t.method,d,t.body,t.successCodes,t.additionalRetryCodes,t.handler,t.errorHandler,t.timeout,t.progressCallback,s,o)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function KA(t){if(t.length===0)return null;const e=t.lastIndexOf("/");return e===-1?"":t.slice(0,e)}function QA(t){const e=t.lastIndexOf("/",t.length-2);return e===-1?t:t.slice(e+1)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xc{constructor(e,n){this._service=e,n instanceof hn?this._location=n:this._location=hn.makeFromUrl(n,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,n){return new xc(e,n)}get root(){const e=new hn(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return QA(this._location.path)}get storage(){return this._service}get parent(){const e=KA(this._location.path);if(e===null)return null;const n=new hn(this._location.bucket,e);return new xc(this._service,n)}_throwIfRoot(e){if(this._location.path==="")throw MA(e)}}function Wy(t,e){const n=e==null?void 0:e[SA];return n==null?null:hn.makeFromBucketSpec(n,t)}function YA(t,e,n,r={}){t.host=`${e}:${n}`,t._protocol="http";const{mockUserToken:s}=r;s&&(t._overrideAuthToken=typeof s=="string"?s:gv(s,t.app.options.projectId))}class XA{constructor(e,n,r,s,a){this.app=e,this._authProvider=n,this._appCheckProvider=r,this._url=s,this._firebaseVersion=a,this._bucket=null,this._host=Ew,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=CA,this._maxUploadRetryTime=IA,this._requests=new Set,s!=null?this._bucket=hn.makeFromBucketSpec(s,this._host):this._bucket=Wy(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,this._url!=null?this._bucket=hn.makeFromBucketSpec(this._url,e):this._bucket=Wy(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){Gy("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){Gy("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){const n=await e.getToken();if(n!==null)return n.accessToken}return null}async _getAppCheckToken(){const e=this._appCheckProvider.getImmediate({optional:!0});return e?(await e.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new xc(this,e)}_makeRequest(e,n,r,s,a=!0){if(this._deleted)return new OA(Tw());{const o=WA(e,this._appId,r,s,n,this._firebaseVersion,a);return this._requests.add(o),o.getPromise().then(()=>this._requests.delete(o),()=>this._requests.delete(o)),o}}async makeRequestWithTokens(e,n){const[r,s]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,n,r,s).getPromise()}}const Ky="@firebase/storage",Qy="0.13.2";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jw="storage";function JA(t=Vc(),e){t=Le(t);const r=no(t,jw).getImmediate({identifier:e}),s=Tm("storage");return s&&ZA(r,...s),r}function ZA(t,e,n,r={}){YA(t,e,n,r)}function e2(t,{instanceIdentifier:e}){const n=t.getProvider("app").getImmediate(),r=t.getProvider("auth-internal"),s=t.getProvider("app-check-internal");return new XA(n,r,s,e,_s)}function t2(){Vr(new Jn(jw,e2,"PUBLIC").setMultipleInstances(!0)),tn(Ky,Qy,""),tn(Ky,Qy,"esm2017")}t2();/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Sw="functions";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class n2{constructor(e,n,r){this.auth=null,this.messaging=null,this.appCheck=null,this.auth=e.getImmediate({optional:!0}),this.messaging=n.getImmediate({optional:!0}),this.auth||e.get().then(s=>this.auth=s,()=>{}),this.messaging||n.get().then(s=>this.messaging=s,()=>{}),this.appCheck||r.get().then(s=>this.appCheck=s,()=>{})}async getAuthToken(){if(this.auth)try{const e=await this.auth.getToken();return e==null?void 0:e.accessToken}catch{return}}async getMessagingToken(){if(!(!this.messaging||!("Notification"in self)||Notification.permission!=="granted"))try{return await this.messaging.getToken()}catch{return}}async getAppCheckToken(e){if(this.appCheck){const n=e?await this.appCheck.getLimitedUseToken():await this.appCheck.getToken();return n.error?null:n.token}return null}async getContext(e){const n=await this.getAuthToken(),r=await this.getMessagingToken(),s=await this.getAppCheckToken(e);return{authToken:n,messagingToken:r,appCheckToken:s}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ah="us-central1";class r2{constructor(e,n,r,s,a=Ah,o){this.app=e,this.fetchImpl=o,this.emulatorOrigin=null,this.contextProvider=new n2(n,r,s),this.cancelAllRequests=new Promise(c=>{this.deleteService=()=>Promise.resolve(c())});try{const c=new URL(a);this.customDomain=c.origin+(c.pathname==="/"?"":c.pathname),this.region=Ah}catch{this.customDomain=null,this.region=a}}_delete(){return this.deleteService()}_url(e){const n=this.app.options.projectId;return this.emulatorOrigin!==null?`${this.emulatorOrigin}/${n}/${this.region}/${e}`:this.customDomain!==null?`${this.customDomain}/${e}`:`https://${this.region}-${n}.cloudfunctions.net/${e}`}}function s2(t,e,n){t.emulatorOrigin=`http://${e}:${n}`}const Yy="@firebase/functions",Xy="0.11.8";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const i2="auth-internal",a2="app-check-internal",o2="messaging-internal";function l2(t,e){const n=(r,{instanceIdentifier:s})=>{const a=r.getProvider("app").getImmediate(),o=r.getProvider(i2),c=r.getProvider(o2),u=r.getProvider(a2);return new r2(a,o,c,u,s,t)};Vr(new Jn(Sw,n,"PUBLIC").setMultipleInstances(!0)),tn(Yy,Xy,e),tn(Yy,Xy,"esm2017")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function c2(t=Vc(),e=Ah){const r=no(Le(t),Sw).getImmediate({identifier:e}),s=Tm("functions");return s&&u2(r,...s),r}function u2(t,e,n){s2(Le(t),e,n)}l2(fetch.bind(self));const d2={apiKey:"AIzaSyB1ddVOczgt5n2NkoIq3H_5x_eB0Aqw2HI",authDomain:"alojamientos-3c46b.firebaseapp.com",projectId:"alojamientos-3c46b",storageBucket:"alojamientos-3c46b.appspot.com",messagingSenderId:"858434059981",appId:"1:858434059981:web:f235cea133b874f985b384"},ee="alojamientos-3c46b",lu=vv(d2),Je=S1(lu),te=mA(lu);JA(lu);c2(lu);const Cw=async()=>{console.log("🔍 DIAGNÓSTICO COMPLETO DE FIREBASE"),console.log("=====================================");try{console.log("📱 App ID:",ee),console.log(`
📁 Verificando estructura de base de datos...`);const t=xe(te,"artifacts",ee,"public","data","users");console.log("👥 Ruta de usuarios:",`artifacts/${ee}/public/data/users`);try{const e=await In(t);if(console.log("👥 Total de usuarios encontrados:",e.size),e.empty)return console.log("❌ No hay usuarios en la colección"),{hasUsers:!1,users:[]};const n=[];e.docs.forEach((a,o)=>{const c=a.data(),u={id:a.id,email:c.email||"Sin email",role:c.role||"Sin rol",status:c.status||"Sin estado",createdAt:c.createdAt||"Sin fecha",fullName:c.fullName||"Sin nombre"};n.push(u),console.log(`👤 Usuario ${o+1}:`,u)}),console.log(`
🏢 Verificando configuración de empresa...`);const r=ue(te,"artifacts",ee,"public","data","settings","company_info"),s=await ls(r);s.exists()?(console.log("✅ Configuración de empresa encontrada"),console.log("📋 Configuración:",s.data())):console.log("❌ No hay configuración de empresa"),console.log(`
🔐 Verificando permisos...`);try{const a=He(t,xw(1));await In(a),console.log("✅ Permisos de lectura OK")}catch(a){console.error("❌ Error de permisos:",a)}return{hasUsers:!0,users:n,hasSettings:s.exists(),settings:s.exists()?s.data():null}}catch(e){return console.error("❌ Error accediendo a usuarios:",e),{hasUsers:!1,error:e.message}}}catch(t){return console.error("❌ Error en diagnóstico:",t),{hasUsers:!1,error:t.message}}},h2=async()=>{try{console.log("🔍 Buscando usuario más antiguo...");const t=xe(te,"artifacts",ee,"public","data","users");try{const s=He(t,po("createdAt","asc"),xw(1)),a=await In(s);if(!a.empty){const o=a.docs[0],c=o.data();return console.log("👑 Usuario más antiguo (con ordenamiento):",{id:o.id,email:c.email,role:c.role,createdAt:c.createdAt}),{user:o,data:c}}}catch(s){console.warn("⚠️ Error con ordenamiento, usando método alternativo:",s)}const e=await In(t);if(e.empty)return console.log("❌ No hay usuarios"),null;let n=null,r=null;return e.docs.forEach(s=>{const a=s.data(),o=a.createdAt;o&&(!r||o<r)&&(r=o,n={user:s,data:a})}),n?console.log("👑 Usuario más antiguo (método alternativo):",{id:n.user.id,email:n.data.email,role:n.data.role,createdAt:n.data.createdAt}):console.log("❌ No se pudo determinar el usuario más antiguo"),n}catch(t){return console.error("❌ Error buscando usuario más antiguo:",t),null}},m2=async()=>{try{console.log("🔐 Verificando usuarios en Authentication...");const t=Je.currentUser;return t?(console.log("✅ Usuario autenticado encontrado:",t.email),!0):(console.log("⚠️ No hay usuario autenticado, pero asumiendo que hay usuarios en el sistema"),!0)}catch(t){return console.error("❌ Error verificando Authentication:",t),!1}},Iw=V.createContext();function f2({message:t,type:e,onClose:n}){const r=e==="success"?"bg-green-500":"bg-red-500";return V.useEffect(()=>{const s=setTimeout(n,4e3);return()=>clearTimeout(s)},[n]),i.jsx("div",{className:`fixed top-5 right-5 ${r} text-white py-2 px-4 rounded-lg shadow-lg animate-fade-in-down`,children:t})}function p2({children:t}){const[e,n]=V.useState([]),r=(a,o="success")=>{const c=`${Date.now()}-${Math.random().toString(36).substr(2,9)}`;n(u=>[...u,{id:c,message:a,type:o}])},s=a=>{n(o=>o.filter(c=>c.id!==a))};return i.jsxs(Iw.Provider,{value:{addNotification:r},children:[t,i.jsx("div",{className:"fixed top-5 right-5 z-50 space-y-2",children:e.map(a=>i.jsx(f2,{message:a.message,type:a.type,onClose:()=>s(a.id)},a.id))})]})}const ke=()=>V.useContext(Iw),go=()=>i.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})}),Aw=()=>i.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),g2=()=>i.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"})}),y2=()=>i.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M15 21a6 6 0 00-9-5.197m0 0A5.995 5.995 0 0012 12.75a5.995 5.995 0 00-3-5.197m0 0A4 4 0 0112 4.354a4 4 0 013 3.249m-3 7.586a4 4 0 01-3-3.25"})}),vc=()=>i.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"})}),Sl=()=>i.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})}),kw=()=>i.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16M4 18h7"})}),cu=()=>i.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.096 2.572-1.065z"}),i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]}),cs=()=>i.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 5v2m0 4v2m0 4v2M5 5a2 2 0 00-2 2v3a2 2 0 110 4v3a2 2 0 002 2h14a2 2 0 002-2v-3a2 2 0 110-4V7a2 2 0 00-2-2H5z"})}),x2=()=>i.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"})}),v2=()=>i.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:i.jsx("path",{fillRule:"evenodd",d:"M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z",clipRule:"evenodd"})}),Ii=()=>i.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-gray-400",viewBox:"0 0 20 20",fill:"currentColor",children:i.jsx("path",{fillRule:"evenodd",d:"M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z",clipRule:"evenodd"})}),b2=()=>i.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})}),w2=()=>i.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 17h5l-5 5v-5zM4.828 7l2.586 2.586a2 2 0 002.828 0L12 7H4.828zM4.828 17h5l-5-5v5zM12 7l2.586 2.586a2 2 0 002.828 0L20 7h-8z"})}),Ut=()=>i.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"})}),ri=()=>i.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.207A1 1 0 013 6.5V4z"})}),uu=()=>i.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),bi=()=>i.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})}),Mr=()=>i.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})}),Pw=()=>i.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z"})}),Jt=()=>i.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),$r=()=>i.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]}),Ka=()=>i.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})}),bc=()=>i.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})}),_2=()=>i.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13"})}),N2=()=>i.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})});function yo({children:t}){const[e,n]=V.useState(!1),[r,s]=V.useState({top:0,left:0,position:"bottom-right"}),a=V.useRef(null),o=V.useRef(null);V.useEffect(()=>{const u=d=>{a.current&&!a.current.contains(d.target)&&n(!1)};return document.addEventListener("mousedown",u),()=>document.removeEventListener("mousedown",u)},[a]),V.useEffect(()=>{if(e&&o.current){const u=o.current.getBoundingClientRect(),d=window.innerHeight,m=window.innerWidth,y=d-u.bottom,g=u.top,x=m-u.right,C=u.left;let E=u.bottom+8,A=u.right-224,N="bottom-right";y<200&&g>y&&(E=u.top-8,N=x>224?"top-right":"top-left"),x<224&&C>224&&(A=u.left-224,N=y>200?"bottom-left":"top-left"),A<8&&(A=8),A+224>m-8&&(A=m-232),E<8&&(E=8),E+200>d-8&&(E=d-208),s({top:E,left:A,position:N})}},[e]);const c=()=>"fixed w-56 rounded-md shadow-lg bg-white ring-1 ring-black ring-opacity-5 z-50";return i.jsxs("div",{className:"relative inline-block text-left",ref:a,children:[i.jsxs("button",{ref:o,onClick:()=>n(!e),className:"inline-flex justify-center w-full rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:["Acciones ",i.jsx(v2,{className:"-mr-1 ml-2 h-5 w-5"})]}),e&&i.jsx("div",{className:c(),style:{top:`${r.top}px`,left:`${r.left}px`},children:i.jsx("div",{className:"py-1",role:"menu","aria-orientation":"vertical",onClick:()=>n(!1),children:t})})]})}function E2({isOpen:t,onClose:e,onSave:n,service:r,clients:s,isDemo:a}){var $;const{addNotification:o}=ke(),[c,u]=V.useState({}),[d,m]=V.useState(""),[y,g]=V.useState(""),[x,C]=V.useState(""),[E,A]=V.useState(!1),[N,T]=V.useState(""),[k,L]=V.useState(!1),q=["Activo","Periodo de Gracia Vencido","Pendiente Pago","Pago","Cancelado"],z=()=>{const D=new Date,F=D.getFullYear().toString().slice(-2),O=(D.getMonth()+1).toString().padStart(2,"0"),M=D.getDate().toString().padStart(2,"0"),W=D.getTime().toString().slice(-6);return`SRV-${F}${O}${M}-${W}`},j=(D,F)=>{if(!D||D==="One-Time"||!F)return{startDate:"",endDate:""};const O=new Date(F);let M=new Date(O);switch(D){case"Monthly":M.setMonth(M.getMonth()+1);break;case"Semiannually":M.setMonth(M.getMonth()+6);break;case"Annually":M.setFullYear(M.getFullYear()+1);break;case"Biennially":M.setFullYear(M.getFullYear()+2);break;case"Triennially":M.setFullYear(M.getFullYear()+3);break;case"Custom":return{startDate:O.toISOString().split("T")[0],endDate:""};default:if(D&&D!=="Custom"&&D!=="One-Time"){const W=D.match(/(\d+)\s*mes/i),U=D.match(/(\d+)\s*año/i);if(W){const Q=parseInt(W[1]);M.setMonth(M.getMonth()+Q)}else if(U){const Q=parseInt(U[1]);M.setFullYear(M.getFullYear()+Q)}else return{startDate:O.toISOString().split("T")[0],endDate:""}}else return{startDate:"",endDate:""};break}return{startDate:O.toISOString().split("T")[0],endDate:M.toISOString().split("T")[0]}},v=()=>[{value:"One-Time",label:"Pago único"},{value:"Monthly",label:"Mensual"},{value:"Semiannually",label:"Semestral"},{value:"Annually",label:"Anual"},{value:"Biennially",label:"Bianual (2 años)"},{value:"Triennially",label:"Trienal (3 años)"},{value:"Custom",label:"Otros"}];V.useEffect(()=>{const D={clientName:"",clientEmail:"",serviceType:"Hosting",description:"",amount:"",currency:"USD",dueDate:"",billingCycle:"One-Time",status:"Activo",clientNotes:"",adminNotes:"",assignedUserId:""};if(r){u({...r,dueDate:r.dueDate?new Date(r.dueDate.seconds*1e3).toISOString().split("T")[0]:"",assignedUserId:r.assignedUserId||""}),g(r.serviceNumber||"");const F=["Hosting","Dominio","Dominio + Hosting"];r.serviceType&&!F.includes(r.serviceType)?(T(r.serviceType),L(!0)):(T(""),L(!1));const O=["One-Time","Monthly","Semiannually","Annually","Biennially","Triennially"];if(r.billingCycle&&!O.includes(r.billingCycle)?(C(r.billingCycle),A(!0)):(C(""),A(!1)),r.assignedUserId){const M=s.find(W=>W.id===r.assignedUserId);M&&m(M.email)}}else{const F=z();u(D),m(""),g(F),T(""),L(!1),C(""),A(!1)}},[r,s]);const S=D=>{const{name:F,value:O}=D.target;u(M=>({...M,[F]:O})),F==="billingCycle"&&(O==="Custom"?A(!0):(A(!1),C(""))),F==="serviceType"&&(O==="Otro"?L(!0):(L(!1),T("")))},p=D=>{const F=D.target.value;C(F),u(O=>({...O,billingCycle:F||"Custom"}))},I=D=>{const F=D.target.value;T(F),u(O=>({...O,serviceType:F||"Otro"}))},b=D=>{m(D);const F=s.find(O=>O.email===D);u(F?O=>({...O,clientEmail:F.email,clientName:F.fullName||F.email.split("@")[0],assignedUserId:F.id}):O=>({...O,assignedUserId:""}))},_=async D=>{if(D.preventDefault(),a){o("Función no disponible en modo demo.","error");return}try{const F={...c,amount:parseFloat(c.amount),dueDate:oe.fromDate(new Date(c.dueDate)),serviceNumber:y};await n(F),o(`Servicio ${r?"actualizado":"creado"} exitosamente.`,"success"),e()}catch(F){o("Error al guardar el servicio.","error"),console.error(F)}};return t?i.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex justify-center items-center p-4",children:i.jsxs("div",{className:"bg-white rounded-lg shadow-2xl p-8 max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[i.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-6",children:r?"Editar Servicio":"Añadir Nuevo Servicio"}),i.jsxs("form",{onSubmit:_,className:"space-y-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Número de Servicio"}),i.jsx("input",{type:"text",value:y,onChange:D=>g(D.target.value),className:"w-full p-2 border rounded-md bg-gray-50 font-mono",placeholder:"SRV-YYMMDD-XXXXXX",required:!0}),i.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Identificador único del servicio"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Asignar a Cliente Existente"}),i.jsxs("select",{value:d,onChange:D=>b(D.target.value),className:"w-full p-2 border rounded-md bg-gray-50",children:[i.jsx("option",{value:"",children:"-- Opcional --"}),s.map(D=>i.jsx("option",{value:D.email,children:D.fullName||D.email},D.id))]}),d&&i.jsxs("p",{className:"text-sm text-green-600 mt-1",children:["✓ Servicio asignado a: ",(($=s.find(D=>D.email===d))==null?void 0:$.fullName)||d]})]}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[i.jsx("input",{name:"clientName",value:c.clientName||"",onChange:S,placeholder:"Nombre del Cliente",className:"w-full p-2 border rounded-md",required:!0}),i.jsx("input",{name:"clientEmail",type:"email",value:c.clientEmail||"",onChange:S,placeholder:"Email del Cliente",className:"w-full p-2 border rounded-md",required:!0})]}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tipo de Servicio"}),i.jsxs("select",{name:"serviceType",value:c.serviceType||"Hosting",onChange:S,className:"w-full p-2 border rounded-md",children:[i.jsx("option",{children:"Hosting"}),i.jsx("option",{children:"Dominio"}),i.jsx("option",{children:"Dominio + Hosting"}),i.jsx("option",{children:"Otro"})]}),k&&i.jsxs("div",{className:"mt-2",children:[i.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"Especificar tipo de servicio personalizado"}),i.jsx("input",{type:"text",value:N,onChange:I,placeholder:"Ej: VPS, Cloud Storage, SSL, etc.",className:"w-full p-2 border rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"}),i.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Escribe el tipo de servicio específico que ofreces"})]})]}),i.jsx("input",{name:"description",value:c.description||"",onChange:S,placeholder:"Descripción (ej: plan, dominio.com)",className:"w-full p-2 border rounded-md"})]}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[i.jsx("input",{name:"amount",type:"number",step:"0.01",value:c.amount||"",onChange:S,placeholder:"Monto",className:"w-full p-2 border rounded-md",required:!0}),i.jsxs("select",{name:"currency",value:c.currency||"USD",onChange:S,className:"w-full p-2 border rounded-md",children:[i.jsx("option",{children:"USD"}),i.jsx("option",{children:"COP"})]}),i.jsx("input",{name:"dueDate",type:"date",value:c.dueDate||"",onChange:S,className:"w-full p-2 border rounded-md",required:!0})]}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Ciclo de Facturación"}),i.jsx("select",{name:"billingCycle",value:c.billingCycle||"One-Time",onChange:S,className:"w-full p-2 border rounded-md",children:v().map(D=>i.jsx("option",{value:D.value,children:D.label},D.value))}),E&&i.jsxs("div",{className:"mt-2",children:[i.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"Especificar ciclo personalizado"}),i.jsx("input",{type:"text",value:x,onChange:p,placeholder:"Ej: 6 meses, 18 meses, 2 años, etc.",className:"w-full p-2 border rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"}),i.jsx("p",{className:"text-xs text-gray-500 mt-1",children:'Puedes escribir el período en meses o años (ej: "6 meses", "2 años")'})]})]}),i.jsx("select",{name:"status",value:c.status||"Activo",onChange:S,className:"w-full p-2 border rounded-md",children:q.map(D=>i.jsx("option",{value:D,children:D},D))})]}),c.billingCycle&&c.billingCycle!=="One-Time"&&c.dueDate&&i.jsxs("div",{className:"bg-blue-50 p-4 rounded-md",children:[i.jsx("h4",{className:"text-sm font-medium text-blue-800 mb-2",children:"Período del Servicio"}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-xs font-medium text-blue-700 mb-1",children:"Fecha de Inicio"}),i.jsx("input",{type:"date",value:j(c.billingCycle,c.dueDate).startDate,readOnly:!0,className:"w-full p-2 border border-blue-200 rounded-md bg-blue-50 text-blue-800"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-xs font-medium text-blue-700 mb-1",children:"Fecha de Vencimiento"}),i.jsx("input",{type:"date",value:j(c.billingCycle,c.dueDate).endDate,readOnly:!0,className:"w-full p-2 border border-blue-200 rounded-md bg-blue-50 text-blue-800"})]})]})]}),c.billingCycle==="One-Time"&&i.jsxs("div",{className:"bg-yellow-50 p-4 rounded-md",children:[i.jsx("h4",{className:"text-sm font-medium text-yellow-800 mb-2",children:"Pago Único"}),i.jsxs("div",{className:"space-y-2",children:[i.jsxs("div",{className:"flex items-center space-x-2",children:[i.jsx("input",{type:"radio",id:"activation-only",name:"oneTimeType",value:"activation-only",className:"text-yellow-600"}),i.jsx("label",{htmlFor:"activation-only",className:"text-sm text-yellow-700",children:"Solo fecha de activación (sin expiración)"})]}),i.jsxs("div",{className:"flex items-center space-x-2",children:[i.jsx("input",{type:"radio",id:"with-expiration",name:"oneTimeType",value:"with-expiration",className:"text-yellow-600"}),i.jsx("label",{htmlFor:"with-expiration",className:"text-sm text-yellow-700",children:"Con fecha de expiración"})]}),i.jsxs("div",{className:"ml-6",children:[i.jsx("label",{className:"block text-xs font-medium text-yellow-700 mb-1",children:"Hasta qué fecha expira"}),i.jsx("input",{type:"date",name:"expirationDate",value:c.expirationDate||"",onChange:S,className:"w-full p-2 border border-yellow-200 rounded-md"})]})]})]}),i.jsx("textarea",{name:"clientNotes",value:c.clientNotes||"",onChange:S,placeholder:"Notas para el cliente (visible en su portal)",rows:"3",className:"w-full p-2 border rounded-md"}),i.jsx("textarea",{name:"adminNotes",value:c.adminNotes||"",onChange:S,placeholder:"Notas internas (solo para administrador)",rows:"3",className:"w-full p-2 border rounded-md"}),i.jsxs("div",{className:"flex justify-end space-x-4 pt-4",children:[i.jsx("button",{type:"button",onClick:e,className:"px-4 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300",children:"Cancelar"}),i.jsx("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:"Guardar Servicio"})]})]})]})}):null}function T2({isOpen:t,onClose:e,onSend:n,service:r,templates:s,companySettings:a,isDemo:o}){const{addNotification:c}=ke(),[u,d]=V.useState(""),[m,y]=V.useState(""),[g,x]=V.useState("");if(V.useEffect(()=>{var E;s.length>0&&t&&d(((E=s[0])==null?void 0:E.id)||"")},[s,t]),V.useEffect(()=>{var E;if(u&&r){const A=s.find(N=>N.id===u);if(A){const N=r.dueDate?new Date(r.dueDate.seconds*1e3).toLocaleDateString():"N/A",T={"{clientName}":r.clientName||"","{serviceType}":r.serviceType||"","{description}":r.description||"","{amount}":`$${(E=r.amount)==null?void 0:E.toFixed(2)} ${r.currency}`||"","{dueDate}":N,"{companyName}":a.companyName||"Tu Empresa"};let k=A.subject,L=A.body;for(const q in T){const z=new RegExp(q.replace(/[-\\/\\^$*+?.()|[\]{}]/g,"\\$&"),"g");k=k.replace(z,T[q]),L=L.replace(z,T[q])}y(k),x(L)}}},[u,r,s,a]),!t)return null;const C=()=>{var E;n({to:r.clientEmail,subject:m,body:g,reason:`Notificación Manual: ${((E=s.find(A=>A.id===u))==null?void 0:E.name)||"Mensaje Personalizado"}`}),e()};return i.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex justify-center items-center p-4",children:i.jsxs("div",{className:"bg-white rounded-lg shadow-2xl p-8 max-w-2xl w-full",children:[i.jsxs("h2",{className:"text-2xl font-bold mb-4",children:["Enviar Notificación a ",r.clientName]}),i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Seleccionar Plantilla"}),i.jsx("select",{value:u,onChange:E=>d(E.target.value),className:"mt-1 w-full p-2 border rounded-md",children:s.map(E=>i.jsx("option",{value:E.id,children:E.name},E.id))})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Asunto"}),i.jsx("input",{type:"text",value:m,onChange:E=>y(E.target.value),className:"mt-1 w-full p-2 border rounded-md"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Cuerpo del Mensaje (Editable)"}),i.jsx("textarea",{value:g,onChange:E=>x(E.target.value),rows:"10",className:"mt-1 w-full p-2 border rounded-md font-mono text-sm"})]})]}),i.jsxs("div",{className:"flex justify-end gap-4 mt-8",children:[i.jsx("button",{onClick:e,className:"px-4 py-2 bg-gray-200 rounded-md",children:"Cancelar"}),i.jsx("button",{onClick:C,className:"px-4 py-2 bg-blue-600 text-white rounded-md",children:"Enviar"})]})]})})}function j2({isDemo:t,userRole:e}){const{addNotification:n}=ke(),[r,s]=V.useState([]),[a,o]=V.useState([]),[c,u]=V.useState(!1),[d,m]=V.useState(null),[y,g]=V.useState("Todos"),[x,C]=V.useState(""),[E,A]=V.useState(!1),[N,T]=V.useState([]),[k,L]=V.useState({}),q=["Activo","Periodo de Gracia Vencido","Pendiente Pago","Pago","Cancelado"];V.useEffect(()=>{if(t){const Y=oe.fromDate(new Date);s([{id:"s1",clientName:"Juan Perez (Demo)",clientEmail:"juan@demo.com",serviceType:"Hosting",description:"Plan Pro",amount:25,currency:"USD",dueDate:Y,billingCycle:"Monthly",status:"Pendiente Pago",clientNotes:"A la espera del pago.",adminNotes:"Contactado por teléfono."},{id:"s2",clientName:"Maria Garcia (Demo)",clientEmail:"maria@demo.com",serviceType:"Dominio",description:"nuevositio.co",amount:5e4,currency:"COP",dueDate:Y,billingCycle:"Annually",status:"Pago",clientNotes:"",adminNotes:""},{id:"s3",clientName:"Carlos Lopez (Demo)",clientEmail:"carlos@demo.com",serviceType:"Mantenimiento",description:"Sitio Web",amount:150,currency:"USD",dueDate:Y,billingCycle:"Monthly",status:"Activo",clientNotes:"Servicio funcionando correctamente.",adminNotes:"Cliente satisfecho."},{id:"s4",clientName:"Ana Rodriguez (Demo)",clientEmail:"ana@demo.com",serviceType:"Hosting",description:"Plan Básico",amount:15,currency:"USD",dueDate:Y,billingCycle:"Monthly",status:"Periodo de Gracia Vencido",clientNotes:"Necesita renovar pronto.",adminNotes:"Enviar recordatorio urgente."},{id:"s5",clientName:"Pedro Martinez (Demo)",clientEmail:"pedro@demo.com",serviceType:"Dominio",description:"tiendaonline.com",amount:12e4,currency:"COP",dueDate:Y,billingCycle:"Annually",status:"Cancelado",clientNotes:"Cliente canceló el servicio.",adminNotes:"Cancelación por solicitud del cliente."}]),o([{id:"c1",email:"juan@demo.com",fullName:"Juan Perez (Demo)"},{id:"c2",email:"maria@demo.com",fullName:"Maria Garcia (Demo)"}]),T([{id:"t1",name:"Recordatorio General (Demo)",subject:"Recordatorio de pago",body:"Hola {clientName}, recuerda pagar..."}]),L({companyName:"Tu Empresa (Demo)"});return}const F=xe(te,"artifacts",ee,"public","data","services"),O=He(F,po("dueDate","desc")),M=Ee(O,Y=>{s(Y.docs.map(ne=>({id:ne.id,...ne.data()})))}),W=xe(te,"artifacts",ee,"public","data","users"),U=He(W,rt("role","==","client")),Q=Ee(U,Y=>{o(Y.docs.map(ne=>({id:ne.id,...ne.data()})))}),P=xe(te,"artifacts",ee,"public","data","messageTemplates"),H=Ee(P,Y=>{T(Y.docs.map(ne=>({id:ne.id,...ne.data()})))}),R=ue(te,"artifacts",ee,"public","data","settings","company"),K=Ee(R,Y=>{Y.exists()&&L(Y.data())});return()=>{M(),Q(),H(),K()}},[t]);const z=async F=>{if(t){n("Función no disponible en modo demo.","error");return}const O=xe(te,"artifacts",ee,"public","data","services");try{if(F.id){const{id:M,...W}=F;await qe(ue(O,M),W)}else await sr(O,{...F,createdAt:oe.now()})}catch(M){throw M}},j=async F=>{if(t){n("Función no disponible en modo demo.","error");return}if(window.confirm("¿Seguro que quieres eliminar este servicio?"))try{await vi(ue(te,"artifacts",ee,"public","data","services",F)),n("Servicio eliminado.","success")}catch{n("Error al eliminar el servicio.","error")}},v=async F=>{if(t){n(`Simulación: Enviando correo a ${F.to}.`,"success");return}try{await sr(xe(te,"artifacts",ee,"public","data","messageHistory"),{...F,sentAt:oe.now()}),n("Notificación registrada en el historial.","success")}catch{n("Error al registrar la notificación.","error")}},S=async(F,O)=>{if(t){n("Función no disponible en modo demo.","error");return}try{await qe(ue(te,"artifacts",ee,"public","data","services",F),{status:O}),n("Estado actualizado.","success")}catch{n("Error al actualizar estado.","error")}},p=F=>F.status==="Pendiente Pago"&&F.dueDate&&F.dueDate.toDate()<new Date?"Periodo de Gracia Vencido":F.status,I=(F,O)=>{if(!O)return"text-gray-500";const M=new Date,U=(O.toDate()-M)/(1e3*60*60*24);return F==="Pago"?"text-green-600":F==="Cancelado"?"text-gray-500":F==="Periodo de Gracia Vencido"||U<0?"text-red-600 font-bold":F==="Pendiente Pago"&&U<7?"text-yellow-600 font-semibold":F==="Activo"?"text-blue-600":"text-gray-700"},b=F=>{if(!F.dueDate||!F.billingCycle||F.billingCycle==="One-Time")return F.expirationDate?F.expirationDate.toDate().toLocaleDateString():"N/A";const O=F.dueDate.toDate();let M=new Date(O);switch(F.billingCycle){case"Monthly":M.setMonth(M.getMonth()+1);break;case"Semiannually":M.setMonth(M.getMonth()+6);break;case"Annually":M.setFullYear(M.getFullYear()+1);break;case"Biennially":M.setFullYear(M.getFullYear()+2);break;case"Triennially":M.setFullYear(M.getFullYear()+3);break;default:return"N/A"}return M.toLocaleDateString()},_=F=>({"One-Time":"Pago único",Monthly:"Mensual",Semiannually:"Semestral",Annually:"Anual",Biennially:"Bianual",Triennially:"Trienal",Custom:"Personalizado"})[F]||F,$=F=>{m(F),A(!0)},D=r.filter(F=>y==="Todos"||p(F)===y).filter(F=>{var W,U,Q,P,H,R,K,Y,ne,pe;if(!x)return!0;const O=x.toLowerCase(),M=p(F);return((W=F.clientName)==null?void 0:W.toLowerCase().includes(O))||((U=F.clientEmail)==null?void 0:U.toLowerCase().includes(O))||((Q=F.serviceType)==null?void 0:Q.toLowerCase().includes(O))||((P=F.description)==null?void 0:P.toLowerCase().includes(O))||((H=F.amount)==null?void 0:H.toString().includes(O))||((R=F.currency)==null?void 0:R.toLowerCase().includes(O))||((K=F.billingCycle)==null?void 0:K.toLowerCase().includes(O))||(M==null?void 0:M.toLowerCase().includes(O))||((Y=F.clientNotes)==null?void 0:Y.toLowerCase().includes(O))||((ne=F.adminNotes)==null?void 0:ne.toLowerCase().includes(O))||F.dueDate&&new Date(F.dueDate.seconds*1e3).toLocaleDateString().includes(O)||F.dueDate&&((pe=F.dueDate.seconds)==null?void 0:pe.toString().includes(O))});return i.jsxs("div",{className:"p-4 sm:p-6 lg:p-8",children:[i.jsxs("div",{className:"flex flex-wrap justify-between items-center gap-4 mb-6",children:[i.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[["Todos",...q].map(F=>i.jsx("button",{onClick:()=>g(F),className:`px-4 py-2 rounded-full text-sm font-semibold transition-colors ${y===F?"bg-blue-600 text-white shadow-lg":"bg-white hover:bg-gray-100"}`,children:F},F)),i.jsxs("div",{className:"relative",children:[i.jsx("input",{type:"text",placeholder:"Buscar en toda la tabla...",value:x,onChange:F=>C(F.target.value),className:"pl-10 pr-4 py-2 border rounded-full w-full sm:w-64"}),i.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:i.jsx(Ii,{})})]})]}),i.jsxs("button",{onClick:()=>{m(null),u(!0)},className:"flex items-center space-x-2 px-4 py-2 bg-blue-600 text-white rounded-lg shadow-md hover:bg-blue-700",children:[i.jsx(go,{})," ",i.jsx("span",{className:"hidden sm:inline",children:"Nuevo Servicio"})]})]}),i.jsx("div",{className:"bg-white rounded-xl shadow-lg overflow-x-auto",children:i.jsxs("table",{className:"w-full text-left",children:[i.jsx("thead",{className:"bg-gray-50",children:i.jsx("tr",{children:["Número","Cliente","Servicio","Monto","Ciclo","Fecha de Inicio","Fecha de Vencimiento","Notas","Estado","Acciones"].map(F=>i.jsx("th",{className:"px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:F},F))})}),i.jsx("tbody",{className:"divide-y divide-gray-200",children:D.map(F=>{var M;const O=p(F);return i.jsxs("tr",{children:[i.jsx("td",{className:"px-6 py-4",children:i.jsx("div",{className:"font-mono text-sm font-medium text-blue-600",children:F.serviceNumber||"N/A"})}),i.jsxs("td",{className:"px-6 py-4",children:[i.jsx("div",{className:"font-medium",children:F.clientName}),i.jsx("div",{className:"text-sm text-gray-500",children:F.clientEmail})]}),i.jsxs("td",{className:"px-6 py-4",children:[i.jsx("div",{className:"font-semibold",children:F.serviceType}),i.jsx("div",{className:"text-sm text-gray-600",children:F.description})]}),i.jsxs("td",{className:"px-6 py-4 font-semibold",children:[(M=F.amount)==null?void 0:M.toFixed(2)," ",F.currency]}),i.jsxs("td",{className:"px-6 py-4",children:[i.jsx("div",{className:"text-sm font-medium text-gray-900",children:_(F.billingCycle)}),F.billingCycle==="Custom"&&F.customBillingCycle&&i.jsxs("div",{className:"text-xs text-gray-500",children:["(",F.customBillingCycle,")"]})]}),i.jsxs("td",{className:`px-6 py-4 ${I(O,F.dueDate)}`,children:[i.jsx("div",{className:"text-sm",children:F.dueDate?F.dueDate.toDate().toLocaleDateString():"N/A"}),i.jsx("div",{className:"text-xs text-gray-500",children:"Inicio"})]}),i.jsxs("td",{className:"px-6 py-4",children:[i.jsx("div",{className:"text-sm font-medium text-gray-900",children:b(F)}),i.jsx("div",{className:"text-xs text-gray-500",children:"Vencimiento"})]}),i.jsxs("td",{className:"px-6 py-4 text-xs max-w-xs",children:[F.clientNotes&&i.jsxs("div",{className:"truncate",title:F.clientNotes,children:[i.jsx("strong",{children:"Cliente:"})," ",F.clientNotes]}),F.adminNotes&&i.jsxs("div",{className:"truncate text-purple-600 mt-1",title:F.adminNotes,children:[i.jsx("strong",{children:"Admin:"})," ",F.adminNotes]})]}),i.jsx("td",{className:"px-6 py-4",children:i.jsx("select",{value:F.status,onChange:W=>S(F.id,W.target.value),className:"p-1 text-xs rounded-md border-gray-300 bg-white shadow-sm w-full",children:q.map(W=>i.jsx("option",{value:W,children:W},W))})}),i.jsx("td",{className:"px-6 py-4 text-center",children:i.jsxs(yo,{children:[i.jsx("button",{onClick:()=>{m(F),u(!0)},className:"block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100",children:"Editar"}),i.jsx("button",{onClick:()=>$(F),className:"block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100",children:"Enviar Notificación"}),i.jsx("button",{onClick:()=>j(F.id),className:"block w-full text-left px-4 py-2 text-sm text-red-700 hover:bg-red-50",children:"Eliminar"})]})})]},F.id)})})]})}),i.jsx(E2,{isOpen:c,onClose:()=>u(!1),onSave:z,service:d,clients:a,isDemo:t}),i.jsx(T2,{isOpen:E,onClose:()=>A(!1),onSend:v,service:d,templates:N,companySettings:k,isDemo:t})]})}function S2({isOpen:t,onClose:e,onSave:n,user:r,isDemo:s}){const{addNotification:a}=ke(),[o,c]=V.useState({});V.useEffect(()=>{r&&c(r)},[r]);const u=m=>{const{name:y,value:g}=m.target;c(x=>({...x,[y]:g}))},d=async m=>{m.preventDefault();try{await n(o),a("Usuario actualizado.","success"),e()}catch{a("Error al actualizar usuario.","error")}};return t?i.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex justify-center items-center p-4",children:i.jsxs("div",{className:"bg-white rounded-lg shadow-2xl p-8 max-w-lg w-full",children:[i.jsx("h2",{className:"text-2xl font-bold mb-6",children:"Editar Usuario"}),i.jsxs("form",{onSubmit:d,className:"space-y-4",children:[i.jsx("input",{name:"fullName",value:o.fullName||"",onChange:u,placeholder:"Nombre Completo",className:"w-full p-2 border rounded-md"}),i.jsx("input",{name:"identification",value:o.identification||"",onChange:u,placeholder:"Identificación",className:"w-full p-2 border rounded-md"}),i.jsx("input",{type:"email",value:o.email||"",readOnly:!0,disabled:!0,className:"w-full p-2 border rounded-md bg-gray-100"}),i.jsxs("div",{className:"flex justify-end space-x-4 pt-4",children:[i.jsx("button",{type:"button",onClick:e,className:"px-4 py-2 bg-gray-200 rounded-md",children:"Cancelar"}),i.jsx("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded-md",children:"Guardar Cambios"})]})]})]})}):null}function C2({isOpen:t,onClose:e,onSave:n,isDemo:r}){const{addNotification:s}=ke(),[a,o]=V.useState(""),[c,u]=V.useState(""),[d,m]=V.useState(""),[y,g]=V.useState(""),[x,C]=V.useState("client"),[E,A]=V.useState("active"),[N,T]=V.useState(!1),[k,L]=V.useState(""),q=[{value:"client",label:"Cliente"},{value:"admin",label:"Administrador"},{value:"superadmin",label:"Super Administrador"}],z=[{value:"active",label:"Activo"},{value:"inactive",label:"Inactivo"},{value:"pending",label:"Pendiente"}],j=()=>{o(""),u(""),m(""),g(""),C("client"),A("active"),T(!1),L("")},v=()=>{j(),e()},S=async p=>{if(p.preventDefault(),c.length<6){L("La contraseña debe tener al menos 6 caracteres.");return}L("");try{await n({email:a,password:c,notify:N,fullName:d,identification:y,role:x,status:E}),e()}catch{s("Error al crear usuario.","error")}};return t?i.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex justify-center items-center p-4",children:i.jsxs("div",{className:"bg-white rounded-lg shadow-2xl p-8 max-w-md w-full",children:[i.jsx("h2",{className:"text-2xl font-bold mb-6",children:"Crear Nuevo Usuario"}),i.jsxs("form",{onSubmit:S,className:"space-y-4",children:[i.jsx("input",{type:"email",value:a,onChange:p=>o(p.target.value),placeholder:"Email del nuevo usuario",className:"w-full p-2 border rounded-md",required:!0}),i.jsx("input",{type:"password",value:c,onChange:p=>u(p.target.value),placeholder:"Contraseña temporal",className:"w-full p-2 border rounded-md",required:!0}),i.jsx("input",{value:d,onChange:p=>m(p.target.value),placeholder:"Nombre Completo",className:"w-full p-2 border rounded-md"}),i.jsx("input",{value:y,onChange:p=>g(p.target.value),placeholder:"Identificación",className:"w-full p-2 border rounded-md"}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Rol"}),i.jsx("select",{value:x,onChange:p=>C(p.target.value),className:"w-full p-2 border rounded-md",required:!0,children:q.map(p=>i.jsx("option",{value:p.value,children:p.label},p.value))})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Estado"}),i.jsx("select",{value:E,onChange:p=>A(p.target.value),className:"w-full p-2 border rounded-md",required:!0,children:z.map(p=>i.jsx("option",{value:p.value,children:p.label},p.value))})]})]}),k&&i.jsx("p",{className:"text-red-500 text-sm",children:k}),i.jsxs("div",{className:"flex items-center",children:[i.jsx("input",{id:"notify",type:"checkbox",checked:N,onChange:p=>T(p.target.checked),className:"h-4 w-4 text-blue-600 border-gray-300 rounded"}),i.jsx("label",{htmlFor:"notify",className:"ml-2 block text-sm text-gray-900",children:"Notificar al usuario por correo"})]}),i.jsxs("div",{className:"flex justify-end space-x-4 pt-4",children:[i.jsx("button",{type:"button",onClick:v,className:"px-4 py-2 bg-gray-200 rounded-md",children:"Cancelar"}),i.jsx("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded-md",children:"Crear Usuario"})]})]})]})}):null}function I2({isOpen:t,onClose:e,user:n,onActivate:r}){const{addNotification:s}=ke(),[a,o]=V.useState(""),[c,u]=V.useState(!1),d=`Hola ${(n==null?void 0:n.fullName)||(n==null?void 0:n.email)},

Tu cuenta ha sido activada exitosamente en nuestro sistema de gestión de cobros.

Ahora puedes:
• Ver tus servicios contratados
• Crear tickets de soporte
• Gestionar tu perfil

Para acceder, simplemente inicia sesión con tu email y contraseña.

¡Bienvenido!

Equipo de Soporte`,m=async()=>{u(!0);try{await r(),await sr(xe(te,"artifacts",ee,"public","data","messageHistory"),{to:n.email,subject:"Cuenta Activada - Sistema de Gestión de Cobros",body:a||d,reason:"Activación de Usuario",sentAt:oe.now(),type:"activation"}),s(`Usuario ${n.email} activado y notificado exitosamente`,"success"),e()}catch(y){s("Error al activar usuario","error"),console.error("Error activating user:",y)}finally{u(!1)}};return t?i.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-70 z-50 flex justify-center items-center p-4",children:i.jsxs("div",{className:"bg-white rounded-lg shadow-2xl p-8 max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[i.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Activar Usuario"}),i.jsxs("div",{className:"mb-6 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[i.jsx("h3",{className:"font-semibold text-blue-800 mb-2",children:"Usuario a Activar:"}),i.jsxs("p",{className:"text-blue-700",children:[i.jsx("strong",{children:"Email:"})," ",n==null?void 0:n.email,i.jsx("br",{}),i.jsx("strong",{children:"Nombre:"})," ",(n==null?void 0:n.fullName)||"Sin especificar",i.jsx("br",{}),i.jsx("strong",{children:"Rol:"})," ",(n==null?void 0:n.role)||"Cliente"]})]}),i.jsxs("div",{className:"mb-4",children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Mensaje de Notificación (Opcional)"}),i.jsx("textarea",{value:a,onChange:y=>o(y.target.value),rows:"8",className:"w-full p-3 border rounded-md focus:ring-2 focus:ring-blue-500",placeholder:d}),i.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Si no escribes un mensaje personalizado, se enviará el mensaje por defecto."})]}),i.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-6",children:[i.jsx("h4",{className:"font-semibold text-yellow-800 mb-2",children:"¿Qué sucederá?"}),i.jsxs("ul",{className:"text-sm text-yellow-700 space-y-1",children:[i.jsx("li",{children:"• El usuario será activado inmediatamente"}),i.jsx("li",{children:"• Se enviará una notificación por email"}),i.jsx("li",{children:"• El usuario podrá iniciar sesión"}),i.jsx("li",{children:"• Si es cliente, deberá completar su perfil"})]})]}),i.jsxs("div",{className:"flex justify-end space-x-4",children:[i.jsx("button",{onClick:e,className:"px-4 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300",children:"Cancelar"}),i.jsx("button",{onClick:m,disabled:c,className:"px-6 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 disabled:opacity-50 flex items-center gap-2",children:c?i.jsxs(i.Fragment,{children:[i.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Activando..."]}):"Activar y Notificar"})]})]})}):null}function A2({isDemo:t,userRole:e}){const{addNotification:n}=ke(),[r,s]=V.useState([]),[a,o]=V.useState(""),[c,u]=V.useState(!1),[d,m]=V.useState(!1),[y,g]=V.useState(!1),[x,C]=V.useState(null),[E,A]=V.useState(null);V.useEffect(()=>{if(t){s([{id:"u1",email:"superadmin@demo.com",role:"superadmin",status:"active",fullName:"Super Admin",identification:"123"},{id:"u2",email:"admin@demo.com",role:"admin",status:"active",fullName:"Admin User",identification:"456"},{id:"u3",email:"cliente1@demo.com",role:"client",status:"pending",fullName:"Cliente Pendiente",identification:"789"},{id:"u4",email:"cliente2@demo.com",role:"client",status:"disabled",fullName:"Cliente Deshabilitado",identification:"101"}]);return}const p=xe(te,"artifacts",ee,"public","data","users");return Ee(He(p,po("email")),b=>{s(b.docs.map(_=>({id:_.id,..._.data()})))})},[t]);const N=async p=>{if(t){n("Función no disponible en modo demo.","error");return}const{id:I,...b}=p,_=ue(te,"artifacts",ee,"public","data","users",I);await qe(_,b)},T=async p=>{if(t){n(`Simulación: Creando usuario ${p.email} con rol ${p.role}.`,"success");return}try{const I=He(xe(te,"artifacts",ee,"public","data","users"),rt("email","==",p.email));if(!(await In(I)).empty){n("El email ya está registrado en el sistema","error");return}const $=(await Uc(Je,p.email,p.password)).user,D={email:p.email,fullName:p.fullName||"",identification:p.identification||"",role:p.role||"client",status:p.status||"active",isProfileComplete:!0,createdAt:oe.now(),requiresPasswordChange:!0},F=ue(te,"artifacts",ee,"public","data","users",$.uid);if(await An(F,D),p.notify)try{await Gv($),n(`Usuario ${p.email} creado exitosamente. Email de verificación enviado.`,"success")}catch{n(`Usuario ${p.email} creado exitosamente, pero no se pudo enviar el email de verificación.`,"warning")}else n(`Usuario ${p.email} creado exitosamente.`,"success")}catch(I){console.error("Error creating user:",I);let b="Error al crear usuario";throw I.code==="auth/email-already-in-use"?b="El email ya está registrado en el sistema":I.code==="auth/invalid-email"?b="El email no es válido":I.code==="auth/weak-password"?b="La contraseña es muy débil":b=`Error al crear usuario: ${I.message}`,n(b,"error"),I}},k=async()=>{if(E)try{const p=ue(te,"artifacts",ee,"public","data","users",E.id);await qe(p,{status:"active"}),n(`Usuario ${E.email} activado exitosamente.`,"success")}catch(p){n("Error al activar usuario","error"),console.error("Error activating user:",p)}},L=async(p,I)=>{if(t||e!=="superadmin"){n("Acción no permitida.","error");return}const b=ue(te,"artifacts",ee,"public","data","users",p.id);try{switch(I){case"activate":A(p),g(!0);break;case"notify":const _=`${window.location.origin}?uid=${p.id}&email=${encodeURIComponent(p.email)}&name=${encodeURIComponent(p.fullName||"")}&id=${encodeURIComponent(p.identification||"")}`;console.log("Link de activación:",_),n(`Link de activación generado para ${p.email}. Copia el link desde la consola.`,"success"),navigator.clipboard.writeText(_),n("Link copiado al portapapeles","info");break;case"disable":window.confirm(`¿Deshabilitar a ${p.email}?`)&&(await qe(b,{status:"disabled"}),n(`Usuario ${p.email} deshabilitado.`,"success"));break;case"makeAdmin":window.confirm(`¿Convertir a ${p.email} en administrador?`)&&(await qe(b,{role:"admin"}),n(`${p.email} ahora es administrador.`,"success"));break;case"makeClient":window.confirm(`¿Convertir a ${p.email} en cliente?`)&&(await qe(b,{role:"client"}),n(`${p.email} ahora es cliente.`,"success"));break;case"delete":if(window.confirm(`¿Eliminar permanentemente a ${p.email}? Esta acción no se puede deshacer.`))try{await vi(b),n(`Usuario ${p.email} eliminado de la base de datos.`,"success"),n("Nota: El usuario permanece en Authentication. Contacta al administrador para eliminación completa.","info")}catch($){console.error("Error deleting user:",$),n("Error al eliminar el usuario: "+$.message,"error")}break;default:n("Acción no reconocida.","error")}}catch(_){n("Ocurrió un error al realizar la acción.","error"),console.error("Error in user action:",_)}},q=r.filter(p=>{const I=a.toLowerCase();return!I||p.email.toLowerCase().includes(I)||p.fullName&&p.fullName.toLowerCase().includes(I)||p.identification&&p.identification.includes(I)}),z=p=>({active:"bg-green-100 text-green-800",pending:"bg-yellow-100 text-yellow-800",disabled:"bg-red-100 text-red-800"})[p]||"bg-gray-100 text-gray-800",j=p=>({superadmin:"bg-red-100 text-red-800 font-bold",admin:"bg-blue-100 text-blue-800 font-semibold",client:"bg-gray-100 text-gray-800"})[p]||"bg-gray-100 text-gray-800",v=p=>({active:"Activo",pending:"Pendiente",disabled:"Deshabilitado"})[p]||p,S=p=>({superadmin:"Super Admin",admin:"Administrador",client:"Cliente"})[p]||p;return i.jsxs("div",{className:"p-4 sm:p-6 lg:p-8",children:[i.jsxs("div",{className:"flex flex-wrap justify-between items-center gap-4 mb-6",children:[i.jsxs("div",{className:"relative",children:[i.jsx("input",{type:"text",placeholder:"Buscar por email, nombre, ID...",value:a,onChange:p=>o(p.target.value),className:"pl-10 pr-4 py-2 border rounded-full w-full sm:w-64"}),i.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:i.jsx(Ii,{})})]}),e==="superadmin"&&i.jsxs("button",{onClick:()=>u(!0),className:"flex items-center space-x-2 px-4 py-2 bg-blue-600 text-white rounded-lg shadow-md hover:bg-blue-700",children:[i.jsx(go,{})," ",i.jsx("span",{className:"hidden sm:inline",children:"Crear Usuario"})]})]}),i.jsx("div",{className:"bg-white rounded-xl shadow-lg overflow-x-auto",children:i.jsxs("table",{className:"w-full text-left",children:[i.jsx("thead",{className:"bg-gray-50",children:i.jsx("tr",{children:["Nombre","Email","Identificación","Rol","Estado","Fecha Creación","Acciones"].map(p=>i.jsx("th",{className:"px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:p},p))})}),i.jsx("tbody",{className:"divide-y divide-gray-200",children:q.map(p=>i.jsxs("tr",{children:[i.jsxs("td",{className:"px-6 py-4",children:[i.jsx("div",{className:"font-medium text-gray-900",children:p.fullName||"Sin nombre"}),p.fullName&&i.jsxs("div",{className:"text-sm text-gray-500",children:["ID: ",p.id.slice(0,8),"..."]})]}),i.jsxs("td",{className:"px-6 py-4",children:[i.jsx("div",{className:"text-sm text-gray-900",children:p.email}),p.requiresPasswordChange&&i.jsx("div",{className:"text-xs text-orange-600",children:"Requiere cambio de contraseña"})]}),i.jsx("td",{className:"px-6 py-4 text-sm text-gray-600",children:p.identification||"--"}),i.jsx("td",{className:"px-6 py-4",children:i.jsx("span",{className:`px-3 py-1 inline-flex text-xs leading-5 font-semibold rounded-full ${j(p.role)}`,children:S(p.role)})}),i.jsx("td",{className:"px-6 py-4",children:i.jsx("span",{className:`px-3 py-1 inline-flex text-xs leading-5 font-semibold rounded-full ${z(p.status)}`,children:v(p.status)})}),i.jsx("td",{className:"px-6 py-4 text-sm text-gray-500",children:p.createdAt?new Date(p.createdAt.seconds*1e3).toLocaleDateString():"--"}),i.jsx("td",{className:"px-6 py-4",children:e==="superadmin"&&p.role!=="superadmin"&&i.jsxs(yo,{children:[i.jsx("button",{onClick:()=>{C(p),m(!0)},className:"block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100",children:"✏️ Editar Datos"}),i.jsx("button",{onClick:()=>L(p,"notify"),className:"block w-full text-left px-4 py-2 text-sm text-blue-700 hover:bg-blue-50",children:"📧 Notificar Activación"}),p.status==="pending"&&i.jsx("button",{onClick:()=>L(p,"activate"),className:"block w-full text-left px-4 py-2 text-sm text-green-700 hover:bg-green-50",children:"✅ Activar Usuario"}),p.status==="active"&&i.jsx("button",{onClick:()=>L(p,"disable"),className:"block w-full text-left px-4 py-2 text-sm text-yellow-700 hover:bg-yellow-50",children:"⏸️ Deshabilitar"}),p.status==="disabled"&&i.jsx("button",{onClick:()=>L(p,"activate"),className:"block w-full text-left px-4 py-2 text-sm text-green-700 hover:bg-green-50",children:"🔄 Re-Activar"}),p.role==="client"?i.jsx("button",{onClick:()=>L(p,"makeAdmin"),className:"block w-full text-left px-4 py-2 text-sm text-blue-700 hover:bg-blue-50",children:"👨‍💼 Hacer Administrador"}):i.jsx("button",{onClick:()=>L(p,"makeClient"),className:"block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-50",children:"👤 Hacer Cliente"}),i.jsx("button",{onClick:()=>L(p,"delete"),className:"block w-full text-left px-4 py-2 text-sm text-red-700 hover:bg-red-50",children:"🗑️ Eliminar Permanentemente"})]})})]},p.id))})]})}),i.jsx(C2,{isOpen:c,onClose:()=>u(!1),onSave:T,isDemo:t}),i.jsx(S2,{isOpen:d,onClose:()=>m(!1),onSave:N,user:x,isDemo:t}),i.jsx(I2,{isOpen:y,onClose:()=>{g(!1),A(null)},onActivate:k,user:E})]})}function k2({isDemo:t}){const{addNotification:e}=ke(),[n,r]=V.useState([]),[s,a]=V.useState(null),[o,c]=V.useState(""),[u,d]=V.useState(""),[m,y]=V.useState(""),[g,x]=V.useState(!1),[C,E]=V.useState([]),[A,N]=V.useState({preVencimiento:{enabled:!1,days:7,clientTemplate:"",adminTemplate:"",notifyAdmins:!1,selectedAdmins:[]},periodoGracia:{enabled:!1,days:3,clientTemplate:"",adminTemplate:"",notifyAdmins:!1,selectedAdmins:[]},vencido:{enabled:!1,days:0,clientTemplate:"",adminTemplate:"",notifyAdmins:!1,selectedAdmins:[]},suspendido:{enabled:!1,days:0,clientTemplate:"",adminTemplate:"",notifyAdmins:!1,selectedAdmins:[]}}),[T,k]=V.useState("templates"),L={preVencimiento:{name:"Aviso de Próximo Vencimiento",subject:"Recordatorio de Renovación de Servicio: {description}",body:`Estimado/a {clientName},

Le escribimos para recordarle que su servicio '{description}' está programado para vencer el próximo {dueDate}.

El monto correspondiente a la renovación es de {amount} {currency}.

Para garantizar la continuidad de su servicio, le recomendamos realizar el pago antes de la fecha de vencimiento. Puede gestionarlo a través de nuestro portal de clientes.

Si tiene alguna consulta, no dude en contactarnos.

Atentamente,
{companyName}`},vencido:{name:"Notificación de Servicio Vencido",subject:"Importante: Su servicio {description} ha vencido",body:`Estimado/a {clientName},

Le informamos que la factura correspondiente a su servicio '{description}', con fecha de vencimiento {dueDate}, se encuentra pendiente de pago.

Su servicio ha entrado en un período de gracia. Para evitar la suspensión del mismo, le solicitamos regularizar su situación a la brevedad posible. El monto pendiente es de {amount} {currency}.

Si usted ya ha realizado el pago, por favor, omita esta notificación.

Cordialmente,
{companyName}`},suspendido:{name:"Aviso de Suspensión de Servicio",subject:"Acción Requerida: Suspensión del servicio {description}",body:`Estimado/a {clientName},

Lamentamos informarle que, debido a la falta de pago, su servicio '{description}' ha sido suspendido.

Para proceder con la reactivación y recuperar el acceso, es necesario saldar el monto pendiente de {amount} {currency}. Por favor, contáctenos para coordinar el pago y la restauración del servicio.

Quedamos a su disposición.

Atentamente,
{companyName}`},pagoRecibido:{name:"Confirmación de Pago Recibido",subject:"Confirmación: Pago recibido para {description}",body:`Estimado/a {clientName},

Hemos recibido y procesado exitosamente su pago por {amount} {currency} correspondiente al servicio '{description}'.

Su servicio está activo y funcionando correctamente. La próxima fecha de vencimiento será {dueDate}.

Gracias por su confianza y por mantener sus pagos al día.

Atentamente,
{companyName}`},bienvenida:{name:"Bienvenida a Nuevo Cliente",subject:"Bienvenido a {companyName} - Servicio {description}",body:`Estimado/a {clientName},

¡Bienvenido a {companyName}!

Nos complace confirmar que su servicio '{description}' ha sido activado exitosamente.

Detalles del servicio:
- Descripción: {description}
- Monto: {amount} {currency}
- Próximo vencimiento: {dueDate}

Puede acceder a su portal de cliente en cualquier momento para gestionar su cuenta y realizar pagos.

Si tiene alguna pregunta, no dude en contactarnos.

¡Gracias por elegirnos!

Atentamente,
{companyName}`},adminPreVencimiento:{name:"Alerta Admin: Próximo Vencimiento",subject:"ALERTA: Servicio próximo a vencer - {clientName}",body:`Estimado/a Administrador,

Se ha generado una alerta automática para el siguiente servicio:

📋 INFORMACIÓN DEL SERVICIO:
- Cliente: {clientName} ({clientEmail})
- Servicio: {description}
- Tipo: {serviceType}
- Monto: {amount} {currency}
- Fecha de vencimiento: {dueDate}
- Ciclo de facturación: {billingCycle}
- Días restantes: {daysRemaining}

📊 ESTADO ACTUAL:
- Estado: Próximo a vencer
- Notificación enviada al cliente: ✅
- Plantilla utilizada: Aviso de Próximo Vencimiento

🔔 ACCIONES RECOMENDADAS:
1. Verificar que el cliente haya recibido la notificación
2. Contactar al cliente si es necesario
3. Preparar seguimiento post-vencimiento

📈 ESTADÍSTICAS:
- Total de servicios próximos a vencer: {totalPending}
- Ingresos potenciales: {potentialRevenue}

Este es un mensaje automático del sistema de gestión de cobros.

Sistema de Gestión - {companyName}`},adminPeriodoGracia:{name:"Alerta Admin: Período de Gracia",subject:"URGENTE: Servicio en período de gracia - {clientName}",body:`Estimado/a Administrador,

⚠️ ALERTA URGENTE - Servicio en período de gracia:

📋 INFORMACIÓN DEL SERVICIO:
- Cliente: {clientName} ({clientEmail})
- Servicio: {description}
- Tipo: {serviceType}
- Monto pendiente: {amount} {currency}
- Fecha de vencimiento original: {dueDate}
- Días en período de gracia: {graceDays}
- Días restantes de gracia: {remainingGraceDays}

📊 ESTADO ACTUAL:
- Estado: Período de Gracia Vencido
- Notificación enviada al cliente: ✅
- Plantilla utilizada: Notificación de Servicio Vencido
- Riesgo de suspensión: ALTO

🚨 ACCIONES INMEDIATAS:
1. Contactar al cliente por teléfono
2. Enviar recordatorio personalizado
3. Evaluar opciones de pago flexibles
4. Preparar suspensión si no hay respuesta

📈 IMPACTO:
- Ingresos en riesgo: {amount} {currency}
- Tiempo de mora: {daysOverdue} días
- Historial de pagos: {paymentHistory}

⏰ PRÓXIMOS PASOS:
- Si no se paga en {remainingGraceDays} días: Suspender servicio
- Seguimiento diario hasta resolución
- Documentar todas las comunicaciones

Este es un mensaje automático del sistema de gestión de cobros.

Sistema de Gestión - {companyName}`},adminVencido:{name:"Alerta Admin: Servicio Vencido",subject:"INMEDIATO: Servicio vencido - {clientName}",body:`Estimado/a Administrador,

🔴 ALERTA INMEDIATA - Servicio vencido:

📋 INFORMACIÓN DEL SERVICIO:
- Cliente: {clientName} ({clientEmail})
- Servicio: {description}
- Tipo: {serviceType}
- Monto vencido: {amount} {currency}
- Fecha de vencimiento: {dueDate}
- Días de atraso: {daysOverdue}
- Ciclo de facturación: {billingCycle}

📊 ESTADO ACTUAL:
- Estado: Vencido
- Notificación enviada al cliente: ✅
- Plantilla utilizada: Notificación de Servicio Vencido
- Próximo paso: Período de gracia

🎯 ACCIONES REQUERIDAS:
1. Verificar recepción de notificación por cliente
2. Iniciar período de gracia ({gracePeriod} días)
3. Contacto directo con el cliente
4. Evaluar historial de pagos del cliente
5. Preparar estrategia de cobro

📈 ANÁLISIS:
- Cliente desde: {clientSince}
- Pagos anteriores: {previousPayments}
- Patrón de pago: {paymentPattern}
- Riesgo de pérdida: {riskLevel}

📞 CONTACTOS:
- Teléfono: {clientPhone}
- Email: {clientEmail}
- Última comunicación: {lastContact}

Este es un mensaje automático del sistema de gestión de cobros.

Sistema de Gestión - {companyName}`},adminSuspendido:{name:"Alerta Admin: Servicio Suspendido",subject:"SUSPENDIDO: Servicio cancelado por falta de pago - {clientName}",body:`Estimado/a Administrador,

❌ SERVICIO SUSPENDIDO - Acción requerida:

📋 INFORMACIÓN DEL SERVICIO:
- Cliente: {clientName} ({clientEmail})
- Servicio: {description}
- Tipo: {serviceType}
- Monto pendiente: {amount} {currency}
- Fecha de vencimiento: {dueDate}
- Días de atraso: {daysOverdue}
- Período de gracia agotado: {gracePeriod} días

📊 ESTADO ACTUAL:
- Estado: Cancelado
- Motivo: Falta de pago
- Notificación enviada al cliente: ✅
- Plantilla utilizada: Aviso de Suspensión de Servicio
- Fecha de suspensión: {suspensionDate}

🔧 ACCIONES INMEDIATAS:
1. Suspender acceso del cliente al servicio
2. Documentar suspensión en el sistema
3. Enviar notificación de suspensión
4. Iniciar proceso de recuperación de cobros
5. Evaluar reactivación futura

📈 ANÁLISIS FINANCIERO:
- Pérdida de ingresos: {amount} {currency}
- Costo de reactivación: {reactivationCost}
- Valor del cliente: {clientValue}
- Probabilidad de recuperación: {recoveryProbability}%

📞 SEGUIMIENTO:
- Contactar para negociación de pago
- Ofrecer planes de pago flexibles
- Documentar todas las comunicaciones
- Evaluar cancelación definitiva

📋 DOCUMENTACIÓN:
- Historial de pagos: {paymentHistory}
- Comunicaciones previas: {communicationHistory}
- Términos del servicio: {serviceTerms}
- Política de suspensión: {suspensionPolicy}

Este es un mensaje automático del sistema de gestión de cobros.

Sistema de Gestión - {companyName}`},adminPagoRecibido:{name:"Notificación Admin: Pago Recibido",subject:"CONFIRMADO: Pago recibido - {clientName}",body:`Estimado/a Administrador,

✅ PAGO CONFIRMADO - Servicio reactivado:

📋 INFORMACIÓN DEL PAGO:
- Cliente: {clientName} ({clientEmail})
- Servicio: {description}
- Monto recibido: {amount} {currency}
- Fecha de pago: {paymentDate}
- Método de pago: {paymentMethod}
- Referencia: {paymentReference}

📊 ESTADO ACTUAL:
- Estado: Activo
- Servicio reactivado: ✅
- Notificación enviada al cliente: ✅
- Plantilla utilizada: Confirmación de Pago Recibido
- Próximo vencimiento: {nextDueDate}

🎯 ACCIONES COMPLETADAS:
1. Pago procesado y verificado
2. Servicio reactivado automáticamente
3. Cliente notificado del pago
4. Próxima fecha de vencimiento actualizada
5. Historial de pagos actualizado

📈 IMPACTO POSITIVO:
- Ingresos recuperados: {amount} {currency}
- Cliente retenido: ✅
- Servicio activo: ✅
- Próximo ciclo iniciado

📊 ESTADÍSTICAS:
- Tiempo de pago: {paymentTime} días
- Eficiencia de cobro: {collectionEfficiency}%
- Satisfacción del cliente: {clientSatisfaction}
- Ingresos mensuales: {monthlyRevenue}

📋 SEGUIMIENTO:
- Monitorear estabilidad del servicio
- Preparar próximo recordatorio
- Actualizar perfil del cliente
- Documentar éxito de cobro

Este es un mensaje automático del sistema de gestión de cobros.

Sistema de Gestión - {companyName}`},adminNuevoCliente:{name:"Notificación Admin: Nuevo Cliente",subject:"NUEVO CLIENTE: {clientName} - Servicio {description}",body:`Estimado/a Administrador,

🎉 NUEVO CLIENTE REGISTRADO:

📋 INFORMACIÓN DEL CLIENTE:
- Nombre: {clientName}
- Email: {clientEmail}
- Identificación: {clientId}
- Teléfono: {clientPhone}
- Fecha de registro: {registrationDate}

📋 INFORMACIÓN DEL SERVICIO:
- Descripción: {description}
- Tipo: {serviceType}
- Monto: {amount} {currency}
- Ciclo de facturación: {billingCycle}
- Fecha de vencimiento: {dueDate}
- Estado: Activo

📊 CONFIGURACIÓN:
- Servicio activado: ✅
- Notificación de bienvenida enviada: ✅
- Plantilla utilizada: Bienvenida a Nuevo Cliente
- Portal de cliente habilitado: ✅
- Método de pago configurado: {paymentMethod}

🎯 ACCIONES INICIALES:
1. Verificar activación del servicio
2. Confirmar recepción de bienvenida
3. Programar seguimiento inicial
4. Configurar recordatorios automáticos
5. Documentar preferencias del cliente

📈 ANÁLISIS:
- Valor del cliente: {clientValue}
- Potencial de crecimiento: {growthPotential}
- Segmento: {clientSegment}
- Fuente de adquisición: {acquisitionSource}

📋 PRÓXIMOS PASOS:
- Seguimiento en 7 días
- Verificar satisfacción inicial
- Preparar próximo recordatorio
- Monitorear uso del servicio

Este es un mensaje automático del sistema de gestión de cobros.

Sistema de Gestión - {companyName}`}},q=D=>{a(null),x(!1),c(D.name),d(D.subject),y(D.body),e("Sugerencia cargada en el editor.","success")};V.useEffect(()=>{if(t){E([{id:"admin1",email:"admin@demo.com",fullName:"Admin Demo",role:"admin"},{id:"super1",email:"super@demo.com",fullName:"Super Admin Demo",role:"superadmin"}]);return}const D=xe(te,"artifacts",ee,"public","data","users");return Ee(He(D,rt("role","in",["admin","superadmin"])),O=>{E(O.docs.map(M=>({id:M.id,...M.data()})))})},[t]),V.useEffect(()=>{if(t){N({preVencimiento:{enabled:!0,days:7,clientTemplate:"t1",adminTemplate:"t1",notifyAdmins:!0,selectedAdmins:["admin1"]},periodoGracia:{enabled:!0,days:3,clientTemplate:"t2",adminTemplate:"t2",notifyAdmins:!0,selectedAdmins:["admin1"]},vencido:{enabled:!0,days:0,clientTemplate:"t2",adminTemplate:"t2",notifyAdmins:!0,selectedAdmins:["admin1"]},suspendido:{enabled:!1,days:0,clientTemplate:"",adminTemplate:"",notifyAdmins:!1,selectedAdmins:[]}});return}const D=ue(te,"artifacts",ee,"public","data","settings","alertSettings");return Ee(D,O=>{O.exists()&&N(O.data())})},[t]),V.useEffect(()=>{if(t){r([{id:"t1",name:"Recordatorio General (Demo)",subject:"Recordatorio de pago",body:"Hola {clientName}, recuerda pagar tu servicio {description} por {amount} {currency} antes del {dueDate}. Gracias, {companyName}",createdAt:new Date},{id:"t2",name:"Servicio Vencido (Demo)",subject:"Servicio vencido: {description}",body:"Estimado {clientName}, su servicio {description} ha vencido. Por favor regularice su pago de {amount} {currency}. Atentamente, {companyName}",createdAt:new Date}]);return}const D=xe(te,"artifacts",ee,"public","data","messageTemplates");return Ee(He(D,po("name")),O=>{r(O.docs.map(M=>({id:M.id,...M.data()})))})},[t]),V.useEffect(()=>{s?(c(s.name),d(s.subject),y(s.body),x(!0)):(c(""),d(""),y(""),x(!1))},[s]);const z=async()=>{if(t){e("Función no disponible en modo demo.","error");return}if(!o.trim()||!u.trim()||!m.trim()){e("Por favor, complete todos los campos de la plantilla.","error");return}const D={name:o.trim(),subject:u.trim(),body:m.trim(),updatedAt:new Date},F=xe(te,"artifacts",ee,"public","data","messageTemplates");try{s?(await qe(ue(F,s.id),D),e("Plantilla actualizada exitosamente.","success")):(await sr(F,{...D,createdAt:new Date}),e("Plantilla creada exitosamente.","success")),a(null)}catch(O){console.error("Error saving template:",O),e("Error al guardar la plantilla.","error")}},j=async D=>{if(t){e("Función no disponible en modo demo.","error");return}if(window.confirm("¿Seguro que quieres eliminar esta plantilla?"))try{await vi(ue(te,"artifacts",ee,"public","data","messageTemplates",D)),e("Plantilla eliminada.","success"),a(null)}catch(F){console.error("Error deleting template:",F),e("Error al eliminar la plantilla.","error")}},v=()=>{a(null),x(!1),c(""),d(""),y("")},S=D=>{a(D),x(!0)},p=(D,F,O)=>{N(M=>({...M,[D]:{...M[D],[F]:O}}))},I=(D,F,O)=>{N(M=>({...M,[D]:{...M[D],selectedAdmins:O?[...M[D].selectedAdmins,F]:M[D].selectedAdmins.filter(W=>W!==F)}}))},b=async()=>{if(t){e("Configuración de alertas guardada (modo demo).","success");return}try{const D=ue(te,"artifacts",ee,"public","data","settings","alertSettings");await An(D,A,{merge:!0}),e("Configuración de alertas guardada exitosamente.","success")}catch(D){console.error("Error saving alert settings:",D),e("Error al guardar la configuración de alertas.","error")}},_=["{clientName}","{serviceType}","{description}","{amount}","{currency}","{dueDate}","{companyName}","{billingCycle}","{clientEmail}"],$=["{clientName}","{clientEmail}","{clientPhone}","{clientId}","{serviceType}","{description}","{amount}","{currency}","{dueDate}","{billingCycle}","{companyName}","{daysRemaining}","{daysOverdue}","{graceDays}","{remainingGraceDays}","{totalPending}","{potentialRevenue}","{paymentHistory}","{clientSince}","{previousPayments}","{paymentPattern}","{riskLevel}","{lastContact}","{suspensionDate}","{reactivationCost}","{clientValue}","{recoveryProbability}","{paymentDate}","{paymentMethod}","{paymentReference}","{nextDueDate}","{paymentTime}","{collectionEfficiency}","{clientSatisfaction}","{monthlyRevenue}","{registrationDate}","{growthPotential}","{clientSegment}","{acquisitionSource}","{gracePeriod}","{communicationHistory}","{serviceTerms}","{suspensionPolicy}"];return i.jsxs("div",{className:"p-4 sm:p-6 lg:p-8",children:[i.jsxs("div",{className:"mb-6",children:[i.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Plantillas y Alertas"}),i.jsx("p",{className:"text-gray-600 mt-2",children:"Gestiona las plantillas de correo y configura alertas automáticas"})]}),i.jsx("div",{className:"mb-6",children:i.jsx("div",{className:"border-b border-gray-200",children:i.jsxs("nav",{className:"-mb-px flex space-x-8",children:[i.jsxs("button",{onClick:()=>k("templates"),className:`py-2 px-1 border-b-2 font-medium text-sm ${T==="templates"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:[i.jsx(kw,{}),i.jsx("span",{className:"ml-2",children:"Plantillas"})]}),i.jsxs("button",{onClick:()=>k("alerts"),className:`py-2 px-1 border-b-2 font-medium text-sm ${T==="alerts"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:[i.jsx(w2,{}),i.jsx("span",{className:"ml-2",children:"Alertas Automáticas"})]})]})})}),T==="templates"&&i.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[i.jsxs("div",{className:"lg:col-span-1 space-y-6",children:[i.jsxs("div",{className:"bg-white rounded-lg shadow-sm border",children:[i.jsxs("div",{className:"p-4 border-b",children:[i.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Plantillas Guardadas"}),i.jsx("p",{className:"text-sm text-gray-500",children:"Haz clic para editar una plantilla"})]}),i.jsx("div",{className:"max-h-80 overflow-y-auto",children:n.length===0?i.jsxs("div",{className:"p-4 text-center text-gray-500",children:[i.jsx("p",{children:"No hay plantillas guardadas"}),i.jsx("p",{className:"text-sm",children:"Crea tu primera plantilla"})]}):n.map(D=>i.jsx("div",{className:"p-4 border-b hover:bg-gray-50 transition-colors",children:i.jsxs("div",{className:"flex justify-between items-start",children:[i.jsxs("div",{className:"flex-1 min-w-0",children:[i.jsx("h4",{className:"font-medium text-gray-900 truncate",children:D.name}),i.jsx("p",{className:"text-sm text-gray-500 truncate mt-1",children:D.subject}),i.jsx("p",{className:"text-xs text-gray-400 mt-1",children:D.createdAt?new Date(D.createdAt.seconds*1e3).toLocaleDateString():"Sin fecha"})]}),i.jsxs("div",{className:"flex space-x-2 ml-2",children:[i.jsx("button",{onClick:()=>S(D),className:"text-blue-600 hover:text-blue-800 p-1",title:"Editar plantilla",children:i.jsx(b2,{})}),i.jsx("button",{onClick:()=>j(D.id),className:"text-red-600 hover:text-red-800 p-1",title:"Eliminar plantilla",children:i.jsx(Aw,{})})]})]})},D.id))}),i.jsx("div",{className:"p-4",children:i.jsxs("button",{onClick:v,className:"w-full flex items-center justify-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[i.jsx(go,{}),i.jsx("span",{className:"ml-2",children:"Nueva Plantilla"})]})})]}),i.jsxs("div",{className:"bg-white rounded-lg shadow-sm border",children:[i.jsxs("div",{className:"p-4 border-b",children:[i.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Plantillas para Clientes"}),i.jsx("p",{className:"text-sm text-gray-500",children:"Mensajes dirigidos a los clientes"})]}),i.jsxs("div",{className:"p-4 space-y-2",children:[i.jsxs("button",{onClick:()=>q(L.preVencimiento),className:"w-full text-left p-3 bg-blue-50 hover:bg-blue-100 rounded-lg transition-colors",children:[i.jsx("div",{className:"font-medium text-blue-900",children:"Aviso de Próximo Vencimiento"}),i.jsx("div",{className:"text-sm text-blue-700",children:"Recordatorio antes del vencimiento"})]}),i.jsxs("button",{onClick:()=>q(L.vencido),className:"w-full text-left p-3 bg-yellow-50 hover:bg-yellow-100 rounded-lg transition-colors",children:[i.jsx("div",{className:"font-medium text-yellow-900",children:"Servicio Vencido"}),i.jsx("div",{className:"text-sm text-yellow-700",children:"Notificación de período de gracia"})]}),i.jsxs("button",{onClick:()=>q(L.suspendido),className:"w-full text-left p-3 bg-red-50 hover:bg-red-100 rounded-lg transition-colors",children:[i.jsx("div",{className:"font-medium text-red-900",children:"Aviso de Suspensión"}),i.jsx("div",{className:"text-sm text-red-700",children:"Servicio suspendido por falta de pago"})]}),i.jsxs("button",{onClick:()=>q(L.pagoRecibido),className:"w-full text-left p-3 bg-green-50 hover:bg-green-100 rounded-lg transition-colors",children:[i.jsx("div",{className:"font-medium text-green-900",children:"Confirmación de Pago"}),i.jsx("div",{className:"text-sm text-green-700",children:"Confirmación de pago recibido"})]}),i.jsxs("button",{onClick:()=>q(L.bienvenida),className:"w-full text-left p-3 bg-purple-50 hover:bg-purple-100 rounded-lg transition-colors",children:[i.jsx("div",{className:"font-medium text-purple-900",children:"Bienvenida"}),i.jsx("div",{className:"text-sm text-purple-700",children:"Mensaje de bienvenida a nuevos clientes"})]})]})]}),i.jsxs("div",{className:"bg-white rounded-lg shadow-sm border",children:[i.jsxs("div",{className:"p-4 border-b",children:[i.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Plantillas para Administradores"}),i.jsx("p",{className:"text-sm text-gray-500",children:"Alertas y notificaciones internas"})]}),i.jsxs("div",{className:"p-4 space-y-2",children:[i.jsxs("button",{onClick:()=>q(L.adminPreVencimiento),className:"w-full text-left p-3 bg-blue-50 hover:bg-blue-100 rounded-lg transition-colors",children:[i.jsx("div",{className:"font-medium text-blue-900",children:"🔔 Alerta: Próximo Vencimiento"}),i.jsx("div",{className:"text-sm text-blue-700",children:"Notificación interna de servicios próximos a vencer"})]}),i.jsxs("button",{onClick:()=>q(L.adminPeriodoGracia),className:"w-full text-left p-3 bg-orange-50 hover:bg-orange-100 rounded-lg transition-colors",children:[i.jsx("div",{className:"font-medium text-orange-900",children:"⚠️ Alerta: Período de Gracia"}),i.jsx("div",{className:"text-sm text-orange-700",children:"Alerta urgente de servicios en período de gracia"})]}),i.jsxs("button",{onClick:()=>q(L.adminVencido),className:"w-full text-left p-3 bg-red-50 hover:bg-red-100 rounded-lg transition-colors",children:[i.jsx("div",{className:"font-medium text-red-900",children:"🔴 Alerta: Servicio Vencido"}),i.jsx("div",{className:"text-sm text-red-700",children:"Notificación inmediata de servicios vencidos"})]}),i.jsxs("button",{onClick:()=>q(L.adminSuspendido),className:"w-full text-left p-3 bg-gray-50 hover:bg-gray-100 rounded-lg transition-colors",children:[i.jsx("div",{className:"font-medium text-gray-900",children:"❌ Alerta: Servicio Suspendido"}),i.jsx("div",{className:"text-sm text-gray-700",children:"Notificación de servicios cancelados por falta de pago"})]}),i.jsxs("button",{onClick:()=>q(L.adminPagoRecibido),className:"w-full text-left p-3 bg-green-50 hover:bg-green-100 rounded-lg transition-colors",children:[i.jsx("div",{className:"font-medium text-green-900",children:"✅ Notificación: Pago Recibido"}),i.jsx("div",{className:"text-sm text-green-700",children:"Confirmación interna de pagos procesados"})]}),i.jsxs("button",{onClick:()=>q(L.adminNuevoCliente),className:"w-full text-left p-3 bg-purple-50 hover:bg-purple-100 rounded-lg transition-colors",children:[i.jsx("div",{className:"font-medium text-purple-900",children:"🎉 Notificación: Nuevo Cliente"}),i.jsx("div",{className:"text-sm text-purple-700",children:"Alerta de nuevos clientes registrados"})]})]})]}),i.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[i.jsx("h4",{className:"font-semibold text-gray-900 mb-2",children:"Variables para Clientes"}),i.jsxs("div",{className:"text-xs text-gray-600 space-y-1",children:[i.jsx("p",{className:"font-medium",children:"Información básica:"}),i.jsx("p",{children:_.slice(0,3).join(", ")}),i.jsx("p",{className:"font-medium mt-2",children:"Información del servicio:"}),i.jsx("p",{children:_.slice(3,6).join(", ")}),i.jsx("p",{className:"font-medium mt-2",children:"Información adicional:"}),i.jsx("p",{children:_.slice(6).join(", ")})]})]}),i.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[i.jsx("h4",{className:"font-semibold text-gray-900 mb-2",children:"Variables para Administradores"}),i.jsxs("div",{className:"text-xs text-gray-600 space-y-1",children:[i.jsx("p",{className:"font-medium",children:"Información del cliente:"}),i.jsx("p",{children:$.slice(0,4).join(", ")}),i.jsx("p",{className:"font-medium mt-2",children:"Información del servicio:"}),i.jsx("p",{children:$.slice(4,11).join(", ")}),i.jsx("p",{className:"font-medium mt-2",children:"Fechas y tiempos:"}),i.jsx("p",{children:$.slice(11,15).join(", ")}),i.jsx("p",{className:"font-medium mt-2",children:"Estadísticas:"}),i.jsx("p",{children:$.slice(15,19).join(", ")}),i.jsx("p",{className:"font-medium mt-2",children:"Análisis de riesgo:"}),i.jsx("p",{children:$.slice(19,23).join(", ")}),i.jsx("p",{className:"font-medium mt-2",children:"Información de pago:"}),i.jsx("p",{children:$.slice(23,27).join(", ")}),i.jsx("p",{className:"font-medium mt-2",children:"Métricas de rendimiento:"}),i.jsx("p",{children:$.slice(27,31).join(", ")}),i.jsx("p",{className:"font-medium mt-2",children:"Información de registro:"}),i.jsx("p",{children:$.slice(31,35).join(", ")}),i.jsx("p",{className:"font-medium mt-2",children:"Configuración:"}),i.jsx("p",{children:$.slice(35).join(", ")})]})]})]}),i.jsx("div",{className:"lg:col-span-2",children:i.jsxs("div",{className:"bg-white rounded-lg shadow-sm border",children:[i.jsxs("div",{className:"p-6 border-b",children:[i.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:g?"Editando Plantilla":"Nueva Plantilla"}),i.jsx("p",{className:"text-sm text-gray-500 mt-1",children:g?"Modifica los campos de la plantilla":"Completa los campos para crear una nueva plantilla"})]}),i.jsxs("div",{className:"p-6 space-y-6",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Nombre de la Plantilla"}),i.jsx("input",{type:"text",value:o,onChange:D=>c(D.target.value),placeholder:"Ej: Primer Recordatorio de Pago",className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Asunto del Correo"}),i.jsx("input",{type:"text",value:u,onChange:D=>d(D.target.value),placeholder:"Ej: Recordatorio de Renovación: {description}",className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Cuerpo del Mensaje"}),i.jsx("textarea",{value:m,onChange:D=>y(D.target.value),placeholder:"Escribe el contenido del mensaje aquí...",rows:"12",className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 font-mono text-sm"})]}),i.jsxs("div",{className:"flex justify-end space-x-4 pt-4 border-t",children:[i.jsx("button",{onClick:v,className:"px-4 py-2 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors",children:"Limpiar"}),i.jsx("button",{onClick:z,className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium",children:g?"Guardar Cambios":"Crear Plantilla"})]})]})]})})]}),T==="alerts"&&i.jsxs("div",{className:"space-y-6",children:[i.jsxs("div",{className:"bg-white rounded-lg shadow-sm border",children:[i.jsxs("div",{className:"p-6 border-b",children:[i.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center",children:[i.jsx("div",{className:"w-3 h-3 bg-yellow-500 rounded-full mr-3"}),"Alerta de Próximo Vencimiento"]}),i.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Notificaciones antes del vencimiento del servicio"})]}),i.jsxs("div",{className:"p-6 space-y-4",children:[i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{children:[i.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Activar alerta"}),i.jsx("p",{className:"text-xs text-gray-500",children:"Enviar notificaciones antes del vencimiento"})]}),i.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[i.jsx("input",{type:"checkbox",checked:A.preVencimiento.enabled,onChange:D=>p("preVencimiento","enabled",D.target.checked),className:"sr-only peer"}),i.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"})]})]}),A.preVencimiento.enabled&&i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Días antes del vencimiento"}),i.jsx("input",{type:"number",min:"1",max:"30",value:A.preVencimiento.days,onChange:D=>p("preVencimiento","days",parseInt(D.target.value)),className:"w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Plantilla para cliente"}),i.jsxs("select",{value:A.preVencimiento.clientTemplate,onChange:D=>p("preVencimiento","clientTemplate",D.target.value),className:"w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[i.jsx("option",{value:"",children:"Seleccionar plantilla"}),n.map(D=>i.jsx("option",{value:D.id,children:D.name},D.id))]})]})]}),i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{children:[i.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Notificar administradores"}),i.jsx("p",{className:"text-xs text-gray-500",children:"Enviar copia a administradores seleccionados"})]}),i.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[i.jsx("input",{type:"checkbox",checked:A.preVencimiento.notifyAdmins,onChange:D=>p("preVencimiento","notifyAdmins",D.target.checked),className:"sr-only peer"}),i.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"})]})]}),A.preVencimiento.notifyAdmins&&i.jsxs("div",{className:"space-y-3",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Plantilla para administradores"}),i.jsxs("select",{value:A.preVencimiento.adminTemplate,onChange:D=>p("preVencimiento","adminTemplate",D.target.value),className:"w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[i.jsx("option",{value:"",children:"Seleccionar plantilla"}),n.map(D=>i.jsx("option",{value:D.id,children:D.name},D.id))]})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Administradores a notificar"}),i.jsx("div",{className:"space-y-2 max-h-32 overflow-y-auto border border-gray-200 rounded-lg p-3",children:C.map(D=>i.jsxs("label",{className:"flex items-center space-x-2",children:[i.jsx("input",{type:"checkbox",checked:A.preVencimiento.selectedAdmins.includes(D.id),onChange:F=>I("preVencimiento",D.id,F.target.checked),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),i.jsxs("span",{className:"text-sm text-gray-700",children:[D.fullName," (",D.email,")"]})]},D.id))})]})]})]})]})]})]}),i.jsxs("div",{className:"bg-white rounded-lg shadow-sm border",children:[i.jsxs("div",{className:"p-6 border-b",children:[i.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center",children:[i.jsx("div",{className:"w-3 h-3 bg-orange-500 rounded-full mr-3"}),"Período de Gracia"]}),i.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Notificaciones durante el período de gracia después del vencimiento"})]}),i.jsxs("div",{className:"p-6 space-y-4",children:[i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{children:[i.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Activar período de gracia"}),i.jsx("p",{className:"text-xs text-gray-500",children:"Tiempo adicional para pagar antes de suspender"})]}),i.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[i.jsx("input",{type:"checkbox",checked:A.periodoGracia.enabled,onChange:D=>p("periodoGracia","enabled",D.target.checked),className:"sr-only peer"}),i.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"})]})]}),A.periodoGracia.enabled&&i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Días de gracia"}),i.jsx("input",{type:"number",min:"1",max:"30",value:A.periodoGracia.days,onChange:D=>p("periodoGracia","days",parseInt(D.target.value)),className:"w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Plantilla para cliente"}),i.jsxs("select",{value:A.periodoGracia.clientTemplate,onChange:D=>p("periodoGracia","clientTemplate",D.target.value),className:"w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[i.jsx("option",{value:"",children:"Seleccionar plantilla"}),n.map(D=>i.jsx("option",{value:D.id,children:D.name},D.id))]})]})]}),i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{children:[i.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Notificar administradores"}),i.jsx("p",{className:"text-xs text-gray-500",children:"Enviar copia a administradores seleccionados"})]}),i.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[i.jsx("input",{type:"checkbox",checked:A.periodoGracia.notifyAdmins,onChange:D=>p("periodoGracia","notifyAdmins",D.target.checked),className:"sr-only peer"}),i.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"})]})]}),A.periodoGracia.notifyAdmins&&i.jsxs("div",{className:"space-y-3",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Plantilla para administradores"}),i.jsxs("select",{value:A.periodoGracia.adminTemplate,onChange:D=>p("periodoGracia","adminTemplate",D.target.value),className:"w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[i.jsx("option",{value:"",children:"Seleccionar plantilla"}),n.map(D=>i.jsx("option",{value:D.id,children:D.name},D.id))]})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Administradores a notificar"}),i.jsx("div",{className:"space-y-2 max-h-32 overflow-y-auto border border-gray-200 rounded-lg p-3",children:C.map(D=>i.jsxs("label",{className:"flex items-center space-x-2",children:[i.jsx("input",{type:"checkbox",checked:A.periodoGracia.selectedAdmins.includes(D.id),onChange:F=>I("periodoGracia",D.id,F.target.checked),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),i.jsxs("span",{className:"text-sm text-gray-700",children:[D.fullName," (",D.email,")"]})]},D.id))})]})]})]})]})]})]}),i.jsxs("div",{className:"bg-white rounded-lg shadow-sm border",children:[i.jsxs("div",{className:"p-6 border-b",children:[i.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center",children:[i.jsx("div",{className:"w-3 h-3 bg-red-500 rounded-full mr-3"}),"Servicio Vencido"]}),i.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Notificaciones cuando el servicio ha vencido"})]}),i.jsxs("div",{className:"p-6 space-y-4",children:[i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{children:[i.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Activar alerta"}),i.jsx("p",{className:"text-xs text-gray-500",children:"Enviar notificaciones cuando el servicio vence"})]}),i.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[i.jsx("input",{type:"checkbox",checked:A.vencido.enabled,onChange:D=>p("vencido","enabled",D.target.checked),className:"sr-only peer"}),i.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"})]})]}),A.vencido.enabled&&i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Plantilla para cliente"}),i.jsxs("select",{value:A.vencido.clientTemplate,onChange:D=>p("vencido","clientTemplate",D.target.value),className:"w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[i.jsx("option",{value:"",children:"Seleccionar plantilla"}),n.map(D=>i.jsx("option",{value:D.id,children:D.name},D.id))]})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Plantilla para administradores"}),i.jsxs("select",{value:A.vencido.adminTemplate,onChange:D=>p("vencido","adminTemplate",D.target.value),className:"w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[i.jsx("option",{value:"",children:"Seleccionar plantilla"}),n.map(D=>i.jsx("option",{value:D.id,children:D.name},D.id))]})]})]}),i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{children:[i.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Notificar administradores"}),i.jsx("p",{className:"text-xs text-gray-500",children:"Enviar copia a administradores seleccionados"})]}),i.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[i.jsx("input",{type:"checkbox",checked:A.vencido.notifyAdmins,onChange:D=>p("vencido","notifyAdmins",D.target.checked),className:"sr-only peer"}),i.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"})]})]}),A.vencido.notifyAdmins&&i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Administradores a notificar"}),i.jsx("div",{className:"space-y-2 max-h-32 overflow-y-auto border border-gray-200 rounded-lg p-3",children:C.map(D=>i.jsxs("label",{className:"flex items-center space-x-2",children:[i.jsx("input",{type:"checkbox",checked:A.vencido.selectedAdmins.includes(D.id),onChange:F=>I("vencido",D.id,F.target.checked),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),i.jsxs("span",{className:"text-sm text-gray-700",children:[D.fullName," (",D.email,")"]})]},D.id))})]})]})]})]}),i.jsx("div",{className:"flex justify-end",children:i.jsxs("button",{onClick:b,className:"px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium flex items-center",children:[i.jsx(cu,{}),i.jsx("span",{className:"ml-2",children:"Guardar Configuración de Alertas"})]})})]})]})}function Rw({isDemo:t}){const{addNotification:e}=ke(),[n,r]=V.useState({bold:{enabled:!1,apiKey:"",environment:"sandbox",webhookSecret:"",autoApprove:!1},paypal:{enabled:!1,clientId:"",clientSecret:"",environment:"sandbox",autoApprove:!1},payu:{enabled:!1,merchantId:"",apiKey:"",apiLogin:"",environment:"sandbox",autoApprove:!1},bankTransfer:{enabled:!1,accounts:[],autoApprove:!1,requireConfirmation:!0},general:{currency:"USD",defaultGateway:"bold"}}),[s,a]=V.useState(!1);V.useEffect(()=>{if(t){r({bold:{enabled:!0,apiKey:"demo_key",environment:"sandbox",webhookSecret:"demo_secret",autoApprove:!1},paypal:{enabled:!1,clientId:"",clientSecret:"",environment:"sandbox",autoApprove:!1},payu:{enabled:!1,merchantId:"",apiKey:"",apiLogin:"",environment:"sandbox",autoApprove:!1},bankTransfer:{enabled:!0,accounts:[{id:"1",bankName:"Banco Nacional",accountNumber:"1234567890",accountHolder:"Empresa Demo",accountType:"Ahorros"},{id:"2",bankName:"Banco Popular",accountNumber:"0987654321",accountHolder:"Empresa Demo",accountType:"Corriente"}],autoApprove:!1,requireConfirmation:!0},general:{currency:"USD",defaultGateway:"bold"}});return}const x=ue(te,"artifacts",ee,"public","data","settings","paymentConfig"),C=Ee(x,E=>{E.exists()&&r(E.data())});return()=>C()},[t]);const o=(x,C,E)=>{r(A=>({...A,[x]:{...A[x],[C]:E}}))},c=(x,C)=>{r(E=>({...E,general:{...E.general,[x]:C}}))},u=()=>{const x={id:Date.now().toString(),bankName:"",accountNumber:"",accountHolder:"",accountType:"Ahorros"};r(C=>({...C,bankTransfer:{...C.bankTransfer,accounts:[...C.bankTransfer.accounts,x]}}))},d=(x,C,E)=>{r(A=>({...A,bankTransfer:{...A.bankTransfer,accounts:A.bankTransfer.accounts.map(N=>N.id===x?{...N,[C]:E}:N)}}))},m=x=>{r(C=>({...C,bankTransfer:{...C.bankTransfer,accounts:C.bankTransfer.accounts.filter(E=>E.id!==x)}}))},y=async()=>{if(t){e("Configuración guardada (modo demo)","success");return}a(!0);try{const x=ue(te,"artifacts",ee,"public","data","settings","paymentConfig");await An(x,n),e("Configuración de pagos guardada exitosamente","success")}catch(x){console.error("Error saving payment config:",x),e("Error al guardar la configuración","error")}a(!1)},g=(x,C,E)=>i.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6 mb-6",children:[i.jsxs("div",{className:"flex items-center justify-between mb-4",children:[i.jsxs("h3",{className:"text-lg font-semibold text-gray-800 flex items-center gap-2",children:[i.jsx(Ut,{}),C]}),i.jsxs("label",{className:"flex items-center",children:[i.jsx("input",{type:"checkbox",checked:n[x].enabled,onChange:A=>o(x,"enabled",A.target.checked),className:"mr-2"}),i.jsx("span",{className:"text-sm text-gray-600",children:"Habilitado"})]})]}),n[x].enabled&&i.jsxs("div",{className:"space-y-4",children:[E.map(A=>i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:A.label}),A.type==="select"?i.jsx("select",{value:n[x][A.name],onChange:N=>o(x,A.name,N.target.value),className:"w-full p-2 border rounded-md",children:A.options.map(N=>i.jsx("option",{value:N.value,children:N.label},N.value))}):i.jsx("input",{type:A.type,value:n[x][A.name],onChange:N=>o(x,A.name,N.target.value),placeholder:A.placeholder,className:"w-full p-2 border rounded-md"}),A.help&&i.jsx("p",{className:"text-xs text-gray-500 mt-1",children:A.help})]},A.name)),i.jsxs("div",{className:"mt-4 p-3 bg-gray-50 rounded-md",children:[i.jsxs("label",{className:"flex items-center",children:[i.jsx("input",{type:"checkbox",checked:n[x].autoApprove,onChange:A=>o(x,"autoApprove",A.target.checked),className:"mr-2"}),i.jsx("span",{className:"text-sm text-gray-700",children:"Aprobar pagos automáticamente"})]}),i.jsx("p",{className:"text-xs text-gray-500 mt-1",children:'Los pagos de esta pasarela se marcarán como "Completado" automáticamente'})]})]})]});return i.jsxs("div",{className:"p-4 sm:p-6 lg:p-8",children:[i.jsxs("div",{className:"flex justify-between items-center mb-6",children:[i.jsxs("h2",{className:"text-2xl sm:text-3xl font-bold text-gray-900 flex items-center gap-2",children:[i.jsx(cu,{}),"Configuración de Pagos"]}),i.jsx("button",{onClick:y,disabled:s,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50",children:s?"Guardando...":"Guardar Configuración"})]}),i.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6 mb-6",children:[i.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Configuración General"}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Moneda por Defecto"}),i.jsxs("select",{value:n.general.currency,onChange:x=>c("currency",x.target.value),className:"w-full p-2 border rounded-md",children:[i.jsx("option",{value:"USD",children:"USD - Dólar Americano"}),i.jsx("option",{value:"COP",children:"COP - Peso Colombiano"}),i.jsx("option",{value:"EUR",children:"EUR - Euro"})]})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Pasarela por Defecto"}),i.jsxs("select",{value:n.general.defaultGateway,onChange:x=>c("defaultGateway",x.target.value),className:"w-full p-2 border rounded-md",children:[i.jsx("option",{value:"bold",children:"Bold"}),i.jsx("option",{value:"paypal",children:"PayPal"}),i.jsx("option",{value:"payu",children:"PayU"}),i.jsx("option",{value:"bankTransfer",children:"Transferencia Bancaria"})]})]})]}),i.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"Cada pasarela tiene su propia configuración de auto-aprobación independiente."})]}),g("bold","Bold",[{name:"apiKey",label:"API Key",type:"password",placeholder:"Ingresa tu API Key de Bold"},{name:"environment",label:"Ambiente",type:"select",options:[{value:"sandbox",label:"Sandbox (Pruebas)"},{value:"production",label:"Producción"}]},{name:"webhookSecret",label:"Webhook Secret",type:"password",placeholder:"Secreto para webhooks"}]),g("paypal","PayPal",[{name:"clientId",label:"Client ID",type:"text",placeholder:"Ingresa tu Client ID de PayPal"},{name:"clientSecret",label:"Client Secret",type:"password",placeholder:"Ingresa tu Client Secret"},{name:"environment",label:"Ambiente",type:"select",options:[{value:"sandbox",label:"Sandbox (Pruebas)"},{value:"live",label:"Live (Producción)"}]}]),g("payu","PayU",[{name:"merchantId",label:"Merchant ID",type:"text",placeholder:"ID del comerciante"},{name:"apiKey",label:"API Key",type:"password",placeholder:"API Key de PayU"},{name:"apiLogin",label:"API Login",type:"text",placeholder:"API Login de PayU"},{name:"environment",label:"Ambiente",type:"select",options:[{value:"sandbox",label:"Sandbox (Pruebas)"},{value:"production",label:"Producción"}]}]),i.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6 mb-6",children:[i.jsxs("div",{className:"flex items-center justify-between mb-4",children:[i.jsxs("h3",{className:"text-lg font-semibold text-gray-800 flex items-center gap-2",children:[i.jsx(Ut,{}),"Transferencias Bancarias"]}),i.jsxs("label",{className:"flex items-center",children:[i.jsx("input",{type:"checkbox",checked:n.bankTransfer.enabled,onChange:x=>o("bankTransfer","enabled",x.target.checked),className:"mr-2"}),i.jsx("span",{className:"text-sm text-gray-600",children:"Habilitado"})]})]}),n.bankTransfer.enabled&&i.jsxs("div",{className:"space-y-6",children:[i.jsxs("div",{className:"p-3 bg-gray-50 rounded-md",children:[i.jsxs("label",{className:"flex items-center",children:[i.jsx("input",{type:"checkbox",checked:n.bankTransfer.autoApprove,onChange:x=>o("bankTransfer","autoApprove",x.target.checked),className:"mr-2"}),i.jsx("span",{className:"text-sm text-gray-700",children:"Aprobar transferencias automáticamente"})]}),i.jsx("p",{className:"text-xs text-gray-500 mt-1",children:'Las transferencias se marcarán como "Completado" automáticamente'})]}),i.jsxs("div",{children:[i.jsxs("div",{className:"flex items-center justify-between mb-4",children:[i.jsx("h4",{className:"text-md font-medium text-gray-800",children:"Cuentas Bancarias"}),i.jsx("button",{onClick:u,className:"px-3 py-1 bg-blue-600 text-white text-sm rounded-md hover:bg-blue-700",children:"+ Agregar Cuenta"})]}),i.jsx("div",{className:"space-y-4",children:n.bankTransfer.accounts.map((x,C)=>i.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[i.jsxs("div",{className:"flex items-center justify-between mb-3",children:[i.jsxs("h5",{className:"font-medium text-gray-700",children:["Cuenta ",C+1]}),i.jsx("button",{onClick:()=>m(x.id),className:"text-red-600 hover:text-red-800 text-sm",children:"Eliminar"})]}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nombre del Banco"}),i.jsx("input",{type:"text",value:x.bankName,onChange:E=>d(x.id,"bankName",E.target.value),placeholder:"Ej: Banco Nacional",className:"w-full p-2 border rounded-md"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Número de Cuenta"}),i.jsx("input",{type:"text",value:x.accountNumber,onChange:E=>d(x.id,"accountNumber",E.target.value),placeholder:"1234567890",className:"w-full p-2 border rounded-md"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Titular de la Cuenta"}),i.jsx("input",{type:"text",value:x.accountHolder,onChange:E=>d(x.id,"accountHolder",E.target.value),placeholder:"Nombre del titular",className:"w-full p-2 border rounded-md"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tipo de Cuenta"}),i.jsxs("select",{value:x.accountType,onChange:E=>d(x.id,"accountType",E.target.value),className:"w-full p-2 border rounded-md",children:[i.jsx("option",{value:"Ahorros",children:"Ahorros"}),i.jsx("option",{value:"Corriente",children:"Corriente"})]})]})]})]},x.id))}),n.bankTransfer.accounts.length===0&&i.jsxs("div",{className:"text-center py-8 text-gray-500",children:[i.jsx("p",{children:"No hay cuentas bancarias configuradas"}),i.jsx("p",{className:"text-sm",children:'Haz clic en "Agregar Cuenta" para comenzar'})]})]})]})]}),i.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:[i.jsx("h4",{className:"font-medium text-yellow-800 mb-2",children:"⚠️ Información Importante"}),i.jsxs("ul",{className:"text-sm text-yellow-700 space-y-1",children:[i.jsx("li",{children:"• Las credenciales se almacenan de forma segura en Firestore"}),i.jsx("li",{children:"• Siempre prueba en modo sandbox antes de usar en producción"}),i.jsx("li",{children:"• Mantén tus claves API seguras y no las compartas"}),i.jsx("li",{children:"• Los webhooks deben configurarse en cada pasarela de pago"})]})]})]})}function P2({isOpen:t,onClose:e,payment:n,onSend:r,isDemo:s}){const{addNotification:a}=ke(),[o,c]=V.useState([]),[u,d]=V.useState(""),[m,y]=V.useState((n==null?void 0:n._messageType)||"approval"),[g,x]=V.useState(""),[C,E]=V.useState(!1);V.useEffect(()=>{n!=null&&n._messageType&&y(n._messageType)},[n==null?void 0:n._messageType]);const A={approval:[{id:"approval_1",name:"Pago Aprobado - Estándar",subject:"Pago Aprobado - {serviceNumber}",body:`Estimado/a {clientName},

Su pago por el servicio {serviceNumber} ha sido aprobado exitosamente.

Detalles del pago:
- Servicio: {serviceType}
- Monto: {amount} {currency}
- Fecha: {paymentDate}
- Método: {gateway}

Su servicio está ahora activo. Gracias por su pago.

Saludos cordiales,
Equipo de Soporte`},{id:"approval_2",name:"Pago Aprobado - Con Acceso",subject:"Pago Confirmado - Acceso Activado",body:`Hola {clientName},

¡Excelente noticia! Su pago de {amount} {currency} ha sido procesado correctamente.

Su servicio {serviceType} (Ref: {serviceNumber}) está ahora activo y disponible.

Puede acceder a su panel de cliente en: {clientPortalUrl}

Si tiene alguna pregunta, no dude en contactarnos.

¡Gracias por confiar en nosotros!`}],rejection:[{id:"rejection_1",name:"Pago Rechazado - Estándar",subject:"Pago Rechazado - {serviceNumber}",body:`Estimado/a {clientName},

Lamentamos informarle que su pago por el servicio {serviceNumber} no pudo ser procesado.

Detalles del pago:
- Servicio: {serviceType}
- Monto: {amount} {currency}
- Fecha: {paymentDate}
- Método: {gateway}

Por favor, verifique los datos de su método de pago e intente nuevamente.

Si necesita ayuda, contacte a nuestro equipo de soporte.

Saludos cordiales,
Equipo de Soporte`},{id:"rejection_2",name:"Pago Rechazado - Con Alternativas",subject:"Problema con el Pago - Alternativas Disponibles",body:`Hola {clientName},

Hemos detectado un problema con su pago de {amount} {currency} para el servicio {serviceNumber}.

Métodos de pago alternativos disponibles:
- Transferencia bancaria
- PayPal
- Pago en efectivo (oficina)

Para más información, visite: {paymentMethodsUrl}

¿Necesita ayuda? Contáctenos: {supportEmail}

¡Estamos aquí para ayudarle!`}]};V.useEffect(()=>{if(s){c([]);return}const z=He(xe(te,"artifacts",ee,"public","data","templates"),rt("type","==","payment_message")),j=Ee(z,v=>{const S=v.docs.map(p=>({id:p.id,...p.data()}));c(S)});return()=>j()},[s]);const N=z=>{d(z);const j=o.find(p=>p.id===z);if(j){x(j.body);return}const S=A[m].find(p=>p.id===z);S&&x(S.body)},T=z=>n?z.replace(/{clientName}/g,n.clientName||"Cliente").replace(/{serviceNumber}/g,n.serviceNumber||"N/A").replace(/{serviceType}/g,n.serviceType||"Servicio").replace(/{amount}/g,n.amount||"0").replace(/{currency}/g,n.currency||"USD").replace(/{gateway}/g,n.gateway||"N/A").replace(/{paymentDate}/g,new Date().toLocaleDateString("es-ES")).replace(/{clientPortalUrl}/g,window.location.origin).replace(/{paymentMethodsUrl}/g,`${window.location.origin}/payment-methods`).replace(/{supportEmail}/g,"soporte@empresa.com"):z,k=async()=>{if(!g.trim()){a("Por favor, ingrese un mensaje","error");return}E(!0);try{const z={paymentId:n.id,type:m,templateId:u,message:T(g),sentAt:new Date,status:"sent"};await r(z),a(`Mensaje de ${m==="approval"?"aprobación":"rechazo"} enviado`,"success"),e()}catch(z){console.error("Error sending message:",z),a("Error al enviar el mensaje","error")}E(!1)};if(!t||!n)return null;const L=A[m],q=[...o,...L];return i.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex justify-center items-center p-4",children:i.jsxs("div",{className:"bg-white rounded-lg shadow-2xl p-6 max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:[i.jsxs("div",{className:"flex items-center justify-between mb-6",children:[i.jsxs("h2",{className:"text-2xl font-bold text-gray-800 flex items-center gap-2",children:[i.jsx(Ut,{}),"Enviar Mensaje de ",m==="approval"?"Aprobación":"Rechazo"]}),i.jsx("button",{onClick:e,className:"text-gray-400 hover:text-gray-600",children:"✕"})]}),i.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 mb-6",children:[i.jsx("h3",{className:"font-semibold text-gray-800 mb-2",children:"Información del Pago"}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm",children:[i.jsxs("div",{children:[i.jsx("span",{className:"font-medium text-gray-600",children:"Cliente:"}),i.jsx("span",{className:"ml-2",children:n.clientName})]}),i.jsxs("div",{children:[i.jsx("span",{className:"font-medium text-gray-600",children:"Servicio:"}),i.jsx("span",{className:"ml-2 font-mono",children:n.serviceNumber})]}),i.jsxs("div",{children:[i.jsx("span",{className:"font-medium text-gray-600",children:"Monto:"}),i.jsxs("span",{className:"ml-2",children:[n.amount," ",n.currency]})]})]})]}),i.jsxs("div",{className:"mb-6",children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Tipo de Mensaje"}),i.jsxs("div",{className:"flex space-x-4",children:[i.jsxs("button",{onClick:()=>y("approval"),className:`flex items-center gap-2 px-4 py-2 rounded-lg border ${m==="approval"?"bg-green-50 border-green-200 text-green-800":"bg-gray-50 border-gray-200 text-gray-600"}`,children:[i.jsx(uu,{}),"Aprobación"]}),i.jsxs("button",{onClick:()=>y("rejection"),className:`flex items-center gap-2 px-4 py-2 rounded-lg border ${m==="rejection"?"bg-red-50 border-red-200 text-red-800":"bg-gray-50 border-gray-200 text-gray-600"}`,children:[i.jsx(bi,{}),"Rechazo"]})]})]}),i.jsxs("div",{className:"mb-6",children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Seleccionar Plantilla"}),i.jsxs("select",{value:u,onChange:z=>N(z.target.value),className:"w-full p-2 border rounded-md",children:[i.jsx("option",{value:"",children:"-- Seleccionar plantilla --"}),q.map(z=>i.jsx("option",{value:z.id,children:z.name},z.id))]})]}),i.jsxs("div",{className:"mb-6",children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Mensaje Personalizado"}),i.jsx("textarea",{value:g,onChange:z=>x(z.target.value),placeholder:"Escriba su mensaje personalizado aquí...",rows:12,className:"w-full p-3 border rounded-md font-mono text-sm"}),i.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Variables disponibles: ",clientName,", ",serviceNumber,", ",serviceType,", ",amount,", ",currency,", ",gateway,", ",paymentDate]})]}),g&&i.jsxs("div",{className:"mb-6",children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Vista Previa"}),i.jsxs("div",{className:"bg-gray-50 border rounded-lg p-4",children:[i.jsx("div",{className:"font-semibold text-gray-800 mb-2",children:m==="approval"?"✅ Pago Aprobado":"❌ Pago Rechazado"}),i.jsx("div",{className:"text-sm text-gray-700 whitespace-pre-wrap",children:T(g)})]})]}),i.jsxs("div",{className:"flex justify-end space-x-4",children:[i.jsx("button",{onClick:e,className:"px-4 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300",children:"Cancelar"}),i.jsx("button",{onClick:k,disabled:C||!g.trim(),className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50",children:C?"Enviando...":`Enviar ${m==="approval"?"Aprobación":"Rechazo"}`})]})]})})}function R2({isDemo:t}){const{addNotification:e}=ke(),[n,r]=V.useState({renewalSettings:{enabled:!0,maxRenewalYears:3,autoRenewal:!0,gracePeriodDays:7,reminderDays:3},discounts:{monthly:{enabled:!1,discount:0,description:"Descuento por pago mensual"},quarterly:{enabled:!1,discount:5,description:"Descuento por pago trimestral"},semiAnnual:{enabled:!1,discount:10,description:"Descuento por pago semestral"},annual:{enabled:!1,discount:15,description:"Descuento por pago anual"},biennial:{enabled:!1,discount:25,description:"Descuento por pago bienal (2 años)"},triennial:{enabled:!1,discount:35,description:"Descuento por pago trienal (3 años)"}},taxSettings:{ivaEnabled:!0,ivaPercentage:19,ivaIncluded:!1,taxName:"IVA"},documentSettings:{invoiceName:"Factura",receiptName:"Remisión",invoicePrefix:"FAC",receiptPrefix:"REM",invoiceNumberFormat:"FAC-{year}-{month}-{number}",receiptNumberFormat:"REM-{year}-{month}-{number}"},pricingSettings:{roundToNearest:100,minimumAmount:1e3,maximumAmount:1e7}}),[s,a]=V.useState(!1);V.useEffect(()=>{if(t){r({renewalSettings:{enabled:!0,maxRenewalYears:3,autoRenewal:!0,gracePeriodDays:7,reminderDays:3},discounts:{monthly:{enabled:!1,discount:0,description:"Descuento por pago mensual"},quarterly:{enabled:!0,discount:5,description:"Descuento por pago trimestral"},semiAnnual:{enabled:!0,discount:10,description:"Descuento por pago semestral"},annual:{enabled:!0,discount:15,description:"Descuento por pago anual"},biennial:{enabled:!0,discount:25,description:"Descuento por pago bienal (2 años)"},triennial:{enabled:!0,discount:35,description:"Descuento por pago trienal (3 años)"}},taxSettings:{ivaEnabled:!0,ivaPercentage:19,ivaIncluded:!1,taxName:"IVA"},documentSettings:{invoiceName:"Factura",receiptName:"Remisión",invoicePrefix:"FAC",receiptPrefix:"REM",invoiceNumberFormat:"FAC-{year}-{month}-{number}",receiptNumberFormat:"REM-{year}-{month}-{number}"},pricingSettings:{roundToNearest:100,minimumAmount:1e3,maximumAmount:1e7}});return}const x=ue(te,"artifacts",ee,"public","data","settings","renewalConfig"),C=Ee(x,E=>{E.exists()&&r(E.data())});return()=>C()},[t]);const o=(x,C,E)=>{r(A=>({...A,[x]:{...A[x],[C]:E}}))},c=(x,C,E)=>{r(A=>({...A,discounts:{...A.discounts,[x]:{...A.discounts[x],[C]:E}}}))},u=async()=>{if(t){e("Configuración guardada (modo demo)","success");return}a(!0);try{const x=ue(te,"artifacts",ee,"public","data","settings","renewalConfig");await An(x,n),e("Configuración de renovaciones guardada exitosamente","success")}catch(x){console.error("Error saving renewal config:",x),e("Error al guardar la configuración","error")}a(!1)},d=(x,C)=>{const E=n.discounts[C];if(!E.enabled)return x;const A=x*E.discount/100,N=x-A,T=Math.round(N/n.pricingSettings.roundToNearest)*n.pricingSettings.roundToNearest;return Math.max(T,n.pricingSettings.minimumAmount)},m=x=>{if(!n.taxSettings.ivaEnabled||n.taxSettings.ivaIncluded)return x;{const C=x*n.taxSettings.ivaPercentage/100;return x+C}},y=x=>new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP"}).format(x),g=[{key:"monthly",label:"Mensual",months:1},{key:"quarterly",label:"Trimestral",months:3},{key:"semiAnnual",label:"Semestral",months:6},{key:"annual",label:"Anual",months:12},{key:"biennial",label:"Bienal (2 años)",months:24},{key:"triennial",label:"Trienal (3 años)",months:36}];return i.jsxs("div",{className:"p-4 sm:p-6 lg:p-8",children:[i.jsxs("div",{className:"flex items-center justify-between mb-6",children:[i.jsxs("h2",{className:"text-2xl sm:text-3xl font-bold text-gray-900 flex items-center gap-2",children:[i.jsx(Mr,{}),"Configuración de Renovaciones"]}),i.jsx("button",{onClick:u,disabled:s,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50",children:s?"Guardando...":"Guardar Configuración"})]}),i.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6 mb-6",children:[i.jsxs("h3",{className:"text-lg font-semibold text-gray-800 mb-4 flex items-center gap-2",children:[i.jsx(cu,{}),"Configuración General"]}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[i.jsx("div",{children:i.jsxs("label",{className:"flex items-center mb-2",children:[i.jsx("input",{type:"checkbox",checked:n.renewalSettings.enabled,onChange:x=>o("renewalSettings","enabled",x.target.checked),className:"mr-2"}),i.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Habilitar renovaciones automáticas"})]})}),i.jsx("div",{children:i.jsxs("label",{className:"flex items-center mb-2",children:[i.jsx("input",{type:"checkbox",checked:n.renewalSettings.autoRenewal,onChange:x=>o("renewalSettings","autoRenewal",x.target.checked),className:"mr-2"}),i.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Renovación automática"})]})}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Máximo de años para renovación"}),i.jsxs("select",{value:n.renewalSettings.maxRenewalYears,onChange:x=>o("renewalSettings","maxRenewalYears",parseInt(x.target.value)),className:"w-full p-2 border rounded-md",children:[i.jsx("option",{value:1,children:"1 año"}),i.jsx("option",{value:2,children:"2 años"}),i.jsx("option",{value:3,children:"3 años"})]})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Días de gracia"}),i.jsx("input",{type:"number",value:n.renewalSettings.gracePeriodDays,onChange:x=>o("renewalSettings","gracePeriodDays",parseInt(x.target.value)),className:"w-full p-2 border rounded-md",min:"0",max:"30"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Días de recordatorio"}),i.jsx("input",{type:"number",value:n.renewalSettings.reminderDays,onChange:x=>o("renewalSettings","reminderDays",parseInt(x.target.value)),className:"w-full p-2 border rounded-md",min:"1",max:"30"})]})]})]}),i.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6 mb-6",children:[i.jsxs("h3",{className:"text-lg font-semibold text-gray-800 mb-4 flex items-center gap-2",children:[i.jsx(Pw,{}),"Descuentos por Período de Renovación"]}),i.jsx("div",{className:"space-y-4",children:g.map(x=>i.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[i.jsxs("div",{className:"flex items-center justify-between mb-3",children:[i.jsx("h4",{className:"font-medium text-gray-800",children:x.label}),i.jsxs("label",{className:"flex items-center",children:[i.jsx("input",{type:"checkbox",checked:n.discounts[x.key].enabled,onChange:C=>c(x.key,"enabled",C.target.checked),className:"mr-2"}),i.jsx("span",{className:"text-sm text-gray-600",children:"Habilitado"})]})]}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Descuento (%)"}),i.jsx("input",{type:"number",value:n.discounts[x.key].discount,onChange:C=>c(x.key,"discount",parseFloat(C.target.value)),className:"w-full p-2 border rounded-md",min:"0",max:"100",step:"0.1",disabled:!n.discounts[x.key].enabled})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Descripción"}),i.jsx("input",{type:"text",value:n.discounts[x.key].description,onChange:C=>c(x.key,"description",C.target.value),className:"w-full p-2 border rounded-md",disabled:!n.discounts[x.key].enabled})]})]}),n.discounts[x.key].enabled&&i.jsxs("div",{className:"mt-3 p-3 bg-gray-50 rounded-md",children:[i.jsx("h5",{className:"text-sm font-medium text-gray-700 mb-2",children:"Simulación de Precio"}),i.jsxs("div",{className:"text-sm text-gray-600",children:[i.jsxs("div",{children:["Precio original: ",y(1e5)]}),i.jsxs("div",{children:["Descuento (",n.discounts[x.key].discount,"%): ",y(1e5-d(1e5,x.key))]}),i.jsxs("div",{className:"font-semibold text-green-600",children:["Precio final: ",y(d(1e5,x.key))]})]})]})]},x.key))})]}),i.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6 mb-6",children:[i.jsxs("h3",{className:"text-lg font-semibold text-gray-800 mb-4 flex items-center gap-2",children:[i.jsx(Ut,{}),"Configuración de Impuestos"]}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[i.jsx("div",{children:i.jsxs("label",{className:"flex items-center mb-2",children:[i.jsx("input",{type:"checkbox",checked:n.taxSettings.ivaEnabled,onChange:x=>o("taxSettings","ivaEnabled",x.target.checked),className:"mr-2"}),i.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Habilitar IVA"})]})}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Porcentaje de IVA (%)"}),i.jsx("input",{type:"number",value:n.taxSettings.ivaPercentage,onChange:x=>o("taxSettings","ivaPercentage",parseFloat(x.target.value)),className:"w-full p-2 border rounded-md",min:"0",max:"100",step:"0.1",disabled:!n.taxSettings.ivaEnabled})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tipo de IVA"}),i.jsxs("select",{value:n.taxSettings.ivaIncluded?"included":"excluded",onChange:x=>o("taxSettings","ivaIncluded",x.target.value==="included"),className:"w-full p-2 border rounded-md",disabled:!n.taxSettings.ivaEnabled,children:[i.jsx("option",{value:"excluded",children:"IVA se suma al precio"}),i.jsx("option",{value:"included",children:"IVA incluido en el precio"})]})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nombre del impuesto"}),i.jsx("input",{type:"text",value:n.taxSettings.taxName,onChange:x=>o("taxSettings","taxName",x.target.value),className:"w-full p-2 border rounded-md",disabled:!n.taxSettings.ivaEnabled})]})]}),n.taxSettings.ivaEnabled&&i.jsxs("div",{className:"mt-4 p-4 bg-gray-50 rounded-md",children:[i.jsx("h5",{className:"text-sm font-medium text-gray-700 mb-2",children:"Simulación de Impuestos"}),i.jsxs("div",{className:"text-sm text-gray-600",children:[i.jsxs("div",{children:["Precio base: ",y(1e5)]}),!n.taxSettings.ivaIncluded&&i.jsxs("div",{children:["IVA (",n.taxSettings.ivaPercentage,"%): ",y(1e5*n.taxSettings.ivaPercentage/100)]}),i.jsxs("div",{className:"font-semibold text-blue-600",children:["Precio final: ",y(m(1e5))]})]})]})]}),i.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6 mb-6",children:[i.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Configuración de Documentos"}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nombre de Factura"}),i.jsx("input",{type:"text",value:n.documentSettings.invoiceName,onChange:x=>o("documentSettings","invoiceName",x.target.value),className:"w-full p-2 border rounded-md"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nombre de Remisión"}),i.jsx("input",{type:"text",value:n.documentSettings.receiptName,onChange:x=>o("documentSettings","receiptName",x.target.value),className:"w-full p-2 border rounded-md"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Prefijo de Factura"}),i.jsx("input",{type:"text",value:n.documentSettings.invoicePrefix,onChange:x=>o("documentSettings","invoicePrefix",x.target.value),className:"w-full p-2 border rounded-md"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Prefijo de Remisión"}),i.jsx("input",{type:"text",value:n.documentSettings.receiptPrefix,onChange:x=>o("documentSettings","receiptPrefix",x.target.value),className:"w-full p-2 border rounded-md"})]}),i.jsxs("div",{className:"md:col-span-2",children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Formato de Número de Factura"}),i.jsx("input",{type:"text",value:n.documentSettings.invoiceNumberFormat,onChange:x=>o("documentSettings","invoiceNumberFormat",x.target.value),className:"w-full p-2 border rounded-md",placeholder:"FAC-{year}-{month}-{number}"}),i.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Variables disponibles: ","{year}",", ","{month}",", ","{number}"]})]}),i.jsxs("div",{className:"md:col-span-2",children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Formato de Número de Remisión"}),i.jsx("input",{type:"text",value:n.documentSettings.receiptNumberFormat,onChange:x=>o("documentSettings","receiptNumberFormat",x.target.value),className:"w-full p-2 border rounded-md",placeholder:"REM-{year}-{month}-{number}"}),i.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Variables disponibles: ","{year}",", ","{month}",", ","{number}"]})]})]})]}),i.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6 mb-6",children:[i.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Configuración de Precios"}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Redondear al múltiplo más cercano"}),i.jsx("input",{type:"number",value:n.pricingSettings.roundToNearest,onChange:x=>o("pricingSettings","roundToNearest",parseInt(x.target.value)),className:"w-full p-2 border rounded-md",min:"1"}),i.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Ej: 100 para redondear a centenas"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Monto mínimo"}),i.jsx("input",{type:"number",value:n.pricingSettings.minimumAmount,onChange:x=>o("pricingSettings","minimumAmount",parseInt(x.target.value)),className:"w-full p-2 border rounded-md",min:"0"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Monto máximo"}),i.jsx("input",{type:"number",value:n.pricingSettings.maximumAmount,onChange:x=>o("pricingSettings","maximumAmount",parseInt(x.target.value)),className:"w-full p-2 border rounded-md",min:"0"})]})]})]}),i.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:[i.jsx("h4",{className:"font-medium text-yellow-800 mb-2",children:"⚠️ Información Importante"}),i.jsxs("ul",{className:"text-sm text-yellow-700 space-y-1",children:[i.jsx("li",{children:"• Los descuentos se aplican automáticamente según el período de renovación seleccionado"}),i.jsx("li",{children:"• Los precios se redondean automáticamente para evitar decimales"}),i.jsx("li",{children:"• El IVA se calcula según la configuración establecida"}),i.jsx("li",{children:"• Los nombres de documentos se pueden personalizar según las necesidades"})]})]})]})}function D2({isDemo:t,userRole:e}){const{addNotification:n}=ke(),[r,s]=V.useState([]),[a,o]=V.useState([]),[c,u]=V.useState(""),[d,m]=V.useState("Todos"),[y,g]=V.useState("Todos"),[x,C]=V.useState(!0),[E,A]=V.useState("history"),[N,T]=V.useState(!1),[k,L]=V.useState(null),[q,z]=V.useState(!1),j=["Todos","Pendiente","Procesando","Completado","Fallido","Cancelado","Reembolsado"],v=["Todos","Bold","PayPal","PayU","Transferencia Bancaria","Manual"];V.useEffect(()=>{if(t){s([{id:"demo1",serviceNumber:"SRV-241017-123456",clientName:"Juan Pérez",clientEmail:"juan@ejemplo.com",amount:10.99,currency:"USD",status:"Completado",gateway:"Bold",transactionId:"bold_txn_123456",createdAt:{seconds:Date.now()/1e3-86400},completedAt:{seconds:Date.now()/1e3-3600}},{id:"demo2",serviceNumber:"SRV-241017-789012",clientName:"María García",clientEmail:"maria@ejemplo.com",amount:25,currency:"USD",status:"Pendiente",gateway:"PayPal",transactionId:"paypal_txn_789012",createdAt:{seconds:Date.now()/1e3-7200}},{id:"demo3",serviceNumber:"SRV-241017-345678",clientName:"Carlos López",clientEmail:"carlos@ejemplo.com",amount:50,currency:"USD",status:"Completado",gateway:"Transferencia Bancaria",transactionId:"TRF-123456789",createdAt:{seconds:Date.now()/1e3-10800},completedAt:{seconds:Date.now()/1e3-9e3}}]),o([{id:"client1",fullName:"Juan Pérez",email:"juan@ejemplo.com"},{id:"client2",fullName:"María García",email:"maria@ejemplo.com"}]),C(!1);return}const U=xe(te,"artifacts",ee,"public","data","payments"),Q=Ee(U,R=>{console.log("Admin payments snapshot:",R.size,"documents");const K=R.docs.map(Y=>{const ne=Y.data();return console.log("Payment doc:",Y.id,ne),{id:Y.id,...ne}});K.sort((Y,ne)=>{var ce,Ie;const pe=((ce=Y.createdAt)==null?void 0:ce.seconds)||0;return(((Ie=ne.createdAt)==null?void 0:Ie.seconds)||0)-pe}),console.log("Admin payments loaded:",K.length,K),s(K),C(!1)},R=>{console.error("Error loading payments:",R),n("Error al cargar los pagos","error"),C(!1)}),P=He(xe(te,"artifacts",ee,"public","data","users"),rt("role","==","client")),H=Ee(P,R=>{const K=R.docs.map(Y=>({id:Y.id,...Y.data()}));o(K)});return()=>{Q(),H()}},[t,n]);const S=r.filter(U=>{var R,K,Y,ne;const Q=((R=U.serviceNumber)==null?void 0:R.toLowerCase().includes(c.toLowerCase()))||((K=U.clientName)==null?void 0:K.toLowerCase().includes(c.toLowerCase()))||((Y=U.clientEmail)==null?void 0:Y.toLowerCase().includes(c.toLowerCase()))||((ne=U.transactionId)==null?void 0:ne.toLowerCase().includes(c.toLowerCase())),P=d==="Todos"||U.status===d,H=y==="Todos"||U.gateway===y;return Q&&P&&H}),p=async(U,Q)=>{if(t){n("Función no disponible en modo demo","error");return}try{const P=ue(te,"artifacts",ee,"public","data","payments",U);if(await qe(P,{status:Q,updatedAt:new Date,...Q==="Completado"?{completedAt:oe.now()}:{}}),Q==="Completado"){const H=await ls(P);if(H.exists()){const R=H.data(),K=R.serviceId;if(K&&(R.isRenewal||R.paymentType==="Renovación"))try{const Y=ue(te,"artifacts",ee,"public","data","services",K),ne={};R.startDate&&(ne.dueDate=R.startDate),R.endDate&&(ne.expirationDate=R.endDate),ne.status="Pago",ne.updatedAt=oe.now(),await qe(Y,ne)}catch(Y){console.error("Error updating service after completed payment:",Y)}}}n(`Estado del pago actualizado a ${Q}`,"success")}catch(P){console.error("Error updating payment status:",P),n("Error al actualizar el estado del pago","error")}},I=(U,Q)=>{L({...U,_messageType:Q}),T(!0)},b=U=>{const Q=$(U),P=new Blob([Q],{type:"text/html"}),H=URL.createObjectURL(P),R=document.createElement("a");R.href=H,R.download=`invoice-INV-${U.id.slice(-8).toUpperCase()}.html`,document.body.appendChild(R),R.click(),document.body.removeChild(R),URL.revokeObjectURL(H),n("Invoice descargado exitosamente","success")},_=async U=>{if(t){n("Función no disponible en modo demo","error");return}if(window.confirm("¿Estás seguro de que quieres eliminar este pago? Esta acción no se puede deshacer."))try{await vi(ue(te,"artifacts",ee,"public","data","payments",U)),n("Pago eliminado exitosamente","success")}catch(Q){console.error("Error deleting payment:",Q),n("Error al eliminar el pago","error")}},$=U=>{var Q;try{if(!U||!U.id)return console.error("Payment inválido para generar invoice:",U),"<html><body><p>Error: Datos de pago incompletos</p></body></html>";const H="INV-"+String(U.id||"").slice(-8).toUpperCase(),R=new Date(((Q=U.createdAt)==null?void 0:Q.seconds)*1e3||Date.now()).toLocaleDateString("es-ES"),K=U.dueDate?new Date(U.dueDate.seconds*1e3).toLocaleDateString("es-ES"):"N/A",Y=String(U.clientName||"Cliente"),ne=String(U.clientEmail||"N/A"),pe=String(U.serviceNumber||"N/A"),Ce=String(U.serviceType||"Servicio"),ce=String(U.description||"Descripción del servicio"),Ie=Number(U.amount||0),kt=String(U.currency||"USD"),an="Completado",Bt=String(U.gateway||"N/A"),Pt=String(U.transactionId||"N/A"),Mn=String(U.paymentMethod||"N/A"),et="completado",xo=Ie.toFixed(2),vo=Pt!=="N/A"?"<p>ID de Transacción: "+Pt+"</p>":"";return["<!DOCTYPE html>","<html>","<head>",'<meta charset="UTF-8">',"<title>Invoice "+H+"</title>","<style>body { font-family: Arial, sans-serif; margin: 0; padding: 20px; background: #f5f5f5; } .invoice { background: white; max-width: 800px; margin: 0 auto; padding: 30px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); } .header { text-align: center; margin-bottom: 30px; border-bottom: 2px solid #e5e5e5; padding-bottom: 20px; } .company-name { font-size: 24px; font-weight: bold; color: #2563eb; margin-bottom: 5px; } .invoice-title { font-size: 18px; color: #666; } .invoice-details { display: flex; justify-content: space-between; margin-bottom: 30px; } .client-info, .invoice-info { flex: 1; } .client-info h3, .invoice-info h3 { margin: 0 0 10px 0; color: #333; font-size: 16px; } .client-info p, .invoice-info p { margin: 5px 0; color: #666; font-size: 14px; } .service-details { margin-bottom: 30px; } .service-table { width: 100%; border-collapse: collapse; margin-top: 15px; } .service-table th, .service-table td { padding: 12px; text-align: left; border-bottom: 1px solid #e5e5e5; } .service-table th { background: #f8f9fa; font-weight: bold; color: #333; } .service-table .amount { text-align: right; font-weight: bold; } .total { text-align: right; margin-top: 20px; } .total-amount { font-size: 20px; font-weight: bold; color: #2563eb; } .status { display: inline-block; padding: 4px 12px; border-radius: 20px; font-size: 12px; font-weight: bold; } .status.completado { background: #d1fae5; color: #065f46; } .status.pendiente { background: #fef3c7; color: #92400e; } .status.fallido { background: #fee2e2; color: #991b1b; } .status.cancelado { background: #f3f4f6; color: #374151; } .footer { margin-top: 40px; text-align: center; color: #666; font-size: 12px; border-top: 1px solid #e5e5e5; padding-top: 20px; }</style>","</head>","<body>",'<div class="invoice">','<div class="header">','<div class="company-name">Gestor de Cobros</div>','<div class="invoice-title">FACTURA</div>',"</div>",'<div class="invoice-details">','<div class="client-info">',"<h3>Cliente</h3>","<p><strong>"+Y+"</strong></p>","<p>"+ne+"</p>","</div>",'<div class="invoice-info">',"<h3>Detalles de la Factura</h3>","<p><strong>Número:</strong> "+H+"</p>","<p><strong>Fecha:</strong> "+R+"</p>","<p><strong>Vencimiento:</strong> "+K+"</p>",'<p><strong>Estado:</strong> <span class="status '+et+'">'+an+"</span></p>","</div>","</div>",'<div class="service-details">',"<h3>Detalles del Servicio</h3>",'<table class="service-table">',"<thead>","<tr><th>Servicio</th><th>Descripción</th><th>Monto</th></tr>","</thead>","<tbody>","<tr>","<td>"+Ce+"</td>","<td>"+ce+"</td>",'<td class="amount">'+kt+" "+xo+"</td>","</tr>","</tbody>","</table>","</div>",'<div class="total">','<div class="total-amount">Total: '+kt+" "+xo+"</div>","</div>",'<div class="footer">',"<p>Método de Pago: "+Mn+"</p>","<p>Gateway: "+Bt+"</p>",vo,"<p>Gracias por su negocio</p>","</div>","</div>","</body>","</html>"].join("")}catch(P){return console.error("Error en generateInvoiceHTML:",P),"<html><body><p>Error generando factura</p></body></html>"}},D=async U=>{if(t){n("Mensaje enviado (modo demo)","success");return}try{const Q=k;if(!Q||!Q.id){n("No se encontró el pago seleccionado o falta el ID","error");return}if(U.type==="approval"){const P=ue(te,"artifacts",ee,"public","data","payments",Q.id);await qe(P,{status:"Completado",completedAt:oe.now(),updatedAt:oe.now()});const H=await ls(P);if(!H.exists()){n("No se pudo encontrar el pago actualizado","error");return}const R={id:Q.id,...H.data(),clientName:H.data().clientName||Q.clientName||"Cliente",clientEmail:H.data().clientEmail||Q.clientEmail||"N/A",serviceNumber:H.data().serviceNumber||Q.serviceNumber||"N/A",serviceType:H.data().serviceType||Q.serviceType||"Servicio",description:H.data().description||Q.description||"Descripción del servicio",amount:H.data().amount||Q.amount||0,currency:H.data().currency||Q.currency||"USD",gateway:H.data().gateway||Q.gateway||"N/A",transactionId:H.data().transactionId||Q.transactionId||"N/A",paymentMethod:H.data().paymentMethod||Q.paymentMethod||"N/A",createdAt:H.data().createdAt||Q.createdAt,dueDate:H.data().dueDate||Q.dueDate};let K;try{K=$(R)}catch(ne){console.error("Error generando invoice HTML:",ne),K=`
            <html>
              <body>
                <h1>Factura</h1>
                <p>Cliente: ${String(R.clientName||"Cliente")}</p>
                <p>Monto: ${String(R.currency||"USD")} ${Number(R.amount||0).toFixed(2)}</p>
                <p>Estado: Completado</p>
              </body>
            </html>
          `}const Y=R.serviceId;if(Y)try{const ne=ue(te,"artifacts",ee,"public","data","services",Y),pe=await ls(ne);if(pe.exists()){const Ce=pe.data(),ce={updatedAt:oe.now()};R.isRenewal||R.paymentType==="Renovación"?(R.startDate&&(ce.dueDate=R.startDate),R.endDate&&(ce.expirationDate=R.endDate),ce.status="Activo"):(Ce.billingCycle==="One-Time"||R.paymentType==="Pago Único")&&(ce.paidDate=oe.now(),ce.status="Pago"),Object.keys(ce).length>1&&await qe(ne,ce)}}catch(ne){console.error("Error actualizando servicio después de aprobación:",ne)}U.invoiceHTML=K,U.invoiceNumber=`INV-${Q.id.slice(-8).toUpperCase()}`,console.log("Mensaje de aprobación enviado con invoice:",{paymentId:Q.id,invoiceNumber:U.invoiceNumber,message:U.message})}console.log("Mensaje enviado:",U),n(U.type==="approval"?"Pago aprobado, servicio actualizado e invoice enviado exitosamente":"Mensaje enviado exitosamente","success"),T(!1),L(null)}catch(Q){console.error("Error enviando mensaje:",Q),n("Error al enviar el mensaje","error")}},F=U=>({Pendiente:"bg-yellow-100 text-yellow-800",Procesando:"bg-blue-100 text-blue-800",Completado:"bg-green-100 text-green-800",Fallido:"bg-red-100 text-red-800",Cancelado:"bg-gray-100 text-gray-800",Reembolsado:"bg-purple-100 text-purple-800"})[U]||"bg-gray-100 text-gray-800",O=U=>({Bold:"bg-blue-100 text-blue-800",PayPal:"bg-yellow-100 text-yellow-800",PayU:"bg-green-100 text-green-800","Transferencia Bancaria":"bg-purple-100 text-purple-800",Manual:"bg-gray-100 text-gray-800"})[U]||"bg-gray-100 text-gray-800",M=U=>U?new Date(U.seconds*1e3).toLocaleDateString("es-ES",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"--",W=(U,Q)=>new Intl.NumberFormat("es-ES",{style:"currency",currency:Q||"USD"}).format(U);return x?i.jsx("div",{className:"flex justify-center items-center h-64",children:i.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):i.jsxs("div",{className:"p-4 sm:p-6 lg:p-8",children:[i.jsx("div",{className:"flex flex-wrap justify-between items-center gap-4 mb-6",children:i.jsxs("h2",{className:"text-2xl sm:text-3xl font-bold text-gray-900 flex items-center gap-2",children:[i.jsx(Ut,{}),"Gestión de Pagos"]})}),i.jsx("div",{className:"border-b border-gray-200 mb-6",children:i.jsxs("nav",{className:"-mb-px flex space-x-8",children:[i.jsxs("button",{onClick:()=>A("history"),className:`${E==="history"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"} flex items-center gap-2 py-4 px-1 border-b-2 font-medium text-sm`,children:[i.jsx(Ut,{}),"Historial de Pagos"]}),i.jsxs("button",{onClick:()=>A("renewal"),className:`${E==="renewal"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"} flex items-center gap-2 py-4 px-1 border-b-2 font-medium text-sm`,children:[i.jsx(Mr,{}),"Renovaciones"]}),e==="superadmin"&&i.jsxs("button",{onClick:()=>A("config"),className:`${E==="config"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"} flex items-center gap-2 py-4 px-1 border-b-2 font-medium text-sm`,children:[i.jsx(cu,{}),"Configuración"]})]})}),E==="renewal"?i.jsxs("div",{className:"p-6",children:[i.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Configuración de Renovaciones"}),i.jsx(R2,{isDemo:t})]}):E==="config"?i.jsx(Rw,{isDemo:t}):i.jsxs(i.Fragment,{children:[i.jsx("div",{className:"flex flex-wrap justify-between items-center gap-4 mb-6",children:i.jsxs("div",{className:"text-sm text-gray-500",children:[S.length," pago",S.length!==1?"s":""," encontrado",S.length!==1?"s":""]})}),i.jsx("div",{className:"bg-white rounded-lg shadow-md p-4 mb-6",children:i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[i.jsxs("div",{className:"relative",children:[i.jsx("input",{type:"text",placeholder:"Buscar por servicio, cliente, email o transacción...",value:c,onChange:U=>u(U.target.value),className:"w-full pl-10 pr-4 py-2 border rounded-md"}),i.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:i.jsx(Ii,{})})]}),i.jsx("select",{value:d,onChange:U=>m(U.target.value),className:"w-full p-2 border rounded-md",children:j.map(U=>i.jsx("option",{value:U,children:U},U))}),i.jsx("select",{value:y,onChange:U=>g(U.target.value),className:"w-full p-2 border rounded-md",children:v.map(U=>i.jsx("option",{value:U,children:U},U))}),i.jsxs("button",{className:"flex items-center justify-center gap-2 px-4 py-2 bg-gray-100 text-gray-700 rounded-md hover:bg-gray-200",children:[i.jsx(ri,{}),"Filtros"]})]})}),i.jsx("div",{className:"bg-white rounded-xl shadow-lg overflow-x-auto",children:i.jsxs("table",{className:"w-full text-left",children:[i.jsx("thead",{className:"bg-gray-50",children:i.jsx("tr",{children:["Servicio","Cliente","Monto","Estado","Pasarela","Transacción","Fecha","Acciones"].map(U=>i.jsx("th",{className:"px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:U},U))})}),i.jsx("tbody",{className:"divide-y divide-gray-200",children:S.map(U=>i.jsxs("tr",{className:"hover:bg-gray-50",children:[i.jsxs("td",{className:"px-6 py-4",children:[i.jsx("div",{className:"font-mono text-sm font-medium text-blue-600",children:U.serviceNumber||U.id}),i.jsx("div",{className:"text-sm text-gray-600",children:U.serviceName||U.serviceType||"N/A"}),U.serviceDescription&&i.jsx("div",{className:"text-xs text-gray-500 truncate max-w-xs",children:U.serviceDescription}),U.isRenewal&&i.jsxs("div",{className:"text-xs text-green-600 font-medium",children:["Renovación: ",U.renewalPeriod||"N/A"]})]}),i.jsxs("td",{className:"px-6 py-4",children:[i.jsx("div",{className:"font-medium text-gray-900",children:U.clientName}),i.jsx("div",{className:"text-sm text-gray-500",children:U.clientEmail})]}),i.jsx("td",{className:"px-6 py-4",children:i.jsx("div",{className:"font-semibold text-gray-900",children:W(U.amount,U.currency)})}),i.jsx("td",{className:"px-6 py-4",children:i.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${F(U.status)}`,children:U.status})}),i.jsx("td",{className:"px-6 py-4",children:i.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${O(U.gateway)}`,children:U.gateway})}),i.jsxs("td",{className:"px-6 py-4",children:[i.jsx("div",{className:"font-mono text-sm text-gray-600",children:U.transactionId||"N/A"}),U.proofUrl&&i.jsx("div",{className:"mt-2",children:i.jsx("button",{onClick:()=>{L(U),z(!0)},className:"px-2 py-1 text-xs bg-purple-100 text-purple-700 rounded hover:bg-purple-200",children:"Ver Comprobante"})})]}),i.jsxs("td",{className:"px-6 py-4",children:[i.jsxs("div",{className:"text-sm text-gray-900 flex items-center gap-2",children:[M(U.createdAt),U.proofUrl&&i.jsx("span",{className:"ml-2 inline-flex px-2 py-0.5 text-xs rounded-full bg-purple-100 text-purple-700",title:"Comprobante adjunto",children:"Comprobante"})]}),U.completedAt&&i.jsxs("div",{className:"text-xs text-gray-500",children:["Completado: ",M(U.completedAt)]}),U.startDate&&U.endDate&&i.jsxs("div",{className:"text-xs text-blue-600 mt-1",children:[i.jsxs("div",{children:["Inicio: ",M(U.startDate)]}),i.jsxs("div",{children:["Fin: ",M(U.endDate)]})]})]}),i.jsx("td",{className:"px-6 py-4",children:i.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[U.proofUrl&&i.jsx("button",{onClick:()=>{L(U),z(!0)},className:"p-2 text-purple-600 hover:bg-purple-50 rounded-md",title:"Ver comprobante de pago",children:i.jsx($r,{})}),e==="superadmin"&&i.jsxs(i.Fragment,{children:[i.jsxs(yo,{children:[i.jsx("select",{value:U.status,onChange:Q=>p(U.id,Q.target.value),className:"block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 border-none bg-transparent",children:j.filter(Q=>Q!=="Todos").map(Q=>i.jsx("option",{value:Q,children:Q},Q))}),i.jsxs("button",{onClick:()=>b(U),className:"block w-full text-left px-4 py-2 text-sm text-green-700 hover:bg-green-50 flex items-center",children:[i.jsx($r,{className:"h-4 w-4 mr-2"}),"Descargar Invoice"]}),i.jsx("button",{className:"block w-full text-left px-4 py-2 text-sm text-blue-700 hover:bg-blue-50",children:"Ver Detalles"}),i.jsx("button",{className:"block w-full text-left px-4 py-2 text-sm text-yellow-700 hover:bg-yellow-50",children:"Reembolsar"}),i.jsxs("button",{onClick:()=>_(U.id),className:"block w-full text-left px-4 py-2 text-sm text-red-700 hover:bg-red-50 flex items-center",children:[i.jsx(Aw,{className:"h-4 w-4 mr-2"}),"Eliminar Pago"]})]}),i.jsx("button",{onClick:()=>I(U,"approval"),className:"p-2 text-green-600 hover:bg-green-50 rounded-md",title:"Enviar mensaje de aprobación",children:i.jsx(uu,{})}),i.jsx("button",{onClick:()=>I(U,"rejection"),className:"p-2 text-red-600 hover:bg-red-50 rounded-md",title:"Enviar mensaje de rechazo",children:i.jsx(bi,{})})]})]})})]},U.id))})]})}),S.length===0&&i.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-8 text-center",children:[i.jsx(Ut,{className:"mx-auto h-12 w-12 text-gray-400 mb-4"}),i.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No se encontraron pagos"}),i.jsx("p",{className:"text-gray-500",children:"No hay pagos que coincidan con los filtros seleccionados."})]})]}),i.jsx(P2,{isOpen:N,onClose:()=>T(!1),payment:k,onSend:D,isDemo:t}),q&&(k==null?void 0:k.proofUrl)&&i.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex justify-center items-center p-4",children:i.jsxs("div",{className:"bg-white rounded-lg shadow-2xl max-w-3xl w-full max-h-[90vh] overflow-y-auto",children:[i.jsxs("div",{className:"p-4 flex justify-between items-center border-b",children:[i.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"Comprobante de Pago"}),i.jsx("button",{onClick:()=>z(!1),className:"text-gray-400 hover:text-gray-600",children:"✕"})]}),i.jsx("div",{className:"p-4",children:i.jsx("img",{src:k.proofUrl,alt:"Comprobante",className:"max-w-full h-auto rounded"})})]})})]})}function M2({isDemo:t,userRole:e}){const{addNotification:n}=ke(),[r,s]=V.useState([]),[a,o]=V.useState(""),[c,u]=V.useState("Todos"),[d,m]=V.useState("Todos"),[y,g]=V.useState("Todos"),[x,C]=V.useState(!0),[E,A]=V.useState(null),[N,T]=V.useState(!1),k=["Todos","Enviado","Entregado","Leído","Fallido","Pendiente"],L=["Todos","Aprobación","Rechazo","Recordatorio","Notificación","Activación","Sistema"],q=["Todos","Cliente","Administrador","Sistema"];V.useEffect(()=>{if(t){s([{id:"msg1",type:"Aprobación",recipientType:"Cliente",recipientName:"Juan Pérez",recipientEmail:"juan@ejemplo.com",subject:"Pago Aprobado - SRV-241017-123456",message:`Estimado/a Juan Pérez,

Su pago por el servicio SRV-241017-123456 ha sido aprobado exitosamente.

Detalles del pago:
- Servicio: Hosting Básico
- Monto: $50,000 COP
- Fecha: 17/10/2024
- Método: Bold

Su servicio está ahora activo. Gracias por su pago.

Saludos cordiales,
Equipo de Soporte`,status:"Entregado",sentAt:{seconds:Date.now()/1e3-3600},deliveredAt:{seconds:Date.now()/1e3-3e3},readAt:{seconds:Date.now()/1e3-1800},templateId:"approval_1",paymentId:"pay1",serviceId:"srv1",sentBy:"admin@empresa.com",channel:"email"},{id:"msg2",type:"Recordatorio",recipientType:"Cliente",recipientName:"María García",recipientEmail:"maria@ejemplo.com",subject:"Recordatorio de Vencimiento - SRV-241017-789012",message:`Hola María García,

Te recordamos que tu servicio SRV-241017-789012 vence en 3 días.

Para evitar interrupciones, por favor realiza el pago correspondiente.

Gracias por tu atención.

Equipo de Soporte`,status:"Enviado",sentAt:{seconds:Date.now()/1e3-7200},deliveredAt:null,readAt:null,templateId:"reminder_1",serviceId:"srv2",sentBy:"sistema@empresa.com",channel:"email"},{id:"msg3",type:"Rechazo",recipientType:"Cliente",recipientName:"Carlos López",recipientEmail:"carlos@ejemplo.com",subject:"Pago Rechazado - SRV-241017-345678",message:`Estimado/a Carlos López,

Lamentamos informarle que su pago por el servicio SRV-241017-345678 no pudo ser procesado.

Por favor, verifique los datos de su método de pago e intente nuevamente.

Si necesita ayuda, contacte a nuestro equipo de soporte.

Saludos cordiales,
Equipo de Soporte`,status:"Fallido",sentAt:{seconds:Date.now()/1e3-10800},deliveredAt:null,readAt:null,templateId:"rejection_1",paymentId:"pay3",serviceId:"srv3",sentBy:"admin@empresa.com",channel:"email",errorMessage:"Error de conexión con el servidor de email"},{id:"msg4",type:"Notificación",recipientType:"Administrador",recipientName:"Admin Principal",recipientEmail:"admin@empresa.com",subject:"Nuevo Pago Recibido",message:`Se ha recibido un nuevo pago:

- Cliente: Ana Martínez
- Servicio: SRV-241017-456789
- Monto: $75,000 COP
- Método: Transferencia Bancaria

Por favor, verifica y aprueba el pago si es necesario.`,status:"Leído",sentAt:{seconds:Date.now()/1e3-14400},deliveredAt:{seconds:Date.now()/1e3-14300},readAt:{seconds:Date.now()/1e3-14200},templateId:"admin_payment_notification",paymentId:"pay4",serviceId:"srv4",sentBy:"sistema@empresa.com",channel:"email"}]),C(!1);return}const $=He(xe(te,"artifacts",ee,"public","data","messages"),po("sentAt","desc")),D=Ee($,F=>{const O=F.docs.map(M=>({id:M.id,...M.data()}));s(O),C(!1)},F=>{console.error("Error loading messages:",F),n("Error al cargar los mensajes.","error"),C(!1)});return()=>D()},[t,n]);const z=async($,D)=>{if(t){n("Función no disponible en modo demo","error");return}try{const F=ue(te,"artifacts",ee,"public","data","messages",$);await qe(F,{status:D,updatedAt:new Date}),n(`Estado del mensaje actualizado a ${D}`,"success")}catch(F){console.error("Error updating message status:",F),n("Error al actualizar el estado del mensaje","error")}},j=$=>{A($),T(!0)},v=$=>({Enviado:"bg-blue-100 text-blue-800",Entregado:"bg-green-100 text-green-800",Leído:"bg-purple-100 text-purple-800",Fallido:"bg-red-100 text-red-800",Pendiente:"bg-yellow-100 text-yellow-800"})[$]||"bg-gray-100 text-gray-800",S=$=>({Aprobación:"bg-green-100 text-green-800",Rechazo:"bg-red-100 text-red-800",Recordatorio:"bg-yellow-100 text-yellow-800",Notificación:"bg-blue-100 text-blue-800",Activación:"bg-purple-100 text-purple-800",Sistema:"bg-gray-100 text-gray-800"})[$]||"bg-gray-100 text-gray-800",p=$=>({Cliente:"bg-blue-100 text-blue-800",Administrador:"bg-purple-100 text-purple-800",Sistema:"bg-gray-100 text-gray-800"})[$]||"bg-gray-100 text-gray-800",I=$=>$?new Date($.seconds*1e3).toLocaleDateString("es-ES",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"--",b=$=>{switch($){case"Enviado":return i.jsx(Jt,{});case"Entregado":return i.jsx(uu,{});case"Leído":return i.jsx($r,{});case"Fallido":return i.jsx(bi,{});case"Pendiente":return i.jsx(Jt,{});default:return i.jsx(Jt,{})}},_=r.filter($=>{const D=a===""||$.recipientName.toLowerCase().includes(a.toLowerCase())||$.recipientEmail.toLowerCase().includes(a.toLowerCase())||$.subject.toLowerCase().includes(a.toLowerCase())||$.message.toLowerCase().includes(a.toLowerCase()),F=c==="Todos"||$.status===c,O=d==="Todos"||$.type===d,M=y==="Todos"||$.recipientType===y;return D&&F&&O&&M});return x?i.jsx("div",{className:"flex justify-center items-center h-64",children:i.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):i.jsxs("div",{className:"p-4 sm:p-6 lg:p-8",children:[i.jsxs("div",{className:"flex flex-wrap justify-between items-center gap-4 mb-6",children:[i.jsxs("h2",{className:"text-2xl sm:text-3xl font-bold text-gray-900 flex items-center gap-2",children:[i.jsx(Sl,{}),"Historial de Mensajes"]}),i.jsxs("div",{className:"text-sm text-gray-500",children:[_.length," mensaje",_.length!==1?"s":""," encontrado",_.length!==1?"s":""]})]}),i.jsx("div",{className:"bg-white rounded-lg shadow-md p-4 mb-6",children:i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[i.jsxs("div",{className:"relative",children:[i.jsx("input",{type:"text",placeholder:"Buscar por destinatario, asunto o contenido...",value:a,onChange:$=>o($.target.value),className:"pl-10 pr-4 py-2 border rounded-full w-full"}),i.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:i.jsx(Ii,{})})]}),i.jsxs("div",{className:"relative",children:[i.jsx("select",{value:c,onChange:$=>u($.target.value),className:"pl-10 pr-4 py-2 border rounded-full w-full appearance-none bg-white",children:k.map($=>i.jsx("option",{value:$,children:$},$))}),i.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:i.jsx(ri,{})})]}),i.jsxs("div",{className:"relative",children:[i.jsx("select",{value:d,onChange:$=>m($.target.value),className:"pl-10 pr-4 py-2 border rounded-full w-full appearance-none bg-white",children:L.map($=>i.jsx("option",{value:$,children:$},$))}),i.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:i.jsx(Sl,{})})]}),i.jsxs("div",{className:"relative",children:[i.jsx("select",{value:y,onChange:$=>g($.target.value),className:"pl-10 pr-4 py-2 border rounded-full w-full appearance-none bg-white",children:q.map($=>i.jsx("option",{value:$,children:$},$))}),i.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:i.jsx(ri,{})})]})]})}),i.jsx("div",{className:"bg-white rounded-xl shadow-lg overflow-x-auto",children:i.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[i.jsx("thead",{className:"bg-gray-50",children:i.jsx("tr",{children:["Tipo","Destinatario","Asunto","Estado","Canal","Enviado","Entregado","Leído","Acciones"].map($=>i.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:$},$))})}),i.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:_.map($=>i.jsxs("tr",{className:"hover:bg-gray-50",children:[i.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:i.jsxs("div",{className:"flex items-center",children:[i.jsx("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${S($.type)}`,children:$.type}),i.jsx("span",{className:`ml-2 px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${p($.recipientType)}`,children:$.recipientType})]})}),i.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[i.jsx("div",{className:"text-sm font-medium text-gray-900",children:$.recipientName}),i.jsx("div",{className:"text-sm text-gray-500",children:$.recipientEmail})]}),i.jsx("td",{className:"px-6 py-4",children:i.jsx("div",{className:"text-sm text-gray-900 max-w-xs truncate",title:$.subject,children:$.subject})}),i.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:i.jsxs("div",{className:"flex items-center",children:[i.jsx("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${v($.status)}`,children:$.status}),i.jsx("div",{className:"ml-2 text-gray-400",children:b($.status)})]})}),i.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:$.channel||"Email"}),i.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:I($.sentAt)}),i.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:$.deliveredAt?I($.deliveredAt):"--"}),i.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:$.readAt?I($.readAt):"--"}),i.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center text-sm font-medium",children:i.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[i.jsx("button",{onClick:()=>j($),className:"p-2 text-blue-600 hover:bg-blue-50 rounded-md",title:"Ver mensaje completo",children:i.jsx($r,{})}),e==="superadmin"&&i.jsxs(yo,{children:[i.jsx("select",{value:$.status,onChange:D=>z($.id,D.target.value),className:"block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 border-none bg-transparent",children:k.filter(D=>D!=="Todos").map(D=>i.jsx("option",{value:D,children:D},D))}),i.jsx("button",{className:"block w-full text-left px-4 py-2 text-sm text-blue-700 hover:bg-blue-50",children:"Reenviar"}),i.jsx("button",{className:"block w-full text-left px-4 py-2 text-sm text-red-700 hover:bg-red-50",children:"Eliminar"})]})]})})]},$.id))})]})}),_.length===0&&i.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-8 text-center",children:[i.jsx(Sl,{className:"mx-auto h-12 w-12 text-gray-400 mb-4"}),i.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No se encontraron mensajes"}),i.jsx("p",{className:"text-gray-500",children:"No hay mensajes que coincidan con los filtros seleccionados."})]}),N&&E&&i.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex justify-center items-center p-4",children:i.jsxs("div",{className:"bg-white rounded-lg shadow-2xl p-6 max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:[i.jsxs("div",{className:"flex items-center justify-between mb-4",children:[i.jsx("h3",{className:"text-xl font-bold text-gray-800",children:"Detalles del Mensaje"}),i.jsx("button",{onClick:()=>T(!1),className:"text-gray-400 hover:text-gray-600",children:"✕"})]}),i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Tipo"}),i.jsx("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${S(E.type)}`,children:E.type})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Estado"}),i.jsx("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${v(E.status)}`,children:E.status})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Destinatario"}),i.jsx("div",{className:"text-sm text-gray-900",children:E.recipientName}),i.jsx("div",{className:"text-sm text-gray-500",children:E.recipientEmail})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Canal"}),i.jsx("div",{className:"text-sm text-gray-900",children:E.channel||"Email"})]})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Asunto"}),i.jsx("div",{className:"text-sm text-gray-900 p-3 bg-gray-50 rounded-md",children:E.subject})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Contenido del Mensaje"}),i.jsx("div",{className:"text-sm text-gray-900 p-4 bg-gray-50 rounded-md whitespace-pre-wrap max-h-64 overflow-y-auto",children:E.message})]}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Enviado"}),i.jsx("div",{className:"text-gray-900",children:I(E.sentAt)})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Entregado"}),i.jsx("div",{className:"text-gray-900",children:E.deliveredAt?I(E.deliveredAt):"No entregado"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Leído"}),i.jsx("div",{className:"text-gray-900",children:E.readAt?I(E.readAt):"No leído"})]})]}),E.errorMessage&&i.jsxs("div",{className:"p-3 bg-red-50 border border-red-200 rounded-md",children:[i.jsx("label",{className:"block text-sm font-medium text-red-700 mb-1",children:"Error"}),i.jsx("div",{className:"text-sm text-red-600",children:E.errorMessage})]}),i.jsxs("div",{className:"flex justify-end space-x-4 pt-4 border-t",children:[i.jsx("button",{onClick:()=>T(!1),className:"px-4 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300",children:"Cerrar"}),e==="superadmin"&&i.jsx("button",{className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:"Reenviar Mensaje"})]})]})]})})]})}function Dw({ticketId:t,isDemo:e,userRole:n,currentUser:r}){const{addNotification:s}=ke(),[a,o]=V.useState([]),[c,u]=V.useState(""),[d,m]=V.useState(!0),[y,g]=V.useState(!1);V.useEffect(()=>{if(e){o([{id:"msg1",ticketId:t,content:"Hola, tengo un problema con el acceso a mi panel de cliente. No puedo iniciar sesión desde ayer.",senderId:"client1",senderName:"Juan Pérez",senderRole:"client",senderEmail:"juan@ejemplo.com",isInternal:!1,createdAt:{seconds:Date.now()/1e3-3600},attachments:[]},{id:"msg2",ticketId:t,content:"Hola Juan, gracias por contactarnos. He revisado tu cuenta y veo que hay un problema con la configuración de tu perfil. Voy a solucionarlo ahora mismo.",senderId:"admin1",senderName:"Admin Principal",senderRole:"admin",senderEmail:"admin@empresa.com",isInternal:!1,createdAt:{seconds:Date.now()/1e3-1800},attachments:[]},{id:"msg3",ticketId:t,content:"Nota interna: El cliente tiene un problema de configuración en su perfil. Necesito revisar la base de datos.",senderId:"admin1",senderName:"Admin Principal",senderRole:"admin",senderEmail:"admin@empresa.com",isInternal:!0,createdAt:{seconds:Date.now()/1e3-900},attachments:[]}]),m(!1);return}if(!t){m(!1);return}const E=He(xe(te,"artifacts",ee,"public","data","ticketMessages"),rt("ticketId","==",t)),A=Ee(E,N=>{const T=N.docs.map(k=>({id:k.id,...k.data()}));T.sort((k,L)=>{var j,v;const q=((j=k.createdAt)==null?void 0:j.seconds)||0,z=((v=L.createdAt)==null?void 0:v.seconds)||0;return q-z}),o(T),m(!1)},N=>{console.error("Error loading messages:",N),s("Error al cargar los mensajes","error"),m(!1)});return()=>A()},[t,e,s]);const x=async E=>{if(E.preventDefault(),!!c.trim()){if(g(!0),e){const A={id:`msg_${Date.now()}`,ticketId:t,content:c,senderId:(r==null?void 0:r.uid)||"demo",senderName:(r==null?void 0:r.displayName)||"Usuario Demo",senderRole:n||"client",senderEmail:(r==null?void 0:r.email)||"demo@ejemplo.com",isInternal:!1,createdAt:{seconds:Date.now()/1e3},attachments:[]};o(N=>[...N,A]),u(""),g(!1),s("Mensaje enviado (modo demo)","success"),window.updateTicketReplyCount&&window.updateTicketReplyCount(t,a.length+1);return}try{const A={ticketId:t,content:c.trim(),senderId:r.uid,senderName:r.displayName||r.email,senderRole:n,senderEmail:r.email,isInternal:!1,createdAt:oe.now(),attachments:[]};await sr(xe(te,"artifacts",ee,"public","data","ticketMessages"),A);const N=ue(te,"artifacts",ee,"public","data","tickets",t);await qe(N,{replyCount:a.length+1,lastReplyAt:oe.now(),lastReplyBy:r.displayName||r.email,updatedAt:oe.now()}),u(""),s("Mensaje enviado","success")}catch(A){console.error("Error sending message:",A),s("Error al enviar el mensaje","error")}finally{g(!1)}}},C=E=>{if(!E)return"--";const A=new Date,N=new Date(E.seconds*1e3),T=A.getTime()-N.getTime(),k=Math.floor(T/(1e3*60*60*24)),L=Math.floor(T/(1e3*60*60)),q=Math.floor(T/(1e3*60));return k>0?`hace ${k} día${k>1?"s":""}`:L>0?`hace ${L} hora${L>1?"s":""}`:q>0?`hace ${q} minuto${q>1?"s":""}`:"hace unos segundos"};return d?i.jsx("div",{className:"flex justify-center items-center h-32",children:i.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):i.jsxs("div",{className:"space-y-4",children:[i.jsx("div",{className:"space-y-4 max-h-96 overflow-y-auto",children:a.length===0?i.jsxs("div",{className:"text-center py-8 text-gray-500",children:[i.jsx(bc,{className:"mx-auto h-8 w-8 text-gray-400 mb-2"}),i.jsx("p",{children:"No hay mensajes en este ticket"})]}):a.map(E=>i.jsx("div",{className:`flex ${E.senderRole==="client"?"justify-start":"justify-end"}`,children:i.jsxs("div",{className:`max-w-xs lg:max-w-md px-4 py-2 rounded-lg ${E.senderRole==="client"?"bg-gray-100 text-gray-900":E.isInternal?"bg-yellow-100 text-yellow-900 border border-yellow-300":"bg-blue-100 text-blue-900"}`,children:[E.isInternal&&i.jsx("div",{className:"text-xs font-semibold text-yellow-700 mb-1",children:"NOTA INTERNA"}),i.jsx("div",{className:"text-sm whitespace-pre-wrap",children:E.content}),i.jsxs("div",{className:"flex items-center justify-between mt-2 text-xs text-gray-500",children:[i.jsxs("div",{className:"flex items-center gap-1",children:[i.jsx(Ka,{}),i.jsx("span",{children:E.senderName})]}),i.jsxs("div",{className:"flex items-center gap-1",children:[i.jsx(Jt,{}),i.jsx("span",{children:C(E.createdAt)})]})]}),E.attachments&&E.attachments.length>0&&i.jsx("div",{className:"mt-2 pt-2 border-t border-gray-300",children:i.jsxs("div",{className:"flex items-center gap-1 text-xs text-gray-600",children:[i.jsx(_2,{}),i.jsxs("span",{children:[E.attachments.length," archivo",E.attachments.length!==1?"s":""]})]})})]})},E.id))}),i.jsx("div",{className:"border-t pt-4",children:i.jsxs("form",{onSubmit:x,className:"space-y-3",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:n==="client"?"Responder al ticket":"Responder al cliente"}),i.jsx("textarea",{value:c,onChange:E=>u(E.target.value),className:"w-full p-3 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500",rows:3,placeholder:n==="client"?"Escribe tu respuesta aquí...":"Escribe tu respuesta al cliente aquí...",required:!0})]}),n==="admin"||n==="superadmin"?i.jsx("div",{className:"flex items-center gap-4",children:i.jsxs("label",{className:"flex items-center",children:[i.jsx("input",{type:"checkbox",className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),i.jsx("span",{className:"ml-2 text-sm text-gray-700",children:"Nota interna (solo visible para administradores)"})]})}):null,i.jsx("div",{className:"flex justify-end",children:i.jsx("button",{type:"submit",disabled:y||!c.trim(),className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:y?i.jsxs(i.Fragment,{children:[i.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Enviando..."]}):i.jsxs(i.Fragment,{children:[i.jsx(bc,{}),"Enviar Mensaje"]})})})]})})]})}function O2({isDemo:t,userRole:e}){const{addNotification:n}=ke(),[r,s]=V.useState([]),[a,o]=V.useState([]),[c,u]=V.useState(""),[d,m]=V.useState("Todos"),[y,g]=V.useState("Todos"),[x,C]=V.useState("Todos"),[E,A]=V.useState(!0),[N,T]=V.useState(null),[k,L]=V.useState(!1),[q,z]=V.useState(!1),[j,v]=V.useState({subject:"",department:"Soporte Técnico",priority:"Media",description:"",clientId:"",clientName:"",clientEmail:""}),S=["Todos","Abierto","En Progreso","Respondido","Cerrado","Esperando Cliente"],p=["Todos","Baja","Media","Alta","Crítica"],I=["Todos","Soporte Técnico","Facturación","Ventas","General"];V.useEffect(()=>{if(t){s([{id:"ticket1",ticketNumber:"TKT-2024-001",subject:"Problema con el acceso al panel de cliente",description:"No puedo acceder a mi panel de cliente desde ayer. Me aparece un error 500.",status:"Abierto",priority:"Alta",department:"Soporte Técnico",clientId:"client1",clientName:"Juan Pérez",clientEmail:"juan@ejemplo.com",assignedTo:null,assignedToName:null,createdAt:{seconds:Date.now()/1e3-3600},updatedAt:{seconds:Date.now()/1e3-3600},lastReplyAt:{seconds:Date.now()/1e3-3600},lastReplyBy:"Cliente",replyCount:0,attachments:[]},{id:"ticket2",ticketNumber:"TKT-2024-002",subject:"Consulta sobre facturación",description:"Necesito una copia de mi factura del mes pasado para contabilidad.",status:"Respondido",priority:"Media",department:"Facturación",clientId:"client2",clientName:"María García",clientEmail:"maria@ejemplo.com",assignedTo:"admin1",assignedToName:"Admin Principal",createdAt:{seconds:Date.now()/1e3-7200},updatedAt:{seconds:Date.now()/1e3-1800},lastReplyAt:{seconds:Date.now()/1e3-1800},lastReplyBy:"Admin Principal",replyCount:2,attachments:["factura_enero.pdf"]},{id:"ticket3",ticketNumber:"TKT-2024-003",subject:"Solicitud de nuevo servicio",description:"Me gustaría contratar un plan de hosting más grande para mi sitio web.",status:"En Progreso",priority:"Baja",department:"Ventas",clientId:"client3",clientName:"Carlos López",clientEmail:"carlos@ejemplo.com",assignedTo:"admin2",assignedToName:"Admin Ventas",createdAt:{seconds:Date.now()/1e3-10800},updatedAt:{seconds:Date.now()/1e3-900},lastReplyAt:{seconds:Date.now()/1e3-900},lastReplyBy:"Admin Ventas",replyCount:1,attachments:[]},{id:"ticket4",ticketNumber:"TKT-2024-004",subject:"Error crítico en el servidor",description:"Mi sitio web está caído y no responde. Es urgente.",status:"Abierto",priority:"Crítica",department:"Soporte Técnico",clientId:"client4",clientName:"Ana Martínez",clientEmail:"ana@ejemplo.com",assignedTo:null,assignedToName:null,createdAt:{seconds:Date.now()/1e3-300},updatedAt:{seconds:Date.now()/1e3-300},lastReplyAt:{seconds:Date.now()/1e3-300},lastReplyBy:"Cliente",replyCount:0,attachments:["error_screenshot.png"]}]),o([{id:"client1",fullName:"Juan Pérez",email:"juan@ejemplo.com"},{id:"client2",fullName:"María García",email:"maria@ejemplo.com"},{id:"client3",fullName:"Carlos López",email:"carlos@ejemplo.com"},{id:"client4",fullName:"Ana Martínez",email:"ana@ejemplo.com"}]),A(!1);return}const R=He(xe(te,"artifacts",ee,"public","data","tickets")),K=Ee(R,pe=>{const Ce=pe.docs.map(ce=>({id:ce.id,...ce.data()}));Ce.sort((ce,Ie)=>{var Bt,Pt;const kt=((Bt=ce.createdAt)==null?void 0:Bt.seconds)||0;return(((Pt=Ie.createdAt)==null?void 0:Pt.seconds)||0)-kt}),s(Ce),A(!1)},pe=>{console.error("Error loading tickets:",pe),n("Error al cargar los tickets.","error"),A(!1)}),Y=He(xe(te,"artifacts",ee,"public","data","users"),rt("role","==","client")),ne=Ee(Y,pe=>{const Ce=pe.docs.map(ce=>({id:ce.id,...ce.data()}));o(Ce)},pe=>{console.error("Error loading clients:",pe)});return()=>{K(),ne()}},[t,n]);const b=async(R,K)=>{if(t){n("Función no disponible en modo demo","error");return}try{const Y=ue(te,"artifacts",ee,"public","data","tickets",R);await qe(Y,{status:K,updatedAt:oe.now()}),n(`Estado del ticket actualizado a ${K}`,"success")}catch(Y){console.error("Error updating ticket status:",Y),n("Error al actualizar el estado del ticket","error")}},_=async(R,K)=>{if(t){n("Función no disponible en modo demo","error");return}try{const Y=ue(te,"artifacts",ee,"public","data","tickets",R);await qe(Y,{assignedTo:K,assignedToName:K?"Admin Actual":null,updatedAt:oe.now()}),n("Ticket asignado correctamente","success")}catch(Y){console.error("Error assigning ticket:",Y),n("Error al asignar el ticket","error")}},$=R=>{T(R),L(!0)},D=async R=>{if(t){s(K=>K.filter(Y=>Y.id!==R)),n("Ticket eliminado (modo demo)","success");return}try{await vi(ue(te,"artifacts",ee,"public","data","tickets",R));const K=He(xe(te,"artifacts",ee,"public","data","ticketMessages"),rt("ticketId","==",R)),ne=(await In(K)).docs.map(pe=>vi(pe.ref));await Promise.all(ne),n("Ticket eliminado exitosamente","success")}catch(K){console.error("Error deleting ticket:",K),n("Error al eliminar el ticket","error")}},F=async R=>{if(R.preventDefault(),t){const K={id:`ticket_${Date.now()}`,ticketNumber:`TKT-${new Date().getFullYear()}-${String(Date.now()).slice(-6)}`,subject:j.subject,description:j.description,status:"Abierto",priority:j.priority,department:j.department,clientId:j.clientId||"demo",clientName:j.clientName||"Cliente Demo",clientEmail:j.clientEmail||"demo@ejemplo.com",assignedTo:null,assignedToName:null,createdAt:{seconds:Date.now()/1e3},updatedAt:{seconds:Date.now()/1e3},lastReplyAt:{seconds:Date.now()/1e3},lastReplyBy:"Cliente",replyCount:0,attachments:[]};s(Y=>[K,...Y]),n("Ticket creado (modo demo)","success"),z(!1),v({subject:"",department:"Soporte Técnico",priority:"Media",description:"",clientId:"",clientName:"",clientEmail:""});return}try{const K={...j,ticketNumber:`TKT-${new Date().getFullYear()}-${String(Date.now()).slice(-6)}`,status:"Abierto",assignedTo:null,assignedToName:null,createdAt:oe.now(),updatedAt:oe.now(),lastReplyAt:oe.now(),lastReplyBy:"Cliente",replyCount:0,attachments:[]};await sr(xe(te,"artifacts",ee,"public","data","tickets"),K),n("Ticket creado exitosamente","success"),z(!1),v({subject:"",department:"Soporte Técnico",priority:"Media",description:"",clientId:"",clientName:"",clientEmail:""})}catch(K){console.error("Error creating ticket:",K),n("Error al crear el ticket","error")}},O=R=>({Abierto:"bg-red-100 text-red-800","En Progreso":"bg-yellow-100 text-yellow-800",Respondido:"bg-blue-100 text-blue-800",Cerrado:"bg-gray-100 text-gray-800","Esperando Cliente":"bg-orange-100 text-orange-800"})[R]||"bg-gray-100 text-gray-800",M=R=>({Baja:"bg-green-100 text-green-800",Media:"bg-yellow-100 text-yellow-800",Alta:"bg-orange-100 text-orange-800",Crítica:"bg-red-100 text-red-800"})[R]||"bg-gray-100 text-gray-800",W=R=>({"Soporte Técnico":"bg-blue-100 text-blue-800",Facturación:"bg-green-100 text-green-800",Ventas:"bg-purple-100 text-purple-800",General:"bg-gray-100 text-gray-800"})[R]||"bg-gray-100 text-gray-800",U=R=>R?new Date(R.seconds*1e3).toLocaleDateString("es-ES",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"--",Q=R=>{switch(R){case"Abierto":return i.jsx(Jt,{});case"En Progreso":return i.jsx(Jt,{});case"Respondido":return i.jsx(uu,{});case"Cerrado":return i.jsx(bi,{});case"Esperando Cliente":return i.jsx(Ka,{});default:return i.jsx(Jt,{})}},P=R=>{if(!R)return"--";const K=new Date,Y=new Date(R.seconds*1e3),ne=K.getTime()-Y.getTime(),pe=Math.floor(ne/(1e3*60*60*24)),Ce=Math.floor(ne/(1e3*60*60)),ce=Math.floor(ne/(1e3*60));return pe>0?`hace ${pe} día${pe>1?"s":""}`:Ce>0?`hace ${Ce} hora${Ce>1?"s":""}`:ce>0?`hace ${ce} minuto${ce>1?"s":""}`:"hace unos segundos"},H=r.filter(R=>{const K=c===""||R.ticketNumber.toLowerCase().includes(c.toLowerCase())||R.subject.toLowerCase().includes(c.toLowerCase())||R.clientName.toLowerCase().includes(c.toLowerCase())||R.clientEmail.toLowerCase().includes(c.toLowerCase())||R.description.toLowerCase().includes(c.toLowerCase()),Y=d==="Todos"||R.status===d,ne=y==="Todos"||R.priority===y,pe=x==="Todos"||R.department===x;return K&&Y&&ne&&pe});return E?i.jsx("div",{className:"flex justify-center items-center h-64",children:i.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):i.jsxs("div",{className:"p-4 sm:p-6 lg:p-8",children:[i.jsxs("div",{className:"flex flex-wrap justify-between items-center gap-4 mb-6",children:[i.jsxs("h2",{className:"text-2xl sm:text-3xl font-bold text-gray-900 flex items-center gap-2",children:[i.jsx(cs,{}),"Sistema de Tickets"]}),i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsxs("div",{className:"text-sm text-gray-500",children:[H.length," ticket",H.length!==1?"s":""," encontrado",H.length!==1?"s":""]}),i.jsxs("button",{onClick:()=>z(!0),className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 flex items-center gap-2",children:[i.jsx(go,{}),"Nuevo Ticket"]})]})]}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[i.jsx("div",{className:"bg-white rounded-lg shadow-md p-4",children:i.jsxs("div",{className:"flex items-center",children:[i.jsx("div",{className:"p-2 bg-red-100 rounded-lg",children:i.jsx(Jt,{})}),i.jsxs("div",{className:"ml-3",children:[i.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Abiertos"}),i.jsx("p",{className:"text-2xl font-semibold text-gray-900",children:r.filter(R=>R.status==="Abierto").length})]})]})}),i.jsx("div",{className:"bg-white rounded-lg shadow-md p-4",children:i.jsxs("div",{className:"flex items-center",children:[i.jsx("div",{className:"p-2 bg-yellow-100 rounded-lg",children:i.jsx(Jt,{})}),i.jsxs("div",{className:"ml-3",children:[i.jsx("p",{className:"text-sm font-medium text-gray-500",children:"En Progreso"}),i.jsx("p",{className:"text-2xl font-semibold text-gray-900",children:r.filter(R=>R.status==="En Progreso").length})]})]})}),i.jsx("div",{className:"bg-white rounded-lg shadow-md p-4",children:i.jsxs("div",{className:"flex items-center",children:[i.jsx("div",{className:"p-2 bg-orange-100 rounded-lg",children:i.jsx(Ka,{})}),i.jsxs("div",{className:"ml-3",children:[i.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Esperando Cliente"}),i.jsx("p",{className:"text-2xl font-semibold text-gray-900",children:r.filter(R=>R.status==="Esperando Cliente").length})]})]})}),i.jsx("div",{className:"bg-white rounded-lg shadow-md p-4",children:i.jsxs("div",{className:"flex items-center",children:[i.jsx("div",{className:"p-2 bg-red-100 rounded-lg",children:i.jsx(bi,{})}),i.jsxs("div",{className:"ml-3",children:[i.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Críticos"}),i.jsx("p",{className:"text-2xl font-semibold text-gray-900",children:r.filter(R=>R.priority==="Crítica").length})]})]})})]}),i.jsx("div",{className:"bg-white rounded-lg shadow-md p-4 mb-6",children:i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[i.jsxs("div",{className:"relative",children:[i.jsx("input",{type:"text",placeholder:"Buscar por número, asunto, cliente...",value:c,onChange:R=>u(R.target.value),className:"pl-10 pr-4 py-2 border rounded-full w-full"}),i.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:i.jsx(Ii,{})})]}),i.jsxs("div",{className:"relative",children:[i.jsx("select",{value:d,onChange:R=>m(R.target.value),className:"pl-10 pr-4 py-2 border rounded-full w-full appearance-none bg-white",children:S.map(R=>i.jsx("option",{value:R,children:R},R))}),i.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:i.jsx(ri,{})})]}),i.jsxs("div",{className:"relative",children:[i.jsx("select",{value:y,onChange:R=>g(R.target.value),className:"pl-10 pr-4 py-2 border rounded-full w-full appearance-none bg-white",children:p.map(R=>i.jsx("option",{value:R,children:R},R))}),i.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:i.jsx(ri,{})})]}),i.jsxs("div",{className:"relative",children:[i.jsx("select",{value:x,onChange:R=>C(R.target.value),className:"pl-10 pr-4 py-2 border rounded-full w-full appearance-none bg-white",children:I.map(R=>i.jsx("option",{value:R,children:R},R))}),i.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:i.jsx(ri,{})})]})]})}),i.jsx("div",{className:"bg-white rounded-xl shadow-lg overflow-x-auto",children:i.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[i.jsx("thead",{className:"bg-gray-50",children:i.jsx("tr",{children:["Ticket","Cliente","Asunto","Estado","Prioridad","Departamento","Asignado","Última Actividad","Respuestas","Acciones"].map(R=>i.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:R},R))})}),i.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:H.map(R=>i.jsxs("tr",{className:"hover:bg-gray-50",children:[i.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[i.jsx("div",{className:"font-mono text-sm font-medium text-blue-600",children:R.ticketNumber}),i.jsx("div",{className:"text-xs text-gray-500",children:U(R.createdAt)})]}),i.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[i.jsx("div",{className:"text-sm font-medium text-gray-900",children:R.clientName}),i.jsx("div",{className:"text-sm text-gray-500",children:R.clientEmail})]}),i.jsxs("td",{className:"px-6 py-4",children:[i.jsx("div",{className:"text-sm text-gray-900 max-w-xs truncate",title:R.subject,children:R.subject}),i.jsx("div",{className:"text-xs text-gray-500 max-w-xs truncate",title:R.description,children:R.description})]}),i.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:i.jsxs("div",{className:"flex items-center",children:[i.jsx("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${O(R.status)}`,children:R.status}),i.jsx("div",{className:"ml-2 text-gray-400",children:Q(R.status)})]})}),i.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:i.jsx("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${M(R.priority)}`,children:R.priority})}),i.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:i.jsx("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${W(R.department)}`,children:R.department})}),i.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:R.assignedToName||"Sin asignar"}),i.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:[i.jsx("div",{children:P(R.lastReplyAt)}),i.jsxs("div",{className:"text-xs text-gray-400",children:["por ",R.lastReplyBy]})]}),i.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:i.jsxs("div",{className:"flex items-center",children:[i.jsx(bc,{}),i.jsx("span",{className:"ml-1",children:R.replyCount})]})}),i.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center text-sm font-medium",children:i.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[i.jsx("button",{onClick:()=>$(R),className:"p-2 text-blue-600 hover:bg-blue-50 rounded-md",title:"Ver ticket completo",children:i.jsx($r,{})}),e==="superadmin"&&i.jsxs(yo,{children:[i.jsx("select",{value:R.status,onChange:K=>b(R.id,K.target.value),className:"block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 border-none bg-transparent",children:S.filter(K=>K!=="Todos").map(K=>i.jsx("option",{value:K,children:K},K))}),i.jsx("button",{onClick:()=>_(R.id,R.assignedTo?null:"admin"),className:"block w-full text-left px-4 py-2 text-sm text-blue-700 hover:bg-blue-50",children:R.assignedTo?"Desasignar":"Asignar"}),i.jsx("button",{className:"block w-full text-left px-4 py-2 text-sm text-green-700 hover:bg-green-50",children:"Responder"}),i.jsx("button",{className:"block w-full text-left px-4 py-2 text-sm text-orange-700 hover:bg-orange-50",children:"Cerrar Ticket"}),i.jsx("button",{onClick:()=>{window.confirm("¿Estás seguro de que quieres eliminar este ticket? Esta acción no se puede deshacer.")&&D(R.id)},className:"block w-full text-left px-4 py-2 text-sm text-red-700 hover:bg-red-50",children:"Eliminar Ticket"})]})]})})]},R.id))})]})}),H.length===0&&i.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-8 text-center",children:[i.jsx(cs,{className:"mx-auto h-12 w-12 text-gray-400 mb-4"}),i.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No se encontraron tickets"}),i.jsx("p",{className:"text-gray-500",children:"No hay tickets que coincidan con los filtros seleccionados."})]}),k&&N&&i.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex justify-center items-center p-4",children:i.jsxs("div",{className:"bg-white rounded-lg shadow-2xl p-6 max-w-6xl w-full max-h-[90vh] overflow-y-auto",children:[i.jsxs("div",{className:"flex items-center justify-between mb-4",children:[i.jsxs("h3",{className:"text-xl font-bold text-gray-800",children:["Ticket ",N.ticketNumber]}),i.jsx("button",{onClick:()=>L(!1),className:"text-gray-400 hover:text-gray-600",children:"✕"})]}),i.jsxs("div",{className:"space-y-6",children:[i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Cliente"}),i.jsx("div",{className:"text-sm text-gray-900",children:N.clientName}),i.jsx("div",{className:"text-sm text-gray-500",children:N.clientEmail})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Asignado a"}),i.jsx("div",{className:"text-sm text-gray-900",children:N.assignedToName||"Sin asignar"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Estado"}),i.jsx("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${O(N.status)}`,children:N.status})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Prioridad"}),i.jsx("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${M(N.priority)}`,children:N.priority})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Departamento"}),i.jsx("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${W(N.department)}`,children:N.department})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Creado"}),i.jsx("div",{className:"text-sm text-gray-900",children:U(N.createdAt)})]})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Asunto"}),i.jsx("div",{className:"text-sm text-gray-900 p-3 bg-gray-50 rounded-md",children:N.subject})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Descripción"}),i.jsx("div",{className:"text-sm text-gray-900 p-4 bg-gray-50 rounded-md whitespace-pre-wrap",children:N.description})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Historial de Mensajes"}),i.jsx("div",{className:"border border-gray-200 rounded-md p-4",children:i.jsx(Dw,{ticketId:N.id,isDemo:t,userRole:e,currentUser:{uid:"admin",displayName:"Admin",email:"admin@empresa.com"}})})]}),i.jsxs("div",{className:"flex justify-end space-x-4 pt-4 border-t",children:[i.jsx("button",{onClick:()=>L(!1),className:"px-4 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300",children:"Cerrar"}),e==="superadmin"&&i.jsxs(i.Fragment,{children:[i.jsx("button",{className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:"Responder"}),i.jsx("button",{onClick:()=>{window.confirm("¿Estás seguro de que quieres eliminar este ticket? Esta acción no se puede deshacer.")&&(D(N.id),L(!1))},className:"px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700",children:"Eliminar Ticket"})]})]})]})]})}),q&&i.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex justify-center items-center p-4",children:i.jsxs("div",{className:"bg-white rounded-lg shadow-2xl p-6 max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[i.jsxs("div",{className:"flex items-center justify-between mb-4",children:[i.jsx("h3",{className:"text-xl font-bold text-gray-800",children:"Crear Nuevo Ticket"}),i.jsx("button",{onClick:()=>z(!1),className:"text-gray-400 hover:text-gray-600",children:"✕"})]}),i.jsxs("form",{onSubmit:F,className:"space-y-4",children:[i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Cliente"}),i.jsxs("select",{value:j.clientId,onChange:R=>{const K=a.find(Y=>Y.id===R.target.value);v(Y=>({...Y,clientId:R.target.value,clientName:(K==null?void 0:K.fullName)||"",clientEmail:(K==null?void 0:K.email)||""}))},className:"w-full p-2 border rounded-md",required:!0,children:[i.jsx("option",{value:"",children:"Seleccionar cliente"}),a.map(R=>i.jsxs("option",{value:R.id,children:[R.fullName," (",R.email,")"]},R.id))]})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Departamento"}),i.jsx("select",{value:j.department,onChange:R=>v(K=>({...K,department:R.target.value})),className:"w-full p-2 border rounded-md",required:!0,children:I.filter(R=>R!=="Todos").map(R=>i.jsx("option",{value:R,children:R},R))})]})]}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Prioridad"}),i.jsx("select",{value:j.priority,onChange:R=>v(K=>({...K,priority:R.target.value})),className:"w-full p-2 border rounded-md",required:!0,children:p.filter(R=>R!=="Todos").map(R=>i.jsx("option",{value:R,children:R},R))})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email del Cliente"}),i.jsx("input",{type:"email",value:j.clientEmail,onChange:R=>v(K=>({...K,clientEmail:R.target.value})),className:"w-full p-2 border rounded-md",placeholder:"email@ejemplo.com",required:!0})]})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Asunto *"}),i.jsx("input",{type:"text",value:j.subject,onChange:R=>v(K=>({...K,subject:R.target.value})),className:"w-full p-2 border rounded-md",placeholder:"Describe brevemente el problema o consulta",required:!0})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Descripción *"}),i.jsx("textarea",{value:j.description,onChange:R=>v(K=>({...K,description:R.target.value})),className:"w-full p-2 border rounded-md",rows:6,placeholder:"Describe el problema o consulta en detalle...",required:!0})]}),i.jsxs("div",{className:"flex justify-end space-x-4 pt-4 border-t",children:[i.jsx("button",{type:"button",onClick:()=>z(!1),className:"px-4 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300",children:"Cancelar"}),i.jsx("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:"Crear Ticket"})]})]})]})})]})}function L2({isDemo:t,setIsDemoMode:e,onLogout:n}){const{addNotification:r}=ke(),[s,a]=V.useState({}),o="company_info";V.useEffect(()=>{if(t){a({companyName:"Mi Empresa (Demo)",identification:"123.456.789-0",address:"Calle Falsa 123, Ciudad Demo",phone:"+57 300 123 4567",email:"contacto@empresa-demo.com",website:"www.empresa-demo.com",logoUrl:"https://placehold.co/200x80/1d4ed8/ffffff?text=Mi+Logo"});return}const m=ue(te,"artifacts",ee,"public","data","settings",o);return Ee(m,g=>{g.exists()&&a(g.data())})},[t]);const c=m=>{const{name:y,value:g}=m.target;a(x=>({...x,[y]:g}))},u=()=>{const m=!t;e(m),m&&r("Modo demo activado. Recuerda guardar la configuración para aplicar los cambios.","info")},d=async()=>{if(t){r("Función no disponible en modo demo.","error");return}try{const m=ue(te,"artifacts",ee,"public","data","settings",o),y={...s,isDemoMode:t,allowDemoMode:!0};await An(m,y,{merge:!0}),r("Configuración de la empresa guardada.","success"),t&&n&&(r("Modo demo activado. Cerrando sesión para probar los botones de demo...","info"),setTimeout(()=>{n()},2e3))}catch{r("Error al guardar la configuración.","error")}};return i.jsxs("div",{className:"p-4 sm:p-6 lg:p-8",children:[i.jsx("h2",{className:"text-2xl font-bold mb-6",children:"Configuración"}),i.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-md max-w-4xl mx-auto space-y-8",children:[i.jsxs("div",{children:[i.jsx("h3",{className:"text-xl font-bold mb-4",children:"Información de Facturación y Contacto"}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[i.jsx("input",{name:"companyName",value:s.companyName||"",onChange:c,placeholder:"Nombre de la Empresa",className:"w-full p-2 border rounded-md"}),i.jsx("input",{name:"identification",value:s.identification||"",onChange:c,placeholder:"NIT / Identificación Fiscal",className:"w-full p-2 border rounded-md"}),i.jsx("input",{name:"address",value:s.address||"",onChange:c,placeholder:"Dirección",className:"w-full p-2 border rounded-md"}),i.jsx("input",{name:"phone",value:s.phone||"",onChange:c,placeholder:"Teléfono",className:"w-full p-2 border rounded-md"}),i.jsx("input",{name:"email",type:"email",value:s.email||"",onChange:c,placeholder:"Email de Contacto",className:"w-full p-2 border rounded-md"}),i.jsx("input",{name:"website",value:s.website||"",onChange:c,placeholder:"Sitio Web",className:"w-full p-2 border rounded-md"})]})]}),i.jsxs("div",{children:[i.jsx("h3",{className:"text-xl font-bold mt-8 mb-4",children:"Branding"}),i.jsx("input",{name:"logoUrl",value:s.logoUrl||"",onChange:c,placeholder:"URL del Logo (enlace a la imagen)",className:"w-full p-2 border rounded-md"}),s.logoUrl&&i.jsx("img",{src:s.logoUrl,alt:"Vista previa del logo",className:"mt-4 max-h-20 bg-gray-100 p-2 rounded"})]}),i.jsxs("div",{children:[i.jsx("h3",{className:"text-xl font-bold mb-4",children:"Modo de Operación"}),i.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg flex items-center justify-between",children:[i.jsxs("div",{children:[i.jsx("p",{className:"font-medium text-gray-800",children:"Activar Modo de Prueba"}),i.jsx("p",{className:"text-sm text-gray-500",children:"Usa datos de ejemplo sin afectar la información real. En modo prueba aparecerán botones separados para admin y cliente."})]}),i.jsx("label",{htmlFor:"demoToggle",className:"flex items-center cursor-pointer",children:i.jsxs("div",{className:"relative",children:[i.jsx("input",{type:"checkbox",id:"demoToggle",className:"sr-only",checked:t,onChange:u}),i.jsx("div",{className:"block bg-gray-600 w-14 h-8 rounded-full"}),i.jsx("div",{className:"dot absolute left-1 top-1 bg-white w-6 h-6 rounded-full transition"})]})})]}),t&&i.jsxs("div",{className:"mt-4 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[i.jsx("h4",{className:"font-semibold text-blue-800 mb-2",children:"Modo de Prueba Activado"}),i.jsxs("p",{className:"text-sm text-blue-700 mb-2",children:["En el login aparecerán dos botones:",i.jsx("br",{}),"• ",i.jsx("strong",{children:"Administrador:"})," Acceso completo al sistema",i.jsx("br",{}),"• ",i.jsx("strong",{children:"Cliente:"})," Vista limitada de servicios y tickets"]}),i.jsx("div",{className:"mt-3 p-3 bg-yellow-50 border border-yellow-200 rounded",children:i.jsx("p",{className:"text-sm text-yellow-800 font-medium",children:"⚠️ Recuerda guardar la configuración para aplicar los cambios. Se cerrará la sesión automáticamente para probar los botones de demo."})})]}),i.jsxs("div",{className:"mt-6 p-4 bg-green-50 border border-green-200 rounded-lg",children:[i.jsx("h4",{className:"font-semibold text-green-800 mb-2",children:"🔧 Herramientas de Desarrollo"}),i.jsx("p",{className:"text-sm text-green-700 mb-2",children:"Al activar el modo de prueba, también se habilitarán:"}),i.jsxs("ul",{className:"text-sm text-green-700 list-disc list-inside space-y-1",children:[i.jsx("li",{children:"Botón de cambio entre modo Demo/Live en el login"}),i.jsx("li",{children:"Botón de diagnóstico de Firebase para debugging"}),i.jsx("li",{children:"Acceso a herramientas de desarrollo"})]})]})]}),i.jsx("button",{onClick:d,className:"mt-4 px-5 py-2 bg-blue-600 text-white font-semibold rounded-md shadow-sm hover:bg-blue-700",children:"Guardar Configuración"})]})]})}function V2({user:t,isDemo:e,setIsDemoMode:n,userRole:r,companySettings:s,onLogout:a}){const[o,c]=V.useState("services"),u=()=>{switch(o){case"users":return i.jsx(A2,{isDemo:e,userRole:r});case"templates":return i.jsx(k2,{isDemo:e});case"messages":return i.jsx(M2,{isDemo:e,userRole:r});case"tickets":return i.jsx(O2,{isDemo:e,userRole:r});case"payments":return i.jsx(D2,{isDemo:e,userRole:r});case"payment-config":return i.jsx(Rw,{isDemo:e});case"settings":return i.jsx(L2,{isDemo:e,setIsDemoMode:n,onLogout:a});case"services":default:return i.jsx(j2,{isDemo:e,userRole:r})}};return i.jsxs("main",{className:"container mx-auto",children:[i.jsx("div",{className:"border-b border-gray-200",children:i.jsxs("nav",{className:"-mb-px flex space-x-8 px-4 sm:px-6 lg:px-8","aria-label":"Tabs",children:[i.jsxs("button",{onClick:()=>c("services"),className:`${o==="services"?"border-blue-500 text-blue-600":"border-transparent text-gray-500"} flex items-center gap-2 py-4 px-1 border-b-2 font-medium text-sm`,children:[i.jsx(vc,{})," Servicios"]}),r==="superadmin"&&i.jsxs("button",{onClick:()=>c("users"),className:`${o==="users"?"border-blue-500 text-blue-600":"border-transparent text-gray-500"} flex items-center gap-2 py-4 px-1 border-b-2 font-medium text-sm`,children:[i.jsx(y2,{})," Usuarios"]}),i.jsxs("button",{onClick:()=>c("templates"),className:`${o==="templates"?"border-blue-500 text-blue-600":"border-transparent text-gray-500"} flex items-center gap-2 py-4 px-1 border-b-2 font-medium text-sm`,children:[i.jsx(kw,{})," Plantillas"]}),i.jsxs("button",{onClick:()=>c("messages"),className:`${o==="messages"?"border-blue-500 text-blue-600":"border-transparent text-gray-500"} flex items-center gap-2 py-4 px-1 border-b-2 font-medium text-sm`,children:[i.jsx(Sl,{})," Mensajes"]}),i.jsxs("button",{onClick:()=>c("payments"),className:`${o==="payments"?"border-blue-500 text-blue-600":"border-transparent text-gray-500"} flex items-center gap-2 py-4 px-1 border-b-2 font-medium text-sm`,children:[i.jsx(Ut,{})," Pagos"]}),i.jsxs("button",{onClick:()=>c("tickets"),className:`${o==="tickets"?"border-blue-500 text-blue-600":"border-transparent text-gray-500"} flex items-center gap-2 py-4 px-1 border-b-2 font-medium text-sm`,children:[i.jsx(cs,{})," Tickets"]}),r==="superadmin"&&i.jsxs("button",{onClick:()=>c("settings"),className:`${o==="settings"?"border-blue-500 text-blue-600":"border-transparent text-gray-500"} flex items-center gap-2 py-4 px-1 border-b-2 font-medium text-sm`,children:[i.jsx(x2,{})," Empresa"]})]})}),u()]})}function F2({isOpen:t,onClose:e,onConfirm:n,service:r,paymentType:s,warningMessage:a}){if(!t)return null;const o=()=>s==="One-Time"?i.jsx(Ut,{className:"h-8 w-8 text-blue-600"}):i.jsx(Mr,{className:"h-8 w-8 text-green-600"}),c=()=>s==="One-Time"?"Solicitar Pago Único":"Solicitar Pago de Renovación",u=()=>s==="One-Time"?"Esta es una solicitud de pago único que no se renovará automáticamente":"Esta solicitud renovará tu servicio por el período seleccionado",d=()=>s==="One-Time"?"bg-blue-600 hover:bg-blue-700 focus:ring-blue-500":"bg-green-600 hover:bg-green-700 focus:ring-green-500";return i.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex justify-center items-center p-4",children:i.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-md w-full mx-4 transform transition-all",children:[i.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:i.jsxs("div",{className:"flex items-center space-x-3",children:[i.jsx("div",{className:"flex-shrink-0",children:o()}),i.jsxs("div",{className:"flex-1",children:[i.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:c()}),i.jsx("p",{className:"text-sm text-gray-500",children:u()})]})]})}),i.jsxs("div",{className:"px-6 py-4",children:[i.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 mb-4",children:[i.jsxs("div",{className:"flex items-center justify-between mb-2",children:[i.jsx("h4",{className:"font-medium text-gray-900",children:r.serviceType}),i.jsxs("span",{className:"text-sm font-semibold text-gray-600",children:[r.currency," ",r.amount.toFixed(2)]})]}),i.jsx("p",{className:"text-sm text-gray-600 mb-2",children:r.description}),i.jsxs("div",{className:"flex items-center space-x-4 text-xs text-gray-500",children:[i.jsxs("span",{children:["Número: ",r.serviceNumber]}),s!=="One-Time"&&i.jsxs("span",{children:["Ciclo: ",r.billingCycle]})]})]}),i.jsx("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-4 mb-4",children:i.jsxs("div",{className:"flex items-start space-x-3",children:[i.jsx(N2,{className:"h-5 w-5 text-amber-600 flex-shrink-0 mt-0.5"}),i.jsxs("div",{children:[i.jsx("h5",{className:"text-sm font-medium text-amber-800 mb-1",children:"Información Importante"}),i.jsx("p",{className:"text-sm text-amber-700",children:a})]})]})}),i.jsxs("div",{className:"space-y-2 text-sm",children:[i.jsxs("div",{className:"flex justify-between",children:[i.jsx("span",{className:"text-gray-600",children:"Tipo de Pago:"}),i.jsx("span",{className:"font-medium text-gray-900",children:s==="One-Time"?"Pago Único":"Renovación"})]}),i.jsxs("div",{className:"flex justify-between",children:[i.jsx("span",{className:"text-gray-600",children:"Monto:"}),i.jsxs("span",{className:"font-medium text-gray-900",children:[r.currency," ",r.amount.toFixed(2)]})]}),i.jsxs("div",{className:"flex justify-between",children:[i.jsx("span",{className:"text-gray-600",children:"Método de Pago:"}),i.jsx("span",{className:"font-medium text-gray-900",children:"Transferencia Bancaria"})]}),i.jsxs("div",{className:"flex justify-between",children:[i.jsx("span",{className:"text-gray-600",children:"Estado Inicial:"}),i.jsx("span",{className:"font-medium text-amber-600",children:"Pendiente"})]})]})]}),i.jsxs("div",{className:"px-6 py-4 bg-gray-50 rounded-b-2xl flex justify-end space-x-3",children:[i.jsx("button",{onClick:e,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500 transition-colors",children:"Cancelar"}),i.jsx("button",{onClick:n,className:`px-6 py-2 text-sm font-medium text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-offset-2 transition-colors ${d()}`,children:s==="One-Time"?"Solicitar Pago Único":"Solicitar Renovación"})]})]})})}function U2({user:t,isDemo:e,userProfile:n}){const{addNotification:r}=ke(),[s,a]=V.useState([]),[o,c]=V.useState(!0),[u,d]=V.useState(new Set),[m,y]=V.useState(new Set),[g,x]=V.useState({}),[C,E]=V.useState(null),[A,N]=V.useState({isOpen:!1,service:null}),T=b=>{if(!b.dueDate||!b.billingCycle||b.billingCycle==="One-Time")return b.expirationDate?new Date(b.expirationDate.seconds*1e3):null;const _=new Date(b.dueDate.seconds*1e3);let $=new Date(_);switch(b.billingCycle){case"Monthly":$.setMonth($.getMonth()+1);break;case"Semiannually":$.setMonth($.getMonth()+6);break;case"Annually":$.setFullYear($.getFullYear()+1);break;case"Biennially":$.setFullYear($.getFullYear()+2);break;case"Triennially":$.setFullYear($.getFullYear()+3);break;default:return null}return $},k=b=>{const _=T(b);return _?_.toLocaleDateString():"N/A"},L=b=>({"One-Time":"Pago único",Monthly:"Mensual",Semiannually:"Semestral",Annually:"Anual",Biennially:"Bianual",Triennially:"Trienal",Custom:"Personalizado"})[b]||b,q=b=>{if(u.has(b.id)){r("Ya se está solicitando un pago para este servicio","warning");return}if(m.has(b.id)){r("Ya existe una solicitud de pago pendiente para este servicio","warning");return}N({isOpen:!0,service:b})},z=async b=>{if(e){r("Solicitud de pago creada exitosamente (modo demo)","success"),N({isOpen:!1,service:null});return}d(_=>new Set(_).add(b.id));try{let _;if(b.billingCycle==="One-Time")_=b.dueDate?new Date(b.dueDate.seconds*1e3):new Date,_.setDate(_.getDate()+30);else{const P=T(b);P?_=P:_=new Date(Date.now()+30*24*60*60*1e3)}const $=P=>{if(!P)return null;if(P.gateways)return P.gateways;const{bold:H,paypal:R,payu:K,bankTransfer:Y}=P,ne={};return H&&(ne.bold={name:"Bold",...H}),R&&(ne.paypal={name:"PayPal",...R}),K&&(ne.payu={name:"PayU",...K}),Y&&(ne.bankTransfer={name:"Transferencia Bancaria",...Y}),ne},[D,F]=V.useState(null);V.useEffect(()=>{if(e){F({gateways:{bankTransfer:{enabled:!0,name:"Transferencia Bancaria",autoApprove:!1}}});return}const P=ue(te,"artifacts",ee,"public","data","settings","paymentConfig"),H=Ee(P,R=>{R.exists()&&F(R.data())});return()=>H()},[e]);let O=D&&$(D);const M=O?Object.values(O).filter(P=>P.enabled):[];let W="Transferencia Bancaria",U="Transferencia Bancaria";M.length===1?(W=M[0].name,U=M[0].name):M.length>1&&(W="Pendiente de Selección",U=b.billingCycle==="One-Time"?"Pago Único":"Renovación");const Q={serviceId:b.id,serviceNumber:b.serviceNumber,serviceType:b.serviceType,description:b.description,amount:b.amount,currency:b.currency,status:"Pendiente",gateway:W,userId:t.uid,clientName:(n==null?void 0:n.fullName)||"Cliente",clientEmail:t.email,dueDate:oe.fromDate(_),createdAt:oe.now(),paymentMethod:U,notes:`Solicitud de pago automática para servicio ${b.serviceNumber} - Ciclo: ${L(b.billingCycle)}`,billingCycle:b.billingCycle,isAutoGenerated:!0,originalServiceDueDate:b.dueDate?b.dueDate.toDate?b.dueDate:oe.fromDate(new Date(b.dueDate)):null,paymentType:b.billingCycle==="One-Time"?"Pago Único":"Renovación"};await sr(xe(te,"artifacts",ee,"public","data","payments"),Q),r("Solicitud de pago creada exitosamente. Revisa la sección de pagos.","success"),N({isOpen:!1,service:null})}catch(_){console.error("Error generating payment:",_),r("Error al crear la solicitud de pago. Intenta nuevamente.","error")}finally{d(_=>{const $=new Set(_);return $.delete(b.id),$})}},j=b=>{localStorage.setItem("selectedServiceForRenewal",JSON.stringify({id:b.id,serviceNumber:b.serviceNumber,serviceType:b.serviceType,description:b.description,amount:b.amount,currency:b.currency,billingCycle:b.billingCycle,dueDate:b.dueDate})),window.location.hash==="#renewals"?(window.location.hash="",setTimeout(()=>{window.location.hash="renewals"},50)):window.location.hash="renewals",r("Redirigiendo a renovaciones para este servicio","success")};V.useEffect(()=>{if(e){y(new Set(["demo1","demo2"]));return}if(!(t!=null&&t.uid))return;const b=He(xe(te,"artifacts",ee,"public","data","payments"),rt("userId","==",t.uid),rt("status","==","Pendiente")),_=Ee(b,$=>{const D=new Set,F={};$.docs.forEach(O=>{const M=O.data();M.serviceId&&(D.add(M.serviceId),F[M.serviceId]={id:O.id,...M})}),y(D),x(F)});return()=>_()},[t==null?void 0:t.uid,e]),V.useEffect(()=>{if(e){E({renewalSettings:{reminderDays:10,gracePeriodDays:7}});return}const b=ue(te,"artifacts",ee,"public","data","settings","renewalConfig"),_=Ee(b,$=>{$.exists()&&E($.data())});return()=>_()},[e]);const v=b=>{if(!b||b.billingCycle==="One-Time")return null;const _=T(b);if(!_)return null;const $=new Date;return Math.ceil((_.getTime()-$.getTime())/(1e3*60*60*24))};V.useEffect(()=>{if(e||!(C!=null&&C.renewalSettings)||!(t!=null&&t.uid))return;const b=Number(C.renewalSettings.reminderDays??0),_=Number(C.renewalSettings.gracePeriodDays??0);(async()=>{for(const D of s){if(!D||D.billingCycle==="One-Time")continue;const F=v(D);if(F!=null){if(F<=b&&F>=-_&&!m.has(D.id))try{await z(D)}catch(O){console.error("Auto-generate payment failed:",O)}if(F<-_){const O=g[D.id];if(O!=null&&O.id)try{await qe(ue(te,"artifacts",ee,"public","data","payments",O.id),{status:"Cancelado",updatedAt:new Date,cancelReason:"Periodo de gracia agotado"}),r(`Solicitud de pago cancelada por período de gracia (${D.serviceNumber})`,"warning")}catch(M){console.error("Auto-cancel payment failed:",M)}}}}})()},[s,C,m,g,t==null?void 0:t.uid,e]),V.useEffect(()=>{if(e){a([{id:"demo1",serviceNumber:"SRV-241017-123456",serviceType:"Hosting",description:"Plan Básico - 1GB",amount:10.99,currency:"USD",status:"Activo",dueDate:{seconds:Date.now()/1e3+30*24*60*60},billingCycle:"Monthly",clientNotes:"Servicio de hosting básico"},{id:"demo2",serviceNumber:"SRV-241017-789012",serviceType:"Dominio",description:"midominio.com",amount:15,currency:"USD",status:"Pendiente Pago",dueDate:{seconds:Date.now()/1e3+10*24*60*60},billingCycle:"Annually",clientNotes:"Renovación de dominio"}]),c(!1);return}if(!(t!=null&&t.uid)){c(!1);return}const b=He(xe(te,"artifacts",ee,"public","data","services"),rt("assignedUserId","==",t.uid)),_=Ee(b,$=>{const D=$.docs.map(F=>({id:F.id,...F.data()}));D.sort((F,O)=>{var U,Q;const M=((U=F.createdAt)==null?void 0:U.seconds)||0;return(((Q=O.createdAt)==null?void 0:Q.seconds)||0)-M}),a(D),c(!1)},$=>{console.error("Error loading services:",$),r("Error al cargar los servicios","error"),c(!1)});return()=>_()},[t==null?void 0:t.uid,e,r]);const S=b=>({Activo:"bg-green-100 text-green-800","Periodo de Gracia Vencido":"bg-yellow-100 text-yellow-800","Pendiente Pago":"bg-red-100 text-red-800",Pago:"bg-blue-100 text-blue-800",Cancelado:"bg-gray-100 text-gray-800"})[b]||"bg-gray-100 text-gray-800",p=b=>b?new Date(b.seconds*1e3).toLocaleDateString("es-ES"):"--",I=(b,_)=>new Intl.NumberFormat("es-ES",{style:"currency",currency:_||"USD"}).format(b);return o?i.jsx("div",{className:"flex justify-center items-center h-64",children:i.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):i.jsxs("div",{className:"p-4 sm:p-6 lg:p-8",children:[i.jsxs("div",{className:"flex justify-between items-center mb-6",children:[i.jsxs("h2",{className:"text-2xl sm:text-3xl font-bold text-gray-900 flex items-center gap-2",children:[i.jsx(vc,{}),"Mis Servicios Contratados"]}),i.jsxs("div",{className:"text-sm text-gray-500",children:[s.length," servicio",s.length!==1?"s":""," encontrado",s.length!==1?"s":""]})]}),s.length===0?i.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-8 text-center",children:[i.jsx(vc,{className:"mx-auto h-12 w-12 text-gray-400 mb-4"}),i.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No tienes servicios asignados"}),i.jsx("p",{className:"text-gray-500",children:"Contacta al administrador para que te asigne servicios."})]}):i.jsx("div",{className:"bg-white rounded-xl shadow-lg overflow-x-auto",children:i.jsxs("table",{className:"w-full text-left",children:[i.jsx("thead",{className:"bg-gray-50",children:i.jsx("tr",{children:["Número","Servicio","Descripción","Monto","Estado","Ciclo","Fecha de Inicio","Fecha de Vencimiento","Notas","Acciones"].map(b=>i.jsx("th",{className:"px-6 py-3 text-xs font-medium text-gray-500 uppercase tracking-wider",children:b},b))})}),i.jsx("tbody",{className:"divide-y divide-gray-200",children:s.map(b=>i.jsxs("tr",{className:"hover:bg-gray-50",children:[i.jsx("td",{className:"px-6 py-4",children:i.jsx("div",{className:"font-mono text-sm font-medium text-blue-600",children:b.serviceNumber||"N/A"})}),i.jsx("td",{className:"px-6 py-4",children:i.jsx("div",{className:"font-medium text-gray-900",children:b.serviceType})}),i.jsx("td",{className:"px-6 py-4",children:i.jsx("div",{className:"text-gray-900",children:b.description})}),i.jsx("td",{className:"px-6 py-4",children:i.jsx("div",{className:"font-medium text-gray-900",children:I(b.amount,b.currency)})}),i.jsx("td",{className:"px-6 py-4",children:i.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${S(b.status)}`,children:b.status})}),i.jsxs("td",{className:"px-6 py-4",children:[i.jsx("div",{className:"text-sm font-medium text-gray-900",children:L(b.billingCycle)}),b.billingCycle==="Custom"&&b.customBillingCycle&&i.jsxs("div",{className:"text-xs text-gray-500",children:["(",b.customBillingCycle,")"]})]}),i.jsxs("td",{className:"px-6 py-4",children:[i.jsx("div",{className:"text-sm text-gray-900",children:p(b.dueDate)}),i.jsx("div",{className:"text-xs text-gray-500",children:"Inicio"})]}),i.jsxs("td",{className:"px-6 py-4",children:[i.jsx("div",{className:"text-sm font-medium text-gray-900",children:k(b)}),i.jsx("div",{className:"text-xs text-gray-500",children:"Vencimiento"})]}),i.jsx("td",{className:"px-6 py-4",children:i.jsx("div",{className:"text-gray-600 text-sm max-w-xs truncate",children:b.clientNotes||"--"})}),i.jsx("td",{className:"px-6 py-4",children:i.jsx("div",{className:"flex items-center space-x-2",children:m.has(b.id)?i.jsxs("div",{className:"text-center",children:[i.jsx("div",{className:"text-xs text-orange-600 font-medium mb-1",children:"Por pagar"}),i.jsxs("button",{onClick:()=>window.location.href="#payments",className:"inline-flex items-center px-3 py-1.5 border border-transparent text-xs font-medium rounded-md text-white bg-orange-600 hover:bg-orange-700",title:"Ir a Pago",children:[i.jsx($r,{className:"h-4 w-4 mr-1"}),"Ir a Pago"]})]}):i.jsxs("div",{className:"flex flex-col space-y-2",children:[i.jsxs("button",{onClick:()=>{const _=v(b);if(b.billingCycle!=="One-Time"&&(_==null||C!=null&&C.renewalSettings&&_>(C.renewalSettings.reminderDays??0))){j(b);return}q(b)},disabled:u.has(b.id),className:`inline-flex items-center px-3 py-1.5 border border-transparent text-xs font-medium rounded-md focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 ${u.has(b.id)?"text-gray-400 bg-gray-200 cursor-not-allowed":"text-white bg-blue-600 hover:bg-blue-700"}`,title:u.has(b.id)?"Creando solicitud...":b.billingCycle==="One-Time"?"Solicitar de Nuevo":"Solicitar de Nuevo (irá a Renovaciones fuera de ventana)",children:[i.jsx(Ut,{className:"h-4 w-4 mr-1"}),u.has(b.id)?"Creando...":m.has(b.id)?"Ir a Pago":"Solicitar de Nuevo"]}),b.billingCycle!=="One-Time"&&i.jsxs("button",{onClick:()=>j(b),className:"inline-flex items-center px-3 py-1.5 border border-gray-300 text-xs font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50",title:"Aumentar ciclo de este servicio",children:[i.jsx(Mr,{className:"h-4 w-4 mr-1"}),"Aumentar Ciclo"]})]})})})]},b.id))})]})}),A.isOpen&&A.service&&i.jsx(F2,{isOpen:A.isOpen,onClose:()=>N({isOpen:!1,service:null}),onConfirm:()=>z(A.service),service:A.service,paymentType:A.service.billingCycle,warningMessage:A.service.billingCycle==="One-Time"?`Se creará una solicitud de pago único para el servicio "${A.service.serviceType}". La solicitud vencerá en 30 días desde la fecha actual.`:`Se creará una solicitud de pago de renovación para el servicio "${A.service.serviceType}" con ciclo ${L(A.service.billingCycle)}. La solicitud vencerá en la fecha de vencimiento del servicio.`})]})}function B2({bankAccounts:t,serviceNumber:e,amount:n,currency:r,onUpload:s}){const a=(o,c)=>new Intl.NumberFormat("es-ES",{style:"currency",currency:c||"USD"}).format(o);return!t||t.length===0?i.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:i.jsx("p",{className:"text-yellow-800",children:"No hay cuentas bancarias configuradas. Contacta al administrador."})}):i.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[i.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[i.jsx(Ut,{}),i.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"Instrucciones para Transferencia Bancaria"})]}),i.jsxs("div",{className:"space-y-6",children:[i.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[i.jsx("h4",{className:"font-semibold text-blue-800 mb-2",children:"Información del Pago"}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[i.jsxs("div",{children:[i.jsx("span",{className:"font-medium text-gray-700",children:"Número de Servicio:"}),i.jsx("span",{className:"ml-2 font-mono text-blue-600",children:e})]}),i.jsxs("div",{children:[i.jsx("span",{className:"font-medium text-gray-700",children:"Monto a Pagar:"}),i.jsx("span",{className:"ml-2 font-semibold text-green-600",children:a(n,r)})]})]})]}),i.jsxs("div",{children:[i.jsx("h4",{className:"font-semibold text-gray-800 mb-3",children:"Cuentas Disponibles para Transferencia"}),i.jsx("div",{className:"space-y-4",children:t.map((o,c)=>i.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[i.jsxs("div",{className:"flex items-center justify-between mb-3",children:[i.jsxs("h5",{className:"font-medium text-gray-700",children:["Opción ",c+1]}),i.jsx("span",{className:"text-sm text-gray-500",children:o.accountType})]}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[i.jsxs("div",{children:[i.jsx("span",{className:"font-medium text-gray-600",children:"Banco:"}),i.jsx("span",{className:"ml-2 text-gray-800",children:o.bankName})]}),i.jsxs("div",{children:[i.jsx("span",{className:"font-medium text-gray-600",children:"Número de Cuenta:"}),i.jsx("span",{className:"ml-2 font-mono text-blue-600",children:o.accountNumber})]}),i.jsxs("div",{className:"md:col-span-2",children:[i.jsx("span",{className:"font-medium text-gray-600",children:"Titular:"}),i.jsx("span",{className:"ml-2 text-gray-800",children:o.accountHolder})]})]})]},o.id))})]}),i.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[i.jsx("h4",{className:"font-semibold text-gray-800 mb-3",children:"Instrucciones Paso a Paso"}),i.jsxs("ol",{className:"space-y-2 text-sm text-gray-700",children:[i.jsxs("li",{className:"flex items-start",children:[i.jsx("span",{className:"flex-shrink-0 w-6 h-6 bg-blue-600 text-white rounded-full flex items-center justify-center text-xs font-semibold mr-3 mt-0.5",children:"1"}),i.jsx("span",{children:"Realiza una transferencia bancaria a cualquiera de las cuentas mostradas arriba"})]}),i.jsxs("li",{className:"flex items-start",children:[i.jsx("span",{className:"flex-shrink-0 w-6 h-6 bg-blue-600 text-white rounded-full flex items-center justify-center text-xs font-semibold mr-3 mt-0.5",children:"2"}),i.jsxs("span",{children:["Usa el ",i.jsx("strong",{children:"Número de Servicio"})," como referencia en la transferencia"]})]}),i.jsxs("li",{className:"flex items-start",children:[i.jsx("span",{className:"flex-shrink-0 w-6 h-6 bg-blue-600 text-white rounded-full flex items-center justify-center text-xs font-semibold mr-3 mt-0.5",children:"3"}),i.jsxs("span",{children:["Transfiere el monto exacto: ",i.jsx("strong",{children:a(n,r)})]})]}),i.jsxs("li",{className:"flex items-start",children:[i.jsx("span",{className:"flex-shrink-0 w-6 h-6 bg-blue-600 text-white rounded-full flex items-center justify-center text-xs font-semibold mr-3 mt-0.5",children:"4"}),i.jsx("span",{children:"Guarda el comprobante de transferencia"})]}),i.jsxs("li",{className:"flex items-start",children:[i.jsx("span",{className:"flex-shrink-0 w-6 h-6 bg-blue-600 text-white rounded-full flex items-center justify-center text-xs font-semibold mr-3 mt-0.5",children:"5"}),i.jsx("span",{children:"Envía el comprobante por email o sube una foto en el sistema"})]})]})]}),i.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:[i.jsx("h4",{className:"font-semibold text-yellow-800 mb-2",children:"⚠️ Información Importante"}),i.jsxs("ul",{className:"text-sm text-yellow-700 space-y-1",children:[i.jsx("li",{children:"• El pago puede tardar hasta 24 horas en ser procesado"}),i.jsx("li",{children:"• Asegúrate de incluir el número de servicio como referencia"}),i.jsx("li",{children:"• El monto debe ser exacto para evitar retrasos"}),i.jsx("li",{children:"• Contacta al administrador si tienes alguna duda"})]})]}),i.jsx("div",{className:"text-center",children:i.jsxs("label",{className:"inline-block px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-medium cursor-pointer",children:["Subir Comprobante de Transferencia",i.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:o=>{var c;return s&&((c=o.target.files)==null?void 0:c[0])&&s(o.target.files[0])}})]})})]})]})}function $2({user:t,isDemo:e,userProfile:n}){const{addNotification:r}=ke(),[s,a]=V.useState([]),[o,c]=V.useState(""),[u,d]=V.useState("Todos"),[m,y]=V.useState(!0),[g,x]=V.useState([]),[C,E]=V.useState(!1),[A,N]=V.useState(null),[T,k]=V.useState(null),[L,q]=V.useState({}),[z,j]=V.useState(!1),[v,S]=V.useState(null),p=()=>{if(!T)return null;if(T.gateways)return T.gateways;const{bold:P,paypal:H,payu:R,bankTransfer:K}=T,Y={};return P&&(Y.bold={name:"Bold",...P}),H&&(Y.paypal={name:"PayPal",...H}),R&&(Y.payu={name:"PayU",...R}),K&&(Y.bankTransfer={name:"Transferencia Bancaria",...K}),Y},I=["Todos","Pendiente","Procesando","Completado","Fallido","Cancelado","Reembolsado"];V.useEffect(()=>{if(e){k({gateways:{bold:{enabled:!0,name:"Bold",autoApprove:!1},paypal:{enabled:!0,name:"PayPal",autoApprove:!1},payu:{enabled:!0,name:"PayU",autoApprove:!1},bankTransfer:{enabled:!0,name:"Transferencia Bancaria",autoApprove:!1}},bankAccounts:[{id:"1",bank:"Banco Nacional",accountNumber:"1234567890",accountHolder:"Mi Empresa"},{id:"2",bank:"Banco Popular",accountNumber:"0987654321",accountHolder:"Mi Empresa"}]});return}const P=ue(te,"artifacts",ee,"public","data","settings","paymentConfig"),H=Ee(P,R=>{R.exists()?(k(R.data()),console.log("Payment config loaded:",R.data())):(console.log("No payment config found, using defaults"),k({gateways:{bold:{enabled:!0,name:"Bold",autoApprove:!1},paypal:{enabled:!0,name:"PayPal",autoApprove:!1},payu:{enabled:!0,name:"PayU",autoApprove:!1},bankTransfer:{enabled:!0,name:"Transferencia Bancaria",autoApprove:!1}},bankAccounts:[]}))},R=>{console.error("Error loading payment config:",R)});return()=>H()},[e]),V.useEffect(()=>{if(e){a([{id:"demo1",serviceNumber:"SRV-241017-123456",serviceType:"Hosting",amount:10.99,currency:"USD",status:"Completado",gateway:"Bold",transactionId:"bold_txn_123456",createdAt:{seconds:Date.now()/1e3-86400},completedAt:{seconds:Date.now()/1e3-3600}},{id:"demo2",serviceNumber:"SRV-241017-789012",serviceType:"Dominio",amount:25,currency:"USD",status:"Pendiente",gateway:"PayPal",transactionId:"paypal_txn_789012",createdAt:{seconds:Date.now()/1e3-7200}},{id:"demo3",serviceNumber:"SRV-241017-345678",serviceType:"Hosting Premium",amount:50,currency:"USD",status:"Completado",gateway:"Transferencia Bancaria",transactionId:"TRF-123456789",createdAt:{seconds:Date.now()/1e3-10800},completedAt:{seconds:Date.now()/1e3-9e3}}]),x([{id:"1",bankName:"Banco Nacional",accountNumber:"1234567890",accountHolder:"Empresa Demo",accountType:"Ahorros"},{id:"2",bankName:"Banco Popular",accountNumber:"0987654321",accountHolder:"Empresa Demo",accountType:"Corriente"}]),y(!1);return}if(!(t!=null&&t.uid)){y(!1);return}const P=He(xe(te,"artifacts",ee,"public","data","payments"),rt("userId","==",t.uid)),H=Ee(P,R=>{const K=R.docs.map(Y=>({id:Y.id,...Y.data()}));console.log("Payments loaded:",K.length,K),K.sort((Y,ne)=>{var ce,Ie;const pe=((ce=Y.createdAt)==null?void 0:ce.seconds)||0;return(((Ie=ne.createdAt)==null?void 0:Ie.seconds)||0)-pe}),a(K),y(!1)},R=>{console.error("Error loading payments:",R),r("Error al cargar los pagos","error"),y(!1)});return()=>H()},[t==null?void 0:t.uid,e,r]),V.useEffect(()=>{if(e)return;const P=ue(te,"artifacts",ee,"public","data","settings","paymentConfig"),H=Ee(P,R=>{var K;if(R.exists()){const Y=R.data();(K=Y.bankTransfer)!=null&&K.accounts&&x(Y.bankTransfer.accounts)}});return()=>H()},[e]);const b=s.filter(P=>{const H=o===""||P.serviceNumber&&P.serviceNumber.toLowerCase().includes(o.toLowerCase())||P.serviceType&&P.serviceType.toLowerCase().includes(o.toLowerCase())||P.serviceName&&P.serviceName.toLowerCase().includes(o.toLowerCase())||P.transactionId&&P.transactionId.toLowerCase().includes(o.toLowerCase()),R=u==="Todos"||P.status===u,K=H&&R;return console.log("Payment filter:",{payment:P.id,serviceType:P.serviceType,serviceName:P.serviceName,status:P.status,searchTerm:o,statusFilter:u,matchesSearch:H,matchesStatus:R,result:K}),K}),_=P=>({Pendiente:"bg-yellow-100 text-yellow-800",Procesando:"bg-blue-100 text-blue-800",Completado:"bg-green-100 text-green-800",Fallido:"bg-red-100 text-red-800",Cancelado:"bg-gray-100 text-gray-800",Reembolsado:"bg-purple-100 text-purple-800"})[P]||"bg-gray-100 text-gray-800",$=P=>({Bold:"bg-blue-100 text-blue-800",PayPal:"bg-yellow-100 text-yellow-800",PayU:"bg-green-100 text-green-800","Transferencia Bancaria":"bg-purple-100 text-purple-800",Manual:"bg-gray-100 text-gray-800"})[P]||"bg-gray-100 text-gray-800",D=P=>{const H={invoiceNumber:`INV-${P.id.slice(-8).toUpperCase()}`,date:new Date(P.createdAt.seconds*1e3).toLocaleDateString(),dueDate:P.dueDate?new Date(P.dueDate.seconds*1e3).toLocaleDateString():"N/A",clientName:P.clientName||(n==null?void 0:n.fullName)||"Cliente",clientEmail:P.clientEmail||(t==null?void 0:t.email)||"N/A",serviceNumber:P.serviceNumber||"N/A",serviceType:P.serviceType||"Servicio",description:P.description||"Descripción del servicio",amount:P.amount||0,currency:P.currency||"USD",status:P.status||"Pendiente",gateway:P.gateway||"N/A",transactionId:P.transactionId||"N/A",paymentMethod:P.paymentMethod||"N/A"},R=`
      <!DOCTYPE html>
      <html>
      <head>
        <meta charset="UTF-8">
        <title>Invoice ${H.invoiceNumber}</title>
        <style>
          body { font-family: Arial, sans-serif; margin: 0; padding: 20px; background: #f5f5f5; }
          .invoice { background: white; max-width: 800px; margin: 0 auto; padding: 30px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
          .header { text-align: center; margin-bottom: 30px; border-bottom: 2px solid #e5e5e5; padding-bottom: 20px; }
          .company-name { font-size: 24px; font-weight: bold; color: #2563eb; margin-bottom: 5px; }
          .invoice-title { font-size: 18px; color: #666; }
          .invoice-details { display: flex; justify-content: space-between; margin-bottom: 30px; }
          .client-info, .invoice-info { flex: 1; }
          .client-info h3, .invoice-info h3 { margin: 0 0 10px 0; color: #333; font-size: 16px; }
          .client-info p, .invoice-info p { margin: 5px 0; color: #666; font-size: 14px; }
          .service-details { margin-bottom: 30px; }
          .service-table { width: 100%; border-collapse: collapse; margin-top: 15px; }
          .service-table th, .service-table td { padding: 12px; text-align: left; border-bottom: 1px solid #e5e5e5; }
          .service-table th { background: #f8f9fa; font-weight: bold; color: #333; }
          .service-table .amount { text-align: right; font-weight: bold; }
          .total { text-align: right; margin-top: 20px; }
          .total-amount { font-size: 20px; font-weight: bold; color: #2563eb; }
          .status { display: inline-block; padding: 4px 12px; border-radius: 20px; font-size: 12px; font-weight: bold; }
          .status.completado { background: #d1fae5; color: #065f46; }
          .status.pendiente { background: #fef3c7; color: #92400e; }
          .status.fallido { background: #fee2e2; color: #991b1b; }
          .status.cancelado { background: #f3f4f6; color: #374151; }
          .footer { margin-top: 40px; text-align: center; color: #666; font-size: 12px; border-top: 1px solid #e5e5e5; padding-top: 20px; }
        </style>
      </head>
      <body>
        <div class="invoice">
          <div class="header">
            <div class="company-name">Gestor de Cobros</div>
            <div class="invoice-title">FACTURA</div>
          </div>
          
          <div class="invoice-details">
            <div class="client-info">
              <h3>Cliente</h3>
              <p><strong>${H.clientName}</strong></p>
              <p>${H.clientEmail}</p>
            </div>
            <div class="invoice-info">
              <h3>Detalles de la Factura</h3>
              <p><strong>Número:</strong> ${H.invoiceNumber}</p>
              <p><strong>Fecha:</strong> ${H.date}</p>
              <p><strong>Vencimiento:</strong> ${H.dueDate}</p>
              <p><strong>Estado:</strong> <span class="status ${H.status.toLowerCase()}">${H.status}</span></p>
            </div>
          </div>
          
          <div class="service-details">
            <h3>Detalles del Servicio</h3>
            <table class="service-table">
              <thead>
                <tr>
                  <th>Servicio</th>
                  <th>Descripción</th>
                  <th>Monto</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>${H.serviceType}</td>
                  <td>${H.description}</td>
                  <td class="amount">${H.currency} ${H.amount.toFixed(2)}</td>
                </tr>
              </tbody>
            </table>
          </div>
          
          <div class="total">
            <div class="total-amount">Total: ${H.currency} ${H.amount.toFixed(2)}</div>
          </div>
          
          <div class="footer">
            <p>Método de Pago: ${H.paymentMethod}</p>
            <p>Gateway: ${H.gateway}</p>
            ${H.transactionId!=="N/A"?`<p>ID de Transacción: ${H.transactionId}</p>`:""}
            <p>Gracias por su negocio</p>
          </div>
        </div>
      </body>
      </html>
    `,K=new Blob([R],{type:"text/html"}),Y=URL.createObjectURL(K),ne=document.createElement("a");ne.href=Y,ne.download=`invoice-${H.invoiceNumber}.html`,document.body.appendChild(ne),ne.click(),document.body.removeChild(ne),URL.revokeObjectURL(Y),r("Invoice descargado exitosamente","success")},F=P=>P?new Date(P.seconds*1e3).toLocaleDateString("es-ES",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"--",O=(P,H)=>new Intl.NumberFormat("es-ES",{style:"currency",currency:H||"USD"}).format(P),M=P=>{switch(P){case"Completado":return"✅";case"Pendiente":return"⏳";case"Procesando":return"🔄";case"Fallido":return"❌";case"Cancelado":return"🚫";case"Reembolsado":return"↩️";default:return"❓"}},W=P=>{N(P),E(!0)},U=async(P,H)=>{const R=p(),K=R==null?void 0:R[H];if(K)if(H==="bankTransfer"){if(P.gateway!=="Transferencia Bancaria")try{const Y=ue(te,"artifacts",ee,"public","data","payments",P.id);await qe(Y,{gateway:"Transferencia Bancaria",updatedAt:new Date}),r("Pasarela cambiada a Transferencia Bancaria","success")}catch{r("No se pudo actualizar la pasarela del pago","error")}W({...P,gateway:"Transferencia Bancaria"})}else r(`Redirigiendo a ${K.name} para procesar el pago`,"info")},Q=async(P,H)=>{if(!H||!(P!=null&&P.id)){r("Selecciona una imagen válida","warning");return}try{q(ce=>({...ce,[P.id]:!0})),console.log("🔄 Iniciando subida de comprobante vía PHP...");const R=new FormData;R.append("file",H);const K=window.location.origin+"/upload.php";console.log("📤 Enviando a:",K);const Y=await fetch(K,{method:"POST",body:R});if(console.log("📥 Respuesta recibida:",Y.status,Y.statusText),!Y.ok){const ce=await Y.text();throw console.error("❌ Error del servidor:",ce),new Error(`upload_failed_${Y.status}: ${ce}`)}const ne=await Y.json();console.log("✅ Respuesta JSON:",ne);const pe=ne==null?void 0:ne.url;if(!pe)throw console.error("❌ No se recibió URL en la respuesta:",ne),new Error("missing_url");const Ce=ue(te,"artifacts",ee,"public","data","payments",P.id);await qe(Ce,{proofUrl:pe,proofUploadedAt:new Date}),console.log("✅ Comprobante guardado en Firestore:",pe),N(ce=>ce&&ce.id===P.id?{...ce,proofUrl:pe}:ce),a(ce=>ce.map(Ie=>Ie.id===P.id?{...Ie,proofUrl:pe}:Ie)),E(!1),r("Comprobante subido correctamente","success")}catch(R){console.error("❌ Upload proof failed:",R),r(`No se pudo subir el comprobante: ${R.message}`,"error")}finally{q(R=>({...R,[P.id]:!1}))}};return m?i.jsx("div",{className:"flex justify-center items-center h-64",children:i.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):i.jsxs("div",{className:"p-4 sm:p-6 lg:p-8",children:[i.jsxs("div",{className:"flex flex-wrap justify-between items-center gap-4 mb-6",children:[i.jsxs("h2",{className:"text-2xl sm:text-3xl font-bold text-gray-900 flex items-center gap-2",children:[i.jsx(Ut,{}),"Mis Pagos"]}),i.jsxs("div",{className:"text-sm text-gray-500",children:[b.length," pago",b.length!==1?"s":""," encontrado",b.length!==1?"s":""]})]}),i.jsx("div",{className:"bg-white rounded-lg shadow-md p-4 mb-6",children:i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[i.jsxs("div",{className:"relative",children:[i.jsx("input",{type:"text",placeholder:"Buscar por servicio o transacción...",value:o,onChange:P=>c(P.target.value),className:"w-full pl-10 pr-4 py-2 border rounded-md"}),i.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:i.jsx(Ii,{})})]}),i.jsx("select",{value:u,onChange:P=>d(P.target.value),className:"w-full p-2 border rounded-md",children:I.map(P=>i.jsx("option",{value:P,children:P},P))})]})}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[i.jsxs("div",{className:"bg-white rounded-lg shadow-md p-4",children:[i.jsx("div",{className:"text-sm text-gray-500",children:"Total Pagado"}),i.jsx("div",{className:"text-2xl font-bold text-green-600",children:O(s.filter(P=>P.status==="Completado").reduce((P,H)=>P+(H.amount||0),0),"USD")})]}),i.jsxs("div",{className:"bg-white rounded-lg shadow-md p-4",children:[i.jsx("div",{className:"text-sm text-gray-500",children:"Pendientes"}),i.jsx("div",{className:"text-2xl font-bold text-yellow-600",children:s.filter(P=>P.status==="Pendiente").length})]}),i.jsxs("div",{className:"bg-white rounded-lg shadow-md p-4",children:[i.jsx("div",{className:"text-sm text-gray-500",children:"Completados"}),i.jsx("div",{className:"text-2xl font-bold text-green-600",children:s.filter(P=>P.status==="Completado").length})]}),i.jsxs("div",{className:"bg-white rounded-lg shadow-md p-4",children:[i.jsx("div",{className:"text-sm text-gray-500",children:"Fallidos"}),i.jsx("div",{className:"text-2xl font-bold text-red-600",children:s.filter(P=>P.status==="Fallido").length})]})]}),b.length===0?i.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-8 text-center",children:[i.jsx(Ut,{className:"mx-auto h-12 w-12 text-gray-400 mb-4"}),i.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No tienes pagos registrados"}),i.jsx("p",{className:"text-gray-500",children:"Los pagos aparecerán aquí una vez que realices una transacción."})]}):i.jsx("div",{className:"space-y-4",children:b.map(P=>i.jsx("div",{className:"bg-white rounded-lg shadow-md p-6 hover:shadow-lg transition-shadow",children:i.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between",children:[i.jsxs("div",{className:"flex-1",children:[i.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[i.jsx("span",{className:"text-2xl",children:M(P.status)}),i.jsxs("div",{children:[i.jsx("h3",{className:"font-semibold text-gray-900",children:P.serviceName||P.serviceType||"Servicio"}),i.jsx("p",{className:"text-sm text-gray-500 font-mono",children:P.serviceNumber||P.id}),P.serviceDescription&&i.jsx("p",{className:"text-xs text-gray-400 mt-1",children:P.serviceDescription}),P.isRenewal&&i.jsxs("div",{className:"text-xs text-green-600 font-medium mt-1",children:["Renovación: ",P.renewalPeriod||"N/A"]})]})]}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mt-4",children:[i.jsxs("div",{children:[i.jsx("span",{className:"text-sm text-gray-500",children:"Monto:"}),i.jsx("div",{className:"font-semibold text-lg text-gray-900",children:O(P.amount,P.currency)})]}),i.jsxs("div",{children:[i.jsx("span",{className:"text-sm text-gray-500",children:"Estado:"}),i.jsx("div",{className:"mt-1",children:i.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${_(P.status)}`,children:P.status})})]}),i.jsxs("div",{children:[i.jsx("span",{className:"text-sm text-gray-500",children:"Pasarela:"}),i.jsx("div",{className:"mt-1",children:i.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${$(P.gateway)}`,children:P.gateway})})]})]}),i.jsxs("div",{className:"mt-4 text-sm text-gray-500",children:[i.jsxs("div",{children:["Fecha: ",F(P.createdAt)]}),P.completedAt&&i.jsxs("div",{children:["Completado: ",F(P.completedAt)]}),P.startDate&&P.endDate&&i.jsx("div",{className:"text-blue-600 mt-2",children:i.jsxs("div",{children:["Período: ",F(P.startDate)," - ",F(P.endDate)]})}),P.transactionId&&i.jsxs("div",{className:"font-mono",children:["ID: ",P.transactionId]}),P.isRenewal&&P.renewalMonths&&i.jsxs("div",{className:"text-green-600",children:["Duración: ",P.renewalMonths," meses"]})]})]}),i.jsxs("div",{className:"mt-4 md:mt-0 md:ml-4 flex flex-wrap gap-2",children:[(P.status==="Completado"||P.status==="Fallido"||P.status==="Cancelado")&&i.jsxs("button",{onClick:()=>D(P),className:"inline-flex items-center px-3 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 text-sm",children:[i.jsx($r,{className:"h-4 w-4 mr-1"}),"Descargar Invoice"]}),P.status==="Pendiente"&&i.jsx("div",{className:"flex flex-wrap gap-2",children:(()=>{const H=p();return H?Object.entries(H).map(([R,K])=>K.enabled?i.jsxs("button",{onClick:()=>U(P,R),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 text-sm",children:["Pagar con ",K.name]},R):null):null})()}),P.status==="Pendiente"&&P.gateway==="Transferencia Bancaria"&&i.jsxs(i.Fragment,{children:[i.jsxs("label",{className:`px-4 py-2 ${L[P.id]?"bg-gray-200 text-gray-400 cursor-wait":"bg-gray-100 text-gray-800 hover:bg-gray-200 cursor-pointer"} rounded-lg text-sm`,children:[L[P.id]?"Subiendo...":"Subir Comprobante",i.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:H=>{var R;return((R=H.target.files)==null?void 0:R[0])&&Q(P,H.target.files[0])}})]}),P.proofUrl&&i.jsx("button",{onClick:()=>{S(P.proofUrl),j(!0)},className:"px-4 py-2 bg-green-50 text-green-700 rounded-lg hover:bg-green-100 text-sm",children:"Ver Comprobante"})]})]})]})},P.id))}),C&&A&&i.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex justify-center items-center p-4",children:i.jsx("div",{className:"bg-white rounded-lg shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:i.jsxs("div",{className:"p-6",children:[i.jsxs("div",{className:"flex justify-between items-center mb-4",children:[i.jsx("h3",{className:"text-xl font-bold text-gray-800",children:"Instrucciones de Transferencia"}),i.jsx("button",{onClick:()=>E(!1),className:"text-gray-400 hover:text-gray-600",children:"✕"})]}),i.jsx(B2,{bankAccounts:g,serviceNumber:A.serviceNumber,amount:A.amount,currency:A.currency,onUpload:P=>Q(A,P)})]})})}),z&&v&&i.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 z-50 flex justify-center items-center p-4",onClick:()=>j(!1),children:i.jsxs("div",{className:"bg-white rounded-lg shadow-2xl max-w-5xl w-full max-h-[95vh] overflow-hidden flex flex-col",onClick:P=>P.stopPropagation(),children:[i.jsxs("div",{className:"flex justify-between items-center p-4 border-b bg-gray-50",children:[i.jsx("h3",{className:"text-xl font-bold text-gray-800",children:"Comprobante de Pago"}),i.jsx("button",{onClick:()=>j(!1),className:"text-gray-400 hover:text-gray-600 text-2xl font-bold w-8 h-8 flex items-center justify-center","aria-label":"Cerrar",children:"✕"})]}),i.jsx("div",{className:"flex-1 overflow-auto p-4 bg-gray-100 flex justify-center items-center min-h-[400px]",children:i.jsx("img",{src:v,alt:"Comprobante de pago",className:"max-w-full max-h-[80vh] object-contain rounded-lg shadow-lg",onError:P=>{P.target.src='data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" width="400" height="300"%3E%3Ctext x="50%25" y="50%25" text-anchor="middle" dy=".3em" fill="%23999"%3ENo se pudo cargar la imagen%3C/text%3E%3C/svg%3E'}})}),i.jsxs("div",{className:"p-4 border-t bg-gray-50 flex justify-end gap-2",children:[i.jsx("a",{href:v,target:"_blank",rel:"noreferrer",className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 text-sm",children:"Abrir en Nueva Pestaña"}),i.jsx("button",{onClick:()=>{const P=document.createElement("a");P.href=v,P.download=`comprobante-${Date.now()}.${v.split(".").pop().split("?")[0]}`,document.body.appendChild(P),P.click(),document.body.removeChild(P)},className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 text-sm",children:"Descargar"}),i.jsx("button",{onClick:()=>j(!1),className:"px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 text-sm",children:"Cerrar"})]})]})})]})}function z2({user:t,isDemo:e,userProfile:n}){const{addNotification:r}=ke(),[s,a]=V.useState([]),[o,c]=V.useState(null),[u,d]=V.useState(!0),[m,y]=V.useState(null),[g,x]=V.useState(new Set),[C,E]=V.useState(!1),A=[{key:"monthly",label:"Mensual",months:1},{key:"quarterly",label:"Trimestral",months:3},{key:"semiAnnual",label:"Semestral",months:6},{key:"annual",label:"Anual",months:12},{key:"biennial",label:"Bienal (2 años)",months:24},{key:"triennial",label:"Trienal (3 años)",months:36}];V.useEffect(()=>{if(e){c({discounts:{monthly:{enabled:!1,percentage:0},quarterly:{enabled:!0,percentage:5},semiAnnual:{enabled:!0,percentage:10},annual:{enabled:!0,percentage:15},biennial:{enabled:!0,percentage:25},triennial:{enabled:!0,percentage:35}},taxSettings:{ivaEnabled:!0,ivaPercentage:19,ivaIncluded:!1,taxName:"IVA"}});return}const O=ue(te,"artifacts",ee,"public","data","settings","renewalConfig"),M=Ee(O,W=>{W.exists()?(c(W.data()),console.log("Renewal config loaded:",W.data())):(console.log("No renewal config found, using defaults"),c({discounts:{monthly:{enabled:!1,percentage:0},quarterly:{enabled:!0,percentage:5},semiAnnual:{enabled:!0,percentage:10},annual:{enabled:!0,percentage:15},biennial:{enabled:!0,percentage:25},triennial:{enabled:!0,percentage:35}},taxSettings:{ivaEnabled:!0,ivaPercentage:19,ivaIncluded:!1,taxName:"IVA"}}))},W=>{console.error("Error loading renewal config:",W)});return()=>M()},[e]),V.useEffect(()=>{const O=localStorage.getItem("selectedServiceForRenewal");if(O)try{const M=JSON.parse(O);y(M),r(`Servicio "${M.serviceType}" seleccionado para renovación`,"success"),localStorage.removeItem("selectedServiceForRenewal")}catch(M){console.error("Error parsing selected service:",M)}},[]),V.useEffect(()=>{if(!m||s.length===0)return;const O=document.getElementById(`service-${m.id}`);O&&O.scrollIntoView({behavior:"smooth",block:"start"})},[m,s]),V.useEffect(()=>{if(e||!(t!=null&&t.uid))return;const O=He(xe(te,"artifacts",ee,"public","data","payments"),rt("userId","==",t.uid),rt("status","==","Pendiente"),rt("isRenewal","==",!0)),M=Ee(O,W=>{const U=new Set;W.docs.forEach(Q=>{const P=Q.data();P.serviceId&&U.add(P.serviceId)}),x(U)},W=>{console.error("Error loading pending renewals:",W)});return()=>M()},[t==null?void 0:t.uid,e]);const N=O=>{if(!O.dueDate||!O.billingCycle||O.billingCycle==="One-Time")return O.expirationDate?new Date(O.expirationDate.seconds*1e3):null;const M=new Date(O.dueDate.seconds*1e3);let W=new Date(M);switch(O.billingCycle){case"Monthly":W.setMonth(W.getMonth()+1);break;case"Semiannually":W.setMonth(W.getMonth()+6);break;case"Annually":W.setFullYear(W.getFullYear()+1);break;case"Biennially":W.setFullYear(W.getFullYear()+2);break;case"Triennially":W.setFullYear(W.getFullYear()+3);break;default:return null}return W},T=O=>O.billingCycle==="One-Time"?O.dueDate?new Date(O.dueDate.seconds*1e3):null:N(O);V.useEffect(()=>{if(e){a([{id:"demo1",serviceNumber:"SRV-241017-123456",serviceType:"Hosting Básico",description:"Plan Básico - 1GB",amount:5e4,currency:"COP",status:"Activo",dueDate:{seconds:Date.now()/1e3+30*24*60*60},billingCycle:"Monthly",clientNotes:"Servicio de hosting básico"},{id:"demo2",serviceNumber:"SRV-241017-789012",serviceType:"Dominio",description:"midominio.com",amount:15e4,currency:"COP",status:"Activo",dueDate:{seconds:Date.now()/1e3+10*24*60*60},billingCycle:"Annually",clientNotes:"Renovación de dominio"}]),c({renewalSettings:{enabled:!0,maxRenewalYears:3,autoRenewal:!0,gracePeriodDays:7,reminderDays:3},discounts:{monthly:{enabled:!1,discount:0,description:"Descuento por pago mensual"},quarterly:{enabled:!0,discount:5,description:"Descuento por pago trimestral"},semiAnnual:{enabled:!0,discount:10,description:"Descuento por pago semestral"},annual:{enabled:!0,discount:15,description:"Descuento por pago anual"},biennial:{enabled:!0,discount:25,description:"Descuento por pago bienal (2 años)"},triennial:{enabled:!0,discount:35,description:"Descuento por pago trienal (3 años)"}},taxSettings:{ivaEnabled:!0,ivaPercentage:19,ivaIncluded:!1,taxName:"IVA"},pricingSettings:{roundToNearest:100,minimumAmount:1e3,maximumAmount:1e7}}),d(!1);return}if(!(t!=null&&t.uid)){d(!1);return}const O=He(xe(te,"artifacts",ee,"public","data","services"),rt("assignedUserId","==",t.uid)),M=Ee(O,Q=>{const P=Q.docs.map(H=>({id:H.id,...H.data()}));a(P)},Q=>{console.error("Error loading services:",Q),r("Error al cargar los servicios","error")}),W=ue(te,"artifacts",ee,"public","data","settings","renewalConfig"),U=Ee(W,Q=>{Q.exists()&&c(Q.data()),d(!1)});return()=>{M(),U()}},[t==null?void 0:t.uid,e,r]);const k=(O,M)=>{var H,R;if(!((R=(H=o==null?void 0:o.discounts)==null?void 0:H[M])!=null&&R.enabled))return O;const W=o.discounts[M],U=O*W.discount/100,Q=O-U,P=Math.round(Q/o.pricingSettings.roundToNearest)*o.pricingSettings.roundToNearest;return Math.max(P,o.pricingSettings.minimumAmount)},L=O=>{var M;if(!((M=o==null?void 0:o.taxSettings)!=null&&M.ivaEnabled)||o.taxSettings.ivaIncluded)return O;{const W=O*o.taxSettings.ivaPercentage/100;return O+W}},q=O=>new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP"}).format(O),z=O=>{const M=T(O);if(!M)return 0;const W=new Date,U=M.getTime()-W.getTime();return Math.ceil(U/(1e3*60*60*24))},j=O=>{switch(O){case"Activo":return"bg-green-100 text-green-800";case"Periodo de Gracia Vencido":return"bg-yellow-100 text-yellow-800";case"Pendiente Pago":return"bg-orange-100 text-orange-800";case"Pago":return"bg-blue-100 text-blue-800";case"Cancelado":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},v=O=>{switch(O){case"Monthly":return 1;case"Quarterly":return 3;case"Semi-Annual":return 6;case"Annually":return 12;case"Biennial":return 24;case"Triennial":return 36;case"One-Time":return 0;default:return 1}},S=(O,M)=>{var Q;const W=v(O.billingCycle),U=((Q=A.find(P=>P.key===M))==null?void 0:Q.months)||0;return W===0?!1:U>=W},p=(O,M)=>{var H;const W=T(O);if(!W)return{startDate:null,endDate:null};const U=((H=A.find(R=>R.key===M))==null?void 0:H.months)||0,Q=new Date(W),P=new Date(Q);return P.setMonth(P.getMonth()+U),{startDate:Q,endDate:P}},I=(O,M)=>{var Q;const W=v(O.billingCycle);return W===0?"Volver a Comprar":(((Q=A.find(P=>P.key===M))==null?void 0:Q.months)||0)<W?"Período Insuficiente":"Renovar"},b=()=>{window.location.href="#payments"},_=O=>{if(!O)return null;if(O.gateways)return O.gateways;const{bold:M,paypal:W,payu:U,bankTransfer:Q}=O,P={};return M&&(P.bold={name:"Bold",...M}),W&&(P.paypal={name:"PayPal",...W}),U&&(P.payu={name:"PayU",...U}),Q&&(P.bankTransfer={name:"Transferencia Bancaria",...Q}),P},[$,D]=V.useState(null);V.useEffect(()=>{if(e){D({gateways:{bankTransfer:{enabled:!0,name:"Transferencia Bancaria"}}});return}const O=ue(te,"artifacts",ee,"public","data","settings","paymentConfig"),M=Ee(O,W=>{W.exists()&&D(W.data())});return()=>M()},[e]);const F=async(O,M)=>{var W,U,Q,P,H;if(e){const R=I(O,M);r(`${R} ${(W=A.find(K=>K.key===M))==null?void 0:W.label} iniciada (modo demo)`,"success");return}if(g.has(O.id)){r("Ya tienes una solicitud de renovación pendiente para este servicio","warning");return}if(C){r("Ya se está procesando una solicitud de renovación","warning");return}E(!0);try{const{startDate:R,endDate:K}=p(O,M),Y=O.amount,ne=k(Y,M),pe=L(ne);let Ce=$&&_($);const ce=Ce?Object.values(Ce).filter(et=>et.enabled):[];let Ie="Pendiente de Selección",kt="Renovación";ce.length===1&&(Ie=ce[0].name,kt=ce[0].name);const an={userId:t.uid,serviceId:O.id,serviceName:O.serviceType,serviceType:O.serviceType,serviceDescription:O.description,serviceNumber:O.serviceNumber,amount:pe,originalAmount:Y,discount:Y-ne,currency:"USD",status:"Pendiente",paymentMethod:kt,paymentType:"Renovación",gateway:Ie,transactionId:null,dueDate:oe.fromDate(new Date(R)),renewalPeriod:((U=A.find(et=>et.key===M))==null?void 0:U.label)||M,renewalMonths:((Q=A.find(et=>et.key===M))==null?void 0:Q.months)||0,startDate:oe.fromDate(new Date(R)),endDate:oe.fromDate(new Date(K)),createdAt:oe.now(),updatedAt:oe.now(),notes:`Renovación de ${(P=A.find(et=>et.key===M))==null?void 0:P.label} para el servicio ${O.serviceType}`,isRenewal:!0},Bt=xe(te,`artifacts/${ee}/public/data/payments`);await sr(Bt,an);const Pt={service:O,period:M,startDate:R,endDate:K,originalPrice:Y,discountedPrice:ne,finalPrice:pe};localStorage.setItem("renewalData",JSON.stringify(Pt));const Mn=I(O,M);r(`${Mn} ${(H=A.find(et=>et.key===M))==null?void 0:H.label} - Redirigiendo a pagos`,"success"),x(et=>new Set([...et,O.id])),setTimeout(()=>{window.location.href="#payments"},1500)}catch(R){console.error("Error creating renewal payment:",R),r("Error al crear la solicitud de renovación. Intenta nuevamente.","error")}finally{E(!1)}};return u?i.jsx("div",{className:"flex justify-center items-center h-64",children:i.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):i.jsxs("main",{className:"container mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[i.jsx("div",{className:"flex justify-between items-center mb-6",children:i.jsxs("h2",{className:"text-2xl sm:text-3xl font-bold text-gray-900 flex items-center gap-2",children:[i.jsx(Mr,{}),"Renovaciones de Servicios"]})}),s.length===0?i.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-8 text-center",children:[i.jsx(Mr,{className:"mx-auto h-12 w-12 text-gray-400 mb-4"}),i.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No tienes servicios para renovar"}),i.jsx("p",{className:"text-gray-500",children:"Contacta al administrador para que te asigne servicios."})]}):i.jsx("div",{className:"space-y-6",children:s.map(O=>{const M=z(O),W=M<=30&&M>0,U=M<=0,Q=m&&m.id===O.id;return i.jsxs("div",{id:`service-${O.id}`,className:`bg-white rounded-xl shadow-lg p-6 ${Q?"ring-2 ring-blue-500 border-blue-200":""}`,children:[i.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between mb-4",children:[i.jsxs("div",{children:[i.jsxs("div",{className:"flex items-center space-x-2",children:[i.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:O.serviceType}),Q&&i.jsx("span",{className:"px-2 py-1 text-xs font-semibold text-blue-700 bg-blue-100 rounded-full",children:"Seleccionado"})]}),i.jsx("p",{className:"text-sm text-gray-500 font-mono",children:O.serviceNumber}),i.jsx("p",{className:"text-sm text-gray-600",children:O.description})]}),i.jsx("div",{className:"mt-2 md:mt-0",children:i.jsx("span",{className:`px-3 py-1 text-sm font-semibold rounded-full ${j(O.status)}`,children:O.status})})]}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[i.jsxs("div",{children:[i.jsx("span",{className:"text-sm text-gray-500",children:"Precio Actual:"}),i.jsx("div",{className:"font-semibold text-lg text-gray-900",children:q(O.amount)})]}),i.jsxs("div",{children:[i.jsx("span",{className:"text-sm text-gray-500",children:O.billingCycle==="One-Time"?"Fecha de Inicio:":"Fecha de Vencimiento:"}),i.jsx("div",{className:`font-semibold ${U?"text-red-600":W?"text-orange-600":"text-gray-900"}`,children:(()=>{const P=T(O);return P?P.toLocaleDateString():"N/A"})()}),i.jsx("div",{className:"text-xs text-gray-500",children:U?"Vencido":W?`${M} días restantes`:`${M} días restantes`})]}),i.jsxs("div",{children:[i.jsx("span",{className:"text-sm text-gray-500",children:"Ciclo Actual:"}),i.jsx("div",{className:"font-semibold text-gray-900",children:O.billingCycle})]})]}),i.jsxs("div",{className:"border-t pt-6",children:[i.jsxs("h4",{className:"text-md font-semibold text-gray-800 mb-4 flex items-center gap-2",children:[i.jsx(Pw,{}),v(O.billingCycle)===0?"Opciones de Compra":"Opciones de Renovación"]}),v(O.billingCycle)===0?i.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:i.jsxs("div",{className:"flex items-center",children:[i.jsx("div",{className:"flex-shrink-0",children:i.jsx("svg",{className:"h-5 w-5 text-yellow-400",viewBox:"0 0 20 20",fill:"currentColor",children:i.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.725-1.36 3.49 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})})}),i.jsxs("div",{className:"ml-3",children:[i.jsx("h3",{className:"text-sm font-medium text-yellow-800",children:"Servicio de Pago Único"}),i.jsx("div",{className:"mt-2 text-sm text-yellow-700",children:i.jsx("p",{children:'Este servicio es de pago único. Para volver a adquirirlo, contacta al administrador o selecciona "Volver a Comprar" si está disponible.'})})]})]})}):i.jsxs("div",{className:"space-y-4",children:[(()=>{var H,R;const P=A.find(K=>v(O.billingCycle)===K.months);if(P){const K=O.amount,Y=k(K,P.key),ne=L(Y),pe=(H=o==null?void 0:o.discounts)==null?void 0:H[P.key],Ce=K-Y,{startDate:ce,endDate:Ie}=p(O,P.key);return i.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 border-2 border-blue-200 rounded-lg p-4",children:[i.jsxs("div",{className:"flex items-center justify-between mb-3",children:[i.jsxs("h5",{className:"font-semibold text-blue-900 flex items-center gap-2",children:[i.jsx(Mr,{className:"h-4 w-4"}),"Renovación de Período Actual"]}),i.jsx("span",{className:"px-3 py-1 bg-blue-200 text-blue-800 text-sm font-semibold rounded-full",children:P.label})]}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[i.jsxs("div",{children:[i.jsxs("div",{className:"text-sm text-gray-600 mb-2",children:[i.jsxs("div",{children:["Precio base: ",q(K)]}),(pe==null?void 0:pe.enabled)&&Ce>0&&i.jsxs("div",{className:"text-green-600",children:["Ahorras: ",q(Ce)]})]}),i.jsx("div",{className:"font-bold text-xl text-blue-600",children:q(ne)}),((R=o==null?void 0:o.taxSettings)==null?void 0:R.ivaEnabled)&&i.jsx("div",{className:"text-xs text-gray-500",children:o.taxSettings.ivaIncluded?"IVA incluido":`+ ${o.taxSettings.taxName} ${o.taxSettings.ivaPercentage}%`})]}),i.jsx("div",{children:ce&&Ie&&i.jsxs("div",{className:"p-3 bg-white border border-blue-200 rounded-lg",children:[i.jsx("div",{className:"text-xs font-medium text-blue-800 mb-2",children:"Fechas de Renovación:"}),i.jsxs("div",{className:"text-xs text-blue-700 space-y-1",children:[i.jsxs("div",{children:["Fecha de Vencimiento: ",ce.toLocaleDateString()]}),i.jsxs("div",{children:["Fecha Nueva Renovación: ",Ie.toLocaleDateString()]})]})]})})]}),g.has(O.id)?i.jsx("button",{onClick:b,className:"w-full mt-4 px-6 py-3 bg-green-600 text-white font-semibold rounded-lg hover:bg-green-700 transition-colors",children:"Ver Solicitud Pendiente"}):i.jsx("button",{onClick:()=>F(O,P.key),disabled:C,className:`w-full mt-4 px-6 py-3 font-semibold rounded-lg transition-colors ${C?"bg-gray-400 text-white cursor-not-allowed":"bg-blue-600 text-white hover:bg-blue-700"}`,children:C?"Creando...":`Renovar ${P.label}`})]})}return null})(),i.jsxs("div",{children:[i.jsx("h6",{className:"text-sm font-medium text-gray-700 mb-3",children:"Otras Opciones de Renovación:"}),i.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:A.map(P=>{var an,Bt,Pt;const H=O.amount,R=k(H,P.key),K=L(R),Y=(an=o==null?void 0:o.discounts)==null?void 0:an[P.key],ne=H-R,pe=S(O,P),Ce=I(O,P),ce=v(O.billingCycle)===P.months,Ie=!((Bt=o==null?void 0:o.discounts)!=null&&Bt[P.key])||o.discounts[P.key].enabled,kt=pe&&!ce&&Ie;return kt?i.jsxs("div",{className:"border rounded-lg p-4 transition-shadow border-gray-200 hover:shadow-md",children:[i.jsxs("div",{className:"flex items-center justify-between mb-2",children:[i.jsx("h5",{className:"font-medium text-gray-800",children:P.label}),(Y==null?void 0:Y.enabled)&&kt&&i.jsxs("span",{className:"px-2 py-1 bg-green-100 text-green-800 text-xs font-semibold rounded-full",children:["-",Y.discount,"%"]})]}),i.jsxs("div",{className:"space-y-2",children:[i.jsxs("div",{className:"text-sm text-gray-600",children:[i.jsxs("div",{children:["Precio base: ",q(H)]}),(Y==null?void 0:Y.enabled)&&ne>0&&i.jsxs("div",{className:"text-green-600",children:["Ahorras: ",q(ne)]})]}),i.jsx("div",{className:"font-semibold text-lg text-blue-600",children:q(K)}),((Pt=o==null?void 0:o.taxSettings)==null?void 0:Pt.ivaEnabled)&&i.jsx("div",{className:"text-xs text-gray-500",children:o.taxSettings.ivaIncluded?"IVA incluido":`+ ${o.taxSettings.taxName} ${o.taxSettings.ivaPercentage}%`}),(()=>{const{startDate:Mn,endDate:et}=p(O,P);return Mn&&et?i.jsxs("div",{className:"mt-3 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:[i.jsx("div",{className:"text-xs font-medium text-blue-800 mb-2",children:"Fechas de Renovación:"}),i.jsxs("div",{className:"text-xs text-blue-700 space-y-1",children:[i.jsxs("div",{children:["Fecha de Vencimiento: ",Mn.toLocaleDateString()]}),i.jsxs("div",{children:["Fecha Nueva Renovación: ",et.toLocaleDateString()]})]})]}):null})(),g.has(O.id)?i.jsx("button",{onClick:b,className:"w-full px-4 py-2 rounded-md text-sm font-medium bg-green-600 text-white hover:bg-green-700",children:"Ver Solicitud"}):i.jsx("button",{onClick:()=>F(O,P.key),disabled:C,className:`w-full px-4 py-2 rounded-md text-sm font-medium ${C?"bg-gray-400 text-white cursor-not-allowed":"bg-blue-600 text-white hover:bg-blue-700"}`,children:C?"Creando...":`${Ce} ${P.label}`})]})]},P.key):null})})]})]})]}),i.jsxs("div",{className:"mt-6 p-4 bg-gray-50 rounded-lg",children:[i.jsx("h5",{className:"font-medium text-gray-800 mb-2",children:"Información Importante"}),i.jsxs("ul",{className:"text-sm text-gray-600 space-y-1",children:[i.jsxs("li",{children:["• ",i.jsx("strong",{children:'La "Renovación de Período Actual" siempre está disponible y destacada'})]}),i.jsxs("li",{children:["• ",i.jsx("strong",{children:"Fecha de Vencimiento"}),": Fecha actual de vencimiento del servicio"]}),i.jsxs("li",{children:["• ",i.jsx("strong",{children:"Fecha Nueva Renovación"}),": Fecha calculada después de sumar el período"]}),i.jsx("li",{children:"• Los descuentos se aplican automáticamente según el período seleccionado (si están configurados)"}),i.jsx("li",{children:"• Los precios se redondean para evitar decimales"}),i.jsx("li",{children:"• El IVA se calcula según la configuración actual"}),i.jsxs("li",{children:["• ",i.jsx("strong",{children:"La renovación extiende el servicio desde la fecha de vencimiento actual"})]}),i.jsx("li",{children:"• El período de renovación no puede ser inferior al ciclo actual del servicio"}),i.jsx("li",{children:'• Los servicios de pago único requieren "Volver a Comprar" en lugar de renovar'}),i.jsx("li",{children:"• Al seleccionar una renovación, serás redirigido a la sección de pagos para proceder"})]})]})]},O.id)})})]})}function q2({user:t,isDemo:e,userProfile:n}){const{addNotification:r}=ke(),[s,a]=V.useState([]),[o,c]=V.useState(!0),[u,d]=V.useState(!1),[m,y]=V.useState(null),[g,x]=V.useState(!1),[C,E]=V.useState({subject:"",department:"Soporte Técnico",priority:"Media",description:""}),A=["Soporte Técnico","Facturación","Ventas","General"],N=["Baja","Media","Alta","Crítica"];V.useEffect(()=>{if(e){a([{id:"ticket1",ticketNumber:"TKT-2024-001",subject:"Problema con el acceso al panel de cliente",description:"No puedo acceder a mi panel de cliente desde ayer. Me aparece un error 500.",status:"Abierto",priority:"Alta",department:"Soporte Técnico",clientId:(t==null?void 0:t.uid)||"demo",clientName:(n==null?void 0:n.fullName)||"Usuario Demo",clientEmail:(t==null?void 0:t.email)||"demo@ejemplo.com",assignedTo:null,assignedToName:null,createdAt:{seconds:Date.now()/1e3-3600},updatedAt:{seconds:Date.now()/1e3-3600},lastReplyAt:{seconds:Date.now()/1e3-3600},lastReplyBy:"Cliente",replyCount:0,attachments:[]},{id:"ticket2",ticketNumber:"TKT-2024-002",subject:"Consulta sobre facturación",description:"Necesito una copia de mi factura del mes pasado para contabilidad.",status:"Respondido",priority:"Media",department:"Facturación",clientId:(t==null?void 0:t.uid)||"demo",clientName:(n==null?void 0:n.fullName)||"Usuario Demo",clientEmail:(t==null?void 0:t.email)||"demo@ejemplo.com",assignedTo:"admin1",assignedToName:"Admin Principal",createdAt:{seconds:Date.now()/1e3-7200},updatedAt:{seconds:Date.now()/1e3-1800},lastReplyAt:{seconds:Date.now()/1e3-1800},lastReplyBy:"Admin Principal",replyCount:2,attachments:["factura_enero.pdf"]}]),c(!1);return}if(!(t!=null&&t.uid)){c(!1);return}const p=He(xe(te,"artifacts",ee,"public","data","tickets"),rt("clientId","==",t.uid)),I=Ee(p,b=>{const _=b.docs.map($=>({id:$.id,...$.data()}));_.sort(($,D)=>{var M,W;const F=((M=$.createdAt)==null?void 0:M.seconds)||0;return(((W=D.createdAt)==null?void 0:W.seconds)||0)-F}),a(_),c(!1)},b=>{console.error("Error loading tickets:",b),r("Error al cargar los tickets","error"),c(!1)});return()=>I()},[t==null?void 0:t.uid,e,r,n]);const T=async p=>{if(p.preventDefault(),e){r("Ticket creado (modo demo)","success"),d(!1),E({subject:"",department:"Soporte Técnico",priority:"Media",description:""});return}try{const I={...C,ticketNumber:`TKT-${new Date().getFullYear()}-${String(Date.now()).slice(-6)}`,status:"Abierto",clientId:t.uid,clientName:(n==null?void 0:n.fullName)||t.email,clientEmail:t.email,assignedTo:null,assignedToName:null,createdAt:oe.now(),updatedAt:oe.now(),lastReplyAt:oe.now(),lastReplyBy:"Cliente",replyCount:0,attachments:[]};await sr(xe(te,"artifacts",ee,"public","data","tickets"),I),r("Ticket creado exitosamente","success"),d(!1),E({subject:"",department:"Soporte Técnico",priority:"Media",description:""})}catch(I){console.error("Error creating ticket:",I),r("Error al crear el ticket","error")}},k=p=>{y(p),x(!0)},L=async p=>{if(e){a(I=>I.map(b=>b.id===p?{...b,status:"Cerrado",updatedAt:{seconds:Date.now()/1e3}}:b)),r("Ticket cerrado (modo demo)","success");return}try{const I=ue(te,"artifacts",ee,"public","data","tickets",p);await qe(I,{status:"Cerrado",updatedAt:oe.now()}),r("Ticket cerrado exitosamente","success")}catch(I){console.error("Error closing ticket:",I),r("Error al cerrar el ticket","error")}},q=p=>({Abierto:"bg-red-100 text-red-800","En Progreso":"bg-yellow-100 text-yellow-800",Respondido:"bg-blue-100 text-blue-800",Cerrado:"bg-gray-100 text-gray-800","Esperando Cliente":"bg-orange-100 text-orange-800"})[p]||"bg-gray-100 text-gray-800",z=p=>({Baja:"bg-green-100 text-green-800",Media:"bg-yellow-100 text-yellow-800",Alta:"bg-orange-100 text-orange-800",Crítica:"bg-red-100 text-red-800"})[p]||"bg-gray-100 text-gray-800",j=p=>({"Soporte Técnico":"bg-blue-100 text-blue-800",Facturación:"bg-green-100 text-green-800",Ventas:"bg-purple-100 text-purple-800",General:"bg-gray-100 text-gray-800"})[p]||"bg-gray-100 text-gray-800",v=p=>p?new Date(p.seconds*1e3).toLocaleDateString("es-ES",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"--",S=p=>{if(!p)return"--";const I=new Date,b=new Date(p.seconds*1e3),_=I.getTime()-b.getTime(),$=Math.floor(_/(1e3*60*60*24)),D=Math.floor(_/(1e3*60*60)),F=Math.floor(_/(1e3*60));return $>0?`hace ${$} día${$>1?"s":""}`:D>0?`hace ${D} hora${D>1?"s":""}`:F>0?`hace ${F} minuto${F>1?"s":""}`:"hace unos segundos"};return o?i.jsx("div",{className:"flex justify-center items-center h-64",children:i.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):i.jsxs("main",{className:"container mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[i.jsxs("div",{className:"flex justify-between items-center mb-6",children:[i.jsxs("h2",{className:"text-2xl sm:text-3xl font-bold text-gray-900 flex items-center gap-2",children:[i.jsx(cs,{}),"Mis Tickets de Soporte"]}),i.jsxs("button",{onClick:()=>d(!0),className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 flex items-center gap-2",children:[i.jsx(go,{}),"Nuevo Ticket"]})]}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[i.jsx("div",{className:"bg-white rounded-lg shadow-md p-4",children:i.jsxs("div",{className:"flex items-center",children:[i.jsx("div",{className:"p-2 bg-red-100 rounded-lg",children:i.jsx(Jt,{})}),i.jsxs("div",{className:"ml-3",children:[i.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Abiertos"}),i.jsx("p",{className:"text-2xl font-semibold text-gray-900",children:s.filter(p=>p.status==="Abierto").length})]})]})}),i.jsx("div",{className:"bg-white rounded-lg shadow-md p-4",children:i.jsxs("div",{className:"flex items-center",children:[i.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:i.jsx(Ka,{})}),i.jsxs("div",{className:"ml-3",children:[i.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Respondidos"}),i.jsx("p",{className:"text-2xl font-semibold text-gray-900",children:s.filter(p=>p.status==="Respondido").length})]})]})}),i.jsx("div",{className:"bg-white rounded-lg shadow-md p-4",children:i.jsxs("div",{className:"flex items-center",children:[i.jsx("div",{className:"p-2 bg-yellow-100 rounded-lg",children:i.jsx(Jt,{})}),i.jsxs("div",{className:"ml-3",children:[i.jsx("p",{className:"text-sm font-medium text-gray-500",children:"En Progreso"}),i.jsx("p",{className:"text-2xl font-semibold text-gray-900",children:s.filter(p=>p.status==="En Progreso").length})]})]})}),i.jsx("div",{className:"bg-white rounded-lg shadow-md p-4",children:i.jsxs("div",{className:"flex items-center",children:[i.jsx("div",{className:"p-2 bg-gray-100 rounded-lg",children:i.jsx(cs,{})}),i.jsxs("div",{className:"ml-3",children:[i.jsx("p",{className:"text-sm font-medium text-gray-500",children:"Cerrados"}),i.jsx("p",{className:"text-2xl font-semibold text-gray-900",children:s.filter(p=>p.status==="Cerrado").length})]})]})})]}),s.length===0?i.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-8 text-center",children:[i.jsx(cs,{className:"mx-auto h-12 w-12 text-gray-400 mb-4"}),i.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No tienes tickets"}),i.jsx("p",{className:"text-gray-500 mb-4",children:"Crea tu primer ticket para obtener soporte."}),i.jsx("button",{onClick:()=>d(!0),className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:"Crear Primer Ticket"})]}):i.jsx("div",{className:"space-y-4",children:s.map(p=>i.jsx("div",{className:"bg-white rounded-lg shadow-md p-6 hover:shadow-lg transition-shadow",children:i.jsxs("div",{className:"flex items-start justify-between",children:[i.jsxs("div",{className:"flex-1",children:[i.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[i.jsx("span",{className:"font-mono text-sm font-medium text-blue-600",children:p.ticketNumber}),i.jsx("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${q(p.status)}`,children:p.status}),i.jsx("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${z(p.priority)}`,children:p.priority}),i.jsx("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${j(p.department)}`,children:p.department})]}),i.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:p.subject}),i.jsx("p",{className:"text-sm text-gray-600 mb-3 line-clamp-2",children:p.description}),i.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-500",children:[i.jsxs("div",{className:"flex items-center gap-1",children:[i.jsx(Jt,{}),i.jsxs("span",{children:["Creado ",S(p.createdAt)]})]}),i.jsxs("div",{className:"flex items-center gap-1",children:[i.jsx(bc,{}),i.jsxs("span",{children:[p.replyCount," respuesta",p.replyCount!==1?"s":""]})]}),p.assignedToName&&i.jsxs("div",{className:"flex items-center gap-1",children:[i.jsx(Ka,{}),i.jsxs("span",{children:["Asignado a ",p.assignedToName]})]})]})]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("button",{onClick:()=>k(p),className:"p-2 text-blue-600 hover:bg-blue-50 rounded-md",title:"Ver ticket completo",children:i.jsx($r,{})}),p.status!=="Cerrado"&&i.jsx("button",{onClick:()=>L(p.id),className:"p-2 text-red-600 hover:bg-red-50 rounded-md",title:"Cerrar ticket",children:i.jsx(bi,{})})]})]})},p.id))}),u&&i.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex justify-center items-center p-4",children:i.jsxs("div",{className:"bg-white rounded-lg shadow-2xl p-6 max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[i.jsxs("div",{className:"flex items-center justify-between mb-4",children:[i.jsx("h3",{className:"text-xl font-bold text-gray-800",children:"Crear Nuevo Ticket"}),i.jsx("button",{onClick:()=>d(!1),className:"text-gray-400 hover:text-gray-600",children:"✕"})]}),i.jsxs("form",{onSubmit:T,className:"space-y-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Asunto *"}),i.jsx("input",{type:"text",value:C.subject,onChange:p=>E(I=>({...I,subject:p.target.value})),className:"w-full p-2 border rounded-md",placeholder:"Describe brevemente tu problema o consulta",required:!0})]}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Departamento *"}),i.jsx("select",{value:C.department,onChange:p=>E(I=>({...I,department:p.target.value})),className:"w-full p-2 border rounded-md",required:!0,children:A.map(p=>i.jsx("option",{value:p,children:p},p))})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Prioridad *"}),i.jsx("select",{value:C.priority,onChange:p=>E(I=>({...I,priority:p.target.value})),className:"w-full p-2 border rounded-md",required:!0,children:N.map(p=>i.jsx("option",{value:p,children:p},p))})]})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Descripción *"}),i.jsx("textarea",{value:C.description,onChange:p=>E(I=>({...I,description:p.target.value})),className:"w-full p-2 border rounded-md",rows:6,placeholder:"Describe tu problema o consulta en detalle. Incluye cualquier información relevante que pueda ayudar a resolver tu ticket más rápidamente.",required:!0})]}),i.jsxs("div",{className:"flex justify-end space-x-4 pt-4 border-t",children:[i.jsx("button",{type:"button",onClick:()=>d(!1),className:"px-4 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300",children:"Cancelar"}),i.jsx("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:"Crear Ticket"})]})]})]})}),g&&m&&i.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex justify-center items-center p-4",children:i.jsxs("div",{className:"bg-white rounded-lg shadow-2xl p-6 max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:[i.jsxs("div",{className:"flex items-center justify-between mb-4",children:[i.jsxs("h3",{className:"text-xl font-bold text-gray-800",children:["Ticket ",m.ticketNumber]}),i.jsx("button",{onClick:()=>x(!1),className:"text-gray-400 hover:text-gray-600",children:"✕"})]}),i.jsxs("div",{className:"space-y-6",children:[i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Estado"}),i.jsx("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${q(m.status)}`,children:m.status})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Prioridad"}),i.jsx("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${z(m.priority)}`,children:m.priority})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Departamento"}),i.jsx("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${j(m.department)}`,children:m.department})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Asignado a"}),i.jsx("div",{className:"text-sm text-gray-900",children:m.assignedToName||"Sin asignar"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Creado"}),i.jsx("div",{className:"text-sm text-gray-900",children:v(m.createdAt)})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Última actividad"}),i.jsx("div",{className:"text-sm text-gray-900",children:S(m.lastReplyAt)})]})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Asunto"}),i.jsx("div",{className:"text-sm text-gray-900 p-3 bg-gray-50 rounded-md",children:m.subject})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Descripción"}),i.jsx("div",{className:"text-sm text-gray-900 p-4 bg-gray-50 rounded-md whitespace-pre-wrap",children:m.description})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Historial de Mensajes"}),i.jsx("div",{className:"border border-gray-200 rounded-md p-4",children:i.jsx(Dw,{ticketId:m.id,isDemo:e,userRole:"client",currentUser:t})})]}),i.jsxs("div",{className:"flex justify-end space-x-4 pt-4 border-t",children:[i.jsx("button",{onClick:()=>x(!1),className:"px-4 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300",children:"Cerrar"}),m.status!=="Cerrado"&&i.jsx("button",{onClick:()=>{L(m.id),x(!1)},className:"px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700",children:"Cerrar Ticket"}),i.jsx("button",{className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:"Responder"})]})]})]})})]})}function H2({user:t,isDemo:e,userProfile:n}){const[r,s]=V.useState("services");V.useEffect(()=>{const o=()=>{const c=(window.location.hash||"").replace("#","");(c==="services"||c==="payments"||c==="renewals"||c==="tickets")&&s(c)};return o(),window.addEventListener("hashchange",o),()=>window.removeEventListener("hashchange",o)},[]);const a=()=>{switch(r){case"tickets":return i.jsx(q2,{user:t,isDemo:e,userProfile:n});case"payments":return i.jsx($2,{user:t,isDemo:e,userProfile:n});case"renewals":return i.jsx(z2,{user:t,isDemo:e,userProfile:n});case"services":default:return i.jsx(U2,{user:t,isDemo:e,userProfile:n})}};return i.jsxs("main",{className:"container mx-auto",children:[i.jsx("div",{className:"border-b border-gray-200",children:i.jsxs("nav",{className:"-mb-px flex space-x-8 px-4 sm:px-6 lg:px-8","aria-label":"Tabs",children:[i.jsxs("button",{onClick:()=>s("services"),className:`${r==="services"?"border-blue-500 text-blue-600":"border-transparent text-gray-500"} flex items-center gap-2 py-4 px-1 border-b-2 font-medium text-sm`,children:[i.jsx(vc,{})," Mis Servicios"]}),i.jsxs("button",{onClick:()=>s("payments"),className:`${r==="payments"?"border-blue-500 text-blue-600":"border-transparent text-gray-500"} flex items-center gap-2 py-4 px-1 border-b-2 font-medium text-sm`,children:[i.jsx(Ut,{})," Mis Pagos"]}),i.jsxs("button",{onClick:()=>s("renewals"),className:`${r==="renewals"?"border-blue-500 text-blue-600":"border-transparent text-gray-500"} flex items-center gap-2 py-4 px-1 border-b-2 font-medium text-sm`,children:[i.jsx(Mr,{})," Renovaciones"]}),i.jsxs("button",{onClick:()=>s("tickets"),className:`${r==="tickets"?"border-blue-500 text-blue-600":"border-transparent text-gray-500"} flex items-center gap-2 py-4 px-1 border-b-2 font-medium text-sm`,children:[i.jsx(cs,{})," Tickets de Soporte"]})]})}),a()]})}function G2({companySettings:t}){const{addNotification:e}=ke(),[n,r]=V.useState(!0),[s,a]=V.useState(""),[o,c]=V.useState(""),u=async d=>{d.preventDefault();try{if(n){const m=await sc(Je,s,o),y=await In(He(xe(te,"artifacts",ee,"public","data","users"),rt("__name__","==",m.user.uid)));if(y.docs.length===0)throw new Error("No se encontró el perfil de usuario.");const g=y.docs[0].data();if(g.status==="pending"||g.status==="disabled")throw await rs(Je),new Error("Tu cuenta está pendiente de activación o ha sido deshabilitada.")}else{const m=await Uc(Je,s,o);await Gv(m.user);const y=xe(te,"artifacts",ee,"public","data","users");let x=(await In(y)).empty?"superadmin":"client";const C=x==="superadmin"?"active":"pending",E=x!=="superadmin";await An(ue(te,"artifacts",ee,"public","data","users",m.user.uid),{email:s,role:x,status:C,isProfileComplete:!1,createdAt:oe.now(),fullName:"",identification:"",requiresPasswordChange:E}),x==="superadmin"?e("¡Registro exitoso! Eres el primer usuario y tienes permisos de superadministrador.","success"):(e("¡Registro exitoso! Revisa tu correo para verificar la cuenta. Un administrador debe activar tu usuario.","success"),await rs(Je))}}catch(m){e(m.message,"error")}};return i.jsx("div",{className:"flex items-center justify-center min-h-screen bg-gray-100",children:i.jsxs("div",{className:"p-8 bg-white rounded-lg shadow-xl max-w-sm w-full",children:[i.jsx("div",{className:"flex justify-center mb-6",children:t.logoUrl?i.jsx("img",{src:t.logoUrl,alt:"Logo de la Empresa",className:"max-h-16"}):i.jsx("h1",{className:"text-3xl font-bold",children:t.companyName||"Gestor de Pagos"})}),i.jsx("h2",{className:"text-2xl font-bold text-center mb-6",children:n?"Iniciar Sesión":"Crear Cuenta"}),i.jsxs("form",{onSubmit:u,children:[i.jsx("input",{type:"email",value:s,onChange:d=>a(d.target.value),placeholder:"Email",className:"w-full p-2 mb-4 border rounded",required:!0}),i.jsx("input",{type:"password",value:o,onChange:d=>c(d.target.value),placeholder:"Contraseña",className:"w-full p-2 mb-4 border rounded",required:!0}),i.jsx("button",{type:"submit",className:"w-full bg-blue-600 text-white p-2 rounded hover:bg-blue-700",children:n?"Entrar":"Registrarse"})]}),i.jsx("button",{onClick:()=>r(!n),className:"w-full mt-4 text-sm text-blue-600 hover:underline",children:n?"¿No tienes cuenta? Regístrate":"¿Ya tienes cuenta? Inicia sesión"})]})})}function W2({companySettings:t,onLogin:e}){const{addNotification:n}=ke(),[r,s]=V.useState(!1),a=async()=>{s(!0);try{const d=await sc(Je,"admin@test.com","admin123");e(d.user,"superadmin")}catch{n("Error al iniciar sesión como administrador. Verifica las credenciales.","error")}finally{s(!1)}},o=async()=>{s(!0);try{const d=await sc(Je,"cliente@test.com","cliente123");e(d.user,"client")}catch{n("Error al iniciar sesión como cliente. Verifica las credenciales.","error")}finally{s(!1)}};return i.jsx("div",{className:"flex items-center justify-center min-h-screen bg-gray-100",children:i.jsxs("div",{className:"p-8 bg-white rounded-lg shadow-xl max-w-md w-full",children:[i.jsx("div",{className:"flex justify-center mb-6",children:t.logoUrl?i.jsx("img",{src:t.logoUrl,alt:"Logo de la Empresa",className:"max-h-16"}):i.jsx("h1",{className:"text-3xl font-bold",children:t.companyName||"Gestor de Cobros"})}),i.jsxs("div",{className:"text-center mb-6",children:[i.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Modo de Prueba"}),i.jsx("p",{className:"text-gray-600",children:"Selecciona el tipo de usuario para probar el sistema"})]}),i.jsxs("div",{className:"space-y-4",children:[i.jsx("button",{onClick:a,disabled:r,className:"w-full bg-blue-600 text-white p-4 rounded-lg hover:bg-blue-700 font-semibold text-lg disabled:opacity-50 flex items-center justify-center gap-2",children:r?i.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white"}):i.jsxs(i.Fragment,{children:[i.jsx("span",{children:"👨‍💼"}),i.jsx("span",{children:"Entrar como Administrador"})]})}),i.jsx("button",{onClick:o,disabled:r,className:"w-full bg-green-600 text-white p-4 rounded-lg hover:bg-green-700 font-semibold text-lg disabled:opacity-50 flex items-center justify-center gap-2",children:r?i.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white"}):i.jsxs(i.Fragment,{children:[i.jsx("span",{children:"👤"}),i.jsx("span",{children:"Entrar como Cliente"})]})})]}),i.jsx("div",{className:"mt-6 p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:i.jsxs("p",{className:"text-sm text-yellow-800 text-center",children:[i.jsx("strong",{children:"Credenciales de Prueba:"}),i.jsx("br",{}),"Admin: admin@test.com / admin123",i.jsx("br",{}),"Cliente: cliente@test.com / cliente123"]})})]})})}function K2({isOpen:t,onSave:e}){const{addNotification:n}=ke(),[r,s]=V.useState(""),[a,o]=V.useState(""),[c,u]=V.useState(""),d=async m=>{if(m.preventDefault(),r.length<6){u("La contraseña debe tener al menos 6 caracteres.");return}if(r!==a){u("Las contraseñas no coinciden.");return}u("");try{await e(r),n("Contraseña cambiada exitosamente.","success")}catch{n("Error al cambiar la contraseña.","error")}};return t?i.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-70 z-50 flex justify-center items-center p-4",children:i.jsxs("div",{className:"bg-white rounded-lg shadow-2xl p-8 max-w-md w-full",children:[i.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Cambio de Contraseña Requerido"}),i.jsx("p",{className:"text-sm text-gray-600 mb-6",children:"Por seguridad, debes establecer una nueva contraseña para continuar."}),i.jsxs("form",{onSubmit:d,className:"space-y-4",children:[i.jsx("input",{type:"password",value:r,onChange:m=>s(m.target.value),placeholder:"Nueva Contraseña",className:"w-full p-2 border rounded-md",required:!0}),i.jsx("input",{type:"password",value:a,onChange:m=>o(m.target.value),placeholder:"Confirmar Nueva Contraseña",className:"w-full p-2 border rounded-md",required:!0}),c&&i.jsx("p",{className:"text-red-500 text-sm",children:c}),i.jsx("button",{type:"submit",className:"w-full px-4 py-2 bg-blue-600 text-white rounded-md",children:"Guardar Contraseña"})]})]})}):null}function Q2({isOpen:t,onComplete:e,user:n,userProfile:r}){const{addNotification:s}=ke(),[a,o]=V.useState({fullName:(r==null?void 0:r.fullName)||"",identification:(r==null?void 0:r.identification)||"",phone:(r==null?void 0:r.phone)||"",address:(r==null?void 0:r.address)||""}),[c,u]=V.useState(!1);V.useEffect(()=>{const y=new URLSearchParams(window.location.search),g=y.get("uid");y.get("email");const x=y.get("name"),C=y.get("id");g&&g===(n==null?void 0:n.uid)&&(x||C)&&o(E=>({...E,fullName:x?decodeURIComponent(x):E.fullName,identification:C?decodeURIComponent(C):E.identification}))},[n==null?void 0:n.uid]);const d=y=>{const{name:g,value:x}=y.target;o(C=>({...C,[g]:x}))},m=async y=>{if(y.preventDefault(),!a.fullName.trim()){s("El nombre completo es obligatorio","error");return}u(!0);try{const g=ue(te,"artifacts",ee,"public","data","users",n.uid);await qe(g,{fullName:a.fullName.trim(),identification:a.identification.trim(),phone:a.phone.trim(),address:a.address.trim(),isProfileComplete:!0,profileCompletedAt:new Date}),s("Perfil completado exitosamente","success"),e()}catch(g){console.error("Error completing profile:",g),s("Error al completar el perfil","error")}finally{u(!1)}};return t?i.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-70 z-50 flex justify-center items-center p-4",children:i.jsxs("div",{className:"bg-white rounded-lg shadow-2xl p-8 max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[i.jsxs("div",{className:"text-center mb-6",children:[i.jsx("h2",{className:"text-3xl font-bold text-gray-900",children:"Completar Perfil"}),i.jsxs("p",{className:"text-gray-600 mt-2",children:["Bienvenido ",n.email,"! Confirma o actualiza tu información para continuar."]})]}),i.jsxs("form",{onSubmit:m,className:"space-y-4",children:[i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nombre Completo *"}),i.jsx("input",{name:"fullName",value:a.fullName,onChange:d,placeholder:"Tu nombre completo",className:"w-full p-3 border rounded-md focus:ring-2 focus:ring-blue-500",required:!0})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Identificación"}),i.jsx("input",{name:"identification",value:a.identification,onChange:d,placeholder:"Cédula, DNI, etc.",className:"w-full p-3 border rounded-md focus:ring-2 focus:ring-blue-500"})]})]}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Teléfono"}),i.jsx("input",{name:"phone",value:a.phone,onChange:d,placeholder:"+57 300 123 4567",className:"w-full p-3 border rounded-md focus:ring-2 focus:ring-blue-500"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Dirección"}),i.jsx("input",{name:"address",value:a.address,onChange:d,placeholder:"Tu dirección",className:"w-full p-3 border rounded-md focus:ring-2 focus:ring-blue-500"})]})]}),i.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[i.jsx("h4",{className:"font-semibold text-blue-800 mb-2",children:"Información Importante"}),i.jsxs("ul",{className:"text-sm text-blue-700 space-y-1",children:[i.jsx("li",{children:"• Los datos mostrados fueron configurados por el administrador"}),i.jsx("li",{children:"• Puedes confirmar o modificar la información"}),i.jsx("li",{children:"• Esta información se usará para la facturación"}),i.jsx("li",{children:"• Puedes actualizar estos datos más tarde"})]})]}),i.jsx("div",{className:"flex justify-end pt-4",children:i.jsx("button",{type:"submit",disabled:c,className:"px-6 py-3 bg-blue-600 text-white rounded-md hover:bg-blue-700 font-semibold disabled:opacity-50 flex items-center gap-2",children:c?i.jsxs(i.Fragment,{children:[i.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Completando..."]}):"Completar Perfil"})})]})]})}):null}function Y2({onComplete:t}){const{addNotification:e}=ke(),[n,r]=V.useState(1),[s,a]=V.useState({companyName:"",identification:"",address:"",phone:"",email:"",website:""}),[o,c]=V.useState({email:"",password:"",confirmPassword:"",fullName:"",identification:""}),[u,d]=V.useState(!1),m=C=>{const{name:E,value:A}=C.target;a(N=>({...N,[E]:A}))},y=C=>{const{name:E,value:A}=C.target;c(N=>({...N,[E]:A}))},g=C=>{if(C.preventDefault(),!s.companyName){e("El nombre de la empresa es obligatorio","error");return}r(2)},x=async C=>{if(C.preventDefault(),o.password!==o.confirmPassword){e("Las contraseñas no coinciden","error");return}if(o.password.length<6){e("La contraseña debe tener al menos 6 caracteres","error");return}d(!0);try{const E=await Uc(Je,o.email,o.password);await An(ue(te,"artifacts",ee,"public","data","users",E.user.uid),{email:o.email,fullName:o.fullName,identification:o.identification,role:"superadmin",status:"active",isProfileComplete:!0,createdAt:oe.now(),requiresPasswordChange:!1}),await An(ue(te,"artifacts",ee,"public","data","settings","company_info"),{...s,isDemoMode:!1,createdAt:oe.now()}),e("¡Configuración inicial completada exitosamente!","success"),r(3),setTimeout(()=>{t()},2e3)}catch(E){console.error("Error en configuración inicial:",E),e(`Error: ${E.message}`,"error")}finally{d(!1)}};return n===1?i.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-70 z-50 flex justify-center items-center p-4",children:i.jsxs("div",{className:"bg-white rounded-lg shadow-2xl p-8 max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[i.jsxs("div",{className:"text-center mb-6",children:[i.jsx("h2",{className:"text-3xl font-bold text-gray-900",children:"Configuración Inicial"}),i.jsx("p",{className:"text-gray-600 mt-2",children:"Paso 1 de 2: Información de la Empresa"})]}),i.jsxs("form",{onSubmit:g,className:"space-y-4",children:[i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[i.jsx("input",{name:"companyName",value:s.companyName,onChange:m,placeholder:"Nombre de la Empresa *",className:"w-full p-3 border rounded-md focus:ring-2 focus:ring-blue-500",required:!0}),i.jsx("input",{name:"identification",value:s.identification,onChange:m,placeholder:"NIT / Identificación Fiscal",className:"w-full p-3 border rounded-md focus:ring-2 focus:ring-blue-500"})]}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[i.jsx("input",{name:"address",value:s.address,onChange:m,placeholder:"Dirección",className:"w-full p-3 border rounded-md focus:ring-2 focus:ring-blue-500"}),i.jsx("input",{name:"phone",value:s.phone,onChange:m,placeholder:"Teléfono",className:"w-full p-3 border rounded-md focus:ring-2 focus:ring-blue-500"})]}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[i.jsx("input",{name:"email",type:"email",value:s.email,onChange:m,placeholder:"Email de Contacto",className:"w-full p-3 border rounded-md focus:ring-2 focus:ring-blue-500"}),i.jsx("input",{name:"website",value:s.website,onChange:m,placeholder:"Sitio Web",className:"w-full p-3 border rounded-md focus:ring-2 focus:ring-blue-500"})]}),i.jsx("div",{className:"flex justify-end pt-4",children:i.jsx("button",{type:"submit",className:"px-6 py-3 bg-blue-600 text-white rounded-md hover:bg-blue-700 font-semibold",children:"Continuar"})})]})]})}):n===2?i.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-70 z-50 flex justify-center items-center p-4",children:i.jsxs("div",{className:"bg-white rounded-lg shadow-2xl p-8 max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[i.jsxs("div",{className:"text-center mb-6",children:[i.jsx("h2",{className:"text-3xl font-bold text-gray-900",children:"Crear Superadministrador"}),i.jsx("p",{className:"text-gray-600 mt-2",children:"Paso 2 de 2: Cuenta de Administrador Principal"})]}),i.jsxs("form",{onSubmit:x,className:"space-y-4",children:[i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[i.jsx("input",{name:"fullName",value:o.fullName,onChange:y,placeholder:"Nombre Completo *",className:"w-full p-3 border rounded-md focus:ring-2 focus:ring-blue-500",required:!0}),i.jsx("input",{name:"identification",value:o.identification,onChange:y,placeholder:"Identificación",className:"w-full p-3 border rounded-md focus:ring-2 focus:ring-blue-500"})]}),i.jsx("input",{name:"email",type:"email",value:o.email,onChange:y,placeholder:"Email del Administrador *",className:"w-full p-3 border rounded-md focus:ring-2 focus:ring-blue-500",required:!0}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[i.jsx("input",{name:"password",type:"password",value:o.password,onChange:y,placeholder:"Contraseña *",className:"w-full p-3 border rounded-md focus:ring-2 focus:ring-blue-500",required:!0}),i.jsx("input",{name:"confirmPassword",type:"password",value:o.confirmPassword,onChange:y,placeholder:"Confirmar Contraseña *",className:"w-full p-3 border rounded-md focus:ring-2 focus:ring-blue-500",required:!0})]}),i.jsxs("div",{className:"flex justify-between pt-4",children:[i.jsx("button",{type:"button",onClick:()=>r(1),className:"px-6 py-3 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300 font-semibold",children:"Atrás"}),i.jsx("button",{type:"submit",disabled:u,className:"px-6 py-3 bg-blue-600 text-white rounded-md hover:bg-blue-700 font-semibold disabled:opacity-50",children:u?"Creando...":"Completar Configuración"})]})]})]})}):n===3?i.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-70 z-50 flex justify-center items-center p-4",children:i.jsxs("div",{className:"bg-white rounded-lg shadow-2xl p-8 max-w-md w-full text-center",children:[i.jsx("div",{className:"text-green-500 text-6xl mb-4",children:"✅"}),i.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"¡Configuración Completada!"}),i.jsx("p",{className:"text-gray-600 mb-6",children:"El sistema está listo para usar. Serás redirigido al dashboard en unos segundos..."}),i.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"})]})}):null}const X2=async()=>{console.log("🔍 Iniciando diagnóstico de Firebase...");try{console.log("📋 Configuración de Firebase:"),console.log("- App ID:",ee),console.log("- Auth:",Je?"✅ Configurado":"❌ No configurado"),console.log("- Firestore:",te?"✅ Configurado":"❌ No configurado"),console.log(`
👥 Verificando usuarios existentes...`);const t=xe(te,"artifacts",ee,"public","data","users"),e=await In(t);if(e.empty)return console.log("⚠️ No hay usuarios en la base de datos"),{success:!1,message:"No hay usuarios registrados"};const n=e.docs.map(a=>({id:a.id,...a.data()}));console.log("📊 Usuarios encontrados:",n.length),n.forEach(a=>{console.log(`- ${a.email} (${a.role}) - Estado: ${a.status}`)}),console.log(`
🏢 Verificando configuración de empresa...`);const r=ue(te,"artifacts",ee,"public","data","settings","company_info"),s=await ls(r);return s.exists()?(console.log("✅ Configuración de empresa encontrada"),console.log("- Nombre:",s.data().companyName)):console.log("⚠️ No hay configuración de empresa"),{success:!0,users:n,settings:s.exists()?s.data():null}}catch(t){return console.error("❌ Error en diagnóstico:",t),{success:!1,error:t.message}}},Mw=async(t,e,n="client")=>{try{console.log(`🔧 Creando usuario de prueba: ${t}`);const r=await Uc(Je,t,e);return await An(ue(te,"artifacts",ee,"public","data","users",r.user.uid),{email:t,fullName:`Usuario ${n}`,identification:"12345678",role:n,status:"active",isProfileComplete:!0,createdAt:oe.now(),requiresPasswordChange:!1}),console.log("✅ Usuario creado exitosamente"),{success:!0,user:r.user}}catch(r){return console.error("❌ Error creando usuario:",r),{success:!1,error:r.message}}},J2=async(t,e)=>{try{console.log(`🔐 Probando login: ${t}`);const n=await sc(Je,t,e);return console.log("✅ Login exitoso"),await rs(Je),console.log("🚪 Sesión cerrada"),{success:!0,user:n.user}}catch(n){return console.error("❌ Error en login:",n),{success:!1,error:n.message}}},Z2=async()=>{const t=[{email:"admin@test.com",password:"admin123",role:"superadmin"},{email:"cliente@test.com",password:"cliente123",role:"client"}];console.log("🚀 Creando usuarios de prueba por defecto...");for(const e of t){const n=await Mw(e.email,e.password,e.role);n.success?console.log(`✅ ${e.email} creado`):console.log(`❌ Error creando ${e.email}:`,n.error)}},ek=async()=>{try{console.log("🔧 Verificando configuración básica...");const t=ue(te,"artifacts",ee,"public","data","settings","company_info");(await ls(t)).exists()||(console.log("📝 Creando configuración básica de empresa..."),await An(t,{companyName:"Gestor de Cobros",identification:"123.456.789-0",address:"Dirección de Prueba",phone:"+57 300 123 4567",email:"contacto@gestor-cobros.com",website:"www.gestor-cobros.com",isDemoMode:!1,createdAt:oe.now()}),console.log("✅ Configuración de empresa creada"));const n=xe(te,"artifacts",ee,"public","data","users");return(await In(n)).empty&&(console.log("👥 Creando superadmin inicial..."),await Mw("admin@gestor-cobros.com","admin123","superadmin")),console.log("✅ Configuración básica completada"),{success:!0}}catch(t){return console.error("❌ Error en configuración básica:",t),{success:!1,error:t.message}}};function tk(){const[t,e]=V.useState([]),[n,r]=V.useState(!1),s=(g,x="info")=>{e(C=>[...C,{message:g,type:x,timestamp:new Date().toLocaleTimeString()}])},a=()=>e([]),o=async()=>{r(!0),a(),s("🔍 Iniciando diagnóstico de Firebase...","info");try{const g=await X2();g.success?(s("✅ Diagnóstico completado exitosamente","success"),s(`📊 Usuarios encontrados: ${g.users.length}`,"info"),g.users.forEach(x=>{s(`- ${x.email} (${x.role}) - Estado: ${x.status}`,"info")})):s(`❌ Error en diagnóstico: ${g.message}`,"error")}catch(g){s(`❌ Error: ${g.message}`,"error")}finally{r(!1)}},c=async()=>{r(!0),a(),s("🚀 Creando usuarios de prueba...","info");try{await Z2(),s("✅ Usuarios de prueba creados","success")}catch(g){s(`❌ Error: ${g.message}`,"error")}finally{r(!1)}},u=async()=>{r(!0),a(),s("🔧 Configurando sistema básico...","info");try{const g=await ek();g.success?s("✅ Configuración básica completada","success"):s(`❌ Error: ${g.error}`,"error")}catch(g){s(`❌ Error: ${g.message}`,"error")}finally{r(!1)}},d=async()=>{r(!0),a(),s("🔐 Probando login con usuario de prueba...","info");try{const g=await J2("admin@test.com","admin123");g.success?s("✅ Login de prueba exitoso","success"):s(`❌ Error en login: ${g.error}`,"error")}catch(g){s(`❌ Error: ${g.message}`,"error")}finally{r(!1)}},m=async()=>{r(!0),a(),s("🔍 Ejecutando diagnóstico avanzado...","info");try{const g=await Cw();if(g.hasUsers){s(`✅ Usuarios encontrados: ${g.users.length}`,"success"),g.users.forEach((C,E)=>{s(`👤 ${E+1}. ${C.email} (${C.role}) - ${C.status}`,"info")}),g.hasSettings?s("✅ Configuración de empresa encontrada","success"):s("⚠️ No hay configuración de empresa","warning");const x=await h2();x&&s(`👑 Usuario más antiguo: ${x.data.email} (${x.data.role})`,"info")}else s("❌ No hay usuarios en la base de datos","error"),g.error&&s(`Error: ${g.error}`,"error")}catch(g){s(`❌ Error en diagnóstico: ${g.message}`,"error")}finally{r(!1)}},y=g=>{switch(g){case"success":return"text-green-600";case"error":return"text-red-600";case"warning":return"text-yellow-600";default:return"text-blue-600"}};return i.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-70 z-50 flex justify-center items-center p-4",children:i.jsxs("div",{className:"bg-white rounded-lg shadow-2xl p-8 max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:[i.jsx("h2",{className:"text-2xl font-bold mb-6",children:"🔧 Diagnóstico de Firebase"}),i.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4 mb-6",children:[i.jsx("button",{onClick:o,disabled:n,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50",children:"🔍 Diagnóstico"}),i.jsx("button",{onClick:m,disabled:n,className:"px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 disabled:opacity-50",children:"🔬 Avanzado"}),i.jsx("button",{onClick:c,disabled:n,className:"px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 disabled:opacity-50",children:"👥 Crear Usuarios"}),i.jsx("button",{onClick:u,disabled:n,className:"px-4 py-2 bg-purple-600 text-white rounded-md hover:bg-purple-700 disabled:opacity-50",children:"⚙️ Configurar"}),i.jsx("button",{onClick:d,disabled:n,className:"px-4 py-2 bg-orange-600 text-white rounded-md hover:bg-orange-700 disabled:opacity-50",children:"🔐 Probar Login"})]}),i.jsx("div",{className:"mb-4",children:i.jsx("button",{onClick:a,className:"px-4 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300",children:"🗑️ Limpiar"})}),i.jsxs("div",{className:"bg-gray-100 rounded-lg p-4 max-h-96 overflow-y-auto",children:[i.jsx("h3",{className:"font-semibold mb-2",children:"Resultados:"}),t.length===0?i.jsx("p",{className:"text-gray-500",children:"No hay resultados aún. Ejecuta un diagnóstico."}):i.jsx("div",{className:"space-y-1",children:t.map((g,x)=>i.jsxs("div",{className:"flex items-start gap-2",children:[i.jsx("span",{className:"text-xs text-gray-400",children:g.timestamp}),i.jsx("span",{className:`text-sm ${y(g.type)}`,children:g.message})]},x))})]}),i.jsxs("div",{className:"mt-6 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[i.jsx("h4",{className:"font-semibold text-blue-800 mb-2",children:"Credenciales de Prueba:"}),i.jsxs("div",{className:"text-sm text-blue-700 space-y-1",children:[i.jsxs("p",{children:[i.jsx("strong",{children:"Admin:"})," admin@test.com / admin123"]}),i.jsxs("p",{children:[i.jsx("strong",{children:"Cliente:"})," cliente@test.com / cliente123"]})]})]}),i.jsx("div",{className:"mt-4 flex justify-end",children:i.jsx("button",{onClick:()=>window.location.reload(),className:"px-6 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700",children:"🔄 Recargar Página"})})]})})}function nk(){const{addNotification:t}=ke(),[e,n]=V.useState(null),[r,s]=V.useState(null),[a,o]=V.useState(!0),[c,u]=V.useState(()=>localStorage.getItem("isDemoMode")==="true"),[d,m]=V.useState({companyName:"Gestor de Cobros"}),[y,g]=V.useState(!1),[x,C]=V.useState(!1),[E,A]=V.useState(!1);V.useEffect(()=>{localStorage.setItem("isDemoMode",c.toString())},[c]);const N=async()=>{try{console.log("🔍 Verificando si el sistema está configurado...");try{if((await Cw()).hasUsers)return console.log("✅ Usuarios encontrados en Firestore"),!0}catch(b){console.warn("⚠️ Error accediendo a Firestore:",b.message)}return await m2()?(console.log("✅ Usuarios encontrados en Authentication"),!0):(console.log("⚠️ Asumiendo que el sistema está configurado (hay errores de permisos)"),!0)}catch(I){return console.error("❌ Error verificando configuración:",I),!0}};V.useEffect(()=>{(async()=>{try{console.log("🔧 Iniciando verificación de configuración..."),console.log("🏢 Verificando configuración de empresa...");const b=ue(te,"artifacts",ee,"public","data","settings","company_info"),_=await ls(b);if(_.exists()){console.log("✅ Configuración de empresa encontrada");const D=_.data();console.log("📋 Configuración:",D),m(D),u(D.isDemoMode||!1),C(!0),g(!1),console.log("✅ Sistema configurado con configuración existente");return}console.log("👥 No hay configuración, verificando si hay usuarios..."),await N()?(console.log("✅ Sistema ya configurado, saltando setup inicial"),m({companyName:"Gestor de Cobros",isDemoMode:!1}),C(!0),g(!1)):(console.log("❌ Sistema no configurado, mostrando setup inicial"),g(!0))}catch(b){console.error("❌ Error checking configuration:",b),console.log("⚠️ Error en verificación, asumiendo que el sistema está configurado"),m({companyName:"Gestor de Cobros",isDemoMode:!1}),C(!0),g(!1)}})()},[]),V.useEffect(()=>{if(!x)return;if(c){n({email:"superadmin@demo.com",uid:"demouser"}),s({role:"superadmin"}),o(!1);return}const I=gS(Je,b=>{if(b){const _=ue(te,"artifacts",ee,"public","data","users",b.uid),$=Ee(_,async D=>{if(D.exists()){const F=D.data();F.status==="active"||F.role==="superadmin"?(s(F),n(b)):(console.warn("Usuario inactivo o sin permisos:",F),t("Tu cuenta no está activa. Contacta al administrador.","error"),rs(Je))}else console.warn("No se encontró el perfil de usuario en la base de datos"),console.log("Usuario no tiene perfil en Firestore, cerrando sesión..."),t("Usuario no encontrado en el sistema. Contacta al administrador.","error"),rs(Je);o(!1)},D=>{console.error("Error fetching user data:",D),b&&t("Error al cargar el perfil de usuario. Intenta nuevamente.","error"),o(!1)});return()=>$()}else n(null),s(null),o(!1)});return()=>{I()}},[x,c]);const T=async I=>{const b=Je.currentUser;if(b)try{await hS(b,I);const _=ue(te,"artifacts",ee,"public","data","users",b.uid);await qe(_,{requiresPasswordChange:!1})}catch(_){console.error("Error updating password:",_),t("Hubo un error al cambiar la contraseña.","error"),rs(Je)}},k=()=>{c?(n(null),s(null)):rs(Je)},L=(I,b)=>{n(I),s({role:b,status:"active"})},q=()=>{g(!1),C(!0),window.location.reload()};if(y)return i.jsx(Y2,{onComplete:q});if(E)return i.jsx(tk,{onClose:()=>A(!1)});if(a)return i.jsx("div",{className:"flex items-center justify-center min-h-screen",children:"Cargando..."});const z=c?{email:"superadmin@demo.com",uid:"demouser"}:e,j=c?"superadmin":r==null?void 0:r.role;if(r!=null&&r.requiresPasswordChange&&!c)return i.jsx(K2,{isOpen:!0,onSave:T});const S=new URLSearchParams(window.location.search).get("uid"),p=S&&S===(e==null?void 0:e.uid);return(r==null?void 0:r.role)==="client"&&!c&&(!(r!=null&&r.isProfileComplete)&&(r==null?void 0:r.requiresPasswordChange)===!1||p)?i.jsx(Q2,{isOpen:!0,onComplete:()=>{s(I=>({...I,isProfileComplete:!0})),p&&window.history.replaceState({},document.title,window.location.pathname)},user:e,userProfile:r}):i.jsx("div",{className:"bg-gray-50 min-h-screen font-sans text-gray-800",children:z?i.jsxs(i.Fragment,{children:[i.jsx("header",{className:"bg-white shadow-md",children:i.jsxs("div",{className:"container mx-auto px-4 sm:px-6 lg:px-8 py-4 flex justify-between items-center",children:[d.logoUrl?i.jsx("img",{src:d.logoUrl,alt:d.companyName,className:"max-h-10"}):i.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-gray-900",children:d.companyName}),i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsx("span",{className:"text-sm text-gray-600 hidden sm:block",children:z.email}),i.jsx("button",{onClick:k,className:"text-gray-500 hover:text-red-600",children:i.jsx(g2,{})})]})]})}),c&&i.jsx("div",{className:"bg-yellow-400 text-center p-2 text-sm font-semibold",children:"MODO DE PRUEBA ACTIVO"}),j==="superadmin"||j==="admin"?i.jsx(V2,{user:z,isDemo:c,setIsDemoMode:u,userRole:j,companySettings:d,onLogout:k}):i.jsx(H2,{user:z,isDemo:c,userProfile:r})]}):i.jsxs("div",{className:"flex flex-col min-h-screen",children:[c&&i.jsx("div",{className:"bg-yellow-400 text-center p-3 text-sm font-semibold",children:"🟡 MODO DEMO ACTIVO - Usa los botones de prueba para acceder"}),i.jsx("div",{className:"flex-grow",children:c?i.jsx(W2,{companySettings:d,onLogin:L}):i.jsx(G2,{companySettings:d})}),(d.isDemoMode||d.allowDemoMode)&&i.jsxs("div",{className:"fixed bottom-4 right-4 flex flex-col gap-2",children:[i.jsx("button",{onClick:()=>u(!c),className:`px-4 py-2 rounded-lg shadow-lg text-sm font-medium transition-colors ${c?"bg-green-600 text-white hover:bg-green-700":"bg-yellow-600 text-white hover:bg-yellow-700"}`,title:c?"Cambiar a modo Live":"Cambiar a modo Demo",children:c?"🟢 Live":"🟡 Demo"}),i.jsx("button",{onClick:()=>A(!0),className:"px-4 py-2 bg-red-600 text-white rounded-lg shadow-lg hover:bg-red-700 text-sm",title:"Diagnóstico de Firebase",children:"🔧 Debug"})]})]})})}function rk(){return i.jsx(p2,{children:i.jsx(nk,{})})}md.createRoot(document.getElementById("root")).render(i.jsx(T_.StrictMode,{children:i.jsx(rk,{})}));
