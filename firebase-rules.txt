// Reglas de Firestore para Gestor de Cobros
// Copia estas reglas en la consola de Firebase > Firestore > Rules

rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // Reglas más permisivas para desarrollo
    match /artifacts/{appId}/public/data/{collection}/{document} {
      // Permitir lectura y escritura para usuarios autenticados
      allow read, write: if request.auth != null;
    }
    
    // Reglas específicas para usuarios
    match /artifacts/{appId}/public/data/users/{userId} {
      // Permitir lectura y escritura si el usuario está autenticado
      allow read, write: if request.auth != null;
    }
    
    // Reglas para servicios
    match /artifacts/{appId}/public/data/services/{serviceId} {
      allow read, write: if request.auth != null;
    }
    
    // Reglas para configuración
    // Permitir lectura pública de email_config (para usuarios no autenticados que necesitan restablecer contraseña)
    // Otras configuraciones y escritura requieren autenticación
    match /artifacts/{appId}/public/data/settings/{settingId} {
      // Permitir lectura pública solo de email_config
      allow read: if settingId == 'email_config' || request.auth != null;
      allow write: if request.auth != null; // Escritura solo para autenticados
    }
    
    // Reglas para plantillas
    // Permitir lectura pública (para usuarios no autenticados que necesitan restablecer contraseña)
    // Solo escritura requiere autenticación
    match /artifacts/{appId}/public/data/messageTemplates/{templateId} {
      allow read: if true; // Lectura pública para plantillas
      allow write: if request.auth != null; // Escritura solo para autenticados
    }
    
    // Reglas para historial
    match /artifacts/{appId}/public/data/messageHistory/{messageId} {
      allow read, write: if request.auth != null;
    }
  }
}
